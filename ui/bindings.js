const _0x27224b=_0x3a82;(function(_0x228a9d,_0x5386f8){const _0x4f6b95=_0x3a82,_0x235616=_0x228a9d();while(!![]){try{const _0x4033db=parseInt(_0x4f6b95(0x118))/0x1+parseInt(_0x4f6b95(0x15c))/0x2+-parseInt(_0x4f6b95(0xd0))/0x3*(parseInt(_0x4f6b95(0x16d))/0x4)+-parseInt(_0x4f6b95(0x174))/0x5*(parseInt(_0x4f6b95(0x113))/0x6)+parseInt(_0x4f6b95(0x158))/0x7*(parseInt(_0x4f6b95(0x169))/0x8)+parseInt(_0x4f6b95(0x127))/0x9*(-parseInt(_0x4f6b95(0xcc))/0xa)+parseInt(_0x4f6b95(0x14a))/0xb;if(_0x4033db===_0x5386f8)break;else _0x235616['push'](_0x235616['shift']());}catch(_0x57313a){_0x235616['push'](_0x235616['shift']());}}}(_0x42e8,0x1d8a7));import{extension_settings}from'/scripts/extensions.js';import{saveSettingsDebounced}from'/script.js';import{defaultSettings,extensionName}from'../utils/settings.js';import{pluginAuthStatus,activatePluginAuthorization,getPasswordForDate}from'../utils/auth.js';import{fetchSupportedModels}from'../core/api.js';import{setAvailableModels,populateModelDropdown,getLatestUpdateInfo}from'./state.js';import{fixCommand,testReplyChecker}from'../core/commands.js';import{createDrawer}from'../ui/drawer.js';import{messageFormatting}from'/script.js';import{executeManualCommand}from'../core/autoHideManager.js';import{showContentModal,showHtmlModal}from'./page-window.js';function displayDailyAuthCode(){const _0x313d83=_0x3a82,_0x5c0093=document[_0x313d83(0x13f)]('amily2_daily_code_display'),_0x30e001=document[_0x313d83(0x13f)]('amily2_copy_daily_code');if(_0x5c0093&&_0x30e001){const _0x4e385d=getPasswordForDate(new Date());_0x5c0093['textContent']=_0x4e385d,_0x30e001[_0x313d83(0x146)]('click',()=>{const _0x6682b8=_0x313d83;navigator[_0x6682b8(0xfb)][_0x6682b8(0xf9)](_0x4e385d)[_0x6682b8(0x154)](()=>{const _0x9e4680=_0x6682b8;toastr['success'](_0x9e4680(0xe2));},()=>{const _0x119c35=_0x6682b8;toastr[_0x119c35(0x143)]('复制失败，请手动复制。');});});}}export function bindModalEvents(){const _0x1e7429=_0x3a82,_0xc84ba8=$(_0x1e7429(0x14b))['length']?$(_0x1e7429(0x14b)):$(_0x1e7429(0x152));displayDailyAuthCode();function _0x2bda4e(){const _0xe4c4d0=_0x1e7429,_0x19d6bf=extension_settings[extensionName]||{},_0x1f4fee=_0x19d6bf[_0xe4c4d0(0x126)]===!![],_0x537f34=_0x19d6bf[_0xe4c4d0(0xe0)]||'';_0xc84ba8[_0xe4c4d0(0x171)](_0xe4c4d0(0x133))['prop'](_0xe4c4d0(0x16a),_0x1f4fee),_0xc84ba8[_0xe4c4d0(0x171)](_0xe4c4d0(0x130))[_0xe4c4d0(0x16b)](_0x537f34);const _0x33117e=_0xc84ba8['find']('#amily2_model_autofetch_wrapper'),_0x947601=_0xc84ba8[_0xe4c4d0(0x171)](_0xe4c4d0(0x130));_0x1f4fee?(_0x33117e['hide'](),_0x947601[_0xe4c4d0(0x123)]()):(_0x33117e[_0xe4c4d0(0x123)](),_0x947601[_0xe4c4d0(0xe6)]());}if(!_0xc84ba8[_0x1e7429(0x167)]||_0xc84ba8[_0x1e7429(0xd8)](_0x1e7429(0x115)))return;const _0x53b181=_0x114c98=>_0x114c98[_0x1e7429(0xe3)](/_([a-z])/g,_0x377a97=>_0x377a97[0x1][_0x1e7429(0xde)]()),_0x462b3b=(_0x4171f7,_0x38c017)=>{const _0x519759=_0x1e7429;console[_0x519759(0x110)](_0x519759(0x16e)+_0x4171f7+_0x519759(0x10c),_0x38c017),!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName]={...extension_settings[extensionName],[_0x4171f7]:_0x38c017},saveSettingsDebounced(),console['log'](_0x519759(0x144)+_0x4171f7+_0x519759(0x103));};_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0xd6))['on'](_0x1e7429(0xd6),_0x1e7429(0x133),function(){const _0x202a94=_0x1e7429;if(!pluginAuthStatus[_0x202a94(0x173)])return;_0x462b3b(_0x202a94(0x126),this[_0x202a94(0x16a)]),_0x2bda4e();}),_0xc84ba8['off'](_0x1e7429(0xd4))['on'](_0x1e7429(0xd4),'#amily2_manual_model_input',function(){const _0x23a1be=_0x1e7429;if(!pluginAuthStatus[_0x23a1be(0x173)])return;_0x462b3b('model',this['value']),toastr[_0x23a1be(0x11a)](_0x23a1be(0x100)+this['value']+_0x23a1be(0xfa),_0x23a1be(0x106));}),_0xc84ba8[_0x1e7429(0x156)]('click.amily2.auth')['on'](_0x1e7429(0xdc),_0x1e7429(0xdf),async function(){const _0x2df2ec=_0x1e7429,_0x18eb6c=$(_0x2df2ec(0x145))[_0x2df2ec(0x16b)]()['trim']();_0x18eb6c?await activatePluginAuthorization(_0x18eb6c):toastr[_0x2df2ec(0x166)](_0x2df2ec(0xf2),_0x2df2ec(0x106));}),_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0xc4))['on'](_0x1e7429(0xc4),_0x1e7429(0x134),async function(){const _0xcb1fa6=_0x1e7429;if(!pluginAuthStatus['authorized'])return;const _0x28f869=$(this),_0x862b61=_0x28f869[_0xcb1fa6(0xc5)]();_0x28f869[_0xcb1fa6(0x121)](_0xcb1fa6(0x14f),!![])[_0xcb1fa6(0xc5)](_0xcb1fa6(0x111));try{switch(this['id']){case _0xcb1fa6(0x16c):const _0x653edb=await fetchSupportedModels();_0x653edb[_0xcb1fa6(0x167)]>0x0&&(setAvailableModels(_0x653edb),localStorage[_0xcb1fa6(0x116)]('cached_models_amily2',JSON[_0xcb1fa6(0xd2)](_0x653edb)),populateModelDropdown());break;case _0xcb1fa6(0x15b):await testReplyChecker();break;case'amily2_fix_now':await fixCommand();break;}}catch(_0x33b1ce){console[_0xcb1fa6(0x143)](_0xcb1fa6(0x10f)+this['id']+_0xcb1fa6(0x13d),_0x33b1ce),toastr[_0xcb1fa6(0x143)]('操作失败:\x20'+_0x33b1ce[_0xcb1fa6(0x14e)],_0xcb1fa6(0x106));}finally{_0x28f869[_0xcb1fa6(0x121)](_0xcb1fa6(0x14f),![])[_0xcb1fa6(0xc5)](_0x862b61);}}),_0xc84ba8[_0x1e7429(0x156)]('click.amily2.expand_editor')['on']('click.amily2.expand_editor',_0x1e7429(0x178),function(_0x243bea){const _0x3ddb46=_0x1e7429;if(!pluginAuthStatus[_0x3ddb46(0x173)])return;_0x243bea['stopPropagation']();const _0x226692=$(_0x3ddb46(0x102))['val'](),_0x1f1378=$(_0x3ddb46(0x12a))[_0x3ddb46(0x16b)](),_0x190966=_0x3ddb46(0x14d)+_0x226692+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20id=\x22amily2_dialog_editor\x22\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x596c50=$(_0x190966)[_0x3ddb46(0xfc)](_0x3ddb46(0x150)),_0x442a01=_0x596c50['find']('#amily2_dialog_editor');_0x442a01[_0x3ddb46(0x16b)](_0x1f1378);const _0x3da40b=()=>{const _0x94798a=_0x3ddb46;_0x596c50[0x0][_0x94798a(0x101)](),_0x596c50[_0x94798a(0xda)]();};_0x596c50['find']('.popup-button-ok')['on'](_0x3ddb46(0x11e),()=>{const _0x1e581c=_0x3ddb46,_0x2ba936=_0x442a01['val']();$('#amily2_unified_editor')[_0x1e581c(0x16b)](_0x2ba936),_0x462b3b(_0x226692,_0x2ba936),toastr[_0x1e581c(0x11a)](_0x1e581c(0x163)+_0x226692+_0x1e581c(0xea),_0x1e581c(0x106)),_0x3da40b();}),_0x596c50[_0x3ddb46(0x171)](_0x3ddb46(0x108))['on'](_0x3ddb46(0x11e),_0x3da40b),_0x596c50[0x0]['showModal']();}),_0xc84ba8[_0x1e7429(0x156)]('click.amily2.tutorial')['on'](_0x1e7429(0xc8),_0x1e7429(0x107),function(){const _0x23912b=_0x1e7429;if(!pluginAuthStatus[_0x23912b(0x173)])return;const _0xcf43a2={'amily2_open_tutorial':{'title':'主殿使用教程','url':_0x23912b(0x151)},'amily2_open_neige_tutorial':{'title':_0x23912b(0x160),'url':'scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/NeiGe.md'}},_0x1fb9c7=_0xcf43a2[this['id']];_0x1fb9c7&&showContentModal(_0x1fb9c7[_0x23912b(0xeb)],_0x1fb9c7['url']);}),_0xc84ba8['off'](_0x1e7429(0xf8))['on']('click.amily2.update',_0x1e7429(0xc9),function(){const _0x3e4e28=_0x1e7429;$(_0x3e4e28(0x170))['hide']();const _0x1593ec=getLatestUpdateInfo();if(_0x1593ec&&_0x1593ec[_0x3e4e28(0x153)]){const _0x58a209=messageFormatting(_0x1593ec[_0x3e4e28(0x153)]),_0x1479cc=_0x3e4e28(0x137)+_0x58a209+_0x3e4e28(0x117),_0x43e764=$(_0x1479cc)[_0x3e4e28(0xfc)](_0x3e4e28(0x150)),_0x211786=()=>{const _0x691aea=_0x3e4e28;_0x43e764[0x0][_0x691aea(0x101)](),_0x43e764[_0x691aea(0xda)]();};_0x43e764['find'](_0x3e4e28(0x135))['on'](_0x3e4e28(0x11e),_0x211786),_0x43e764[0x0][_0x3e4e28(0x12c)]();}else toastr[_0x3e4e28(0x138)](_0x3e4e28(0x159),_0x3e4e28(0x13c));}),_0xc84ba8[_0x1e7429(0x156)]('click.amily2.manual_command')['on']('click.amily2.manual_command',_0x1e7429(0x11f),async function(){const _0x55cc9f=_0x1e7429;if(!pluginAuthStatus[_0x55cc9f(0x173)])return;const _0x345fde=this['id'];let _0xaa24f6='',_0x2a511d={};switch(_0x345fde){case _0x55cc9f(0xd5):_0xaa24f6=_0x55cc9f(0xf3);break;case _0x55cc9f(0x10a):_0xaa24f6=_0x55cc9f(0xff),_0x2a511d={'from':$(_0x55cc9f(0x129))[_0x55cc9f(0x16b)](),'to':$(_0x55cc9f(0xe7))[_0x55cc9f(0x16b)]()};break;case _0x55cc9f(0x13a):_0xaa24f6=_0x55cc9f(0x132),_0x2a511d={'from':$('#amily2_manual_unhide_from')[_0x55cc9f(0x16b)](),'to':$(_0x55cc9f(0xf7))[_0x55cc9f(0x16b)]()};break;}_0xaa24f6&&await executeManualCommand(_0xaa24f6,_0x2a511d);}),_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0x161))['on']('click.amily2.chamber_nav',_0x1e7429(0x165),function(){const _0x110a28=_0x1e7429;if(!pluginAuthStatus[_0x110a28(0x173)])return;const _0x3d0be2=_0xc84ba8[_0x110a28(0x171)](_0x110a28(0x140)),_0x3b4826=_0xc84ba8[_0x110a28(0x171)](_0x110a28(0x128)),_0x51abe3=_0xc84ba8['find'](_0x110a28(0x131));_0x3d0be2['hide'](),_0x3b4826[_0x110a28(0xe6)](),_0x51abe3[_0x110a28(0xe6)]();switch(this['id']){case'amily2_open_additional_features':_0x3b4826[_0x110a28(0x123)]();break;case _0x110a28(0x15f):_0x51abe3[_0x110a28(0x123)]();break;case'amily2_back_to_main_settings':case'amily2_back_to_main_from_hanlinyuan':_0x3d0be2[_0x110a28(0x123)]();break;}}),_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0xce))['on']('change.amily2.checkbox',_0x1e7429(0x139),function(_0x10388a){const _0x268470=_0x1e7429;if(!pluginAuthStatus[_0x268470(0x173)])return;const _0x5552f3=this['id'],_0x2edbb6=$(this),_0x208587=_0x53b181(_0x5552f3[_0x268470(0xe3)]('amily2_',''));_0x462b3b(_0x208587,_0x2edbb6[_0x268470(0x121)](_0x268470(0x16a)));if(_0x5552f3===_0x268470(0x112)&&_0x2edbb6[_0x268470(0x121)](_0x268470(0x16a))){const _0x2398ee=extension_settings[extensionName],_0x6d43e1=_0x2398ee[_0x268470(0xd3)]||[],_0x1c42ea=(_0x4c8cd7={'start':'','end':''},_0x18764a)=>_0x268470(0x172)+_0x18764a+_0x268470(0xfe)+_0x4c8cd7[_0x268470(0x176)]+_0x268470(0x16f)+_0x4c8cd7['end']+_0x268470(0x13e),_0x52ac6b=_0x6d43e1['map'](_0x1c42ea)[_0x268470(0x12d)](''),_0x165a16='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22notes\x22>在这里定义需要从优化内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-rules-list\x22\x20style=\x22max-height:\x2045vh;\x20overflow-y:\x20auto;\x20padding:\x2010px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.1);\x20border-radius:\x205px;\x20margin-bottom:10px;\x22>'+_0x52ac6b+_0x268470(0xf5);showHtmlModal(_0x268470(0x136),_0x165a16,{'okText':'确认','cancelText':'取消','onOk':_0x52bd45=>{const _0x5433c5=_0x268470,_0xff4fcd=[];_0x52bd45[_0x5433c5(0x171)](_0x5433c5(0x162))[_0x5433c5(0xfd)](function(){const _0x12fd89=_0x5433c5,_0x263c52=$(this)[_0x12fd89(0x171)](_0x12fd89(0xed))['eq'](0x0)[_0x12fd89(0x16b)]()['trim'](),_0x5e0869=$(this)[_0x12fd89(0x171)](_0x12fd89(0xed))['eq'](0x1)[_0x12fd89(0x16b)]()['trim']();if(_0x263c52&&_0x5e0869)_0xff4fcd['push']({'start':_0x263c52,'end':_0x5e0869});}),_0x462b3b(_0x5433c5(0xd3),_0xff4fcd),toastr[_0x5433c5(0x11a)](_0x5433c5(0xec),_0x5433c5(0x106));},'onCancel':()=>{}});const _0x50746c=$(_0x268470(0x11c)),_0x4cb01d=_0x50746c[_0x268470(0x171)](_0x268470(0x157));_0x50746c['find']('#optimization-add-rule-btn')['on'](_0x268470(0x11e),()=>{const _0x1b3d46=_0x268470,_0x4cd249=_0x4cb01d[_0x1b3d46(0xd7)]()[_0x1b3d46(0x167)];_0x4cb01d['append'](_0x1c42ea(undefined,_0x4cd249));}),_0x4cb01d['on'](_0x268470(0x11e),_0x268470(0x10b),function(){const _0x533c8e=_0x268470;$(this)[_0x533c8e(0x14c)](_0x533c8e(0x162))[_0x533c8e(0xda)]();});}}),_0xc84ba8['off'](_0x1e7429(0xd9))['on'](_0x1e7429(0xd9),'input[type=\x22radio\x22][name^=\x22amily2_\x22]:not([name=\x22amily2_icon_location\x22])',function(){const _0x451470=_0x1e7429;if(!pluginAuthStatus[_0x451470(0x173)])return;const _0x5ba557=_0x53b181(this[_0x451470(0x12b)]['replace'](_0x451470(0x13b),'')),_0x3fea89=$(_0x451470(0xf1)+this[_0x451470(0x12b)]+_0x451470(0xca))[_0x451470(0x16b)]();_0x462b3b(_0x5ba557,_0x3fea89);}),_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0xc6))['on'](_0x1e7429(0xc6),_0x1e7429(0x105),function(){const _0x324887=_0x1e7429;if(!pluginAuthStatus[_0x324887(0x173)])return;const _0x5815a7=_0x53b181(this['id']['replace'](_0x324887(0x13b),''));_0x462b3b(_0x5815a7,this[_0x324887(0x175)]),toastr[_0x324887(0x11a)](_0x324887(0xf6)+_0x5815a7+_0x324887(0xfa),'Amily2号');}),_0xc84ba8[_0x1e7429(0x156)]('change.amily2.select')['on']('change.amily2.select',_0x1e7429(0xdb),function(){const _0x33183d=_0x1e7429;if(!pluginAuthStatus[_0x33183d(0x173)])return;const _0xd89a66=_0x53b181(this['id'][_0x33183d(0xe3)](_0x33183d(0x13b),''));_0x462b3b(_0xd89a66,this[_0x33183d(0x175)]),populateModelDropdown();}),_0xc84ba8['off'](_0x1e7429(0x15d))['on'](_0x1e7429(0x15d),_0x1e7429(0x11d),function(){const _0x280012=_0x1e7429;if(!pluginAuthStatus[_0x280012(0x173)])return;const _0x507d5b=_0x53b181(this['id'][_0x280012(0xe3)]('amily2_','')),_0x534818=this['id'][_0x280012(0x148)](_0x280012(0xe5))?parseFloat(this[_0x280012(0x175)]):parseInt(this[_0x280012(0x175)],0xa);$('#'+this['id']+'_value')['text'](_0x534818),_0x462b3b(_0x507d5b,_0x534818);});const _0x4fc795={'mainPrompt':_0x1e7429(0x15e),'systemPrompt':_0x1e7429(0x109),'outputFormatPrompt':_0x1e7429(0x147)},_0x32d9e8=_0x1e7429(0x102),_0x5f4ae0='#amily2_unified_editor',_0x3e8f2a=_0x1e7429(0x12e);function _0x150f85(){const _0x31920d=_0x1e7429;if(!$(_0x32d9e8)[_0x31920d(0x167)])return;const _0x2594e3=$(_0x32d9e8)[_0x31920d(0x16b)]();if(!_0x2594e3)return;const _0x290de4=extension_settings[extensionName][_0x2594e3]||'';$(_0x5f4ae0)[_0x31920d(0x16b)](_0x290de4);}_0xc84ba8[_0x1e7429(0x156)]('change.amily2.prompt_selector')['on'](_0x1e7429(0x12f),_0x32d9e8,_0x150f85),_0xc84ba8[_0x1e7429(0x156)](_0x1e7429(0x125))['on'](_0x1e7429(0x125),_0x3e8f2a,function(){const _0x57175d=_0x1e7429,_0x11fbc4=$(_0x32d9e8)[_0x57175d(0x16b)]();if(!_0x11fbc4)return;const _0x491cec=$(_0x5f4ae0)['val']();_0x462b3b(_0x11fbc4,_0x491cec),toastr[_0x57175d(0x11a)](_0x57175d(0x163)+_0x11fbc4+_0x57175d(0xe4),'Amily2号');}),_0xc84ba8['off'](_0x1e7429(0x168))['on'](_0x1e7429(0x168),'#amily2_unified_restore_button',function(){const _0x5c91ba=_0x1e7429,_0x5e0fb0=$(_0x32d9e8)[_0x5c91ba(0x16b)]();if(!_0x5e0fb0)return;const _0x12b880=defaultSettings[_0x5e0fb0];$(_0x5f4ae0)[_0x5c91ba(0x16b)](_0x12b880),_0x462b3b(_0x5e0fb0,_0x12b880),toastr['success'](_0x5c91ba(0x163)+_0x5e0fb0+_0x5c91ba(0xee),'Amily2号');}),_0xc84ba8['off'](_0x1e7429(0x149))['on']('change.amily2.lore_settings',_0x1e7429(0x10e),function(){const _0x4f0433=_0x1e7429;if(!pluginAuthStatus['authorized'])return;let _0x259f43=_0x53b181(this['id']['replace'](_0x4f0433(0x13b),''));_0x259f43===_0x4f0433(0x122)&&(_0x259f43=_0x4f0433(0xcf));const _0x23e5a3=this[_0x4f0433(0x164)]==='number'?parseInt(this[_0x4f0433(0x175)],0xa):this[_0x4f0433(0x175)];_0x462b3b(_0x259f43,_0x23e5a3);if(this['id']===_0x4f0433(0x141)){const _0x4dfca7=$(_0x4f0433(0xef));this[_0x4f0433(0x175)]===_0x4f0433(0xe1)?_0x4dfca7[_0x4f0433(0x120)](0xc8):_0x4dfca7[_0x4f0433(0x119)](0xc8);}}),_0xc84ba8['off'](_0x1e7429(0x142))['on']('click.amily2.lore_save',_0x1e7429(0x15a),function(){const _0x20345c=_0x1e7429;if(!pluginAuthStatus['authorized'])return;const _0x2f53ca=$(this),_0xd586dc=$(_0x20345c(0xc7));_0x2f53ca[_0x20345c(0x121)](_0x20345c(0x14f),!![])[_0x20345c(0xc5)](_0x20345c(0x124)),_0xd586dc[_0x20345c(0xcb)](_0x20345c(0xf0))[_0x20345c(0xe9)]()[_0x20345c(0xdd)](),setTimeout(()=>{const _0x3214d1=_0x20345c;_0x2f53ca['prop'](_0x3214d1(0x14f),![])[_0x3214d1(0xc5)]('<i\x20class=\x22fas\x20fa-save\x22></i>\x20确认敕令'),_0xd586dc['fadeOut']();},0x9c4);}),setTimeout(_0x150f85,0x64),_0x2bda4e(),_0xc84ba8[_0x1e7429(0xd8)](_0x1e7429(0x115),!![]);}$(document)['on'](_0x27224b(0xcd),_0x27224b(0x177),function(){const _0x1cc0d9=_0x27224b;if(!pluginAuthStatus[_0x1cc0d9(0x173)])return;const _0x99c749=$(this)[_0x1cc0d9(0x16b)]();extension_settings[extensionName][_0x1cc0d9(0x11b)]=_0x99c749,saveSettingsDebounced(),console[_0x1cc0d9(0x110)](_0x1cc0d9(0x114)+_0x99c749+_0x1cc0d9(0xe8)),toastr[_0x1cc0d9(0x138)](_0x1cc0d9(0x155)+(_0x99c749===_0x1cc0d9(0xd1)?'顶栏':_0x1cc0d9(0x10d))+']...','迁都令',{'timeOut':0x7d0}),$('#amily2_main_drawer')[_0x1cc0d9(0xda)](),$(document)['off'](_0x1cc0d9(0x104)),$(_0x1cc0d9(0xf4))[_0x1cc0d9(0xda)](),setTimeout(createDrawer,0x32);});function _0x3a82(_0x4c7130,_0x2d12e0){const _0x42e86f=_0x42e8();return _0x3a82=function(_0x3a8279,_0x35bcb6){_0x3a8279=_0x3a8279-0xc4;let _0x119409=_0x42e86f[_0x3a8279];return _0x119409;},_0x3a82(_0x4c7130,_0x2d12e0);}function _0x42e8(){const _0x265122=['#amily2_extension_frame','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22optimization-add-rule-btn\x22\x20class=\x22menu_button\x20amily2-add-rule-btn\x22><i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','配置\x20[','#amily2_manual_unhide_to','click.amily2.update','writeText',']\x20已自动保存!','clipboard','appendTo','each','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','manual_hide','模型ID\x20[','close','#amily2_prompt_selector',']\x20的新状态已保存。','mousedown.amily2Drawer','#amily2_api_url,\x20#amily2_api_key,\x20#amily2_optimization_target_tag','Amily2号','#amily2_open_tutorial,\x20#amily2_open_neige_tutorial','.popup-button-cancel','#amily2_system_prompt','amily2_manual_hide_confirm','.delete-rule-btn',']\x20设置为\x20->','扩展区','select[id^=\x22amily2_lore_\x22],\x20input#amily2_lore_depth_input','[Amily2-工部]\x20操作按钮\x20','log','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20处理中','amily2_optimization_exclusion_enabled','6KMHTKM','[Amily-禁卫军]\x20收到迁都指令\x20->\x20','events-bound','setItem','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>朕已阅</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','23426FcKdiX','slideUp','success','iconLocation','#optimization-exclusion-rules-container','input[type=\x22range\x22][id^=\x22amily2_\x22]','click','#amily2_unhide_all_button,\x20#amily2_manual_hide_confirm,\x20#amily2_manual_unhide_confirm','slideDown','prop','loreDepthInput','show','<i\x20class=\x22fas\x20fa-check\x22></i>\x20已确认','click.amily2.unified_save','forceProxyForCustomApi','211563xbHoJE','#amily2_additional_features_panel','#amily2_manual_hide_from','#amily2_unified_editor','name','showModal','join','#amily2_unified_save_button','change.amily2.prompt_selector','#amily2_manual_model_input','#amily2_hanlinyuan_panel','manual_unhide','#amily2_force_proxy','#amily2_refresh_models,\x20#amily2_test,\x20#amily2_fix_now','.popup-button-ok','编辑内容排除规则','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22><i\x20class=\x22fas\x20fa-bell\x22\x20style=\x22color:\x20#ff9800;\x22></i>\x20帝国最新情报</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2060vh;\x20overflow-y:\x20auto;\x20background:\x20rgba(0,0,0,0.2);\x20padding:\x2015px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mes_text\x22>','info','input[type=\x22checkbox\x22][id^=\x22amily2_\x22]','amily2_manual_unhide_confirm','amily2_','情报部回报','\x20执行失败:','\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-rule-btn\x20menu_button\x20danger_button\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','getElementById','.plugin-features','amily2_lore_insertion_position','click.amily2.lore_save','error','[Amily-谕令镌刻]\x20[','#amily2_auth_code','addEventListener','#amily2_output_format_prompt','includes','change.amily2.lore_settings','3834809KzetTA','#amily2_drawer_content','closest','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','message','disabled','body','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/ZhuDian.md','#amily2_chat_optimiser','changelog','then','正在将帝国徽记迁往\x20[','off','#optimization-rules-list','3507yaUHLm','未能获取到云端情报，请稍后再试。','#amily2_save_lore_settings','amily2_test','145556XGZyBR','input.amily2.range','#amily2_main_prompt','amily2_open_rag_palace','内阁使用教程','click.amily2.chamber_nav','.opt-exclusion-rule-row','谕令\x20[','type','#amily2_open_additional_features,\x20#amily2_open_rag_palace,\x20#amily2_back_to_main_settings,\x20#amily2_back_to_main_from_hanlinyuan','warning','length','click.amily2.unified_restore','120ZzApWv','checked','val','amily2_refresh_models','8cwKPxY','[Amily-谕令确认]\x20收到指令:\x20将\x20[','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','#amily2_update_indicator','find','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22opt-exclusion-rule-row\x22\x20data-index=\x22','authorized','825490rUNtNw','value','start','input[name=\x22amily2_icon_location\x22]','#amily2_expand_editor','click.amily2.actions','html','change.amily2.text','#amily2_lore_save_status','click.amily2.tutorial','#amily2_update_button','\x22]:checked','text','10WJfapW','change','change.amily2.checkbox','loreDepth','214101vzBJsi','topbar','stringify','optimizationExclusionRules','change.amily2.manual_model','amily2_unhide_all_button','change.amily2.force_proxy','children','data','change.amily2.radio','remove','select#amily2_model','click.amily2.auth','fadeIn','toUpperCase','#auth_submit','model','at_depth','授权码已复制到剪贴板！','replace',']\x20已镌刻!','temperature','hide','#amily2_manual_hide_to','。圣意已存档。','stop',']\x20已镌刻！','title','排除规则已更新。','input',']\x20已成功恢复为帝国初始蓝图。','#amily2_lore_depth_container','圣意已在您每次更改时自动镌刻。','input[name=\x22','请输入授权码','unhide_all'];_0x42e8=function(){return _0x265122;};return _0x42e8();}
