const _0x7bbaf1=_0x2c1c;(function(_0x176244,_0x1f51d3){const _0x2ef816=_0x2c1c,_0x405096=_0x176244();while(!![]){try{const _0x1e09d9=parseInt(_0x2ef816(0x165))/0x1+-parseInt(_0x2ef816(0x130))/0x2*(-parseInt(_0x2ef816(0x144))/0x3)+parseInt(_0x2ef816(0x143))/0x4*(parseInt(_0x2ef816(0x19c))/0x5)+parseInt(_0x2ef816(0x133))/0x6+-parseInt(_0x2ef816(0x15c))/0x7+-parseInt(_0x2ef816(0x19d))/0x8*(-parseInt(_0x2ef816(0x13e))/0x9)+-parseInt(_0x2ef816(0x15e))/0xa;if(_0x1e09d9===_0x1f51d3)break;else _0x405096['push'](_0x405096['shift']());}catch(_0x5db059){_0x405096['push'](_0x405096['shift']());}}}(_0x33d7,0x58b53));import{extension_settings}from'/scripts/extensions.js';import{saveSettingsDebounced}from'/script.js';import{defaultSettings,extensionName}from'../utils/settings.js';function _0x2c1c(_0x3bc7fa,_0x345bcc){const _0x33d75f=_0x33d7();return _0x2c1c=function(_0x2c1c22,_0x248b8b){_0x2c1c22=_0x2c1c22-0x11e;let _0x2e7de9=_0x33d75f[_0x2c1c22];return _0x2e7de9;},_0x2c1c(_0x3bc7fa,_0x345bcc);}import{pluginAuthStatus,activatePluginAuthorization,getPasswordForDate}from'../utils/auth.js';import{fetchSupportedModels}from'../core/api.js';import{setAvailableModels,populateModelDropdown,getLatestUpdateInfo}from'./state.js';import{fixCommand,testReplyChecker}from'../core/commands.js';import{createDrawer}from'../ui/drawer.js';import{messageFormatting}from'/script.js';import{executeManualCommand}from'../core/autoHideManager.js';import{showContentModal,showHtmlModal}from'./page-window.js';function displayDailyAuthCode(){const _0x16e33c=_0x2c1c,_0x473c9e=document[_0x16e33c(0x1ac)](_0x16e33c(0x178)),_0x138488=document[_0x16e33c(0x1ac)](_0x16e33c(0x15d));if(_0x473c9e&&_0x138488){const _0x94748e=getPasswordForDate(new Date());_0x473c9e[_0x16e33c(0x1a8)]=_0x94748e,_0x138488[_0x16e33c(0x15f)](_0x16e33c(0x1ce),()=>{const _0x211869=_0x16e33c;navigator['clipboard'][_0x211869(0x1a4)](_0x94748e)[_0x211869(0x197)](()=>{const _0x99dadb=_0x211869;toastr[_0x99dadb(0x1b4)](_0x99dadb(0x1c4));},()=>{const _0x420095=_0x211869;toastr[_0x420095(0x155)](_0x420095(0x142));});});}}export function bindModalEvents(){const _0x161e84=_0x2c1c,_0x7d171d=$('#amily2_drawer_content')[_0x161e84(0x1cf)]?$(_0x161e84(0x182)):$(_0x161e84(0x163));displayDailyAuthCode();function _0x53734d(){const _0x11fdf4=_0x161e84,_0x2770e8=extension_settings[extensionName]||{},_0x2c36e0=_0x2770e8[_0x11fdf4(0x13c)]===!![],_0xa5fd4e=_0x2770e8[_0x11fdf4(0x161)]||'';_0x7d171d[_0x11fdf4(0x1a6)](_0x11fdf4(0x1b0))[_0x11fdf4(0x18f)](_0x11fdf4(0x1af),_0x2c36e0),_0x7d171d[_0x11fdf4(0x1a6)](_0x11fdf4(0x19a))[_0x11fdf4(0x131)](_0xa5fd4e);const _0x1aa8af=_0x7d171d[_0x11fdf4(0x1a6)](_0x11fdf4(0x12b)),_0x3fb61b=_0x7d171d[_0x11fdf4(0x1a6)](_0x11fdf4(0x19a));_0x2c36e0?(_0x1aa8af[_0x11fdf4(0x1c7)](),_0x3fb61b[_0x11fdf4(0x14b)]()):(_0x1aa8af[_0x11fdf4(0x14b)](),_0x3fb61b[_0x11fdf4(0x1c7)]());}if(!_0x7d171d[_0x161e84(0x1cf)]||_0x7d171d[_0x161e84(0x136)](_0x161e84(0x140)))return;const _0x3bc9de=_0x3d8f5d=>_0x3d8f5d[_0x161e84(0x12f)](/_([a-z])/g,_0x39b71e=>_0x39b71e[0x1][_0x161e84(0x123)]()),_0x40bcd1=(_0x18aa29,_0x46fff9)=>{const _0x32b99c=_0x161e84;console[_0x32b99c(0x194)](_0x32b99c(0x183)+_0x18aa29+_0x32b99c(0x1a2),_0x46fff9),!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName]={...extension_settings[extensionName],[_0x18aa29]:_0x46fff9},saveSettingsDebounced(),console[_0x32b99c(0x194)](_0x32b99c(0x1c8)+_0x18aa29+']\x20的新状态已保存。');};_0x7d171d['off'](_0x161e84(0x1d1))['on'](_0x161e84(0x1d1),_0x161e84(0x1b0),function(){const _0x4c420e=_0x161e84;if(!pluginAuthStatus[_0x4c420e(0x18c)])return;_0x40bcd1(_0x4c420e(0x13c),this[_0x4c420e(0x1af)]),_0x53734d();}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x132))['on'](_0x161e84(0x132),_0x161e84(0x19a),function(){const _0x3a7f20=_0x161e84;if(!pluginAuthStatus[_0x3a7f20(0x18c)])return;_0x40bcd1(_0x3a7f20(0x161),this[_0x3a7f20(0x186)]),toastr[_0x3a7f20(0x1b4)](_0x3a7f20(0x16b)+this[_0x3a7f20(0x186)]+_0x3a7f20(0x16f),'Amily2号');}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x14d))['on'](_0x161e84(0x14d),_0x161e84(0x1b2),async function(){const _0x30d501=_0x161e84,_0x1b2f9b=$(_0x30d501(0x173))['val']()[_0x30d501(0x1ad)]();_0x1b2f9b?await activatePluginAuthorization(_0x1b2f9b):toastr['warning']('请输入授权码','Amily2号');}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x1b3))['on'](_0x161e84(0x1b3),_0x161e84(0x141),async function(){const _0x34a6a6=_0x161e84;if(!pluginAuthStatus[_0x34a6a6(0x18c)])return;const _0x440439=$(this),_0x32cb90=_0x440439['html']();_0x440439[_0x34a6a6(0x18f)](_0x34a6a6(0x138),!![])[_0x34a6a6(0x181)]('<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20处理中');try{switch(this['id']){case _0x34a6a6(0x164):const _0x59a54d=await fetchSupportedModels();_0x59a54d['length']>0x0&&(setAvailableModels(_0x59a54d),localStorage['setItem']('cached_models_amily2',JSON['stringify'](_0x59a54d)),populateModelDropdown());break;case _0x34a6a6(0x157):await testReplyChecker();break;case _0x34a6a6(0x147):await fixCommand();break;}}catch(_0x336263){console['error'](_0x34a6a6(0x15a)+this['id']+_0x34a6a6(0x1cc),_0x336263),toastr[_0x34a6a6(0x155)](_0x34a6a6(0x156)+_0x336263[_0x34a6a6(0x184)],'Amily2号');}finally{_0x440439[_0x34a6a6(0x18f)](_0x34a6a6(0x138),![])['html'](_0x32cb90);}}),_0x7d171d[_0x161e84(0x18d)]('click.amily2.expand_editor')['on'](_0x161e84(0x135),_0x161e84(0x145),function(_0x279157){const _0x31f54c=_0x161e84;if(!pluginAuthStatus[_0x31f54c(0x18c)])return;_0x279157[_0x31f54c(0x17d)]();const _0xc06db3=$(_0x31f54c(0x11e))[_0x31f54c(0x131)](),_0x2c71ff=$(_0x31f54c(0x175))[_0x31f54c(0x131)](),_0x15c247=_0x31f54c(0x193)+_0xc06db3+_0x31f54c(0x124),_0x392bb2=$(_0x15c247)[_0x31f54c(0x159)](_0x31f54c(0x1c3)),_0x309252=_0x392bb2[_0x31f54c(0x1a6)](_0x31f54c(0x1b5));_0x309252['val'](_0x2c71ff);const _0x46cb00=()=>{const _0x1c5f73=_0x31f54c;_0x392bb2[0x0][_0x1c5f73(0x179)](),_0x392bb2['remove']();};_0x392bb2[_0x31f54c(0x1a6)](_0x31f54c(0x1c2))['on'](_0x31f54c(0x1ce),()=>{const _0x259c2f=_0x31f54c,_0x44e5e1=_0x309252[_0x259c2f(0x131)]();$(_0x259c2f(0x175))[_0x259c2f(0x131)](_0x44e5e1),_0x40bcd1(_0xc06db3,_0x44e5e1),toastr['success'](_0x259c2f(0x188)+_0xc06db3+_0x259c2f(0x16d),_0x259c2f(0x185)),_0x46cb00();}),_0x392bb2[_0x31f54c(0x1a6)](_0x31f54c(0x129))['on'](_0x31f54c(0x1ce),_0x46cb00),_0x392bb2[0x0]['showModal']();}),_0x7d171d['off'](_0x161e84(0x171))['on']('click.amily2.tutorial',_0x161e84(0x148),function(){const _0x57af06=_0x161e84;if(!pluginAuthStatus[_0x57af06(0x18c)])return;const _0xc57402={'amily2_open_tutorial':{'title':'主殿使用教程','url':_0x57af06(0x14a)},'amily2_open_neige_tutorial':{'title':_0x57af06(0x151),'url':_0x57af06(0x191)}},_0x2fdfce=_0xc57402[this['id']];_0x2fdfce&&showContentModal(_0x2fdfce[_0x57af06(0x14c)],_0x2fdfce['url']);}),_0x7d171d['off']('click.amily2.update')['on'](_0x161e84(0x1a7),'#amily2_update_button',function(){const _0x4d076c=_0x161e84;$('#amily2_update_indicator')[_0x4d076c(0x1c7)]();const _0xf71901=getLatestUpdateInfo();if(_0xf71901&&_0xf71901[_0x4d076c(0x14e)]){const _0x3e380a=messageFormatting(_0xf71901['changelog']),_0x5195e3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22><i\x20class=\x22fas\x20fa-bell\x22\x20style=\x22color:\x20#ff9800;\x22></i>\x20帝国最新情报</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2060vh;\x20overflow-y:\x20auto;\x20background:\x20rgba(0,0,0,0.2);\x20padding:\x2015px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mes_text\x22>'+_0x3e380a+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>朕已阅</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x262eea=$(_0x5195e3)['appendTo']('body'),_0x2b7981=()=>{const _0x18da3a=_0x4d076c;_0x262eea[0x0][_0x18da3a(0x179)](),_0x262eea[_0x18da3a(0x18e)]();};_0x262eea['find']('.popup-button-ok')['on'](_0x4d076c(0x1ce),_0x2b7981),_0x262eea[0x0]['showModal']();}else toastr[_0x4d076c(0x18a)](_0x4d076c(0x146),'情报部回报');}),_0x7d171d['off'](_0x161e84(0x187))['on'](_0x161e84(0x187),'#amily2_update_button_new',function(){const _0x1a71b3=_0x161e84;$(_0x1a71b3(0x1a5))[_0x1a71b3(0x169)]()[_0x1a71b3(0x1ce)]();}),_0x7d171d['off'](_0x161e84(0x1a9))['on'](_0x161e84(0x1a9),_0x161e84(0x17a),async function(){const _0x1167de=_0x161e84;if(!pluginAuthStatus['authorized'])return;const _0x287ff3=this['id'];let _0x24e08f='',_0x3c5f8b={};switch(_0x287ff3){case'amily2_unhide_all_button':_0x24e08f=_0x1167de(0x125);break;case _0x1167de(0x1b9):_0x24e08f=_0x1167de(0x17c),_0x3c5f8b={'from':$(_0x1167de(0x1c5))['val'](),'to':$(_0x1167de(0x196))[_0x1167de(0x131)]()};break;case _0x1167de(0x1a1):_0x24e08f=_0x1167de(0x121),_0x3c5f8b={'from':$(_0x1167de(0x1c6))[_0x1167de(0x131)](),'to':$(_0x1167de(0x1b7))['val']()};break;}_0x24e08f&&await executeManualCommand(_0x24e08f,_0x3c5f8b);}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x120))['on'](_0x161e84(0x120),_0x161e84(0x1d2),function(){const _0x2e2c6d=_0x161e84;if(!pluginAuthStatus[_0x2e2c6d(0x18c)])return;const _0x1676bc=_0x7d171d['find']('.plugin-features'),_0x21d45a=_0x7d171d[_0x2e2c6d(0x1a6)](_0x2e2c6d(0x1bc)),_0x18e37a=_0x7d171d[_0x2e2c6d(0x1a6)](_0x2e2c6d(0x19f));_0x1676bc[_0x2e2c6d(0x1c7)](),_0x21d45a[_0x2e2c6d(0x1c7)](),_0x18e37a['hide']();switch(this['id']){case _0x2e2c6d(0x1bd):_0x21d45a[_0x2e2c6d(0x14b)]();break;case'amily2_open_rag_palace':_0x18e37a[_0x2e2c6d(0x14b)]();break;case _0x2e2c6d(0x126):case _0x2e2c6d(0x180):_0x1676bc[_0x2e2c6d(0x14b)]();break;}}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x13f))['on'](_0x161e84(0x13f),'input[type=\x22checkbox\x22][id^=\x22amily2_\x22]',function(_0x141fb8){const _0x34196a=_0x161e84;if(!pluginAuthStatus[_0x34196a(0x18c)])return;const _0x4062fc=this['id'],_0x517fac=$(this),_0x57c5c6=_0x3bc9de(_0x4062fc[_0x34196a(0x12f)]('amily2_',''));_0x40bcd1(_0x57c5c6,_0x517fac[_0x34196a(0x18f)]('checked'));if(_0x4062fc===_0x34196a(0x17e)&&_0x517fac['prop'](_0x34196a(0x1af))){const _0x40422b=extension_settings[extensionName],_0x27b71a=_0x40422b['optimizationExclusionRules']||[],_0x5924a3=(_0x136f82={'start':'','end':''},_0x52ab37)=>_0x34196a(0x162)+_0x52ab37+_0x34196a(0x19b)+_0x136f82[_0x34196a(0x1ca)]+_0x34196a(0x153)+_0x136f82[_0x34196a(0x13a)]+_0x34196a(0x199),_0x6ef57d=_0x27b71a[_0x34196a(0x1aa)](_0x5924a3)[_0x34196a(0x15b)](''),_0x2207fa=_0x34196a(0x1d9)+_0x6ef57d+_0x34196a(0x1d6);showHtmlModal(_0x34196a(0x168),_0x2207fa,{'okText':'确认','cancelText':'取消','onOk':_0xed65dc=>{const _0x48f5aa=_0x34196a,_0x1ef7d3=[];_0xed65dc[_0x48f5aa(0x1a6)]('.opt-exclusion-rule-row')[_0x48f5aa(0x1bf)](function(){const _0x4b892c=_0x48f5aa,_0x11cb3e=$(this)['find'](_0x4b892c(0x18b))['eq'](0x0)['val']()['trim'](),_0x2d75af=$(this)['find'](_0x4b892c(0x18b))['eq'](0x1)[_0x4b892c(0x131)]()[_0x4b892c(0x1ad)]();if(_0x11cb3e&&_0x2d75af)_0x1ef7d3[_0x4b892c(0x137)]({'start':_0x11cb3e,'end':_0x2d75af});}),_0x40bcd1(_0x48f5aa(0x12d),_0x1ef7d3),toastr[_0x48f5aa(0x1b4)](_0x48f5aa(0x17f),'Amily2号');},'onCancel':()=>{}});const _0x14d17f=$(_0x34196a(0x152)),_0x358b88=_0x14d17f['find'](_0x34196a(0x1c9));_0x14d17f['find'](_0x34196a(0x1be))['on']('click',()=>{const _0x3f961b=_0x34196a,_0x4952bb=_0x358b88['children']()[_0x3f961b(0x1cf)];_0x358b88[_0x3f961b(0x1a3)](_0x5924a3(undefined,_0x4952bb));}),_0x358b88['on'](_0x34196a(0x1ce),'.delete-rule-btn',function(){const _0x16f831=_0x34196a;$(this)[_0x16f831(0x166)]('.opt-exclusion-rule-row')[_0x16f831(0x18e)]();});}}),_0x7d171d[_0x161e84(0x18d)]('change.amily2.radio')['on'](_0x161e84(0x14f),_0x161e84(0x195),function(){const _0x9a739d=_0x161e84;if(!pluginAuthStatus['authorized'])return;const _0x3f7351=_0x3bc9de(this[_0x9a739d(0x1d7)][_0x9a739d(0x12f)](_0x9a739d(0x16c),'')),_0x4e7b8d=$(_0x9a739d(0x189)+this[_0x9a739d(0x1d7)]+'\x22]:checked')[_0x9a739d(0x131)]();_0x40bcd1(_0x3f7351,_0x4e7b8d);}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x12e))['on']('change.amily2.text',_0x161e84(0x1bb),function(){const _0x2682cc=_0x161e84;if(!pluginAuthStatus['authorized'])return;const _0x44fc87=_0x3bc9de(this['id']['replace'](_0x2682cc(0x16c),''));_0x40bcd1(_0x44fc87,this[_0x2682cc(0x186)]),toastr[_0x2682cc(0x1b4)]('配置\x20['+_0x44fc87+_0x2682cc(0x16f),'Amily2号');}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x1a0))['on'](_0x161e84(0x1a0),_0x161e84(0x1b6),function(){if(!pluginAuthStatus['authorized'])return;const _0x208f39=_0x3bc9de(this['id']['replace']('amily2_',''));_0x40bcd1(_0x208f39,this['value']),populateModelDropdown();}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x170))['on']('input.amily2.range','input[type=\x22range\x22][id^=\x22amily2_\x22]',function(){const _0x2796c2=_0x161e84;if(!pluginAuthStatus[_0x2796c2(0x18c)])return;const _0x64be6b=_0x3bc9de(this['id'][_0x2796c2(0x12f)](_0x2796c2(0x16c),'')),_0x2c8a10=this['id'][_0x2796c2(0x11f)](_0x2796c2(0x1d0))?parseFloat(this[_0x2796c2(0x186)]):parseInt(this[_0x2796c2(0x186)],0xa);$('#'+this['id']+_0x2796c2(0x12a))[_0x2796c2(0x149)](_0x2c8a10),_0x40bcd1(_0x64be6b,_0x2c8a10);});const _0x4e4906={'mainPrompt':_0x161e84(0x172),'systemPrompt':_0x161e84(0x1b1),'outputFormatPrompt':_0x161e84(0x174)},_0x13333f=_0x161e84(0x11e),_0x572211='#amily2_unified_editor',_0x274951=_0x161e84(0x134);function _0x39ff97(){const _0x114552=_0x161e84;if(!$(_0x13333f)[_0x114552(0x1cf)])return;const _0x12a195=$(_0x13333f)[_0x114552(0x131)]();if(!_0x12a195)return;const _0x1aab74=extension_settings[extensionName][_0x12a195]||'';$(_0x572211)[_0x114552(0x131)](_0x1aab74);}_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x127))['on'](_0x161e84(0x127),_0x13333f,_0x39ff97),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x19e))['on'](_0x161e84(0x19e),_0x274951,function(){const _0x194b92=_0x161e84,_0x2febd1=$(_0x13333f)[_0x194b92(0x131)]();if(!_0x2febd1)return;const _0x4347c5=$(_0x572211)[_0x194b92(0x131)]();_0x40bcd1(_0x2febd1,_0x4347c5),toastr[_0x194b92(0x1b4)]('谕令\x20['+_0x2febd1+_0x194b92(0x1cb),_0x194b92(0x185));}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x1ae))['on']('click.amily2.unified_restore',_0x161e84(0x158),function(){const _0x5e5fbc=_0x161e84,_0x36033e=$(_0x13333f)[_0x5e5fbc(0x131)]();if(!_0x36033e)return;const _0x5cfa71=defaultSettings[_0x36033e];$(_0x572211)[_0x5e5fbc(0x131)](_0x5cfa71),_0x40bcd1(_0x36033e,_0x5cfa71),toastr['success']('谕令\x20['+_0x36033e+_0x5e5fbc(0x1b8),_0x5e5fbc(0x185));}),_0x7d171d[_0x161e84(0x18d)](_0x161e84(0x13b))['on'](_0x161e84(0x13b),'select[id^=\x22amily2_lore_\x22],\x20input#amily2_lore_depth_input',function(){const _0x18d840=_0x161e84;if(!pluginAuthStatus[_0x18d840(0x18c)])return;let _0x3cb8f5=_0x3bc9de(this['id'][_0x18d840(0x12f)](_0x18d840(0x16c),''));_0x3cb8f5===_0x18d840(0x154)&&(_0x3cb8f5=_0x18d840(0x16e));const _0x3842c8=this[_0x18d840(0x13d)]===_0x18d840(0x167)?parseInt(this[_0x18d840(0x186)],0xa):this[_0x18d840(0x186)];_0x40bcd1(_0x3cb8f5,_0x3842c8);if(this['id']===_0x18d840(0x1cd)){const _0x585529=$(_0x18d840(0x190));this[_0x18d840(0x186)]===_0x18d840(0x1ab)?_0x585529['slideDown'](0xc8):_0x585529[_0x18d840(0x150)](0xc8);}}),_0x7d171d['off'](_0x161e84(0x17b))['on'](_0x161e84(0x17b),_0x161e84(0x1d8),function(){const _0x8d4162=_0x161e84;if(!pluginAuthStatus['authorized'])return;const _0x144e26=$(this),_0x36dbe8=$(_0x8d4162(0x128));_0x144e26['prop']('disabled',!![])[_0x8d4162(0x181)](_0x8d4162(0x1c1)),_0x36dbe8[_0x8d4162(0x149)](_0x8d4162(0x1d4))[_0x8d4162(0x1d5)]()[_0x8d4162(0x192)](),setTimeout(()=>{const _0x38c142=_0x8d4162;_0x144e26[_0x38c142(0x18f)](_0x38c142(0x138),![])[_0x38c142(0x181)](_0x38c142(0x160)),_0x36dbe8[_0x38c142(0x122)]();},0x9c4);}),setTimeout(_0x39ff97,0x64),_0x53734d(),_0x7d171d['data'](_0x161e84(0x140),!![]);}$(document)['on'](_0x7bbaf1(0x12c),'input[name=\x22amily2_icon_location\x22]',function(){const _0x48f2e7=_0x7bbaf1;if(!pluginAuthStatus['authorized'])return;const _0x2f172c=$(this)[_0x48f2e7(0x131)]();extension_settings[extensionName][_0x48f2e7(0x139)]=_0x2f172c,saveSettingsDebounced(),console[_0x48f2e7(0x194)]('[Amily-禁卫军]\x20收到迁都指令\x20->\x20'+_0x2f172c+_0x48f2e7(0x16a)),toastr[_0x48f2e7(0x18a)](_0x48f2e7(0x177)+(_0x2f172c===_0x48f2e7(0x198)?'顶栏':_0x48f2e7(0x1ba))+_0x48f2e7(0x1d3),'迁都令',{'timeOut':0x7d0}),$(_0x48f2e7(0x176))[_0x48f2e7(0x18e)](),$(document)['off']('mousedown.amily2Drawer'),$(_0x48f2e7(0x1c0))[_0x48f2e7(0x18e)](),setTimeout(createDrawer,0x32);});function _0x33d7(){const _0x270243=['</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20id=\x22amily2_dialog_editor\x22\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','unhide_all','amily2_back_to_main_settings','change.amily2.prompt_selector','#amily2_lore_save_status','.popup-button-cancel','_value','#amily2_model_autofetch_wrapper','change','optimizationExclusionRules','change.amily2.text','replace','16NYCmOV','val','change.amily2.manual_model','3994116prfYti','#amily2_unified_save_button','click.amily2.expand_editor','data','push','disabled','iconLocation','end','change.amily2.lore_settings','forceProxyForCustomApi','type','9ocAoxk','change.amily2.checkbox','events-bound','#amily2_refresh_models,\x20#amily2_test,\x20#amily2_fix_now','复制失败，请手动复制。','401236DGZwkB','34428aybKEP','#amily2_expand_editor','未能获取到云端情报，请稍后再试。','amily2_fix_now','#amily2_open_tutorial,\x20#amily2_open_neige_tutorial','text','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/ZhuDian.md','show','title','click.amily2.auth','changelog','change.amily2.radio','slideUp','内阁使用教程','#optimization-exclusion-rules-container','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','loreDepthInput','error','操作失败:\x20','amily2_test','#amily2_unified_restore_button','appendTo','[Amily2-工部]\x20操作按钮\x20','join','330169yaeQKq','amily2_copy_daily_code','14609770tqaQOD','addEventListener','<i\x20class=\x22fas\x20fa-save\x22></i>\x20确认敕令','model','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22opt-exclusion-rule-row\x22\x20data-index=\x22','#amily2_chat_optimiser','amily2_refresh_models','396011DjbHyQ','closest','number','编辑内容排除规则','first','。圣意已存档。','模型ID\x20[','amily2_',']\x20已镌刻！','loreDepth',']\x20已自动保存!','input.amily2.range','click.amily2.tutorial','#amily2_main_prompt','#amily2_auth_code','#amily2_output_format_prompt','#amily2_unified_editor','#amily2_main_drawer','正在将帝国徽记迁往\x20[','amily2_daily_code_display','close','#amily2_unhide_all_button,\x20#amily2_manual_hide_confirm,\x20#amily2_manual_unhide_confirm','click.amily2.lore_save','manual_hide','stopPropagation','amily2_optimization_exclusion_enabled','排除规则已更新。','amily2_back_to_main_from_hanlinyuan','html','#amily2_drawer_content','[Amily-谕令确认]\x20收到指令:\x20将\x20[','message','Amily2号','value','click.amily2.update_new','谕令\x20[','input[name=\x22','info','input','authorized','off','remove','prop','#amily2_lore_depth_container','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/NeiGe.md','fadeIn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','log','input[type=\x22radio\x22][name^=\x22amily2_\x22]:not([name=\x22amily2_icon_location\x22])','#amily2_manual_hide_to','then','topbar','\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-rule-btn\x20menu_button\x20danger_button\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','#amily2_manual_model_input','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','10FZsseG','4138944QDBYpO','click.amily2.unified_save','#amily2_hanlinyuan_panel','change.amily2.select','amily2_manual_unhide_confirm',']\x20设置为\x20->','append','writeText','span[data-i18n=\x22Manage\x20extensions\x22]','find','click.amily2.update','textContent','click.amily2.manual_command','map','at_depth','getElementById','trim','click.amily2.unified_restore','checked','#amily2_force_proxy','#amily2_system_prompt','#auth_submit','click.amily2.actions','success','#amily2_dialog_editor','select#amily2_model','#amily2_manual_unhide_to',']\x20已成功恢复为帝国初始蓝图。','amily2_manual_hide_confirm','扩展区','#amily2_api_url,\x20#amily2_api_key,\x20#amily2_optimization_target_tag','#amily2_additional_features_panel','amily2_open_additional_features','#optimization-add-rule-btn','each','#amily2_extension_frame','<i\x20class=\x22fas\x20fa-check\x22></i>\x20已确认','.popup-button-ok','body','授权码已复制到剪贴板！','#amily2_manual_hide_from','#amily2_manual_unhide_from','hide','[Amily-谕令镌刻]\x20[','#optimization-rules-list','start',']\x20已镌刻!','\x20执行失败:','amily2_lore_insertion_position','click','length','temperature','change.amily2.force_proxy','#amily2_open_additional_features,\x20#amily2_open_rag_palace,\x20#amily2_back_to_main_settings,\x20#amily2_back_to_main_from_hanlinyuan',']...','圣意已在您每次更改时自动镌刻。','stop','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22optimization-add-rule-btn\x22\x20class=\x22menu_button\x20amily2-add-rule-btn\x22><i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','name','#amily2_save_lore_settings','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22notes\x22>在这里定义需要从优化内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-rules-list\x22\x20style=\x22max-height:\x2045vh;\x20overflow-y:\x20auto;\x20padding:\x2010px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.1);\x20border-radius:\x205px;\x20margin-bottom:10px;\x22>','#amily2_prompt_selector','includes','click.amily2.chamber_nav','manual_unhide','fadeOut','toUpperCase'];_0x33d7=function(){return _0x270243;};return _0x33d7();}