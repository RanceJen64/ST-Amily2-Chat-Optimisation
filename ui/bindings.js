const _0x4bdbb9=_0x3eb7;function _0x3eb7(_0x47bd02,_0x2df4ae){const _0x2341a1=_0x2341();return _0x3eb7=function(_0x3eb708,_0x50ac61){_0x3eb708=_0x3eb708-0x15e;let _0xb34587=_0x2341a1[_0x3eb708];return _0xb34587;},_0x3eb7(_0x47bd02,_0x2df4ae);}function _0x2341(){const _0x3568db=['[Amily2-工部]\x20操作按钮\x20','select[id^=\x22amily2_lore_\x22],\x20input#amily2_lore_depth_input','click.amily2.manual_command','click.amily2.expand_editor','change.amily2.force_proxy','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/ZhuDian.md','#amily2_main_prompt','#amily2_open_additional_features,\x20#amily2_open_rag_palace,\x20#amily2_open_memorisation_forms,\x20#amily2_back_to_main_settings,\x20#amily2_back_to_main_from_hanlinyuan,\x20#amily2_back_to_main_from_forms','#auth_submit','内阁使用教程','slideDown','情报部回报','input[name=\x22','data','slideUp','replace','change.amily2.text','checked','模型ID\x20[',']\x20已镌刻!','change','end','Amily2号','#amily2_chat_optimiser','optimizationExclusionRules','amily2_unhide_all_button','209133HTCYsa','1250OdQtyP','迁都令','#amily2_additional_features_panel','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','amily2_manual_unhide_confirm','then','#amily2_manual_hide_to','hide','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>朕已阅</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','授权码已复制到剪贴板！','input[type=\x22checkbox\x22][id^=\x22amily2_\x22]','[Amily-禁卫军]\x20收到迁都指令\x20->\x20','mousedown.amily2Drawer','amily2_copy_daily_code','click.amily2.unified_restore','#amily2_refresh_models,\x20#amily2_test,\x20#amily2_fix_now','<i\x20class=\x22fas\x20fa-save\x22></i>\x20确认敕令','amily2_','model','change.amily2.manual_model','show','click.amily2.auth','#amily2_unified_save_button','includes','off','select#amily2_model','amily2_back_to_main_from_forms','</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20id=\x22amily2_dialog_editor\x22\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','#amily2_update_button','temperature','#amily2_update_indicator','请输入授权码','#amily2_save_lore_settings','#amily2_output_format_prompt','#amily2_hanlinyuan_panel','#amily2_drawer_content','appendTo','url','value','html','change.amily2.prompt_selector','#amily2_auth_code','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','fadeIn','number','showModal','3563034BXXxDf','closest','#amily2_lore_save_status','amily2_manual_hide_confirm','getElementById','amily2_back_to_main_settings','input[type=\x22range\x22][id^=\x22amily2_\x22]','stop','3552872PjxAvY','join','change.amily2.select',']\x20已自动保存!','.delete-rule-btn','amily2_test','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22opt-exclusion-rule-row\x22\x20data-index=\x22','#amily2_open_tutorial,\x20#amily2_open_neige_tutorial','input.amily2.range','children','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/NeiGe.md','title',']\x20已成功恢复为帝国初始蓝图。','body','writeText','click.amily2.unified_save','\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-rule-btn\x20menu_button\x20danger_button\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','#amily2_prompt_selector','.popup-button-ok','trim','error','#amily2_system_prompt','click.amily2.chamber_nav','close','amily2_back_to_main_from_hanlinyuan','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20处理中','amily2_fix_now','正在将帝国徽记迁往\x20[','click.amily2.actions','#amily2_manual_unhide_to','length','#amily2_manual_model_input','5272272LBltdK','442069ucHDzm','val','\x22]:checked','name','success','stopPropagation','#amily2_unhide_all_button,\x20#amily2_manual_hide_confirm,\x20#amily2_manual_unhide_confirm','push',']\x20设置为\x20->','#amily2_update_button_new','谕令\x20[','圣意已在您每次更改时自动镌刻。','配置\x20[','each','find','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','#amily2_extension_frame','.plugin-features','#amily2_manual_hide_from','changelog','unhide_all','\x20执行失败:','setItem','input[type=\x22radio\x22][name^=\x22amily2_\x22]:not([name=\x22amily2_icon_location\x22])','click.amily2.update_new','loreDepth','span[data-i18n=\x22Manage\x20extensions\x22]','主殿使用教程','[Amily-谕令确认]\x20收到指令:\x20将\x20[','10gIXDBC','prop','info',']\x20已镌刻！','<i\x20class=\x22fas\x20fa-check\x22></i>\x20已确认','.opt-exclusion-rule-row','amily2_open_rag_palace',']\x20的新状态已保存。','排除规则已更新。','first','933540VDVvnd','change.amily2.checkbox','remove','append','click.amily2.tutorial',']...','.popup-button-cancel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22notes\x22>在这里定义需要从优化内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-rules-list\x22\x20style=\x22max-height:\x2045vh;\x20overflow-y:\x20auto;\x20padding:\x2010px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.1);\x20border-radius:\x205px;\x20margin-bottom:10px;\x22>','cached_models_amily2','amily2_open_additional_features','iconLocation','clipboard','3024721JUmWKv','manual_hide','#amily2_main_drawer','click.amily2.lore_save','click.amily2.update','扩展区','disabled','authorized','addEventListener','manual_unhide','amily2_lore_insertion_position','操作失败:\x20','change.amily2.lore_settings','change.amily2.radio','log','amily2_optimization_exclusion_enabled','forceProxyForCustomApi','#amily2_unified_editor','events-bound','16qZlwoL','click','textContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22><i\x20class=\x22fas\x20fa-bell\x22\x20style=\x22color:\x20#ff9800;\x22></i>\x20帝国最新情报</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2060vh;\x20overflow-y:\x20auto;\x20background:\x20rgba(0,0,0,0.2);\x20padding:\x2015px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mes_text\x22>','#amily2_force_proxy','#amily2_model_autofetch_wrapper','#amily2_manual_unhide_from','#optimization-add-rule-btn','start'];_0x2341=function(){return _0x3568db;};return _0x2341();}(function(_0x37072a,_0x12a668){const _0x3f4249=_0x3eb7,_0x233b58=_0x37072a();while(!![]){try{const _0x237d3b=-parseInt(_0x3f4249(0x1fd))/0x1+-parseInt(_0x3f4249(0x163))/0x2+parseInt(_0x3f4249(0x1d4))/0x3+parseInt(_0x3f4249(0x1dc))/0x4*(parseInt(_0x3f4249(0x21a))/0x5)+parseInt(_0x3f4249(0x1fc))/0x6+-parseInt(_0x3f4249(0x16f))/0x7*(-parseInt(_0x3f4249(0x182))/0x8)+-parseInt(_0x3f4249(0x1a5))/0x9*(parseInt(_0x3f4249(0x1a6))/0xa);if(_0x237d3b===_0x12a668)break;else _0x233b58['push'](_0x233b58['shift']());}catch(_0x376714){_0x233b58['push'](_0x233b58['shift']());}}}(_0x2341,0xda280));import{extension_settings}from'/scripts/extensions.js';import{saveSettingsDebounced}from'/script.js';import{defaultSettings,extensionName}from'../utils/settings.js';import{pluginAuthStatus,activatePluginAuthorization,getPasswordForDate}from'../utils/auth.js';import{fetchSupportedModels}from'../core/api.js';import{setAvailableModels,populateModelDropdown,getLatestUpdateInfo}from'./state.js';import{fixCommand,testReplyChecker}from'../core/commands.js';import{createDrawer}from'../ui/drawer.js';import{messageFormatting}from'/script.js';import{executeManualCommand}from'../core/autoHideManager.js';import{showContentModal,showHtmlModal}from'./page-window.js';function displayDailyAuthCode(){const _0x4dc1a0=_0x3eb7,_0x18f4ab=document[_0x4dc1a0(0x1d8)]('amily2_daily_code_display'),_0x36e94b=document[_0x4dc1a0(0x1d8)](_0x4dc1a0(0x1b3));if(_0x18f4ab&&_0x36e94b){const _0x3fba90=getPasswordForDate(new Date());_0x18f4ab[_0x4dc1a0(0x184)]=_0x3fba90,_0x36e94b[_0x4dc1a0(0x177)]('click',()=>{const _0x152f8c=_0x4dc1a0;navigator[_0x152f8c(0x16e)][_0x152f8c(0x1ea)](_0x3fba90)[_0x152f8c(0x1ab)](()=>{const _0x2edffb=_0x152f8c;toastr[_0x2edffb(0x201)](_0x2edffb(0x1af));},()=>{toastr['error']('复制失败，请手动复制。');});});}}export function bindModalEvents(){const _0x3c7af9=_0x3eb7,_0x3890dd=$(_0x3c7af9(0x1c9))[_0x3c7af9(0x1fa)]?$(_0x3c7af9(0x1c9)):$(_0x3c7af9(0x1a2));displayDailyAuthCode();function _0x52afec(){const _0x3a4670=_0x3c7af9,_0xbba5df=extension_settings[extensionName]||{},_0x2c936d=_0xbba5df[_0x3a4670(0x17f)]===!![],_0x34e587=_0xbba5df[_0x3a4670(0x1b8)]||'';_0x3890dd[_0x3a4670(0x20b)](_0x3a4670(0x186))[_0x3a4670(0x21b)](_0x3a4670(0x19c),_0x2c936d),_0x3890dd[_0x3a4670(0x20b)](_0x3a4670(0x1fb))['val'](_0x34e587);const _0x523413=_0x3890dd[_0x3a4670(0x20b)](_0x3a4670(0x187)),_0x590ee2=_0x3890dd[_0x3a4670(0x20b)](_0x3a4670(0x1fb));_0x2c936d?(_0x523413[_0x3a4670(0x1ad)](),_0x590ee2[_0x3a4670(0x1ba)]()):(_0x523413['show'](),_0x590ee2[_0x3a4670(0x1ad)]());}if(!_0x3890dd['length']||_0x3890dd[_0x3c7af9(0x198)](_0x3c7af9(0x181)))return;const _0x1cb3f7=_0x28d50d=>_0x28d50d[_0x3c7af9(0x19a)](/_([a-z])/g,_0x81cf59=>_0x81cf59[0x1]['toUpperCase']()),_0x1d7c03=(_0x2c0229,_0x4795fc)=>{const _0x123eb2=_0x3c7af9;console['log'](_0x123eb2(0x219)+_0x2c0229+_0x123eb2(0x205),_0x4795fc),!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName]={...extension_settings[extensionName],[_0x2c0229]:_0x4795fc},saveSettingsDebounced(),console[_0x123eb2(0x17d)]('[Amily-谕令镌刻]\x20['+_0x2c0229+_0x123eb2(0x160));};_0x3890dd[_0x3c7af9(0x1be)]('change.amily2.force_proxy')['on'](_0x3c7af9(0x18f),_0x3c7af9(0x186),function(){const _0xc0abce=_0x3c7af9;if(!pluginAuthStatus[_0xc0abce(0x176)])return;_0x1d7c03(_0xc0abce(0x17f),this[_0xc0abce(0x19c)]),_0x52afec();}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x1b9))['on'](_0x3c7af9(0x1b9),_0x3c7af9(0x1fb),function(){const _0x271c7d=_0x3c7af9;if(!pluginAuthStatus[_0x271c7d(0x176)])return;_0x1d7c03(_0x271c7d(0x1b8),this[_0x271c7d(0x1cc)]),toastr[_0x271c7d(0x201)](_0x271c7d(0x19d)+this['value']+_0x271c7d(0x1df),_0x271c7d(0x1a1));}),_0x3890dd['off']('click.amily2.auth')['on'](_0x3c7af9(0x1bb),_0x3c7af9(0x193),async function(){const _0x3e0b23=_0x3c7af9,_0x1761b2=$(_0x3e0b23(0x1cf))[_0x3e0b23(0x1fe)]()[_0x3e0b23(0x1ef)]();_0x1761b2?await activatePluginAuthorization(_0x1761b2):toastr['warning'](_0x3e0b23(0x1c5),_0x3e0b23(0x1a1));}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x1f8))['on'](_0x3c7af9(0x1f8),_0x3c7af9(0x1b5),async function(){const _0x2e9f29=_0x3c7af9;if(!pluginAuthStatus['authorized'])return;const _0x3bf156=$(this),_0x55294a=_0x3bf156['html']();_0x3bf156[_0x2e9f29(0x21b)](_0x2e9f29(0x175),!![])[_0x2e9f29(0x1cd)](_0x2e9f29(0x1f5));try{switch(this['id']){case'amily2_refresh_models':const _0x3f89d6=await fetchSupportedModels();_0x3f89d6[_0x2e9f29(0x1fa)]>0x0&&(setAvailableModels(_0x3f89d6),localStorage[_0x2e9f29(0x213)](_0x2e9f29(0x16b),JSON['stringify'](_0x3f89d6)),populateModelDropdown());break;case _0x2e9f29(0x1e1):await testReplyChecker();break;case _0x2e9f29(0x1f6):await fixCommand();break;}}catch(_0x4b68ea){console['error'](_0x2e9f29(0x18b)+this['id']+_0x2e9f29(0x212),_0x4b68ea),toastr[_0x2e9f29(0x1f0)](_0x2e9f29(0x17a)+_0x4b68ea['message'],_0x2e9f29(0x1a1));}finally{_0x3bf156[_0x2e9f29(0x21b)]('disabled',![])[_0x2e9f29(0x1cd)](_0x55294a);}}),_0x3890dd['off'](_0x3c7af9(0x18e))['on'](_0x3c7af9(0x18e),'#amily2_expand_editor',function(_0xfd9b05){const _0x35067b=_0x3c7af9;if(!pluginAuthStatus[_0x35067b(0x176)])return;_0xfd9b05[_0x35067b(0x202)]();const _0x44589b=$(_0x35067b(0x1ed))['val'](),_0x2df781=$('#amily2_unified_editor')['val'](),_0x2d8508=_0x35067b(0x20c)+_0x44589b+_0x35067b(0x1c1),_0x225a6e=$(_0x2d8508)[_0x35067b(0x1ca)](_0x35067b(0x1e9)),_0x32b672=_0x225a6e[_0x35067b(0x20b)]('#amily2_dialog_editor');_0x32b672[_0x35067b(0x1fe)](_0x2df781);const _0x34dc1f=()=>{const _0x307a1f=_0x35067b;_0x225a6e[0x0]['close'](),_0x225a6e[_0x307a1f(0x165)]();};_0x225a6e[_0x35067b(0x20b)](_0x35067b(0x1ee))['on'](_0x35067b(0x183),()=>{const _0x71a007=_0x35067b,_0x2f382d=_0x32b672[_0x71a007(0x1fe)]();$(_0x71a007(0x180))[_0x71a007(0x1fe)](_0x2f382d),_0x1d7c03(_0x44589b,_0x2f382d),toastr[_0x71a007(0x201)](_0x71a007(0x207)+_0x44589b+_0x71a007(0x21d),_0x71a007(0x1a1)),_0x34dc1f();}),_0x225a6e[_0x35067b(0x20b)](_0x35067b(0x169))['on'](_0x35067b(0x183),_0x34dc1f),_0x225a6e[0x0][_0x35067b(0x1d3)]();}),_0x3890dd[_0x3c7af9(0x1be)]('click.amily2.tutorial')['on'](_0x3c7af9(0x167),_0x3c7af9(0x1e3),function(){const _0xd1c2da=_0x3c7af9;if(!pluginAuthStatus[_0xd1c2da(0x176)])return;const _0x10f74d={'amily2_open_tutorial':{'title':_0xd1c2da(0x218),'url':_0xd1c2da(0x190)},'amily2_open_neige_tutorial':{'title':_0xd1c2da(0x194),'url':_0xd1c2da(0x1e6)}},_0x5c1b7a=_0x10f74d[this['id']];_0x5c1b7a&&showContentModal(_0x5c1b7a[_0xd1c2da(0x1e7)],_0x5c1b7a[_0xd1c2da(0x1cb)]);}),_0x3890dd['off'](_0x3c7af9(0x173))['on'](_0x3c7af9(0x173),_0x3c7af9(0x1c2),function(){const _0x3198c4=_0x3c7af9;$(_0x3198c4(0x1c4))[_0x3198c4(0x1ad)]();const _0x735127=getLatestUpdateInfo();if(_0x735127&&_0x735127['changelog']){const _0x34c660=messageFormatting(_0x735127[_0x3198c4(0x210)]),_0x561250=_0x3198c4(0x185)+_0x34c660+_0x3198c4(0x1ae),_0xce8579=$(_0x561250)[_0x3198c4(0x1ca)](_0x3198c4(0x1e9)),_0x2dbd08=()=>{const _0x342838=_0x3198c4;_0xce8579[0x0][_0x342838(0x1f3)](),_0xce8579[_0x342838(0x165)]();};_0xce8579[_0x3198c4(0x20b)](_0x3198c4(0x1ee))['on']('click',_0x2dbd08),_0xce8579[0x0][_0x3198c4(0x1d3)]();}else toastr['info']('未能获取到云端情报，请稍后再试。',_0x3198c4(0x196));}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x215))['on'](_0x3c7af9(0x215),_0x3c7af9(0x206),function(){const _0x5f130d=_0x3c7af9;$(_0x5f130d(0x217))[_0x5f130d(0x162)]()[_0x5f130d(0x183)]();}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x18d))['on'](_0x3c7af9(0x18d),_0x3c7af9(0x203),async function(){const _0x6d1edc=_0x3c7af9;if(!pluginAuthStatus[_0x6d1edc(0x176)])return;const _0x55e05d=this['id'];let _0x2d343e='',_0x1b8059={};switch(_0x55e05d){case _0x6d1edc(0x1a4):_0x2d343e=_0x6d1edc(0x211);break;case _0x6d1edc(0x1d7):_0x2d343e=_0x6d1edc(0x170),_0x1b8059={'from':$(_0x6d1edc(0x20f))['val'](),'to':$(_0x6d1edc(0x1ac))[_0x6d1edc(0x1fe)]()};break;case _0x6d1edc(0x1aa):_0x2d343e=_0x6d1edc(0x178),_0x1b8059={'from':$(_0x6d1edc(0x188))[_0x6d1edc(0x1fe)](),'to':$(_0x6d1edc(0x1f9))[_0x6d1edc(0x1fe)]()};break;}_0x2d343e&&await executeManualCommand(_0x2d343e,_0x1b8059);}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x1f2))['on']('click.amily2.chamber_nav',_0x3c7af9(0x192),function(){const _0x2e9db1=_0x3c7af9;if(!pluginAuthStatus[_0x2e9db1(0x176)])return;const _0x4f0d84=_0x3890dd[_0x2e9db1(0x20b)](_0x2e9db1(0x20e)),_0x2efa59=_0x3890dd['find'](_0x2e9db1(0x1a8)),_0x47c338=_0x3890dd[_0x2e9db1(0x20b)](_0x2e9db1(0x1c8)),_0x2057aa=_0x3890dd[_0x2e9db1(0x20b)]('#amily2_memorisation_forms_panel');_0x4f0d84['hide'](),_0x2efa59['hide'](),_0x47c338[_0x2e9db1(0x1ad)](),_0x2057aa[_0x2e9db1(0x1ad)]();switch(this['id']){case _0x2e9db1(0x16c):_0x2efa59[_0x2e9db1(0x1ba)]();break;case _0x2e9db1(0x15f):_0x47c338[_0x2e9db1(0x1ba)]();break;case'amily2_open_memorisation_forms':_0x2057aa[_0x2e9db1(0x1ba)]();break;case _0x2e9db1(0x1d9):case _0x2e9db1(0x1f4):case _0x2e9db1(0x1c0):_0x4f0d84['show']();break;}}),_0x3890dd['off'](_0x3c7af9(0x164))['on'](_0x3c7af9(0x164),_0x3c7af9(0x1b0),function(_0x51f36c){const _0x586755=_0x3c7af9;if(!pluginAuthStatus[_0x586755(0x176)])return;const _0x252bde=this['id'],_0x56e987=$(this),_0x37d8d6=_0x1cb3f7(_0x252bde[_0x586755(0x19a)](_0x586755(0x1b7),''));_0x1d7c03(_0x37d8d6,_0x56e987[_0x586755(0x21b)](_0x586755(0x19c)));if(_0x252bde===_0x586755(0x17e)&&_0x56e987[_0x586755(0x21b)]('checked')){const _0x2be2f6=extension_settings[extensionName],_0x280c1a=_0x2be2f6[_0x586755(0x1a3)]||[],_0x22f622=(_0x218b3d={'start':'','end':''},_0x4d47d2)=>_0x586755(0x1e2)+_0x4d47d2+_0x586755(0x1a9)+_0x218b3d[_0x586755(0x18a)]+_0x586755(0x1d0)+_0x218b3d[_0x586755(0x1a0)]+_0x586755(0x1ec),_0x3c0b0b=_0x280c1a['map'](_0x22f622)[_0x586755(0x1dd)](''),_0x59b309=_0x586755(0x16a)+_0x3c0b0b+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22optimization-add-rule-btn\x22\x20class=\x22menu_button\x20amily2-add-rule-btn\x22><i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';showHtmlModal('编辑内容排除规则',_0x59b309,{'okText':'确认','cancelText':'取消','onOk':_0xe3c51d=>{const _0x5c83e3=_0x586755,_0x554459=[];_0xe3c51d['find'](_0x5c83e3(0x15e))[_0x5c83e3(0x20a)](function(){const _0x4bb04b=_0x5c83e3,_0x47c68c=$(this)['find']('input')['eq'](0x0)[_0x4bb04b(0x1fe)]()[_0x4bb04b(0x1ef)](),_0x15cf63=$(this)[_0x4bb04b(0x20b)]('input')['eq'](0x1)[_0x4bb04b(0x1fe)]()[_0x4bb04b(0x1ef)]();if(_0x47c68c&&_0x15cf63)_0x554459[_0x4bb04b(0x204)]({'start':_0x47c68c,'end':_0x15cf63});}),_0x1d7c03(_0x5c83e3(0x1a3),_0x554459),toastr[_0x5c83e3(0x201)](_0x5c83e3(0x161),_0x5c83e3(0x1a1));},'onCancel':()=>{}});const _0x3fd30c=$('#optimization-exclusion-rules-container'),_0x2fb8f1=_0x3fd30c[_0x586755(0x20b)]('#optimization-rules-list');_0x3fd30c[_0x586755(0x20b)](_0x586755(0x189))['on']('click',()=>{const _0x15ccbc=_0x586755,_0x22f11b=_0x2fb8f1[_0x15ccbc(0x1e5)]()['length'];_0x2fb8f1[_0x15ccbc(0x166)](_0x22f622(undefined,_0x22f11b));}),_0x2fb8f1['on'](_0x586755(0x183),_0x586755(0x1e0),function(){const _0x3d9e91=_0x586755;$(this)[_0x3d9e91(0x1d5)](_0x3d9e91(0x15e))['remove']();});}}),_0x3890dd[_0x3c7af9(0x1be)]('change.amily2.radio')['on'](_0x3c7af9(0x17c),_0x3c7af9(0x214),function(){const _0x4dc691=_0x3c7af9;if(!pluginAuthStatus[_0x4dc691(0x176)])return;const _0x5cf476=_0x1cb3f7(this[_0x4dc691(0x200)]['replace'](_0x4dc691(0x1b7),'')),_0x3c0c31=$(_0x4dc691(0x197)+this['name']+_0x4dc691(0x1ff))[_0x4dc691(0x1fe)]();_0x1d7c03(_0x5cf476,_0x3c0c31);}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x19b))['on'](_0x3c7af9(0x19b),'#amily2_api_url,\x20#amily2_api_key,\x20#amily2_optimization_target_tag',function(){const _0xd60509=_0x3c7af9;if(!pluginAuthStatus[_0xd60509(0x176)])return;const _0x1dea72=_0x1cb3f7(this['id'][_0xd60509(0x19a)](_0xd60509(0x1b7),''));_0x1d7c03(_0x1dea72,this[_0xd60509(0x1cc)]),toastr[_0xd60509(0x201)](_0xd60509(0x209)+_0x1dea72+_0xd60509(0x1df),'Amily2号');}),_0x3890dd[_0x3c7af9(0x1be)]('change.amily2.select')['on'](_0x3c7af9(0x1de),_0x3c7af9(0x1bf),function(){const _0x336886=_0x3c7af9;if(!pluginAuthStatus[_0x336886(0x176)])return;const _0x237eec=_0x1cb3f7(this['id'][_0x336886(0x19a)](_0x336886(0x1b7),''));_0x1d7c03(_0x237eec,this['value']),populateModelDropdown();}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x1e4))['on'](_0x3c7af9(0x1e4),_0x3c7af9(0x1da),function(){const _0x25d132=_0x3c7af9;if(!pluginAuthStatus[_0x25d132(0x176)])return;const _0x28e3eb=_0x1cb3f7(this['id']['replace']('amily2_','')),_0x1b4382=this['id'][_0x25d132(0x1bd)](_0x25d132(0x1c3))?parseFloat(this[_0x25d132(0x1cc)]):parseInt(this[_0x25d132(0x1cc)],0xa);$('#'+this['id']+'_value')['text'](_0x1b4382),_0x1d7c03(_0x28e3eb,_0x1b4382);});const _0x1461d1={'mainPrompt':_0x3c7af9(0x191),'systemPrompt':_0x3c7af9(0x1f1),'outputFormatPrompt':_0x3c7af9(0x1c7)},_0x22be9f='#amily2_prompt_selector',_0x11bc4d='#amily2_unified_editor',_0x7a2d18=_0x3c7af9(0x1bc);function _0x27bd26(){const _0x277878=_0x3c7af9;if(!$(_0x22be9f)[_0x277878(0x1fa)])return;const _0x430e17=$(_0x22be9f)['val']();if(!_0x430e17)return;const _0x2a9e81=extension_settings[extensionName][_0x430e17]||'';$(_0x11bc4d)['val'](_0x2a9e81);}_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x1ce))['on']('change.amily2.prompt_selector',_0x22be9f,_0x27bd26),_0x3890dd[_0x3c7af9(0x1be)]('click.amily2.unified_save')['on'](_0x3c7af9(0x1eb),_0x7a2d18,function(){const _0x5108c4=_0x3c7af9,_0x4bc272=$(_0x22be9f)['val']();if(!_0x4bc272)return;const _0x26c584=$(_0x11bc4d)[_0x5108c4(0x1fe)]();_0x1d7c03(_0x4bc272,_0x26c584),toastr[_0x5108c4(0x201)](_0x5108c4(0x207)+_0x4bc272+_0x5108c4(0x19e),'Amily2号');}),_0x3890dd[_0x3c7af9(0x1be)]('click.amily2.unified_restore')['on'](_0x3c7af9(0x1b4),'#amily2_unified_restore_button',function(){const _0x46721f=_0x3c7af9,_0x57cffc=$(_0x22be9f)[_0x46721f(0x1fe)]();if(!_0x57cffc)return;const _0x436023=defaultSettings[_0x57cffc];$(_0x11bc4d)[_0x46721f(0x1fe)](_0x436023),_0x1d7c03(_0x57cffc,_0x436023),toastr['success'](_0x46721f(0x207)+_0x57cffc+_0x46721f(0x1e8),_0x46721f(0x1a1));}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x17b))['on'](_0x3c7af9(0x17b),_0x3c7af9(0x18c),function(){const _0x5b7d2c=_0x3c7af9;if(!pluginAuthStatus['authorized'])return;let _0x45e3b6=_0x1cb3f7(this['id'][_0x5b7d2c(0x19a)](_0x5b7d2c(0x1b7),''));_0x45e3b6==='loreDepthInput'&&(_0x45e3b6=_0x5b7d2c(0x216));const _0x2e7f5e=this['type']===_0x5b7d2c(0x1d2)?parseInt(this[_0x5b7d2c(0x1cc)],0xa):this[_0x5b7d2c(0x1cc)];_0x1d7c03(_0x45e3b6,_0x2e7f5e);if(this['id']===_0x5b7d2c(0x179)){const _0xff2fa7=$('#amily2_lore_depth_container');this['value']==='at_depth'?_0xff2fa7[_0x5b7d2c(0x195)](0xc8):_0xff2fa7[_0x5b7d2c(0x199)](0xc8);}}),_0x3890dd[_0x3c7af9(0x1be)](_0x3c7af9(0x172))['on'](_0x3c7af9(0x172),_0x3c7af9(0x1c6),function(){const _0x13136d=_0x3c7af9;if(!pluginAuthStatus[_0x13136d(0x176)])return;const _0x525bd6=$(this),_0x3a885a=$(_0x13136d(0x1d6));_0x525bd6[_0x13136d(0x21b)](_0x13136d(0x175),!![])[_0x13136d(0x1cd)](_0x13136d(0x21e)),_0x3a885a['text'](_0x13136d(0x208))[_0x13136d(0x1db)]()[_0x13136d(0x1d1)](),setTimeout(()=>{const _0x2230b1=_0x13136d;_0x525bd6[_0x2230b1(0x21b)](_0x2230b1(0x175),![])[_0x2230b1(0x1cd)](_0x2230b1(0x1b6)),_0x3a885a['fadeOut']();},0x9c4);}),setTimeout(_0x27bd26,0x64),_0x52afec(),_0x3890dd[_0x3c7af9(0x198)](_0x3c7af9(0x181),!![]);}$(document)['on'](_0x4bdbb9(0x19f),'input[name=\x22amily2_icon_location\x22]',function(){const _0x2f440c=_0x4bdbb9;if(!pluginAuthStatus['authorized'])return;const _0x3e95de=$(this)[_0x2f440c(0x1fe)]();extension_settings[extensionName][_0x2f440c(0x16d)]=_0x3e95de,saveSettingsDebounced(),console[_0x2f440c(0x17d)](_0x2f440c(0x1b1)+_0x3e95de+'。圣意已存档。'),toastr[_0x2f440c(0x21c)](_0x2f440c(0x1f7)+(_0x3e95de==='topbar'?'顶栏':_0x2f440c(0x174))+_0x2f440c(0x168),_0x2f440c(0x1a7),{'timeOut':0x7d0}),$(_0x2f440c(0x171))[_0x2f440c(0x165)](),$(document)[_0x2f440c(0x1be)](_0x2f440c(0x1b2)),$(_0x2f440c(0x20d))[_0x2f440c(0x165)](),setTimeout(createDrawer,0x32);});
