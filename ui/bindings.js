const _0x555a6f=_0x4a54;(function(_0x294cc1,_0x7034fa){const _0x4c16c5=_0x4a54,_0x10a1d8=_0x294cc1();while(!![]){try{const _0x3b7d70=parseInt(_0x4c16c5(0x198))/0x1+parseInt(_0x4c16c5(0x1d3))/0x2+parseInt(_0x4c16c5(0x1ab))/0x3*(parseInt(_0x4c16c5(0x1c0))/0x4)+-parseInt(_0x4c16c5(0x199))/0x5*(parseInt(_0x4c16c5(0x189))/0x6)+-parseInt(_0x4c16c5(0x1cc))/0x7+-parseInt(_0x4c16c5(0x21e))/0x8*(parseInt(_0x4c16c5(0x18f))/0x9)+parseInt(_0x4c16c5(0x19b))/0xa;if(_0x3b7d70===_0x7034fa)break;else _0x10a1d8['push'](_0x10a1d8['shift']());}catch(_0x51a479){_0x10a1d8['push'](_0x10a1d8['shift']());}}}(_0x1888,0x6905b));import{extension_settings}from'/scripts/extensions.js';import{saveSettingsDebounced}from'/script.js';import{defaultSettings,extensionName}from'../utils/settings.js';import{pluginAuthStatus,activatePluginAuthorization,getPasswordForDate}from'../utils/auth.js';import{fetchSupportedModels}from'../core/api.js';import{setAvailableModels,populateModelDropdown,getLatestUpdateInfo}from'./state.js';import{fixCommand,testReplyChecker}from'../core/commands.js';import{createDrawer}from'../ui/drawer.js';import{messageFormatting}from'/script.js';import{executeManualCommand}from'../core/autoHideManager.js';function _0x4a54(_0x1362d9,_0x12b137){const _0x1888fc=_0x1888();return _0x4a54=function(_0x4a547e,_0x5bebe4){_0x4a547e=_0x4a547e-0x169;let _0x1e5f16=_0x1888fc[_0x4a547e];return _0x1e5f16;},_0x4a54(_0x1362d9,_0x12b137);}import{showContentModal,showHtmlModal}from'./page-window.js';function displayDailyAuthCode(){const _0x48df2c=_0x4a54,_0x310776=document[_0x48df2c(0x192)]('amily2_daily_code_display'),_0x5b0dd3=document[_0x48df2c(0x192)]('amily2_copy_daily_code');if(_0x310776&&_0x5b0dd3){const _0x704d9f=getPasswordForDate(new Date());_0x310776[_0x48df2c(0x1d2)]=_0x704d9f,_0x5b0dd3[_0x48df2c(0x178)](_0x48df2c(0x20e),()=>{const _0x927562=_0x48df2c;navigator[_0x927562(0x1cf)][_0x927562(0x1b1)](_0x704d9f)[_0x927562(0x1bd)](()=>{const _0x516417=_0x927562;toastr[_0x516417(0x1a0)](_0x516417(0x18b));},()=>{const _0x4f1c99=_0x927562;toastr[_0x4f1c99(0x181)](_0x4f1c99(0x1db));});});}}function _0x1888(){const _0x1991eb=['slideDown','#amily2_chat_optimiser','off','map','</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20id=\x22amily2_dialog_editor\x22\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','close','#amily2_update_indicator','message','replace','authorized','34509NmJwrC','\x20执行失败:','loreDepthInput','#amily2_lore_depth_container','value','input.amily2.range','writeText','#amily2_extension_frame','#optimization-add-rule-btn','stopPropagation','圣意已在您每次更改时自动镌刻。',']\x20已镌刻!','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22><i\x20class=\x22fas\x20fa-bell\x22\x20style=\x22color:\x20#ff9800;\x22></i>\x20帝国最新情报</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2060vh;\x20overflow-y:\x20auto;\x20background:\x20rgba(0,0,0,0.2);\x20padding:\x2015px;\x20border-radius:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mes_text\x22>','配置\x20[','change.amily2.radio','click.amily2.expand_editor','#amily2_save_lore_settings','closest','then','hide','length','36LlCxOP','children','end','val','log','#amily2_drawer_content','changelog','input[type=\x22range\x22][id^=\x22amily2_\x22]','input[type=\x22checkbox\x22][id^=\x22amily2_\x22]','trim','select[id^=\x22amily2_lore_\x22],\x20input#amily2_lore_depth_input','appendTo','3626084UeJuDN','input[type=\x22radio\x22][name^=\x22amily2_\x22]:not([name=\x22amily2_icon_location\x22])','[Amily-禁卫军]\x20收到迁都指令\x20->\x20','clipboard','number','#amily2_manual_model_input','textContent','1608710qzgBvH','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22opt-exclusion-rule-row\x22\x20data-index=\x22','。圣意已存档。','#amily2_manual_unhide_to','first','#amily2_lore_save_status','click.amily2.update_new','#amily2_unified_restore_button','复制失败，请手动复制。','.plugin-features','select#amily2_model','模型ID\x20[',']\x20已成功恢复为帝国初始蓝图。','#amily2_force_proxy','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22optimization-add-rule-btn\x22\x20class=\x22menu_button\x20amily2-add-rule-btn\x22><i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','html','click.amily2.auth','click.amily2.update','.popup-button-ok','amily2_open_additional_features','includes','请输入授权码','#amily2_model_autofetch_wrapper','unhide_all','stop','_value','loreDepth','showModal','info','input[name=\x22amily2_icon_location\x22]','.opt-exclusion-rule-row','change.amily2.manual_model','remove','操作失败:\x20','amily2_manual_unhide_confirm','#amily2_expand_editor','amily2_','topbar','fadeOut','iconLocation','checked','change.amily2.text',']\x20的新状态已保存。','prop','#amily2_manual_hide_to','click.amily2.tutorial','<i\x20class=\x22fas\x20fa-check\x22></i>\x20已确认','amily2_fix_now','at_depth','disabled','text','amily2_refresh_models','optimizationExclusionRules','change.amily2.force_proxy','#amily2_output_format_prompt',']\x20已镌刻！','input','click.amily2.unified_restore','amily2_manual_hide_confirm','click','change.amily2.lore_settings','内阁使用教程','temperature','#amily2_unified_save_button','#amily2_api_url,\x20#amily2_api_key,\x20#amily2_optimization_target_tag','slideUp','body','amily2_test','Amily2号','click.amily2.chamber_nav','#amily2_update_button','正在将帝国徽记迁往\x20[','\x22]:checked','click.amily2.unified_save','#optimization-exclusion-rules-container','37576KaJBMf','#amily2_unified_editor','change','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/NeiGe.md','amily2_back_to_main_settings',']...','toUpperCase','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','[Amily2-工部]\x20操作按钮\x20','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/ZhuDian.md','click.amily2.manual_command','amily2_back_to_main_from_forms','#amily2_auth_code','change.amily2.checkbox','change.amily2.prompt_selector','addEventListener','manual_unhide','show','#amily2_main_prompt','forceProxyForCustomApi','amily2_optimization_exclusion_enabled','#amily2_additional_features_panel','情报部回报','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22text_pole\x22\x20value=\x22','error','span[data-i18n=\x22Manage\x20extensions\x22]','#amily2_manual_unhide_from','[Amily-谕令镌刻]\x20[','append','warning',']\x20已自动保存!','click.amily2.lore_save','6ZqKkft','迁都令','授权码已复制到剪贴板！','events-bound','title','#amily2_prompt_selector','963EiQmfV','change.amily2.select','find','getElementById','\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-rule-btn\x20menu_button\x20danger_button\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','join','#amily2_system_prompt','click.amily2.actions','#amily2_refresh_models,\x20#amily2_test,\x20#amily2_fix_now','16682yDWfoP','2794955Oggbzg','谕令\x20[','10851890MkEOXz','.popup-button-cancel','[Amily-谕令确认]\x20收到指令:\x20将\x20[','#optimization-rules-list','model','success'];_0x1888=function(){return _0x1991eb;};return _0x1888();}export function bindModalEvents(){const _0x53ad56=_0x4a54,_0x57ee03=$(_0x53ad56(0x1c5))[_0x53ad56(0x1bf)]?$('#amily2_drawer_content'):$(_0x53ad56(0x1a2));displayDailyAuthCode();function _0x27dd8e(){const _0x20dd2f=_0x53ad56,_0x2cb8d4=extension_settings[extensionName]||{},_0x385494=_0x2cb8d4[_0x20dd2f(0x17c)]===!![],_0x42efc0=_0x2cb8d4['model']||'';_0x57ee03[_0x20dd2f(0x191)](_0x20dd2f(0x1e0))[_0x20dd2f(0x1fe)](_0x20dd2f(0x1fb),_0x385494),_0x57ee03[_0x20dd2f(0x191)]('#amily2_manual_model_input')['val'](_0x42efc0);const _0x479493=_0x57ee03[_0x20dd2f(0x191)](_0x20dd2f(0x1e9)),_0x13657c=_0x57ee03[_0x20dd2f(0x191)]('#amily2_manual_model_input');_0x385494?(_0x479493[_0x20dd2f(0x1be)](),_0x13657c[_0x20dd2f(0x17a)]()):(_0x479493['show'](),_0x13657c['hide']());}if(!_0x57ee03['length']||_0x57ee03['data'](_0x53ad56(0x18c)))return;const _0x5d8815=_0x58fa35=>_0x58fa35[_0x53ad56(0x1a9)](/_([a-z])/g,_0xe176b7=>_0xe176b7[0x1][_0x53ad56(0x16e)]()),_0x3e7fe7=(_0x211b30,_0x32743c)=>{const _0x4a3208=_0x53ad56;console['log'](_0x4a3208(0x19d)+_0x211b30+']\x20设置为\x20->',_0x32743c),!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName]={...extension_settings[extensionName],[_0x211b30]:_0x32743c},saveSettingsDebounced(),console['log'](_0x4a3208(0x184)+_0x211b30+_0x4a3208(0x1fd));};_0x57ee03['off'](_0x53ad56(0x208))['on'](_0x53ad56(0x208),_0x53ad56(0x1e0),function(){const _0x33d844=_0x53ad56;if(!pluginAuthStatus['authorized'])return;_0x3e7fe7(_0x33d844(0x17c),this[_0x33d844(0x1fb)]),_0x27dd8e();}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1f2))['on'](_0x53ad56(0x1f2),_0x53ad56(0x1d1),function(){const _0x44827c=_0x53ad56;if(!pluginAuthStatus[_0x44827c(0x1aa)])return;_0x3e7fe7(_0x44827c(0x19f),this['value']),toastr['success'](_0x44827c(0x1de)+this[_0x44827c(0x1af)]+_0x44827c(0x187),_0x44827c(0x217));}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1e3))['on'](_0x53ad56(0x1e3),'#auth_submit',async function(){const _0x327488=_0x53ad56,_0x5401a1=$(_0x327488(0x175))[_0x327488(0x1c3)]()['trim']();_0x5401a1?await activatePluginAuthorization(_0x5401a1):toastr[_0x327488(0x186)](_0x327488(0x1e8),_0x327488(0x217));}),_0x57ee03['off'](_0x53ad56(0x196))['on'](_0x53ad56(0x196),_0x53ad56(0x197),async function(){const _0x12c394=_0x53ad56;if(!pluginAuthStatus[_0x12c394(0x1aa)])return;const _0x27020d=$(this),_0xcbb441=_0x27020d[_0x12c394(0x1e2)]();_0x27020d[_0x12c394(0x1fe)](_0x12c394(0x204),!![])['html']('<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20处理中');try{switch(this['id']){case _0x12c394(0x206):const _0x1716b3=await fetchSupportedModels();_0x1716b3[_0x12c394(0x1bf)]>0x0&&(setAvailableModels(_0x1716b3),localStorage['setItem']('cached_models_amily2',JSON['stringify'](_0x1716b3)),populateModelDropdown());break;case _0x12c394(0x216):await testReplyChecker();break;case _0x12c394(0x202):await fixCommand();break;}}catch(_0x45e018){console[_0x12c394(0x181)](_0x12c394(0x171)+this['id']+_0x12c394(0x1ac),_0x45e018),toastr['error'](_0x12c394(0x1f4)+_0x45e018[_0x12c394(0x1a8)],_0x12c394(0x217));}finally{_0x27020d[_0x12c394(0x1fe)]('disabled',![])[_0x12c394(0x1e2)](_0xcbb441);}}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1ba))['on'](_0x53ad56(0x1ba),_0x53ad56(0x1f6),function(_0x3f5d05){const _0xf81be1=_0x53ad56;if(!pluginAuthStatus[_0xf81be1(0x1aa)])return;_0x3f5d05[_0xf81be1(0x1b4)]();const _0x21e39c=$(_0xf81be1(0x18e))[_0xf81be1(0x1c3)](),_0x3d0a5d=$(_0xf81be1(0x169))[_0xf81be1(0x1c3)](),_0x3a4d6f=_0xf81be1(0x170)+_0x21e39c+_0xf81be1(0x1a5),_0x443090=$(_0x3a4d6f)[_0xf81be1(0x1cb)](_0xf81be1(0x215)),_0x1c6b87=_0x443090[_0xf81be1(0x191)]('#amily2_dialog_editor');_0x1c6b87[_0xf81be1(0x1c3)](_0x3d0a5d);const _0x61b631=()=>{const _0x18c02e=_0xf81be1;_0x443090[0x0][_0x18c02e(0x1a6)](),_0x443090['remove']();};_0x443090[_0xf81be1(0x191)]('.popup-button-ok')['on'](_0xf81be1(0x20e),()=>{const _0x49fb96=_0xf81be1,_0x449208=_0x1c6b87[_0x49fb96(0x1c3)]();$(_0x49fb96(0x169))[_0x49fb96(0x1c3)](_0x449208),_0x3e7fe7(_0x21e39c,_0x449208),toastr[_0x49fb96(0x1a0)]('谕令\x20['+_0x21e39c+_0x49fb96(0x20a),'Amily2号'),_0x61b631();}),_0x443090[_0xf81be1(0x191)](_0xf81be1(0x19c))['on'](_0xf81be1(0x20e),_0x61b631),_0x443090[0x0][_0xf81be1(0x1ee)]();}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x200))['on'](_0x53ad56(0x200),'#amily2_open_tutorial,\x20#amily2_open_neige_tutorial',function(){const _0x320bce=_0x53ad56;if(!pluginAuthStatus[_0x320bce(0x1aa)])return;const _0x1454b5={'amily2_open_tutorial':{'title':'主殿使用教程','url':_0x320bce(0x172)},'amily2_open_neige_tutorial':{'title':_0x320bce(0x210),'url':_0x320bce(0x16b)}},_0xd8185e=_0x1454b5[this['id']];_0xd8185e&&showContentModal(_0xd8185e[_0x320bce(0x18d)],_0xd8185e['url']);}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1e4))['on'](_0x53ad56(0x1e4),_0x53ad56(0x219),function(){const _0x38c962=_0x53ad56;$(_0x38c962(0x1a7))[_0x38c962(0x1be)]();const _0x54b4c0=getLatestUpdateInfo();if(_0x54b4c0&&_0x54b4c0[_0x38c962(0x1c6)]){const _0x107a5f=messageFormatting(_0x54b4c0[_0x38c962(0x1c6)]),_0x350f8a=_0x38c962(0x1b7)+_0x107a5f+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>朕已阅</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x3c1509=$(_0x350f8a)[_0x38c962(0x1cb)](_0x38c962(0x215)),_0x1a6fa1=()=>{const _0x374b81=_0x38c962;_0x3c1509[0x0][_0x374b81(0x1a6)](),_0x3c1509[_0x374b81(0x1f3)]();};_0x3c1509['find'](_0x38c962(0x1e5))['on'](_0x38c962(0x20e),_0x1a6fa1),_0x3c1509[0x0][_0x38c962(0x1ee)]();}else toastr[_0x38c962(0x1ef)]('未能获取到云端情报，请稍后再试。',_0x38c962(0x17f));}),_0x57ee03[_0x53ad56(0x1a3)]('click.amily2.update_new')['on'](_0x53ad56(0x1d9),'#amily2_update_button_new',function(){const _0x378f80=_0x53ad56;$(_0x378f80(0x182))[_0x378f80(0x1d7)]()[_0x378f80(0x20e)]();}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x173))['on'](_0x53ad56(0x173),'#amily2_unhide_all_button,\x20#amily2_manual_hide_confirm,\x20#amily2_manual_unhide_confirm',async function(){const _0x992c09=_0x53ad56;if(!pluginAuthStatus[_0x992c09(0x1aa)])return;const _0x1fe6af=this['id'];let _0x289c45='',_0x1b6758={};switch(_0x1fe6af){case'amily2_unhide_all_button':_0x289c45=_0x992c09(0x1ea);break;case _0x992c09(0x20d):_0x289c45='manual_hide',_0x1b6758={'from':$('#amily2_manual_hide_from')['val'](),'to':$(_0x992c09(0x1ff))[_0x992c09(0x1c3)]()};break;case _0x992c09(0x1f5):_0x289c45=_0x992c09(0x179),_0x1b6758={'from':$(_0x992c09(0x183))[_0x992c09(0x1c3)](),'to':$(_0x992c09(0x1d6))[_0x992c09(0x1c3)]()};break;}_0x289c45&&await executeManualCommand(_0x289c45,_0x1b6758);}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x218))['on'](_0x53ad56(0x218),'#amily2_open_additional_features,\x20#amily2_open_rag_palace,\x20#amily2_open_memorisation_forms,\x20#amily2_back_to_main_settings,\x20#amily2_back_to_main_from_hanlinyuan,\x20#amily2_back_to_main_from_forms',function(){const _0x2d6c7e=_0x53ad56;if(!pluginAuthStatus[_0x2d6c7e(0x1aa)])return;const _0x113c92=_0x57ee03[_0x2d6c7e(0x191)](_0x2d6c7e(0x1dc)),_0xd003ac=_0x57ee03['find'](_0x2d6c7e(0x17e)),_0x3155cc=_0x57ee03[_0x2d6c7e(0x191)]('#amily2_hanlinyuan_panel'),_0x572d65=_0x57ee03[_0x2d6c7e(0x191)]('#amily2_memorisation_forms_panel');_0x113c92['hide'](),_0xd003ac[_0x2d6c7e(0x1be)](),_0x3155cc['hide'](),_0x572d65['hide']();switch(this['id']){case _0x2d6c7e(0x1e6):_0xd003ac[_0x2d6c7e(0x17a)]();break;case'amily2_open_rag_palace':_0x3155cc[_0x2d6c7e(0x17a)]();break;case'amily2_open_memorisation_forms':_0x572d65[_0x2d6c7e(0x17a)]();break;case _0x2d6c7e(0x16c):case'amily2_back_to_main_from_hanlinyuan':case _0x2d6c7e(0x174):_0x113c92['show']();break;}}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x176))['on'](_0x53ad56(0x176),_0x53ad56(0x1c8),function(_0xeeea3){const _0x307fd2=_0x53ad56;if(!pluginAuthStatus['authorized'])return;const _0x3e4b38=this['id'],_0x38a04e=$(this),_0x3d2252=_0x5d8815(_0x3e4b38[_0x307fd2(0x1a9)](_0x307fd2(0x1f7),''));_0x3e7fe7(_0x3d2252,_0x38a04e['prop'](_0x307fd2(0x1fb)));if(_0x3e4b38===_0x307fd2(0x17d)&&_0x38a04e[_0x307fd2(0x1fe)](_0x307fd2(0x1fb))){const _0x1542e9=extension_settings[extensionName],_0xf01af5=_0x1542e9[_0x307fd2(0x207)]||[],_0x5adca6=(_0x387087={'start':'','end':''},_0x13ee46)=>_0x307fd2(0x1d4)+_0x13ee46+_0x307fd2(0x180)+_0x387087['start']+_0x307fd2(0x16f)+_0x387087[_0x307fd2(0x1c2)]+_0x307fd2(0x193),_0x553fc6=_0xf01af5[_0x307fd2(0x1a4)](_0x5adca6)[_0x307fd2(0x194)](''),_0x33667a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22notes\x22>在这里定义需要从优化内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22optimization-rules-list\x22\x20style=\x22max-height:\x2045vh;\x20overflow-y:\x20auto;\x20padding:\x2010px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.1);\x20border-radius:\x205px;\x20margin-bottom:10px;\x22>'+_0x553fc6+_0x307fd2(0x1e1);showHtmlModal('编辑内容排除规则',_0x33667a,{'okText':'确认','cancelText':'取消','onOk':_0x4849b1=>{const _0x27e17c=_0x307fd2,_0x280dea=[];_0x4849b1[_0x27e17c(0x191)](_0x27e17c(0x1f1))['each'](function(){const _0x393394=_0x27e17c,_0x302ada=$(this)['find'](_0x393394(0x20b))['eq'](0x0)[_0x393394(0x1c3)]()[_0x393394(0x1c9)](),_0x1f53aa=$(this)['find'](_0x393394(0x20b))['eq'](0x1)[_0x393394(0x1c3)]()[_0x393394(0x1c9)]();if(_0x302ada&&_0x1f53aa)_0x280dea['push']({'start':_0x302ada,'end':_0x1f53aa});}),_0x3e7fe7(_0x27e17c(0x207),_0x280dea),toastr[_0x27e17c(0x1a0)]('排除规则已更新。',_0x27e17c(0x217));},'onCancel':()=>{}});const _0x1628bf=$(_0x307fd2(0x21d)),_0x3dd012=_0x1628bf[_0x307fd2(0x191)](_0x307fd2(0x19e));_0x1628bf[_0x307fd2(0x191)](_0x307fd2(0x1b3))['on'](_0x307fd2(0x20e),()=>{const _0x51ece3=_0x307fd2,_0x190461=_0x3dd012[_0x51ece3(0x1c1)]()[_0x51ece3(0x1bf)];_0x3dd012[_0x51ece3(0x185)](_0x5adca6(undefined,_0x190461));}),_0x3dd012['on'](_0x307fd2(0x20e),'.delete-rule-btn',function(){const _0x34fb98=_0x307fd2;$(this)[_0x34fb98(0x1bc)](_0x34fb98(0x1f1))[_0x34fb98(0x1f3)]();});}}),_0x57ee03['off']('change.amily2.radio')['on'](_0x53ad56(0x1b9),_0x53ad56(0x1cd),function(){const _0x378934=_0x53ad56;if(!pluginAuthStatus[_0x378934(0x1aa)])return;const _0x27940d=_0x5d8815(this['name'][_0x378934(0x1a9)]('amily2_','')),_0x184fb8=$('input[name=\x22'+this['name']+_0x378934(0x21b))[_0x378934(0x1c3)]();_0x3e7fe7(_0x27940d,_0x184fb8);}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1fc))['on']('change.amily2.text',_0x53ad56(0x213),function(){const _0x3c71c3=_0x53ad56;if(!pluginAuthStatus[_0x3c71c3(0x1aa)])return;const _0x52c981=_0x5d8815(this['id'][_0x3c71c3(0x1a9)]('amily2_',''));_0x3e7fe7(_0x52c981,this[_0x3c71c3(0x1af)]),toastr[_0x3c71c3(0x1a0)](_0x3c71c3(0x1b8)+_0x52c981+_0x3c71c3(0x187),'Amily2号');}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x190))['on']('change.amily2.select',_0x53ad56(0x1dd),function(){const _0x920790=_0x53ad56;if(!pluginAuthStatus['authorized'])return;const _0x490d23=_0x5d8815(this['id'][_0x920790(0x1a9)](_0x920790(0x1f7),''));_0x3e7fe7(_0x490d23,this[_0x920790(0x1af)]),populateModelDropdown();}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x1b0))['on'](_0x53ad56(0x1b0),_0x53ad56(0x1c7),function(){const _0x13b16c=_0x53ad56;if(!pluginAuthStatus[_0x13b16c(0x1aa)])return;const _0x41efcc=_0x5d8815(this['id'][_0x13b16c(0x1a9)](_0x13b16c(0x1f7),'')),_0x290299=this['id'][_0x13b16c(0x1e7)](_0x13b16c(0x211))?parseFloat(this[_0x13b16c(0x1af)]):parseInt(this[_0x13b16c(0x1af)],0xa);$('#'+this['id']+_0x13b16c(0x1ec))[_0x13b16c(0x205)](_0x290299),_0x3e7fe7(_0x41efcc,_0x290299);});const _0xc87011={'mainPrompt':_0x53ad56(0x17b),'systemPrompt':_0x53ad56(0x195),'outputFormatPrompt':_0x53ad56(0x209)},_0x47e9a4=_0x53ad56(0x18e),_0x5dc547=_0x53ad56(0x169),_0x25ab4a=_0x53ad56(0x212);function _0x2dc88f(){const _0x461116=_0x53ad56;if(!$(_0x47e9a4)[_0x461116(0x1bf)])return;const _0x40930d=$(_0x47e9a4)['val']();if(!_0x40930d)return;const _0x97f8cf=extension_settings[extensionName][_0x40930d]||'';$(_0x5dc547)[_0x461116(0x1c3)](_0x97f8cf);}_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x177))['on'](_0x53ad56(0x177),_0x47e9a4,_0x2dc88f),_0x57ee03['off'](_0x53ad56(0x21c))['on'](_0x53ad56(0x21c),_0x25ab4a,function(){const _0x590350=_0x53ad56,_0x3098ea=$(_0x47e9a4)[_0x590350(0x1c3)]();if(!_0x3098ea)return;const _0x57f659=$(_0x5dc547)[_0x590350(0x1c3)]();_0x3e7fe7(_0x3098ea,_0x57f659),toastr[_0x590350(0x1a0)]('谕令\x20['+_0x3098ea+_0x590350(0x1b6),_0x590350(0x217));}),_0x57ee03['off'](_0x53ad56(0x20c))['on'](_0x53ad56(0x20c),_0x53ad56(0x1da),function(){const _0x18a423=_0x53ad56,_0x4166c1=$(_0x47e9a4)[_0x18a423(0x1c3)]();if(!_0x4166c1)return;const _0x48aca0=defaultSettings[_0x4166c1];$(_0x5dc547)[_0x18a423(0x1c3)](_0x48aca0),_0x3e7fe7(_0x4166c1,_0x48aca0),toastr[_0x18a423(0x1a0)](_0x18a423(0x19a)+_0x4166c1+_0x18a423(0x1df),'Amily2号');}),_0x57ee03[_0x53ad56(0x1a3)](_0x53ad56(0x20f))['on']('change.amily2.lore_settings',_0x53ad56(0x1ca),function(){const _0xe18531=_0x53ad56;if(!pluginAuthStatus[_0xe18531(0x1aa)])return;let _0x2c1ad8=_0x5d8815(this['id'][_0xe18531(0x1a9)]('amily2_',''));_0x2c1ad8===_0xe18531(0x1ad)&&(_0x2c1ad8=_0xe18531(0x1ed));const _0x29fcd6=this['type']===_0xe18531(0x1d0)?parseInt(this[_0xe18531(0x1af)],0xa):this[_0xe18531(0x1af)];_0x3e7fe7(_0x2c1ad8,_0x29fcd6);if(this['id']==='amily2_lore_insertion_position'){const _0x255133=$(_0xe18531(0x1ae));this['value']===_0xe18531(0x203)?_0x255133[_0xe18531(0x1a1)](0xc8):_0x255133[_0xe18531(0x214)](0xc8);}}),_0x57ee03[_0x53ad56(0x1a3)]('click.amily2.lore_save')['on'](_0x53ad56(0x188),_0x53ad56(0x1bb),function(){const _0x3fb0ee=_0x53ad56;if(!pluginAuthStatus[_0x3fb0ee(0x1aa)])return;const _0x4564f2=$(this),_0x38daba=$(_0x3fb0ee(0x1d8));_0x4564f2[_0x3fb0ee(0x1fe)](_0x3fb0ee(0x204),!![])[_0x3fb0ee(0x1e2)](_0x3fb0ee(0x201)),_0x38daba[_0x3fb0ee(0x205)](_0x3fb0ee(0x1b5))[_0x3fb0ee(0x1eb)]()['fadeIn'](),setTimeout(()=>{const _0x7a8e52=_0x3fb0ee;_0x4564f2[_0x7a8e52(0x1fe)]('disabled',![])[_0x7a8e52(0x1e2)]('<i\x20class=\x22fas\x20fa-save\x22></i>\x20确认敕令'),_0x38daba[_0x7a8e52(0x1f9)]();},0x9c4);}),setTimeout(_0x2dc88f,0x64),_0x27dd8e(),_0x57ee03['data'](_0x53ad56(0x18c),!![]);}$(document)['on'](_0x555a6f(0x16a),_0x555a6f(0x1f0),function(){const _0x2455da=_0x555a6f;if(!pluginAuthStatus[_0x2455da(0x1aa)])return;const _0x4e33cd=$(this)[_0x2455da(0x1c3)]();extension_settings[extensionName][_0x2455da(0x1fa)]=_0x4e33cd,saveSettingsDebounced(),console[_0x2455da(0x1c4)](_0x2455da(0x1ce)+_0x4e33cd+_0x2455da(0x1d5)),toastr[_0x2455da(0x1ef)](_0x2455da(0x21a)+(_0x4e33cd===_0x2455da(0x1f8)?'顶栏':'扩展区')+_0x2455da(0x16d),_0x2455da(0x18a),{'timeOut':0x7d0}),$('#amily2_main_drawer')[_0x2455da(0x1f3)](),$(document)['off']('mousedown.amily2Drawer'),$(_0x2455da(0x1b2))[_0x2455da(0x1f3)](),setTimeout(createDrawer,0x32);});
