function _0x4f8d(_0x579cb9,_0xe08b63){const _0x3d1da6=_0x3d1d();return _0x4f8d=function(_0x4f8d5d,_0x308b21){_0x4f8d5d=_0x4f8d5d-0xb4;let _0x156aca=_0x3d1da6[_0x4f8d5d];return _0x156aca;},_0x4f8d(_0x579cb9,_0xe08b63);}function _0x3d1d(){const _0x587a99=['amily2_mhb_large_refresh_lores','amily2_mhb_small_end_floor','closest','9658HRlhDL','_expand_editor','historiography-tag-extraction-toggle','historiographyIngestToRag','appendChild','getElementById','historiographyWriteToLorebook','</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','内容排除规则已保存。','<i\x20class=\x22fas\x20fa-flag-checkered\x22></i>\x20开始远征','#historiography-add-rule-btn','dataset','display','innerHTML','amily2_mhb_large_refine_execute','menu_button\x20small_button\x20interactable','warning','push','圣旨已达','<option\x20value=\x22\x22>此国史馆为空</option>','467277dUQtZj','已保存！','value','8820jYnzpx','historiographyExclusionRules','[Amily2号-工部]\x20【敕史局】的专属工匠已就位...','10GOMhNb','微言录','length','close','find','none','<option\x20value=\x22\x22>请先选择国史馆</option>','472585PjGCBt','amily2_mhb_large_worldbook_selector','map','historiography-exclusion-rules-container','historiographyLargeJailbreakPrompt','<option\x20value=\x22\x22>正在遍览帝国疆域...</option>','65136qOVkNH','破限谕旨','historiography_ingest_to_rag','圣谕不全','<i\x20class=\x22fas\x20fa-stop-circle\x22></i>\x20停止远征','target','key','9465381rHaYlt','textarea','historiographySmallAutoEnable','amily2_mhb_small_start_floor','each','圣谕有误','dispatchEvent','historiography-tag-input','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22hly-imperial-brush\x22\x20value=\x22','80dLzlir','historiographyTagExtractionEnabled','amily2_mhb_small_trigger_count','checked','3996248mUDaSs','hly-delete-rule-btn','historiography_auto_summary_interactive','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22historiography-add-rule-btn\x22\x20class=\x22hly-action-button\x22\x20style=\x22margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-exclusion-rule-row\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x2010px;\x20margin-bottom:\x2010px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-exclusion-rule-row\x20input\x20{\x20flex-grow:\x201;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-delete-rule-btn\x20{\x20background:\x20#c0392b;\x20color:\x20white;\x20border:\x20none;\x20border-radius:\x2050%;\x20width:\x2024px;\x20height:\x2024px;\x20cursor:\x20pointer;\x20font-size:\x2016px;\x20line-height:\x2024px;\x20text-align:\x20center;\x20padding:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20','options','historiographyAutoSummaryInteractive','selectedIndex','showModal','#historiography-rules-list','trim','amily2_mhb_small_expedition_execute','请输入有效的起始和结束楼层！','forEach','log','historiography_write_to_lorebook','block','querySelector','remove','amily2-expedition-state-change','appendTo','change','.hly-exclusion-rule-row','编辑内容排除规则','已恢复为默认谕旨，请点击“保存当前”以确认。','\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22hly-delete-rule-btn\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','running','<option\x20value=\x22\x22>正在检阅史册...</option>','addEventListener','className','small','val','amily2_mhb_','children','.popup-button-cancel','historiographySmallTriggerThreshold','detail','远征阈值必须是大于0的数字。已重置。','74835ggfTRb','error','end','textContent','historiographyTags','click','jailbreak','<option\x20value=\x22\x22>未发现任何国史馆</option>','5901avRzrS','createElement','state','宏史卷','style','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22hly-imperial-brush\x22\x20value=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-exclusion-rule-row\x22\x20data-index=\x22','56xijNfk','body','idle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','join','comment','input','success','已镌刻！','historiographySmallJailbreakPrompt','historiographySmallSummaryPrompt','_save_button'];_0x3d1d=function(){return _0x587a99;};return _0x3d1d();}(function(_0x5154f9,_0x5cd525){const _0x5f0b58=_0x4f8d,_0x5ac255=_0x5154f9();while(!![]){try{const _0x249f53=parseInt(_0x5f0b58(0xd0))/0x1+-parseInt(_0x5f0b58(0xf3))/0x2*(-parseInt(_0x5f0b58(0x11c))/0x3)+-parseInt(_0x5f0b58(0x12b))/0x4*(-parseInt(_0x5f0b58(0xdd))/0x5)+-parseInt(_0x5f0b58(0xd3))/0x6*(-parseInt(_0x5f0b58(0x124))/0x7)+parseInt(_0x5f0b58(0xf7))/0x8+parseInt(_0x5f0b58(0xea))/0x9*(parseInt(_0x5f0b58(0xd6))/0xa)+parseInt(_0x5f0b58(0xbc))/0xb*(-parseInt(_0x5f0b58(0xe3))/0xc);if(_0x249f53===_0x5cd525)break;else _0x5ac255['push'](_0x5ac255['shift']());}catch(_0x4cd6f2){_0x5ac255['push'](_0x5ac255['shift']());}}}(_0x3d1d,0xc67b5));import{extension_settings}from'/scripts/extensions.js';import{extensionName,defaultSettings,saveSettings}from'../utils/settings.js';import{showHtmlModal}from'./page-window.js';import{applyExclusionRules,extractBlocksByTags}from'../core/utils/rag-tag-extractor.js';import{getAvailableWorldbooks,getLoresForWorldbook,executeManualSummary,executeRefinement,executeExpedition,stopExpedition}from'../core/historiographer.js';function setupPromptEditor(_0x5bf17f){const _0x43cb26=_0x4f8d,_0x3ec868=document[_0x43cb26(0xc1)](_0x43cb26(0x116)+_0x5bf17f+'_prompt_selector'),_0x19c727=document['getElementById'](_0x43cb26(0x116)+_0x5bf17f+'_editor'),_0x2a8be9=document[_0x43cb26(0xc1)](_0x43cb26(0x116)+_0x5bf17f+_0x43cb26(0xb8)),_0x59a7ac=document[_0x43cb26(0xc1)](_0x43cb26(0x116)+_0x5bf17f+'_restore_button'),_0x572168=_0x5bf17f===_0x43cb26(0x114)?_0x43cb26(0xb6):_0x43cb26(0xe1),_0x46577d=_0x5bf17f==='small'?_0x43cb26(0xb7):'historiographyLargeRefinePrompt',_0xf7cf57=()=>{const _0x2fb04c=_0x43cb26,_0x3aeaac=_0x3ec868[_0x2fb04c(0xd2)];_0x3aeaac===_0x2fb04c(0x122)?_0x19c727['value']=extension_settings[extensionName][_0x572168]:_0x19c727[_0x2fb04c(0xd2)]=extension_settings[extensionName][_0x46577d];};_0x3ec868[_0x43cb26(0x112)](_0x43cb26(0x10b),_0xf7cf57),_0x2a8be9[_0x43cb26(0x112)](_0x43cb26(0x121),()=>{const _0x12402e=_0x43cb26,_0x49cea9=_0x3ec868[_0x12402e(0xd2)];_0x49cea9===_0x12402e(0x122)?extension_settings[extensionName][_0x572168]=_0x19c727[_0x12402e(0xd2)]:extension_settings[extensionName][_0x46577d]=_0x19c727[_0x12402e(0xd2)],saveSettings()&&toastr[_0x12402e(0xb4)]((_0x5bf17f===_0x12402e(0x114)?_0x12402e(0xd7):_0x12402e(0x127))+'的'+(_0x49cea9===_0x12402e(0x122)?_0x12402e(0xe4):'纲要')+_0x12402e(0xd1));}),_0x59a7ac[_0x43cb26(0x112)](_0x43cb26(0x121),()=>{const _0x37c33b=_0x43cb26,_0x3cebf0=_0x3ec868[_0x37c33b(0xd2)];_0x3cebf0==='jailbreak'?_0x19c727[_0x37c33b(0xd2)]=defaultSettings[_0x572168]:_0x19c727[_0x37c33b(0xd2)]=defaultSettings[_0x46577d],toastr['info'](_0x37c33b(0x10e));}),_0xf7cf57();const _0x299602=document[_0x43cb26(0xc1)](_0x43cb26(0x116)+_0x5bf17f+_0x43cb26(0xbd));_0x299602[_0x43cb26(0x112)](_0x43cb26(0x121),()=>{const _0xb5ee76=_0x43cb26,_0x3be57d=_0x3ec868[_0xb5ee76(0xd2)],_0x3fcfbd=_0x3ec868[_0xb5ee76(0xfb)][_0x3ec868[_0xb5ee76(0xfd)]]['text'],_0x892e7e=_0x19c727[_0xb5ee76(0xd2)],_0x8e25ac=_0xb5ee76(0x12e)+_0x3fcfbd+_0xb5ee76(0xc3),_0x90d3c0=$(_0x8e25ac)[_0xb5ee76(0x10a)](_0xb5ee76(0x12c)),_0x38dccf=_0x90d3c0['find'](_0xb5ee76(0xeb));_0x38dccf[_0xb5ee76(0x115)](_0x892e7e);const _0x100274=()=>{const _0x450ce3=_0xb5ee76;_0x90d3c0[0x0][_0x450ce3(0xd9)](),_0x90d3c0[_0x450ce3(0x108)]();};_0x90d3c0[_0xb5ee76(0xda)]('.popup-button-ok')['on'](_0xb5ee76(0x121),()=>{const _0x26db34=_0xb5ee76,_0xf2d6fa=_0x38dccf[_0x26db34(0x115)]();_0x19c727[_0x26db34(0xd2)]=_0xf2d6fa,_0x3be57d===_0x26db34(0x122)?extension_settings[extensionName][_0x572168]=_0xf2d6fa:extension_settings[extensionName][_0x46577d]=_0xf2d6fa,saveSettings()&&toastr[_0x26db34(0xb4)]((_0x5bf17f==='small'?_0x26db34(0xd7):_0x26db34(0x127))+'的'+_0x3fcfbd+_0x26db34(0xb5)),_0x100274();}),_0x90d3c0[_0xb5ee76(0xda)](_0xb5ee76(0x118))['on'](_0xb5ee76(0x121),_0x100274),_0x90d3c0[0x0][_0xb5ee76(0xfe)]();});}export function bindHistoriographyEvents(){const _0xf9dce7=_0x4f8d;console[_0xf9dce7(0x104)](_0xf9dce7(0xd5)),setupPromptEditor(_0xf9dce7(0x114)),setupPromptEditor('large');const _0x10e00d=document['getElementById'](_0xf9dce7(0xed)),_0x36498d=document[_0xf9dce7(0xc1)](_0xf9dce7(0xba)),_0x2e397f=document[_0xf9dce7(0xc1)]('amily2_mhb_small_manual_execute'),_0x33f5c3=document[_0xf9dce7(0xc1)]('amily2_mhb_small_auto_enabled'),_0x2c6bd8=document[_0xf9dce7(0xc1)](_0xf9dce7(0xf5)),_0x328475=document[_0xf9dce7(0xc1)](_0xf9dce7(0x105)),_0x101d9c=document[_0xf9dce7(0xc1)](_0xf9dce7(0xe5));_0x2e397f['addEventListener'](_0xf9dce7(0x121),()=>{const _0x1415e8=_0xf9dce7,_0x235ce2=parseInt(_0x10e00d[_0x1415e8(0xd2)],0xa),_0x1b738c=parseInt(_0x36498d['value'],0xa);if(isNaN(_0x235ce2)||isNaN(_0x1b738c)||_0x235ce2<=0x0||_0x1b738c<=0x0||_0x235ce2>_0x1b738c){toastr[_0x1415e8(0x11d)](_0x1415e8(0x102),_0x1415e8(0xef));return;}executeManualSummary(_0x235ce2,_0x1b738c);}),_0x33f5c3[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x454a94=>{const _0x12d5c9=_0xf9dce7;extension_settings[extensionName][_0x12d5c9(0xec)]=_0x454a94[_0x12d5c9(0xe8)]['checked'],saveSettings();}),_0x2c6bd8[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x42755f=>{const _0x4afa33=_0xf9dce7,_0xfc626=parseInt(_0x42755f[_0x4afa33(0xe8)]['value'],0xa);if(isNaN(_0xfc626)||_0xfc626<0x1){_0x42755f['target'][_0x4afa33(0xd2)]=defaultSettings[_0x4afa33(0x119)],toastr[_0x4afa33(0xcc)](_0x4afa33(0x11b),_0x4afa33(0xef));return;}extension_settings[extensionName][_0x4afa33(0x119)]=_0xfc626,saveSettings();}),_0x328475[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x4545d6=>{const _0x3947df=_0xf9dce7;extension_settings[extensionName][_0x3947df(0xc2)]=_0x4545d6[_0x3947df(0xe8)][_0x3947df(0xf6)],saveSettings();}),_0x101d9c[_0xf9dce7(0x112)]('change',_0x96094e=>{const _0x1dac27=_0xf9dce7;extension_settings[extensionName]['historiographyIngestToRag']=_0x96094e[_0x1dac27(0xe8)]['checked'],saveSettings();}),_0x33f5c3['checked']=extension_settings[extensionName][_0xf9dce7(0xec)]??![],_0x2c6bd8['value']=extension_settings[extensionName]['historiographySmallTriggerThreshold']??0x1e,_0x328475[_0xf9dce7(0xf6)]=extension_settings[extensionName][_0xf9dce7(0xc2)]??!![],_0x101d9c[_0xf9dce7(0xf6)]=extension_settings[extensionName][_0xf9dce7(0xbf)]??![];const _0x194c17=document['getElementById'](_0xf9dce7(0xf9));_0x194c17['checked']=extension_settings[extensionName][_0xf9dce7(0xfc)]??![],_0x194c17['addEventListener']('change',_0x589446=>{const _0xe4fcc8=_0xf9dce7;extension_settings[extensionName][_0xe4fcc8(0xfc)]=_0x589446[_0xe4fcc8(0xe8)][_0xe4fcc8(0xf6)],saveSettings();});const _0x5c55d3=document[_0xf9dce7(0xc1)](_0xf9dce7(0xbe)),_0x28dfa5=document[_0xf9dce7(0xc1)]('historiography-tag-input-container'),_0x4f3fda=document[_0xf9dce7(0xc1)](_0xf9dce7(0xf1)),_0x549c34=document[_0xf9dce7(0xc1)]('historiography-exclusion-rules-btn');_0x5c55d3[_0xf9dce7(0xf6)]=extension_settings[extensionName]['historiographyTagExtractionEnabled']??![],_0x4f3fda[_0xf9dce7(0xd2)]=extension_settings[extensionName]['historiographyTags']??'',_0x28dfa5['style'][_0xf9dce7(0xc8)]=_0x5c55d3[_0xf9dce7(0xf6)]?_0xf9dce7(0x106):_0xf9dce7(0xdb),_0x5c55d3[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x4129fd=>{const _0x44ec6e=_0xf9dce7,_0x3a49c6=_0x4129fd[_0x44ec6e(0xe8)][_0x44ec6e(0xf6)];extension_settings[extensionName][_0x44ec6e(0xf4)]=_0x3a49c6,_0x28dfa5[_0x44ec6e(0x128)][_0x44ec6e(0xc8)]=_0x3a49c6?_0x44ec6e(0x106):_0x44ec6e(0xdb),saveSettings();}),_0x4f3fda[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x2ef318=>{const _0x18b524=_0xf9dce7;extension_settings[extensionName][_0x18b524(0x120)]=_0x2ef318['target'][_0x18b524(0xd2)],saveSettings();}),_0x549c34[_0xf9dce7(0x112)](_0xf9dce7(0x121),showHistoriographyExclusionRulesModal);const _0x4d0cb8=document[_0xf9dce7(0xc1)](_0xf9dce7(0x101)),_0x2b3abd=_0x5bb597=>{const _0x1eea1a=_0xf9dce7;_0x4d0cb8[_0x1eea1a(0xc7)][_0x1eea1a(0x126)]=_0x5bb597;switch(_0x5bb597){case _0x1eea1a(0x110):_0x4d0cb8[_0x1eea1a(0xc9)]=_0x1eea1a(0xe7),_0x4d0cb8['className']='menu_button\x20small_button\x20interactable\x20danger';break;case'paused':_0x4d0cb8[_0x1eea1a(0xc9)]='<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x20继续远征',_0x4d0cb8[_0x1eea1a(0x113)]='menu_button\x20small_button\x20interactable\x20success';break;case _0x1eea1a(0x12d):default:_0x4d0cb8[_0x1eea1a(0xc9)]=_0x1eea1a(0xc5),_0x4d0cb8[_0x1eea1a(0x113)]=_0x1eea1a(0xcb);break;}};document[_0xf9dce7(0x112)](_0xf9dce7(0x109),_0x478404=>{const _0xda2678=_0xf9dce7,{isRunning:_0xd70272,manualStop:_0x5ad457}=_0x478404[_0xda2678(0x11a)];if(_0xd70272)_0x2b3abd(_0xda2678(0x110));else _0x5ad457?_0x2b3abd('paused'):_0x2b3abd('idle');}),_0x4d0cb8['addEventListener'](_0xf9dce7(0x121),()=>{const _0x48d177=_0xf9dce7,_0x589f26=_0x4d0cb8[_0x48d177(0xc7)][_0x48d177(0x126)]||'idle';_0x589f26===_0x48d177(0x110)?stopExpedition():executeExpedition();}),_0x2b3abd(_0xf9dce7(0x12d));const _0x1ef0fd=document[_0xf9dce7(0xc1)](_0xf9dce7(0xde)),_0x176c14=document[_0xf9dce7(0xc1)]('amily2_mhb_large_lore_selector'),_0x53f794=document[_0xf9dce7(0xc1)]('amily2_mhb_large_refresh_worldbooks'),_0x314734=document[_0xf9dce7(0xc1)](_0xf9dce7(0xb9)),_0x49a012=document[_0xf9dce7(0xc1)](_0xf9dce7(0xca)),_0x1d8929=async()=>{const _0x58b0cb=_0xf9dce7;_0x1ef0fd[_0x58b0cb(0xc9)]=_0x58b0cb(0xe2);const _0x35b157=await getAvailableWorldbooks();_0x1ef0fd['innerHTML']='',_0x35b157&&_0x35b157[_0x58b0cb(0xd8)]>0x0?(_0x35b157[_0x58b0cb(0x103)](_0x2672a7=>{const _0x434159=_0x58b0cb,_0x37faaf=document[_0x434159(0x125)]('option');_0x37faaf[_0x434159(0xd2)]=_0x2672a7,_0x37faaf[_0x434159(0x11f)]=_0x2672a7,_0x1ef0fd[_0x434159(0xc0)](_0x37faaf);}),_0x1ef0fd[_0x58b0cb(0xf0)](new Event(_0x58b0cb(0x10b)))):_0x1ef0fd['innerHTML']=_0x58b0cb(0x123);},_0x5e6011=async()=>{const _0x2fde9f=_0xf9dce7,_0x9677fd=_0x1ef0fd[_0x2fde9f(0xd2)];if(!_0x9677fd){_0x176c14['innerHTML']=_0x2fde9f(0xdc);return;}_0x176c14[_0x2fde9f(0xc9)]=_0x2fde9f(0x111);const _0x489251=await getLoresForWorldbook(_0x9677fd);_0x176c14[_0x2fde9f(0xc9)]='',_0x489251&&_0x489251[_0x2fde9f(0xd8)]>0x0?_0x489251[_0x2fde9f(0x103)](_0x2ef681=>{const _0x3fd0c7=_0x2fde9f,_0x5b5846=document['createElement']('option');_0x5b5846[_0x3fd0c7(0xd2)]=_0x2ef681[_0x3fd0c7(0xe9)],_0x5b5846['textContent']='['+_0x2ef681[_0x3fd0c7(0xe9)]+']\x20'+_0x2ef681[_0x3fd0c7(0x130)],_0x176c14[_0x3fd0c7(0xc0)](_0x5b5846);}):_0x176c14[_0x2fde9f(0xc9)]=_0x2fde9f(0xcf);};_0x53f794['addEventListener']('click',_0x1d8929),_0x1ef0fd[_0xf9dce7(0x112)](_0xf9dce7(0x10b),_0x5e6011),_0x314734['addEventListener'](_0xf9dce7(0x121),_0x5e6011),_0x49a012[_0xf9dce7(0x112)](_0xf9dce7(0x121),()=>{const _0x370071=_0xf9dce7,_0x120e93=_0x1ef0fd[_0x370071(0xd2)],_0x9267b0=_0x176c14[_0x370071(0xd2)];if(!_0x120e93||!_0x9267b0){toastr['error']('请先选择一个国史馆及其中的史册条目！',_0x370071(0xe6));return;}executeRefinement(_0x120e93,_0x9267b0);});}function showHistoriographyExclusionRulesModal(){const _0x1130c1=_0x4f8d,_0x35460d=extension_settings[extensionName][_0x1130c1(0xd4)]||[],_0x288d26=(_0x167234={'start':'','end':''},_0x545a70)=>_0x1130c1(0x12a)+_0x545a70+_0x1130c1(0x129)+_0x167234['start']+_0x1130c1(0xf2)+_0x167234[_0x1130c1(0x11e)]+_0x1130c1(0x10f),_0x4d3463=_0x35460d[_0x1130c1(0xdf)](_0x288d26)[_0x1130c1(0x12f)](''),_0x1ed899='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22historiography-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22hly-notes\x22>在这里定义需要从提取内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22historiography-rules-list\x22>'+_0x4d3463+_0x1130c1(0xfa);showHtmlModal(_0x1130c1(0x10d),_0x1ed899,{'okText':'保存规则','onOk':_0x38ea18=>{const _0x40f05a=_0x1130c1,_0x41a221=[];_0x38ea18[_0x40f05a(0xda)](_0x40f05a(0x10c))[_0x40f05a(0xee)](function(){const _0x2501cd=_0x40f05a,_0x3688c2=$(this)['find'](_0x2501cd(0x131))['eq'](0x0)[_0x2501cd(0x115)]()[_0x2501cd(0x100)](),_0x215067=$(this)['find'](_0x2501cd(0x131))['eq'](0x1)[_0x2501cd(0x115)]()[_0x2501cd(0x100)]();_0x3688c2&&_0x215067&&_0x41a221[_0x2501cd(0xcd)]({'start':_0x3688c2,'end':_0x215067});}),extension_settings[extensionName][_0x40f05a(0xd4)]=_0x41a221,saveSettings(),toastr[_0x40f05a(0xb4)](_0x40f05a(0xc4),_0x40f05a(0xce));}});const _0x4a0859=document[_0x1130c1(0xc1)](_0x1130c1(0xe0)),_0x2d4b19=_0x4a0859[_0x1130c1(0x107)](_0x1130c1(0xff));_0x4a0859[_0x1130c1(0x107)](_0x1130c1(0xc6))[_0x1130c1(0x112)]('click',()=>{const _0x34f4a3=_0x1130c1,_0x51820e=_0x2d4b19[_0x34f4a3(0x117)][_0x34f4a3(0xd8)],_0xf61a56=_0x288d26({'start':'','end':''},_0x51820e);_0x2d4b19['insertAdjacentHTML']('beforeend',_0xf61a56);}),_0x2d4b19['addEventListener']('click',_0x1277bd=>{const _0xad226d=_0x1130c1;_0x1277bd[_0xad226d(0xe8)]['classList']['contains'](_0xad226d(0xf8))&&_0x1277bd[_0xad226d(0xe8)][_0xad226d(0xbb)](_0xad226d(0x10c))[_0xad226d(0x108)]();});}