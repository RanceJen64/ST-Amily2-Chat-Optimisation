(function(_0x4b5239,_0x5dd4d6){const _0x3a1abe=_0x29e6,_0x4d6cbe=_0x4b5239();while(!![]){try{const _0x4c97f3=parseInt(_0x3a1abe(0xaf))/0x1+parseInt(_0x3a1abe(0xae))/0x2*(parseInt(_0x3a1abe(0x88))/0x3)+parseInt(_0x3a1abe(0xc6))/0x4*(-parseInt(_0x3a1abe(0xc9))/0x5)+parseInt(_0x3a1abe(0xa0))/0x6*(parseInt(_0x3a1abe(0x8d))/0x7)+parseInt(_0x3a1abe(0xb7))/0x8*(parseInt(_0x3a1abe(0x8a))/0x9)+-parseInt(_0x3a1abe(0xaa))/0xa+-parseInt(_0x3a1abe(0xd7))/0xb;if(_0x4c97f3===_0x5dd4d6)break;else _0x4d6cbe['push'](_0x4d6cbe['shift']());}catch(_0x19aad4){_0x4d6cbe['push'](_0x4d6cbe['shift']());}}}(_0x1258,0xb5b21));import{extension_settings}from'/scripts/extensions.js';import{extensionName,defaultSettings,saveSettings}from'../utils/settings.js';function _0x29e6(_0x3a979c,_0x39a15a){const _0x1258d1=_0x1258();return _0x29e6=function(_0x29e6d3,_0x2e136d){_0x29e6d3=_0x29e6d3-0x85;let _0x1d7ae6=_0x1258d1[_0x29e6d3];return _0x1d7ae6;},_0x29e6(_0x3a979c,_0x39a15a);}import{getAvailableWorldbooks,getLoresForWorldbook,executeManualSummary,executeRefinement,executeExpedition,stopExpedition}from'../core/historiographer.js';function _0x1258(){const _0xf3c239=['12216138JAsRpi','amily2_mhb_large_refine_execute','options','info','<option\x20value=\x22\x22>正在检阅史册...</option>','<option\x20value=\x22\x22>正在遍览帝国疆域...</option>','36cjwTKm','body','2450961yYIFKJ','remove','selectedIndex','7sYDTLo','target','text','已镌刻！','success','innerHTML','jailbreak','idle','<i\x20class=\x22fas\x20fa-flag-checkered\x22></i>\x20开始远征','textContent','menu_button\x20small_button\x20interactable\x20success','amily2_mhb_large_refresh_worldbooks','_editor','detail','amily2_mhb_large_worldbook_selector','log','amily2_mhb_small_expedition_execute','forEach','find','2374926KkRwSf','dataset','amily2_mhb_large_lore_selector','appendChild','click','破限谕旨','historiographySmallAutoEnable','amily2_mhb_','dispatchEvent','running','5979420cHwrWh','showModal','getElementById','宏史卷','223274pFzhgi','1231506JVJviH','amily2_mhb_small_end_floor','length','<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x20继续远征','_restore_button','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>正在编辑:\x20','val','historiographySmallTriggerThreshold','24LtUPUk','value','amily2_mhb_small_manual_execute','change','.popup-button-ok','key','historiographySmallJailbreakPrompt','<option\x20value=\x22\x22>请先选择国史馆</option>','[Amily2号-工部]\x20【敕史局】的专属工匠已就位...','small','_prompt_selector','state','微言录','addEventListener','圣谕不全','5324932YsubRH','menu_button\x20small_button\x20interactable\x20danger','_expand_editor','5MVwOmn','amily2-expedition-state-change','<option\x20value=\x22\x22>此国史馆为空</option>','amily2_mhb_small_start_floor','textarea','amily2_mhb_large_refresh_lores','.popup-button-cancel','warning','close','paused','<i\x20class=\x22fas\x20fa-stop-circle\x22></i>\x20停止远征','option','className','已保存！'];_0x1258=function(){return _0xf3c239;};return _0x1258();}function setupPromptEditor(_0xff1bdb){const _0x4bc5d8=_0x29e6,_0x4ec263=document[_0x4bc5d8(0xac)]('amily2_mhb_'+_0xff1bdb+_0x4bc5d8(0xc1)),_0x503382=document[_0x4bc5d8(0xac)](_0x4bc5d8(0xa7)+_0xff1bdb+_0x4bc5d8(0x99)),_0x54707d=document['getElementById'](_0x4bc5d8(0xa7)+_0xff1bdb+'_save_button'),_0x1b1186=document[_0x4bc5d8(0xac)]('amily2_mhb_'+_0xff1bdb+_0x4bc5d8(0xb3)),_0x3cd285=_0xff1bdb===_0x4bc5d8(0xc0)?_0x4bc5d8(0xbd):'historiographyLargeJailbreakPrompt',_0xd5e1d8=_0xff1bdb==='small'?'historiographySmallSummaryPrompt':'historiographyLargeRefinePrompt',_0x22c0c7=()=>{const _0x9f7f09=_0x4bc5d8,_0x2f94b0=_0x4ec263[_0x9f7f09(0xb8)];_0x2f94b0===_0x9f7f09(0x93)?_0x503382[_0x9f7f09(0xb8)]=extension_settings[extensionName][_0x3cd285]:_0x503382[_0x9f7f09(0xb8)]=extension_settings[extensionName][_0xd5e1d8];};_0x4ec263[_0x4bc5d8(0xc4)]('change',_0x22c0c7),_0x54707d['addEventListener'](_0x4bc5d8(0xa4),()=>{const _0x5c061a=_0x4bc5d8,_0x2e3b67=_0x4ec263[_0x5c061a(0xb8)];_0x2e3b67==='jailbreak'?extension_settings[extensionName][_0x3cd285]=_0x503382[_0x5c061a(0xb8)]:extension_settings[extensionName][_0xd5e1d8]=_0x503382['value'],saveSettings()&&toastr[_0x5c061a(0x91)]((_0xff1bdb===_0x5c061a(0xc0)?_0x5c061a(0xc3):_0x5c061a(0xad))+'的'+(_0x2e3b67===_0x5c061a(0x93)?_0x5c061a(0xa5):'纲要')+_0x5c061a(0xd6));}),_0x1b1186['addEventListener']('click',()=>{const _0x4ae0c8=_0x4bc5d8,_0x128e76=_0x4ec263[_0x4ae0c8(0xb8)];_0x128e76==='jailbreak'?_0x503382[_0x4ae0c8(0xb8)]=defaultSettings[_0x3cd285]:_0x503382['value']=defaultSettings[_0xd5e1d8],toastr[_0x4ae0c8(0x85)]('已恢复为默认谕旨，请点击“保存当前”以确认。');}),_0x22c0c7();const _0x515e43=document[_0x4bc5d8(0xac)](_0x4bc5d8(0xa7)+_0xff1bdb+_0x4bc5d8(0xc8));_0x515e43[_0x4bc5d8(0xc4)](_0x4bc5d8(0xa4),()=>{const _0x4848d0=_0x4bc5d8,_0x185acd=_0x4ec263[_0x4848d0(0xb8)],_0x308557=_0x4ec263[_0x4848d0(0xd9)][_0x4ec263[_0x4848d0(0x8c)]][_0x4848d0(0x8f)],_0x3dd742=_0x503382['value'],_0x30140e=_0x4848d0(0xb4)+_0x308557+'</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x22><div\x20class=\x22height100p\x20wide100p\x20flex-container\x22><textarea\x20class=\x22height100p\x20wide100p\x20maximized_textarea\x20text_pole\x22></textarea></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22><div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存并关闭</div><div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x1e1df0=$(_0x30140e)['appendTo'](_0x4848d0(0x89)),_0x442290=_0x1e1df0[_0x4848d0(0x9f)](_0x4848d0(0xcd));_0x442290[_0x4848d0(0xb5)](_0x3dd742);const _0x5b8abc=()=>{const _0x39b63=_0x4848d0;_0x1e1df0[0x0][_0x39b63(0xd1)](),_0x1e1df0[_0x39b63(0x8b)]();};_0x1e1df0[_0x4848d0(0x9f)](_0x4848d0(0xbb))['on'](_0x4848d0(0xa4),()=>{const _0x4f7696=_0x4848d0,_0x28ff85=_0x442290[_0x4f7696(0xb5)]();_0x503382[_0x4f7696(0xb8)]=_0x28ff85,_0x185acd===_0x4f7696(0x93)?extension_settings[extensionName][_0x3cd285]=_0x28ff85:extension_settings[extensionName][_0xd5e1d8]=_0x28ff85,saveSettings()&&toastr[_0x4f7696(0x91)]((_0xff1bdb===_0x4f7696(0xc0)?_0x4f7696(0xc3):_0x4f7696(0xad))+'的'+_0x308557+_0x4f7696(0x90)),_0x5b8abc();}),_0x1e1df0[_0x4848d0(0x9f)](_0x4848d0(0xcf))['on'](_0x4848d0(0xa4),_0x5b8abc),_0x1e1df0[0x0][_0x4848d0(0xab)]();});}export function bindHistoriographyEvents(){const _0x1588b6=_0x29e6;console[_0x1588b6(0x9c)](_0x1588b6(0xbf)),setupPromptEditor('small'),setupPromptEditor('large');const _0x2e4337=document['getElementById'](_0x1588b6(0xcc)),_0x149646=document['getElementById'](_0x1588b6(0xb0)),_0x32f537=document[_0x1588b6(0xac)](_0x1588b6(0xb9)),_0x558cf4=document[_0x1588b6(0xac)]('amily2_mhb_small_auto_enabled'),_0x1e2db0=document['getElementById']('amily2_mhb_small_trigger_count');_0x32f537[_0x1588b6(0xc4)](_0x1588b6(0xa4),()=>{const _0x23951d=_0x1588b6,_0x599803=parseInt(_0x2e4337[_0x23951d(0xb8)],0xa),_0x4b78fa=parseInt(_0x149646[_0x23951d(0xb8)],0xa);if(isNaN(_0x599803)||isNaN(_0x4b78fa)||_0x599803<=0x0||_0x4b78fa<=0x0||_0x599803>_0x4b78fa){toastr['error']('请输入有效的起始和结束楼层！','圣谕有误');return;}executeManualSummary(_0x599803,_0x4b78fa);}),_0x558cf4['addEventListener'](_0x1588b6(0xba),_0x405cf8=>{const _0x18d1d7=_0x1588b6;extension_settings[extensionName][_0x18d1d7(0xa6)]=_0x405cf8[_0x18d1d7(0x8e)]['checked'],saveSettings();}),_0x1e2db0['addEventListener'](_0x1588b6(0xba),_0x5b8744=>{const _0x512039=_0x1588b6,_0x53b9c7=parseInt(_0x5b8744['target'][_0x512039(0xb8)],0xa);if(isNaN(_0x53b9c7)||_0x53b9c7<0x1){_0x5b8744[_0x512039(0x8e)][_0x512039(0xb8)]=defaultSettings[_0x512039(0xb6)],toastr[_0x512039(0xd0)]('远征阈值必须是大于0的数字。已重置。','圣谕有误');return;}extension_settings[extensionName][_0x512039(0xb6)]=_0x53b9c7,saveSettings();});const _0x2a7782=document[_0x1588b6(0xac)](_0x1588b6(0x9d)),_0x9bcaea=_0x354f80=>{const _0x32b31d=_0x1588b6;_0x2a7782[_0x32b31d(0xa1)][_0x32b31d(0xc2)]=_0x354f80;switch(_0x354f80){case _0x32b31d(0xa9):_0x2a7782[_0x32b31d(0x92)]=_0x32b31d(0xd3),_0x2a7782[_0x32b31d(0xd5)]=_0x32b31d(0xc7);break;case _0x32b31d(0xd2):_0x2a7782[_0x32b31d(0x92)]=_0x32b31d(0xb2),_0x2a7782[_0x32b31d(0xd5)]=_0x32b31d(0x97);break;case _0x32b31d(0x94):default:_0x2a7782['innerHTML']=_0x32b31d(0x95),_0x2a7782[_0x32b31d(0xd5)]='menu_button\x20small_button\x20interactable';break;}};document[_0x1588b6(0xc4)](_0x1588b6(0xca),_0x40a0d4=>{const _0x138dec=_0x1588b6,{isRunning:_0x973b16,manualStop:_0xa48ff4}=_0x40a0d4[_0x138dec(0x9a)];if(_0x973b16)_0x9bcaea(_0x138dec(0xa9));else _0xa48ff4?_0x9bcaea(_0x138dec(0xd2)):_0x9bcaea(_0x138dec(0x94));}),_0x2a7782[_0x1588b6(0xc4)](_0x1588b6(0xa4),()=>{const _0x533668=_0x1588b6,_0x198d55=_0x2a7782[_0x533668(0xa1)]['state']||'idle';_0x198d55==='running'?stopExpedition():executeExpedition();}),_0x9bcaea(_0x1588b6(0x94));const _0x25c533=document[_0x1588b6(0xac)](_0x1588b6(0x9b)),_0x4da6db=document['getElementById'](_0x1588b6(0xa2)),_0x47b2ee=document[_0x1588b6(0xac)](_0x1588b6(0x98)),_0x59a329=document[_0x1588b6(0xac)](_0x1588b6(0xce)),_0x424287=document[_0x1588b6(0xac)](_0x1588b6(0xd8)),_0x127298=async()=>{const _0x221b4b=_0x1588b6;_0x25c533[_0x221b4b(0x92)]=_0x221b4b(0x87);const _0x4f189b=await getAvailableWorldbooks();_0x25c533[_0x221b4b(0x92)]='',_0x4f189b&&_0x4f189b[_0x221b4b(0xb1)]>0x0?(_0x4f189b[_0x221b4b(0x9e)](_0x2762bf=>{const _0x9ca955=_0x221b4b,_0x39d970=document['createElement'](_0x9ca955(0xd4));_0x39d970[_0x9ca955(0xb8)]=_0x2762bf,_0x39d970[_0x9ca955(0x96)]=_0x2762bf,_0x25c533[_0x9ca955(0xa3)](_0x39d970);}),_0x25c533[_0x221b4b(0xa8)](new Event(_0x221b4b(0xba)))):_0x25c533[_0x221b4b(0x92)]='<option\x20value=\x22\x22>未发现任何国史馆</option>';},_0x3181b7=async()=>{const _0x20d6ae=_0x1588b6,_0x2efe56=_0x25c533[_0x20d6ae(0xb8)];if(!_0x2efe56){_0x4da6db[_0x20d6ae(0x92)]=_0x20d6ae(0xbe);return;}_0x4da6db[_0x20d6ae(0x92)]=_0x20d6ae(0x86);const _0x2e1f41=await getLoresForWorldbook(_0x2efe56);_0x4da6db['innerHTML']='',_0x2e1f41&&_0x2e1f41['length']>0x0?_0x2e1f41['forEach'](_0xf73c03=>{const _0x1c1875=_0x20d6ae,_0x4c8528=document['createElement']('option');_0x4c8528[_0x1c1875(0xb8)]=_0xf73c03[_0x1c1875(0xbc)],_0x4c8528[_0x1c1875(0x96)]='['+_0xf73c03[_0x1c1875(0xbc)]+']\x20'+_0xf73c03['comment'],_0x4da6db[_0x1c1875(0xa3)](_0x4c8528);}):_0x4da6db[_0x20d6ae(0x92)]=_0x20d6ae(0xcb);};_0x47b2ee[_0x1588b6(0xc4)](_0x1588b6(0xa4),_0x127298),_0x25c533[_0x1588b6(0xc4)]('change',_0x3181b7),_0x59a329[_0x1588b6(0xc4)](_0x1588b6(0xa4),_0x3181b7),_0x424287[_0x1588b6(0xc4)](_0x1588b6(0xa4),()=>{const _0x318c54=_0x1588b6,_0x1bc0d1=_0x25c533[_0x318c54(0xb8)],_0x2f3157=_0x4da6db[_0x318c54(0xb8)];if(!_0x1bc0d1||!_0x2f3157){toastr['error']('请先选择一个国史馆及其中的史册条目！',_0x318c54(0xc5));return;}executeRefinement(_0x1bc0d1,_0x2f3157);});}
