(function(_0x5eb43a,_0x5dc7b8){const _0x1897e8=_0xdf01,_0x295b02=_0x5eb43a();while(!![]){try{const _0x27af41=-parseInt(_0x1897e8(0x154))/0x1*(-parseInt(_0x1897e8(0x17c))/0x2)+-parseInt(_0x1897e8(0x16b))/0x3+parseInt(_0x1897e8(0x146))/0x4*(parseInt(_0x1897e8(0x145))/0x5)+-parseInt(_0x1897e8(0x17b))/0x6*(parseInt(_0x1897e8(0x17f))/0x7)+parseInt(_0x1897e8(0x171))/0x8*(parseInt(_0x1897e8(0x176))/0x9)+parseInt(_0x1897e8(0x156))/0xa+-parseInt(_0x1897e8(0x169))/0xb;if(_0x27af41===_0x5dc7b8)break;else _0x295b02['push'](_0x295b02['shift']());}catch(_0x30d0d9){_0x295b02['push'](_0x295b02['shift']());}}}(_0x24f8,0xcc75b));import{getSlideToggleOptions}from'/script.js';import{slideToggle}from'/lib.js';function _0x24f8(){const _0x5a480c=['<div\x20id=\x22amily2_additional_features_panel\x22\x20style=\x22display:\x20none;\x22>','extensions','<p\x20style=\x22color:red;\x20padding:10px;\x20border:1px\x20solid\x20red;\x20border-radius:5px;\x22>紧急报告：在扩展区域建造Amily2号府邸时发生意外。</p>','after','.openDrawer','/assets/hanlinyuan.html','Amily2号','mousedown.amily2Drawer','initialized','11068cTCdBN','#expiry_info','8943300piMeZL','append','#extensions_settings2','info','[Amily-重构]\x20顶栏宫殿已按模块化蓝图竣工。','#extensions_settings2\x20#amily2_chat_optimiser','closedIcon\x20openIcon','<p\x20style=\x22color:red;\x20padding:\x2020px;\x22>紧急报告：无法加载Amily2号府邸内饰。</p>','.openIcon','resizing','[Amily2号]\x20检测到有效授权，将执行自动UI更新。','正在自动加载模型列表...','<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>','topbar','/assets/Amily2-AdditionalFeatures.html','hasClass','closest','#amily2_chat_optimiser','/assets/amily2-modal.html','6844585kMkBtF','iconLocation','5000292lUXHlN','openIcon','[Amily-重构]\x20收到指令，开始在\x27扩展\x27官方区域模块化建造宫殿。','apiUrl','data','closedDrawer\x20openDrawer','261216myfTzm','.drawer-content','html','getItem','each','423iiRXcP','authorized','#amily2_drawer_icon','#amily2_drawer_content','classList','6iEyIbz','206LQQypM',',\x20自动登录标志:\x20','not','3490571EykMzT','error','stringify','length','toggleClass','parse','cached_models_amily2','get','addClass','.pinnedOpen','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_extension_frame\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-toggle\x20inline-drawer-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b><i\x20class=\x22fas\x20fa-crown\x22\x20style=\x22color:\x20#ffc107;\x22></i>\x20Amily2号\x20优化中枢</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-icon\x20fa-solid\x20fa-circle-chevron-down\x20down\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-content\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20宫殿的真正内室将在这里安家\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','#amily2_main_drawer','</div>','preventDefault','log','[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:','remove','155EABaqZ','7244UrVFPo','stopPropagation','find','.drawerPinnedOpen','setItem'];_0x24f8=function(){return _0x5a480c;};return _0x24f8();}import{extension_settings}from'/scripts/extensions.js';import{extensionName,defaultSettings}from'../utils/settings.js';import{checkAuthorization,displayExpiryInfo,pluginAuthStatus}from'../utils/auth.js';import{updateUI,setAvailableModels,populateModelDropdown,applyUpdateIndicator}from'./state.js';import{bindModalEvents}from'./bindings.js';import{fetchSupportedModels}from'../core/api.js';import{bindHistoriographyEvents}from'./historiography-bindings.js';import{bindHanlinyuanEvents}from'./hanlinyuan-bindings.js';const extensionFolderPath='scripts/extensions/third-party/'+extensionName;function _0xdf01(_0x2e7de2,_0x24af11){const _0x24f82f=_0x24f8();return _0xdf01=function(_0xdf0129,_0x1f01f7){_0xdf0129=_0xdf0129-0x13e;let _0x5c56d1=_0x24f82f[_0xdf0129];return _0x5c56d1;},_0xdf01(_0x2e7de2,_0x24af11);}async function loadSettings(){const _0x1a8fa0=_0xdf01;extension_settings[extensionName]={...defaultSettings,...extension_settings[extensionName]||{}},checkAuthorization();const _0x2630e1=localStorage['getItem']('plugin_auto_login')==='true';console['log']('[Amily2-调试]\x20授权状态:\x20'+pluginAuthStatus[_0x1a8fa0(0x177)]+_0x1a8fa0(0x17d)+_0x2630e1);_0x2630e1&&pluginAuthStatus[_0x1a8fa0(0x177)]&&console[_0x1a8fa0(0x142)](_0x1a8fa0(0x160));$(_0x1a8fa0(0x155))[_0x1a8fa0(0x173)](displayExpiryInfo()),updateUI();if(pluginAuthStatus['authorized']&&extension_settings[extensionName][_0x1a8fa0(0x16e)]){const _0x1ee9b0=localStorage[_0x1a8fa0(0x174)](_0x1a8fa0(0x185));if(_0x1ee9b0){const _0xf0eb7b=JSON[_0x1a8fa0(0x184)](_0x1ee9b0);console[_0x1a8fa0(0x142)]('[Amily2号]\x20从缓存加载模型列表\x20('+_0xf0eb7b[_0x1a8fa0(0x182)]+'个)'),setAvailableModels(_0xf0eb7b),populateModelDropdown();}else toastr[_0x1a8fa0(0x159)](_0x1a8fa0(0x161),_0x1a8fa0(0x151)),setTimeout(async()=>{const _0x5a1b53=_0x1a8fa0,_0x5200e2=await fetchSupportedModels();_0x5200e2['length']>0x0&&(setAvailableModels(_0x5200e2),localStorage[_0x5a1b53(0x14a)](_0x5a1b53(0x185),JSON[_0x5a1b53(0x181)](_0x5200e2)),populateModelDropdown());},0x1f4);}}export function createDrawer(){const _0x1b0368=_0xdf01,_0x51aca4=extension_settings[extensionName],_0x29dd42=_0x51aca4[_0x1b0368(0x16a)]||_0x1b0368(0x163);if(_0x29dd42==='topbar'){if($(_0x1b0368(0x13f))[_0x1b0368(0x182)]>0x0)return;const _0xffbaa1='\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_main_drawer\x22\x20class=\x22drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_icon\x22\x20class=\x22drawer-toggle\x20drawer-header\x20closedIcon\x20interactable\x22\x20title=\x22Amily2号优化助手\x22\x20tabindex=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22drawer-icon\x20fa-solid\x20fa-magic\x20fa-fw\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_content\x22\x20class=\x22drawer-content\x20closedDrawer\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';$('#sys-settings-button')[_0x1b0368(0x14e)](_0xffbaa1),$(document)['off']('mousedown.amily2Drawer')['on'](_0x1b0368(0x152),_0x1b0368(0x178),async function(_0x13799f){const _0x4bffa7=_0x1b0368;_0x13799f[_0x4bffa7(0x141)](),_0x13799f[_0x4bffa7(0x147)]();const _0x32d9e6=$(this),_0x365ec2=$(_0x4bffa7(0x179));$(_0x4bffa7(0x14f))[_0x4bffa7(0x17e)](_0x365ec2)[_0x4bffa7(0x17e)](_0x4bffa7(0x188))[_0x4bffa7(0x187)]('resizing')['each']((_0x332aa0,_0x5dc0bb)=>{slideToggle(_0x5dc0bb,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x345b35){const _0x44bdc5=_0xdf01;_0x345b35['closest'](_0x44bdc5(0x172))['classList'][_0x44bdc5(0x144)](_0x44bdc5(0x15f));}});}),$(_0x4bffa7(0x15e))['not'](_0x32d9e6)[_0x4bffa7(0x17e)](_0x4bffa7(0x149))['toggleClass']('closedIcon\x20openIcon'),$(_0x4bffa7(0x14f))['not'](_0x365ec2)[_0x4bffa7(0x17e)](_0x4bffa7(0x188))[_0x4bffa7(0x183)](_0x4bffa7(0x170)),_0x32d9e6[_0x4bffa7(0x183)](_0x4bffa7(0x15c)),_0x365ec2[_0x4bffa7(0x183)](_0x4bffa7(0x170)),_0x365ec2[_0x4bffa7(0x187)](_0x4bffa7(0x15f))[_0x4bffa7(0x175)]((_0x2a0d05,_0x186f72)=>{slideToggle(_0x186f72,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x31a91d){const _0x4b1ec0=_0xdf01;_0x31a91d[_0x4b1ec0(0x166)](_0x4b1ec0(0x172))[_0x4b1ec0(0x17a)][_0x4b1ec0(0x144)](_0x4b1ec0(0x15f));}});});const _0x164721=_0x365ec2[_0x4bffa7(0x16f)](_0x4bffa7(0x153));if(_0x32d9e6[_0x4bffa7(0x165)](_0x4bffa7(0x16c))&&!_0x164721)try{const _0x3f307d=await $[_0x4bffa7(0x186)](extensionFolderPath+_0x4bffa7(0x168));_0x365ec2[_0x4bffa7(0x173)](_0x3f307d);const _0x40081b=_0x365ec2['find']('#amily2_chat_optimiser');if(_0x40081b[_0x4bffa7(0x182)]){const _0x18ba6c=await $['get'](extensionFolderPath+_0x4bffa7(0x164)),_0x2f6278='<div\x20id=\x22amily2_additional_features_panel\x22\x20style=\x22display:\x20none;\x22>'+_0x18ba6c+_0x4bffa7(0x140);_0x40081b[_0x4bffa7(0x157)](_0x2f6278);const _0x2ab315=await $['get'](extensionFolderPath+_0x4bffa7(0x150)),_0x22993c=_0x4bffa7(0x162)+_0x2ab315+'</div>';_0x40081b[_0x4bffa7(0x157)](_0x22993c);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),_0x365ec2['data'](_0x4bffa7(0x153),!![]),console[_0x4bffa7(0x142)](_0x4bffa7(0x15a)),applyUpdateIndicator();}catch(_0x1c6b2f){console[_0x4bffa7(0x180)](_0x4bffa7(0x143),_0x1c6b2f),_0x365ec2[_0x4bffa7(0x173)](_0x4bffa7(0x15d));}});}else{if(_0x29dd42===_0x1b0368(0x14c)){if($(_0x1b0368(0x15b))['length']>0x0)return;const _0xabbcba=_0x1b0368(0x13e);$('#extensions_settings2')[_0x1b0368(0x157)](_0xabbcba),((async()=>{const _0x4d35d8=_0x1b0368;try{console[_0x4d35d8(0x142)](_0x4d35d8(0x16d));const _0x189dee=$('#amily2_extension_frame\x20.inline-drawer-content'),_0x2ada86=await $[_0x4d35d8(0x186)](extensionFolderPath+'/assets/amily2-modal.html');_0x189dee[_0x4d35d8(0x173)](_0x2ada86);const _0xff3c5a=_0x189dee[_0x4d35d8(0x148)](_0x4d35d8(0x167));if(_0xff3c5a[_0x4d35d8(0x182)]){const _0x207247=await $[_0x4d35d8(0x186)](extensionFolderPath+_0x4d35d8(0x164)),_0x53b8a5=_0x4d35d8(0x14b)+_0x207247+'</div>';_0xff3c5a[_0x4d35d8(0x157)](_0x53b8a5);const _0x3672fe=await $[_0x4d35d8(0x186)](extensionFolderPath+_0x4d35d8(0x150)),_0x308977=_0x4d35d8(0x162)+_0x3672fe+_0x4d35d8(0x140);_0xff3c5a[_0x4d35d8(0x157)](_0x308977);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),applyUpdateIndicator();}catch(_0x9fe53){console['error']('[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:',_0x9fe53),$(_0x4d35d8(0x158))[_0x4d35d8(0x157)](_0x4d35d8(0x14d));}})());}}}
