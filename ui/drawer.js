const _0x3dbaa4=_0x4c08;(function(_0x2e01a8,_0x4026da){const _0x21fc9a=_0x4c08,_0x464042=_0x2e01a8();while(!![]){try{const _0x865737=-parseInt(_0x21fc9a(0xb7))/0x1*(parseInt(_0x21fc9a(0xae))/0x2)+-parseInt(_0x21fc9a(0xc5))/0x3*(-parseInt(_0x21fc9a(0xe8))/0x4)+parseInt(_0x21fc9a(0xb4))/0x5+-parseInt(_0x21fc9a(0xe2))/0x6*(parseInt(_0x21fc9a(0xc1))/0x7)+-parseInt(_0x21fc9a(0xb3))/0x8*(-parseInt(_0x21fc9a(0xd1))/0x9)+parseInt(_0x21fc9a(0xd6))/0xa*(-parseInt(_0x21fc9a(0xc6))/0xb)+parseInt(_0x21fc9a(0xa5))/0xc*(parseInt(_0x21fc9a(0xe9))/0xd);if(_0x865737===_0x4026da)break;else _0x464042['push'](_0x464042['shift']());}catch(_0x5e060b){_0x464042['push'](_0x464042['shift']());}}}(_0x4203,0xf1d9d));import{getSlideToggleOptions}from'/script.js';import{slideToggle}from'/lib.js';import{extension_settings,renderExtensionTemplateAsync}from'/scripts/extensions.js';import{extensionName,defaultSettings}from'../utils/settings.js';import{checkAuthorization,displayExpiryInfo,pluginAuthStatus}from'../utils/auth.js';function _0x4c08(_0x1267eb,_0x3bd604){const _0x4203e7=_0x4203();return _0x4c08=function(_0x4c0835,_0x1ccf3e){_0x4c0835=_0x4c0835-0x97;let _0x10cf25=_0x4203e7[_0x4c0835];return _0x10cf25;},_0x4c08(_0x1267eb,_0x3bd604);}import{updateUI,setAvailableModels,populateModelDropdown,applyUpdateIndicator}from'./state.js';import{bindModalEvents}from'./bindings.js';import{fetchModels}from'../core/api.js';import{bindHistoriographyEvents}from'./historiography-bindings.js';import{bindHanlinyuanEvents}from'./hanlinyuan-bindings.js';import{bindTableEvents}from'./table-bindings.js';import{showContentModal}from'./page-window.js';const extensionFolderPath=_0x3dbaa4(0xc8)+extensionName;async function loadSettings(){const _0x49dcb6=_0x3dbaa4;extension_settings[extensionName]={...defaultSettings,...extension_settings[extensionName]||{}},checkAuthorization();const _0x209882=localStorage[_0x49dcb6(0xab)](_0x49dcb6(0xc9))===_0x49dcb6(0xd5);console[_0x49dcb6(0xb0)]('[Amily2-调试]\x20授权状态:\x20'+pluginAuthStatus[_0x49dcb6(0xd4)]+_0x49dcb6(0xd8)+_0x209882);_0x209882&&pluginAuthStatus[_0x49dcb6(0xd4)]&&console['log'](_0x49dcb6(0xe5));$(_0x49dcb6(0xc3))[_0x49dcb6(0xbe)](displayExpiryInfo()),updateUI();if(pluginAuthStatus['authorized']&&extension_settings[extensionName][_0x49dcb6(0xa3)]){const _0x4ae6f7=localStorage[_0x49dcb6(0xab)](_0x49dcb6(0xcb));if(_0x4ae6f7){const _0x5a8749=JSON[_0x49dcb6(0x99)](_0x4ae6f7);console['log'](_0x49dcb6(0xdf)+_0x5a8749[_0x49dcb6(0x9f)]+'个)'),setAvailableModels(_0x5a8749),populateModelDropdown();}else toastr[_0x49dcb6(0xe1)](_0x49dcb6(0xbc),_0x49dcb6(0xa1)),setTimeout(async()=>{const _0x2f72f7=_0x49dcb6,_0x2bff70=await fetchModels();_0x2bff70['length']>0x0&&(setAvailableModels(_0x2bff70),localStorage[_0x2f72f7(0xc7)](_0x2f72f7(0xcb),JSON[_0x2f72f7(0xa6)](_0x2bff70)),populateModelDropdown());},0x1f4);}}async function initializePanel(_0x3aec71,_0x4ef02e){const _0x376221=_0x3dbaa4;if(_0x3aec71[_0x376221(0xa7)](_0x376221(0xe7)))return;try{const _0x64de27=await $[_0x376221(0xde)](extensionFolderPath+_0x376221(0xbb));_0x3aec71[_0x376221(0xbe)](_0x64de27);const _0x4de2df=_0x3aec71[_0x376221(0xd9)](_0x376221(0xaa));if(_0x4de2df[_0x376221(0x9f)]){const _0x3c3548=await $[_0x376221(0xde)](extensionFolderPath+_0x376221(0x98)),_0x162d4e=_0x376221(0xb9)+_0x3c3548+_0x376221(0xb5);_0x4de2df['append'](_0x162d4e);const _0x156245=await $[_0x376221(0xde)](extensionFolderPath+'/assets/hanlinyuan.html'),_0x568460=_0x376221(0xbf)+_0x156245+_0x376221(0xb5);_0x4de2df[_0x376221(0xca)](_0x568460);const _0x36d33c=await $['get'](extensionFolderPath+_0x376221(0xbd)),_0x33f0eb=_0x376221(0xa0)+_0x36d33c+_0x376221(0xb5);_0x4de2df[_0x376221(0xca)](_0x33f0eb);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),bindTableEvents(),_0x3aec71[_0x376221(0xa7)](_0x376221(0xe7),!![]),console[_0x376221(0xb0)](_0x376221(0xdb)),applyUpdateIndicator();}catch(_0x39650c){console['error'](_0x376221(0xe0),_0x39650c);const _0x3b3a35=_0x4ef02e?'<p\x20style=\x22color:red;\x20padding:10px;\x20border:1px\x20solid\x20red;\x20border-radius:5px;\x22>紧急报告：在扩展区域建造Amily2号府邸时发生意外。</p>':_0x376221(0xb8);_0x4ef02e?_0x4ef02e[_0x376221(0xca)](_0x3b3a35):_0x3aec71[_0x376221(0xbe)](_0x3b3a35);}}function toggleDrawerFallback(){const _0x5a56d9=_0x3dbaa4,_0x6a2c92=$(_0x5a56d9(0xc0)),_0x3f113d=$('#amily2_drawer_content');_0x6a2c92['hasClass'](_0x5a56d9(0xa2))&&!_0x3f113d['is'](_0x5a56d9(0xac))&&_0x6a2c92['removeClass']('openIcon')[_0x5a56d9(0x9d)](_0x5a56d9(0xcc)),_0x6a2c92['hasClass']('closedIcon')?($(_0x5a56d9(0xcf))[_0x5a56d9(0xc2)](_0x3f113d)[_0x5a56d9(0xc2)](_0x5a56d9(0xa4))[_0x5a56d9(0x9d)](_0x5a56d9(0xdc))[_0x5a56d9(0xaf)]((_0x47e61d,_0x1a89df)=>{slideToggle(_0x1a89df,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x2ab3ae){const _0x4d8e51=_0x4c08;_0x2ab3ae[_0x4d8e51(0xb2)](_0x4d8e51(0xe6))[_0x4d8e51(0xa8)]['remove']('resizing');}});}),$('.openIcon')['not'](_0x6a2c92)[_0x5a56d9(0xc2)](_0x5a56d9(0xa9))[_0x5a56d9(0x97)]('closedIcon\x20openIcon'),$(_0x5a56d9(0xcf))['not'](_0x3f113d)[_0x5a56d9(0xc2)](_0x5a56d9(0xa4))[_0x5a56d9(0x97)]('closedDrawer\x20openDrawer'),_0x6a2c92[_0x5a56d9(0x97)]('closedIcon\x20openIcon'),_0x3f113d[_0x5a56d9(0x97)](_0x5a56d9(0xdd)),_0x3f113d[_0x5a56d9(0x9d)](_0x5a56d9(0xdc))[_0x5a56d9(0xaf)]((_0x2a91c5,_0x5c710d)=>{slideToggle(_0x5c710d,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x492edb){const _0x39da7b=_0x4c08;_0x492edb[_0x39da7b(0xb2)]('.drawer-content')['classList'][_0x39da7b(0x9c)]('resizing');}});})):(_0x6a2c92[_0x5a56d9(0x97)]('openIcon\x20closedIcon'),_0x3f113d[_0x5a56d9(0x97)](_0x5a56d9(0xd0)),_0x3f113d[_0x5a56d9(0x9d)](_0x5a56d9(0xdc))['each']((_0x3be0e8,_0x19a8bc)=>{slideToggle(_0x19a8bc,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x3651e0){const _0x3f649e=_0x4c08;_0x3651e0[_0x3f649e(0xb2)](_0x3f649e(0xe6))[_0x3f649e(0xa8)][_0x3f649e(0x9c)](_0x3f649e(0xdc));}});}));}function _0x4203(){const _0x2c5e93=['parse','.inline-drawer-content','[Amily2-兼容性]\x20检测到旧版环境\x20(无法导入\x20doNavbarIconClick)，已绑定后备点击事件。','remove','addClass','click','length','<div\x20id=\x22amily2_memorisation_forms_panel\x22\x20style=\x22display:\x20none;\x22>','Amily2号','openIcon','apiUrl','.pinnedOpen','7116BVaIpV','stringify','data','classList','.drawerPinnedOpen','#amily2_chat_optimiser','getItem',':visible','extensions','10iEfxiW','each','log','function','closest','8KbJlxY','2500105bybWVi','</div>','doNavbarIconClick\x20is\x20not\x20a\x20function','109297fRlzOt','<p\x20style=\x22color:red;\x20padding:\x2020px;\x22>紧急报告：无法加载Amily2号府邸内饰。</p>','<div\x20id=\x22amily2_additional_features_panel\x22\x20style=\x22display:\x20none;\x22>','#amily2_drawer_content','/assets/amily2-modal.html','正在自动加载模型列表...','/assets/Memorisation-forms.html','html','<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>','#amily2_drawer_icon','7VpwHOE','not','#expiry_info','#extensions_settings2\x20#amily2_chat_optimiser','3UbFmJp','864083nSWYKU','setItem','scripts/extensions/third-party/','plugin_auto_login','append','cached_models_amily2','closedIcon','/script.js','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_extension_frame\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-toggle\x20inline-drawer-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b><i\x20class=\x22fas\x20fa-crown\x22\x20style=\x22color:\x20#ffc107;\x22></i>\x20Amily2号\x20优化中枢</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-icon\x20fa-solid\x20fa-circle-chevron-down\x20down\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-content\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','.openDrawer','openDrawer\x20closedDrawer','2415708tkRGzj','after','topbar','authorized','true','150hMKDUQ','[Amily2-兼容性]\x20检测到新版环境，已绑定官方点击事件。',',\x20自动登录标志:\x20','find','#sys-settings-button','[Amily-重构]\x20宫殿模块已按蓝图竣工。','resizing','closedDrawer\x20openDrawer','get','[Amily2号]\x20从缓存加载模型列表\x20(','[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:','info','3432966YnLfDD','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_main_drawer\x22\x20class=\x22drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22drawer-toggle\x22\x20data-drawer=\x22amily2_drawer_content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_icon\x22\x20class=\x22drawer-icon\x20fa-solid\x20fa-magic\x20fa-fw\x20closedIcon\x20interactable\x22\x20title=\x22Amily2号优化助手\x22\x20tabindex=\x220\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_content\x22\x20class=\x22drawer-content\x20closedDrawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','iconLocation','[Amily2号]\x20检测到有效授权，将执行自动UI更新。','.drawer-content','initialized','3294968tiXVax','37167XuuoId','#amily2_main_drawer\x20.drawer-toggle','toggleClass','/assets/Amily2-AdditionalFeatures.html'];_0x4203=function(){return _0x2c5e93;};return _0x4203();}export async function createDrawer(){const _0x150379=_0x3dbaa4,_0x3e5708=extension_settings[extensionName],_0x672544=_0x3e5708[_0x150379(0xe4)]||_0x150379(0xd3);if(_0x672544==='topbar'){if($('#amily2_main_drawer')[_0x150379(0x9f)]>0x0)return;const _0xe3c813=_0x150379(0xe3);$(_0x150379(0xda))[_0x150379(0xd2)](_0xe3c813);const _0x7c85dd=$(_0x150379(0xba));await initializePanel(_0x7c85dd);try{const {doNavbarIconClick:_0x4ea0f1}=await import(_0x150379(0xcd));if(typeof _0x4ea0f1===_0x150379(0xb1))$('#amily2_main_drawer\x20.drawer-toggle')['on']('click',_0x4ea0f1),console[_0x150379(0xb0)](_0x150379(0xd7));else throw new Error(_0x150379(0xb6));}catch(_0x4efa52){$(_0x150379(0xea))['on'](_0x150379(0x9e),toggleDrawerFallback),console[_0x150379(0xb0)](_0x150379(0x9b));}}else{if(_0x672544===_0x150379(0xad)){if($(_0x150379(0xc4))[_0x150379(0x9f)]>0x0)return;const _0x33861e=_0x150379(0xce),_0x2126e1=$(_0x33861e);$('#extensions_settings2')[_0x150379(0xca)](_0x2126e1);const _0x5f4489=_0x2126e1[_0x150379(0xd9)](_0x150379(0x9a));initializePanel(_0x5f4489,_0x2126e1);}}}
