const _0x33704e=_0x58fd;function _0x58fd(_0x3660a2,_0x91c294){const _0x539099=_0x5390();return _0x58fd=function(_0x58fd62,_0x4868d0){_0x58fd62=_0x58fd62-0x70;let _0x222d0b=_0x539099[_0x58fd62];return _0x222d0b;},_0x58fd(_0x3660a2,_0x91c294);}(function(_0x5730fa,_0x2fe806){const _0x1e7857=_0x58fd,_0x3eced4=_0x5730fa();while(!![]){try{const _0x373938=-parseInt(_0x1e7857(0xaa))/0x1+-parseInt(_0x1e7857(0x9b))/0x2+-parseInt(_0x1e7857(0x8b))/0x3+parseInt(_0x1e7857(0x7a))/0x4+parseInt(_0x1e7857(0x79))/0x5*(parseInt(_0x1e7857(0x92))/0x6)+parseInt(_0x1e7857(0x87))/0x7+parseInt(_0x1e7857(0x98))/0x8;if(_0x373938===_0x2fe806)break;else _0x3eced4['push'](_0x3eced4['shift']());}catch(_0x206d40){_0x3eced4['push'](_0x3eced4['shift']());}}}(_0x5390,0x674e1));import{getSlideToggleOptions}from'/script.js';import{slideToggle}from'/lib.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName,defaultSettings}from'../utils/settings.js';import{checkAuthorization,displayExpiryInfo,pluginAuthStatus}from'../utils/auth.js';import{updateUI,setAvailableModels,populateModelDropdown,applyUpdateIndicator}from'./state.js';import{bindModalEvents}from'./bindings.js';import{fetchSupportedModels}from'../core/api.js';import{bindHistoriographyEvents}from'./historiography-bindings.js';import{bindHanlinyuanEvents}from'./hanlinyuan-bindings.js';function _0x5390(){const _0x3a83c1=['#amily2_main_drawer','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_main_drawer\x22\x20class=\x22drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_icon\x22\x20class=\x22drawer-toggle\x20drawer-header\x20closedIcon\x20interactable\x22\x20title=\x22Amily2号优化助手\x22\x20tabindex=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22drawer-icon\x20fa-solid\x20fa-magic\x20fa-fw\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_content\x22\x20class=\x22drawer-content\x20closedDrawer\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','scripts/extensions/third-party/','正在自动加载模型列表...','#expiry_info','data','#amily2_drawer_icon','error','plugin_auto_login','each','closest','260cmIPxZ','2365252qUApay','#extensions_settings2','openIcon','not','<div\x20id=\x22amily2_additional_features_panel\x22\x20style=\x22display:\x20none;\x22>','true','addClass','classList','[Amily-重构]\x20收到指令，开始在\x27扩展\x27官方区域模块化建造宫殿。','[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_extension_frame\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-toggle\x20inline-drawer-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b><i\x20class=\x22fas\x20fa-crown\x22\x20style=\x22color:\x20#ffc107;\x22></i>\x20Amily2号\x20优化中枢</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-icon\x20fa-solid\x20fa-circle-chevron-down\x20down\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-content\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20宫殿的真正内室将在这里安家\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','closedIcon\x20openIcon','info','400386dmXKXC','[Amily2-调试]\x20授权状态:\x20','topbar','initialized','1919601NpnviF',',\x20自动登录标志:\x20','html','.drawer-content','[Amily-重构]\x20顶栏宫殿已按模块化蓝图竣工。','get','toggleClass','61578ExkgHX','hasClass','#amily2_drawer_content','cached_models_amily2','<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>','<p\x20style=\x22color:red;\x20padding:\x2020px;\x22>紧急报告：无法加载Amily2号府邸内饰。</p>','9824312uGkXaR','setItem','<p\x20style=\x22color:red;\x20padding:10px;\x20border:1px\x20solid\x20red;\x20border-radius:5px;\x22>紧急报告：在扩展区域建造Amily2号府邸时发生意外。</p>','1185262pFNQLE','</div>','parse','stringify','.openDrawer','[Amily2号]\x20检测到有效授权，将执行自动UI更新。','find','#amily2_chat_optimiser','iconLocation','off','mousedown.amily2Drawer','/assets/amily2-modal.html','log','.openIcon','/assets/Amily2-AdditionalFeatures.html','754591tWjvFG','apiUrl','after','remove','append','length','preventDefault','closedDrawer\x20openDrawer','resizing','.pinnedOpen'];_0x5390=function(){return _0x3a83c1;};return _0x5390();}const extensionFolderPath=_0x33704e(0x70)+extensionName;async function loadSettings(){const _0x6733c1=_0x33704e;extension_settings[extensionName]={...defaultSettings,...extension_settings[extensionName]||{}},checkAuthorization();const _0x3153bb=localStorage['getItem'](_0x6733c1(0x76))===_0x6733c1(0x7f);console[_0x6733c1(0xa7)](_0x6733c1(0x88)+pluginAuthStatus['authorized']+_0x6733c1(0x8c)+_0x3153bb);_0x3153bb&&pluginAuthStatus['authorized']&&console[_0x6733c1(0xa7)](_0x6733c1(0xa0));$(_0x6733c1(0x72))[_0x6733c1(0x8d)](displayExpiryInfo()),updateUI();if(pluginAuthStatus['authorized']&&extension_settings[extensionName][_0x6733c1(0xab)]){const _0x156177=localStorage['getItem'](_0x6733c1(0x95));if(_0x156177){const _0x213675=JSON[_0x6733c1(0x9d)](_0x156177);console[_0x6733c1(0xa7)]('[Amily2号]\x20从缓存加载模型列表\x20('+_0x213675[_0x6733c1(0xaf)]+'个)'),setAvailableModels(_0x213675),populateModelDropdown();}else toastr[_0x6733c1(0x86)](_0x6733c1(0x71),'Amily2号'),setTimeout(async()=>{const _0x495cc7=_0x6733c1,_0x54fa18=await fetchSupportedModels();_0x54fa18[_0x495cc7(0xaf)]>0x0&&(setAvailableModels(_0x54fa18),localStorage[_0x495cc7(0x99)](_0x495cc7(0x95),JSON[_0x495cc7(0x9e)](_0x54fa18)),populateModelDropdown());},0x1f4);}}export function createDrawer(){const _0x57bad3=_0x33704e,_0x341b1d=extension_settings[extensionName],_0x1052d3=_0x341b1d[_0x57bad3(0xa3)]||_0x57bad3(0x89);if(_0x1052d3===_0x57bad3(0x89)){if($(_0x57bad3(0xb4))[_0x57bad3(0xaf)]>0x0)return;const _0x1ae983=_0x57bad3(0xb5);$('#sys-settings-button')[_0x57bad3(0xac)](_0x1ae983),$(document)[_0x57bad3(0xa4)](_0x57bad3(0xa5))['on']('mousedown.amily2Drawer',_0x57bad3(0x74),async function(_0x3b0d8e){const _0x197cfa=_0x57bad3;_0x3b0d8e[_0x197cfa(0xb0)](),_0x3b0d8e['stopPropagation']();const _0x2d50eb=$(this),_0x26fa94=$(_0x197cfa(0x94));$(_0x197cfa(0x9f))[_0x197cfa(0x7d)](_0x26fa94)[_0x197cfa(0x7d)](_0x197cfa(0xb3))[_0x197cfa(0x80)]('resizing')[_0x197cfa(0x77)]((_0x8edd4f,_0x20b2c0)=>{slideToggle(_0x20b2c0,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x507190){const _0xa9fe5=_0x58fd;_0x507190[_0xa9fe5(0x78)](_0xa9fe5(0x8e))[_0xa9fe5(0x81)][_0xa9fe5(0xad)](_0xa9fe5(0xb2));}});}),$(_0x197cfa(0xa8))['not'](_0x2d50eb)['not']('.drawerPinnedOpen')['toggleClass'](_0x197cfa(0x85)),$('.openDrawer')[_0x197cfa(0x7d)](_0x26fa94)[_0x197cfa(0x7d)](_0x197cfa(0xb3))[_0x197cfa(0x91)](_0x197cfa(0xb1)),_0x2d50eb[_0x197cfa(0x91)](_0x197cfa(0x85)),_0x26fa94[_0x197cfa(0x91)](_0x197cfa(0xb1)),_0x26fa94[_0x197cfa(0x80)](_0x197cfa(0xb2))[_0x197cfa(0x77)]((_0x123ec8,_0x20bd49)=>{slideToggle(_0x20bd49,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x393941){const _0x5e02bf=_0x58fd;_0x393941[_0x5e02bf(0x78)](_0x5e02bf(0x8e))[_0x5e02bf(0x81)]['remove'](_0x5e02bf(0xb2));}});});const _0x2c963f=_0x26fa94['data'](_0x197cfa(0x8a));if(_0x2d50eb[_0x197cfa(0x93)](_0x197cfa(0x7c))&&!_0x2c963f)try{const _0x57e60d=await $[_0x197cfa(0x90)](extensionFolderPath+_0x197cfa(0xa6));_0x26fa94[_0x197cfa(0x8d)](_0x57e60d);const _0x29057d=_0x26fa94[_0x197cfa(0xa1)](_0x197cfa(0xa2));if(_0x29057d[_0x197cfa(0xaf)]){const _0x2c269a=await $[_0x197cfa(0x90)](extensionFolderPath+_0x197cfa(0xa9)),_0x229a43=_0x197cfa(0x7e)+_0x2c269a+_0x197cfa(0x9c);_0x29057d[_0x197cfa(0xae)](_0x229a43);const _0x15a479=await $[_0x197cfa(0x90)](extensionFolderPath+'/assets/hanlinyuan.html'),_0x19abaf='<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>'+_0x15a479+_0x197cfa(0x9c);_0x29057d[_0x197cfa(0xae)](_0x19abaf);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),_0x26fa94[_0x197cfa(0x73)](_0x197cfa(0x8a),!![]),console[_0x197cfa(0xa7)](_0x197cfa(0x8f)),applyUpdateIndicator();}catch(_0x4ffa13){console[_0x197cfa(0x75)](_0x197cfa(0x83),_0x4ffa13),_0x26fa94[_0x197cfa(0x8d)](_0x197cfa(0x97));}});}else{if(_0x1052d3==='extensions'){if($('#extensions_settings2\x20#amily2_chat_optimiser')['length']>0x0)return;const _0x44c06a=_0x57bad3(0x84);$(_0x57bad3(0x7b))[_0x57bad3(0xae)](_0x44c06a),((async()=>{const _0x4b34fe=_0x57bad3;try{console['log'](_0x4b34fe(0x82));const _0x19598c=$('#amily2_extension_frame\x20.inline-drawer-content'),_0x13ec7d=await $[_0x4b34fe(0x90)](extensionFolderPath+_0x4b34fe(0xa6));_0x19598c[_0x4b34fe(0x8d)](_0x13ec7d);const _0x3fbf85=_0x19598c[_0x4b34fe(0xa1)](_0x4b34fe(0xa2));if(_0x3fbf85['length']){const _0x4ad0a2=await $[_0x4b34fe(0x90)](extensionFolderPath+_0x4b34fe(0xa9)),_0x24f929=_0x4b34fe(0x7e)+_0x4ad0a2+_0x4b34fe(0x9c);_0x3fbf85['append'](_0x24f929);const _0x5636a6=await $[_0x4b34fe(0x90)](extensionFolderPath+'/assets/hanlinyuan.html'),_0x75d5c2=_0x4b34fe(0x96)+_0x5636a6+_0x4b34fe(0x9c);_0x3fbf85[_0x4b34fe(0xae)](_0x75d5c2);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),applyUpdateIndicator();}catch(_0x17a8be){console[_0x4b34fe(0x75)]('[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:',_0x17a8be),$(_0x4b34fe(0x7b))[_0x4b34fe(0xae)](_0x4b34fe(0x9a));}})());}}}
