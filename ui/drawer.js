const _0x8eb858=_0x1aab;(function(_0x1fd68f,_0xbb96e7){const _0x3b465c=_0x1aab,_0x548c8d=_0x1fd68f();while(!![]){try{const _0x5cb44b=parseInt(_0x3b465c(0x11b))/0x1+-parseInt(_0x3b465c(0x13b))/0x2+parseInt(_0x3b465c(0x10c))/0x3+parseInt(_0x3b465c(0x127))/0x4+-parseInt(_0x3b465c(0x12a))/0x5+parseInt(_0x3b465c(0x13f))/0x6+parseInt(_0x3b465c(0x125))/0x7;if(_0x5cb44b===_0xbb96e7)break;else _0x548c8d['push'](_0x548c8d['shift']());}catch(_0x1902d6){_0x548c8d['push'](_0x548c8d['shift']());}}}(_0x446e,0x8555e));import{getSlideToggleOptions}from'/script.js';function _0x446e(){const _0xb462e0=['684804BCHDOx','topbar','#amily2_main_drawer','get','length','[Amily2-调试]\x20授权状态:\x20','/assets/amily2-modal.html','.openDrawer','/assets/Amily2-AdditionalFeatures.html','data','3677450bgBhzX','.drawer-content','1961788IpjvXE','error','getItem','1630910gdoNDk','initialized','#amily2_chat_optimiser','each','<p\x20style=\x22color:red;\x20padding:\x2020px;\x22>紧急报告：无法加载Amily2号府邸内饰。</p>','plugin_auto_login','info','#extensions_settings2',',\x20自动登录标志:\x20','addClass','extensions','find','resizing','[Amily2号]\x20检测到有效授权，将执行自动UI更新。','append','closedDrawer\x20openDrawer','.openIcon','2171646XbEAyr','</div>','closedIcon\x20openIcon','[Amily-建设部]\x20紧急报告：加载模块化蓝图时发生意外:','45078nBvykR','stopPropagation','<div\x20id=\x22amily2_additional_features_panel\x22\x20style=\x22display:\x20none;\x22>','toggleClass','parse','\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_extension_frame\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-toggle\x20inline-drawer-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b><i\x20class=\x22fas\x20fa-crown\x22\x20style=\x22color:\x20#ffc107;\x22></i>\x20Amily2号\x20优化中枢</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-icon\x20fa-solid\x20fa-circle-chevron-down\x20down\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inline-drawer-content\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20宫殿的真正内室将在这里安家\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','after','remove','closest','#amily2_drawer_content','not','authorized','classList','openIcon','.drawerPinnedOpen','html','750099rfpJmY','#extensions_settings2\x20#amily2_chat_optimiser','正在自动加载模型列表...','#amily2_extension_frame\x20.inline-drawer-content','#expiry_info','scripts/extensions/third-party/','log','apiUrl','setItem','iconLocation','hasClass','[Amily2号]\x20从缓存加载模型列表\x20(','preventDefault','stringify','/assets/hanlinyuan.html'];_0x446e=function(){return _0xb462e0;};return _0x446e();}import{slideToggle}from'/lib.js';function _0x1aab(_0x121b79,_0x2089b5){const _0x446e50=_0x446e();return _0x1aab=function(_0x1aab0b,_0x6716b4){_0x1aab0b=_0x1aab0b-0x10c;let _0x558180=_0x446e50[_0x1aab0b];return _0x558180;},_0x1aab(_0x121b79,_0x2089b5);}import{extension_settings}from'/scripts/extensions.js';import{extensionName,defaultSettings}from'../utils/settings.js';import{checkAuthorization,displayExpiryInfo,pluginAuthStatus}from'../utils/auth.js';import{updateUI,setAvailableModels,populateModelDropdown,applyUpdateIndicator}from'./state.js';import{bindModalEvents}from'./bindings.js';import{fetchSupportedModels}from'../core/api.js';import{bindHistoriographyEvents}from'./historiography-bindings.js';import{bindHanlinyuanEvents}from'./hanlinyuan-bindings.js';const extensionFolderPath=_0x8eb858(0x111)+extensionName;async function loadSettings(){const _0x64fd84=_0x8eb858;extension_settings[extensionName]={...defaultSettings,...extension_settings[extensionName]||{}},checkAuthorization();const _0x52f319=localStorage[_0x64fd84(0x129)](_0x64fd84(0x12f))==='true';console[_0x64fd84(0x112)](_0x64fd84(0x120)+pluginAuthStatus[_0x64fd84(0x14a)]+_0x64fd84(0x132)+_0x52f319);_0x52f319&&pluginAuthStatus['authorized']&&console['log'](_0x64fd84(0x137));$(_0x64fd84(0x110))[_0x64fd84(0x14e)](displayExpiryInfo()),updateUI();if(pluginAuthStatus[_0x64fd84(0x14a)]&&extension_settings[extensionName][_0x64fd84(0x113)]){const _0x51e787=localStorage[_0x64fd84(0x129)]('cached_models_amily2');if(_0x51e787){const _0x32d2ba=JSON[_0x64fd84(0x143)](_0x51e787);console[_0x64fd84(0x112)](_0x64fd84(0x117)+_0x32d2ba[_0x64fd84(0x11f)]+'个)'),setAvailableModels(_0x32d2ba),populateModelDropdown();}else toastr[_0x64fd84(0x130)](_0x64fd84(0x10e),'Amily2号'),setTimeout(async()=>{const _0x31ee84=_0x64fd84,_0x47e5d8=await fetchSupportedModels();_0x47e5d8['length']>0x0&&(setAvailableModels(_0x47e5d8),localStorage[_0x31ee84(0x114)]('cached_models_amily2',JSON[_0x31ee84(0x119)](_0x47e5d8)),populateModelDropdown());},0x1f4);}}export function createDrawer(){const _0x280718=_0x8eb858,_0x5118a4=extension_settings[extensionName],_0x35ce75=_0x5118a4[_0x280718(0x115)]||'topbar';if(_0x35ce75===_0x280718(0x11c)){if($(_0x280718(0x11d))[_0x280718(0x11f)]>0x0)return;const _0xb64cf4='\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_main_drawer\x22\x20class=\x22drawer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_icon\x22\x20class=\x22drawer-toggle\x20drawer-header\x20closedIcon\x20interactable\x22\x20title=\x22Amily2号优化助手\x22\x20tabindex=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22drawer-icon\x20fa-solid\x20fa-magic\x20fa-fw\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22amily2_drawer_content\x22\x20class=\x22drawer-content\x20closedDrawer\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';$('#sys-settings-button')[_0x280718(0x145)](_0xb64cf4),$(document)['off']('mousedown.amily2Drawer')['on']('mousedown.amily2Drawer','#amily2_drawer_icon',async function(_0x184eee){const _0x38b341=_0x280718;_0x184eee[_0x38b341(0x118)](),_0x184eee[_0x38b341(0x140)]();const _0x538e1e=$(this),_0xd0aaa4=$(_0x38b341(0x148));$(_0x38b341(0x122))[_0x38b341(0x149)](_0xd0aaa4)[_0x38b341(0x149)]('.pinnedOpen')[_0x38b341(0x133)](_0x38b341(0x136))[_0x38b341(0x12d)]((_0x572d53,_0xd8516d)=>{slideToggle(_0xd8516d,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x3921ef){const _0x24ef8a=_0x1aab;_0x3921ef[_0x24ef8a(0x147)](_0x24ef8a(0x126))[_0x24ef8a(0x14b)][_0x24ef8a(0x146)](_0x24ef8a(0x136));}});}),$(_0x38b341(0x13a))[_0x38b341(0x149)](_0x538e1e)['not'](_0x38b341(0x14d))[_0x38b341(0x142)]('closedIcon\x20openIcon'),$(_0x38b341(0x122))[_0x38b341(0x149)](_0xd0aaa4)['not']('.pinnedOpen')[_0x38b341(0x142)](_0x38b341(0x139)),_0x538e1e[_0x38b341(0x142)](_0x38b341(0x13d)),_0xd0aaa4[_0x38b341(0x142)](_0x38b341(0x139)),_0xd0aaa4[_0x38b341(0x133)](_0x38b341(0x136))[_0x38b341(0x12d)]((_0x1653e8,_0x418b15)=>{slideToggle(_0x418b15,{...getSlideToggleOptions(),'onAnimationEnd':function(_0x173bb1){const _0x4b112a=_0x1aab;_0x173bb1[_0x4b112a(0x147)](_0x4b112a(0x126))[_0x4b112a(0x14b)][_0x4b112a(0x146)]('resizing');}});});const _0x2183d9=_0xd0aaa4[_0x38b341(0x124)](_0x38b341(0x12b));if(_0x538e1e[_0x38b341(0x116)](_0x38b341(0x14c))&&!_0x2183d9)try{const _0x1d987d=await $[_0x38b341(0x11e)](extensionFolderPath+_0x38b341(0x121));_0xd0aaa4[_0x38b341(0x14e)](_0x1d987d);const _0xae020c=_0xd0aaa4[_0x38b341(0x135)](_0x38b341(0x12c));if(_0xae020c[_0x38b341(0x11f)]){const _0xdaef7c=await $['get'](extensionFolderPath+_0x38b341(0x123)),_0x17371a=_0x38b341(0x141)+_0xdaef7c+_0x38b341(0x13c);_0xae020c[_0x38b341(0x138)](_0x17371a);const _0x1f893b=await $[_0x38b341(0x11e)](extensionFolderPath+_0x38b341(0x11a)),_0xc102f='<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>'+_0x1f893b+_0x38b341(0x13c);_0xae020c[_0x38b341(0x138)](_0xc102f);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),_0xd0aaa4[_0x38b341(0x124)](_0x38b341(0x12b),!![]),console[_0x38b341(0x112)]('[Amily-重构]\x20顶栏宫殿已按模块化蓝图竣工。'),applyUpdateIndicator();}catch(_0x2be13d){console[_0x38b341(0x128)](_0x38b341(0x13e),_0x2be13d),_0xd0aaa4['html'](_0x38b341(0x12e));}});}else{if(_0x35ce75===_0x280718(0x134)){if($(_0x280718(0x10d))[_0x280718(0x11f)]>0x0)return;const _0x12d8e0=_0x280718(0x144);$(_0x280718(0x131))['append'](_0x12d8e0),((async()=>{const _0x5de757=_0x280718;try{console[_0x5de757(0x112)]('[Amily-重构]\x20收到指令，开始在\x27扩展\x27官方区域模块化建造宫殿。');const _0x468350=$(_0x5de757(0x10f)),_0x3405e6=await $['get'](extensionFolderPath+_0x5de757(0x121));_0x468350[_0x5de757(0x14e)](_0x3405e6);const _0x14e10b=_0x468350[_0x5de757(0x135)]('#amily2_chat_optimiser');if(_0x14e10b[_0x5de757(0x11f)]){const _0x5865f7=await $['get'](extensionFolderPath+_0x5de757(0x123)),_0x3d2fc5=_0x5de757(0x141)+_0x5865f7+_0x5de757(0x13c);_0x14e10b[_0x5de757(0x138)](_0x3d2fc5);const _0x34d760=await $[_0x5de757(0x11e)](extensionFolderPath+'/assets/hanlinyuan.html'),_0xf1f00a='<div\x20id=\x22amily2_hanlinyuan_panel\x22\x20style=\x22display:\x20none;\x22>'+_0x34d760+_0x5de757(0x13c);_0x14e10b[_0x5de757(0x138)](_0xf1f00a);}await loadSettings(),bindModalEvents(),bindHistoriographyEvents(),bindHanlinyuanEvents(),applyUpdateIndicator();}catch(_0x5049e8){console[_0x5de757(0x128)](_0x5de757(0x13e),_0x5049e8),$(_0x5de757(0x131))[_0x5de757(0x138)]('<p\x20style=\x22color:red;\x20padding:10px;\x20border:1px\x20solid\x20red;\x20border-radius:5px;\x22>紧急报告：在扩展区域建造Amily2号府邸时发生意外。</p>');}})());}}}
