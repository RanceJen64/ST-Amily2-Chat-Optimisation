const _0x3c7b05=_0x1d86;(function(_0x91ff27,_0x234955){const _0x6cbb6c=_0x1d86,_0x26f1ed=_0x91ff27();while(!![]){try{const _0x244eb4=-parseInt(_0x6cbb6c(0x218))/0x1+parseInt(_0x6cbb6c(0x26e))/0x2*(parseInt(_0x6cbb6c(0x2a3))/0x3)+parseInt(_0x6cbb6c(0x1ea))/0x4+-parseInt(_0x6cbb6c(0x2bb))/0x5*(parseInt(_0x6cbb6c(0x24d))/0x6)+parseInt(_0x6cbb6c(0x295))/0x7*(-parseInt(_0x6cbb6c(0x1f0))/0x8)+-parseInt(_0x6cbb6c(0x20b))/0x9*(-parseInt(_0x6cbb6c(0x29c))/0xa)+-parseInt(_0x6cbb6c(0x20e))/0xb*(-parseInt(_0x6cbb6c(0x1fc))/0xc);if(_0x244eb4===_0x234955)break;else _0x26f1ed['push'](_0x26f1ed['shift']());}catch(_0x1dbcc6){_0x26f1ed['push'](_0x26f1ed['shift']());}}}(_0x47df,0x472f8));import*as _0x22228c from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';function _0x1d86(_0x5a0e6c,_0x178875){const _0x47df54=_0x47df();return _0x1d86=function(_0x1d868a,_0x12e87d){_0x1d868a=_0x1d868a-0x1bf;let _0x5e9b61=_0x47df54[_0x1d868a];return _0x5e9b61;},_0x1d86(_0x5a0e6c,_0x178875);}function _0x47df(){const _0x48b5a1=['batchEventBound','-tab','contenteditable','exportPreset','val','flex','cursor','fa-arrow-right','below','justifyContent','getTime','removeEventListener','insertRow',']”\x20吗？此操作不可逆！','saveBatchFillerFlowTemplate','amily2-export-preset-btn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','appendChild','rows','insertCell','info','warning','在右加列','.add-row-btn','ai-rule-template-restore-btn','move-down','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','table-injection-position','false','流程提示词已恢复为默认。','maxHeight','focus','deleteColumn','amily2-menu-active','deleteRow','target','has','批量填表-规则提示词已恢复默认。','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','fa-pen','ai-flow-template-restore-btn','getMemoryState','<i\x20class=\x22fas\x20','right','已禁用','marginTop','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','maxTouchPoints','2862930PwGXdp','amily2-export-preset-full-btn','getElementById','rename','contains','active','table-injection-depth','table','规则提示词已恢复为默认。','left','table-controls','keydown','getAttribute','删除该列','.edit-rules-btn','input','.popup-button-cancel','tableIndex','appendTo','delete','input[name=\x22table-injection-role\x22]','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','.add-col-btn','click','danger','value','which','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','\x22></i>\x20','.sinan-nav-item','saveBatchFillerRuleTemplate','marginBottom','move-right','142ZYeled','span','表格系统总开关已关闭，请先启用总开关。','您确定要删除\x20“','querySelector','colIndex','#column-name-input','getBoundingClientRect','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','updateHeader','trim','原始填表','down','stopPropagation','2px','innerHTML','请输入新表格的名称：','流程提示词已保存。','rule_delete','style','”\x20列吗？','addHighlight','warn','.sinan-tab-pane','填表模式已切换为\x20','addRow','true','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','change','error','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','exportPresetFull','input[name=\x22filling-mode\x22]','menu_button\x20small_button','moveColumn','编辑列名','add-above','moveTable','删除该行','2434453nesMsA','all-tables-container','.move-table-down-btn','matches','remove','move-up','find','1299370YRQtkk','td.index-col','fa-arrow-down','0.5','delete-row','amily2-clear-all-tables-btn','zIndex','17811RuiKSF','.control-block-with-switch','top','absolute','#rule-delete','addColumn','length','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','textContent','优化中填表','checked','auto','amily2-table-','向左移动','center','moveRow','success','eventsBound','depth','position','min','filling_mode','指令模板编辑器已成功绑定。','fa-arrow-up','5jWExRH','amily2-menu-open','amily2-import-preset-btn','ontouchstart','bottom','label','无法找到指令模板编辑器，绑定失败。','开始为表格视图绑定交互事件...','main-api','setAttribute','批量填表-规则提示词已保存。','100%','.hly-scroll','getHighlights','closest','preventDefault','classList','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','showModal','amily2-context-menu','button','name','\x20行吗？','createElement','批量填表-流程提示词已恢复默认。','optimized','ai-rule-template-editor','opacity','keypress','div','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','您确定要删除第\x20','display','ai-rule-template-save-btn','body','headers','select','updateRow','新表格','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','rule_add','向上移动','表格系统总开关','getBatchFillerRuleTemplate','index-col','space-between','overflowY','pointer','fill-table-now-btn','role','在上加行','.popup-button-ok','表格视图交互事件已成功绑定。','fa-trash-alt','addEventListener','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','cell-highlight','2259364ZenMtC','deleteTable','className','向右移动','fa-plus-circle','disabled','8BQEhDD','move-table-up-btn','tab','#rule-note','.amily2-context-menu','add','在左加列','injection','createTBody','10000','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20编辑列名\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>列名：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22column-name-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','table_injection_enabled','36XINjea','向下移动','rowIndex','createTHead','.radio-group','ai-flow-template-save-btn','#sinan-','.delete-table-btn','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入列名...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：列名将用于标识此列的内容</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','above','table-role-system','querySelectorAll','getBatchFillerFlowTemplate','move-left','add-right','9EEwMcF','insertColumn','forEach','891341jxJEBw','在下加行','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','.amily2-context-menu.amily2-menu-active','.settings-group','clearAllTables','未知表格','dataset','previousElementSibling','touchstart','242888aHDUSj','table_system_enabled','列名不能为空！','tagName','div[style*=\x22overflowX\x22]'];_0x47df=function(){return _0x48b5a1;};return _0x47df();}import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x3c7b05(0x24f)](_0x3c7b05(0x296));function toggleRowContextMenu(_0x3cd66e){const _0xaf7fdb=_0x3c7b05;_0x3cd66e[_0xaf7fdb(0x1c0)](),_0x3cd66e['stopPropagation']();const _0x34048f=_0x3cd66e[_0xaf7fdb(0x240)][_0xaf7fdb(0x1bf)](_0xaf7fdb(0x29d));if(!_0x34048f)return;const _0x4ca48c=_0x34048f[_0xaf7fdb(0x272)](_0xaf7fdb(0x1f4));if(!_0x4ca48c)return;const _0x61ac36=_0x4ca48c[_0xaf7fdb(0x1c1)][_0xaf7fdb(0x251)]('amily2-menu-active');document['querySelectorAll'](_0xaf7fdb(0x211))[_0xaf7fdb(0x20d)](_0x599aa8=>{const _0x2cc9d3=_0xaf7fdb;_0x599aa8[_0x2cc9d3(0x1c1)][_0x2cc9d3(0x299)](_0x2cc9d3(0x23e));});!_0x61ac36&&_0x4ca48c[_0xaf7fdb(0x1c1)]['add'](_0xaf7fdb(0x23e));const _0x4cf5b4=_0x3ebf30=>{const _0x17d9ee=_0xaf7fdb;!_0x4ca48c[_0x17d9ee(0x251)](_0x3ebf30['target'])&&(_0x4ca48c['classList']['remove'](_0x17d9ee(0x23e)),document['removeEventListener'](_0x17d9ee(0x264),_0x4cf5b4,!![]));};setTimeout(()=>{const _0x11c303=_0xaf7fdb;_0x4ca48c[_0x11c303(0x1c1)][_0x11c303(0x251)](_0x11c303(0x23e))&&document[_0x11c303(0x1e7)](_0x11c303(0x264),_0x4cf5b4,!![]);},0x0);}function toggleColumnContextMenu(_0x598c7f){const _0x2a73b8=_0x3c7b05;_0x598c7f[_0x2a73b8(0x1c0)](),_0x598c7f[_0x2a73b8(0x27b)]();const _0x14a46a=_0x598c7f[_0x2a73b8(0x240)][_0x2a73b8(0x1bf)]('th');if(!_0x14a46a)return;const _0x4a1fdc=_0x14a46a[_0x2a73b8(0x1c1)][_0x2a73b8(0x251)]('amily2-menu-open');document[_0x2a73b8(0x207)]('th.amily2-menu-open')[_0x2a73b8(0x20d)](_0x35b0ff=>{const _0xe20e9e=_0x2a73b8;_0x35b0ff['classList']['remove'](_0xe20e9e(0x2bc));});!_0x4a1fdc&&_0x14a46a[_0x2a73b8(0x1c1)][_0x2a73b8(0x1f5)](_0x2a73b8(0x2bc));const _0x2af871=_0x211bdb=>{const _0x2487cc=_0x2a73b8;!_0x14a46a[_0x2487cc(0x251)](_0x211bdb[_0x2487cc(0x240)])&&(_0x14a46a[_0x2487cc(0x1c1)][_0x2487cc(0x299)](_0x2487cc(0x2bc)),document[_0x2487cc(0x228)](_0x2487cc(0x264),_0x2af871,!![]));};setTimeout(()=>{const _0x6f6a4c=_0x2a73b8;_0x14a46a[_0x6f6a4c(0x1c1)][_0x6f6a4c(0x251)]('amily2-menu-open')&&document['addEventListener'](_0x6f6a4c(0x264),_0x2af871,!![]);},0x0);}function showColumnNameEditor(_0x8d7fc5,_0x1918ef,_0x31d567){const _0x1a63d1=_0x3c7b05,_0x2f8659=_0x1a63d1(0x1fa)+_0x31d567+_0x1a63d1(0x204),_0x3d1f7a=$(_0x2f8659)[_0x1a63d1(0x25f)]('body'),_0x2cbf1e=_0x3d1f7a['find'](_0x1a63d1(0x274)),_0x26ad79=()=>{const _0x63a76f=_0x1a63d1;_0x3d1f7a[0x0]['close'](),_0x3d1f7a[_0x63a76f(0x299)]();};_0x3d1f7a['find'](_0x1a63d1(0x1e4))['on'](_0x1a63d1(0x264),()=>{const _0x29ee42=_0x1a63d1,_0x60d168=_0x2cbf1e[_0x29ee42(0x221)]()[_0x29ee42(0x278)]();if(_0x60d168&&_0x60d168!==_0x31d567)_0x22228c[_0x29ee42(0x277)](_0x8d7fc5,_0x1918ef,_0x60d168),renderTables(),toastr[_0x29ee42(0x2b3)]('列名已更新为\x20\x22'+_0x60d168+'\x22');else{if(!_0x60d168){toastr[_0x29ee42(0x232)](_0x29ee42(0x21a)),_0x2cbf1e[_0x29ee42(0x23c)]();return;}}_0x26ad79();}),_0x3d1f7a['find'](_0x1a63d1(0x25d))['on'](_0x1a63d1(0x264),_0x26ad79),_0x2cbf1e['on'](_0x1a63d1(0x1cd),_0x38b266=>{const _0x259624=_0x1a63d1;_0x38b266[_0x259624(0x267)]===0xd&&_0x3d1f7a[_0x259624(0x29b)](_0x259624(0x1e4))[_0x259624(0x264)]();}),_0x2cbf1e['on'](_0x1a63d1(0x258),_0x161d68=>{const _0x56a90d=_0x1a63d1;_0x161d68[_0x56a90d(0x267)]===0x1b&&_0x26ad79();}),_0x3d1f7a[0x0][_0x1a63d1(0x1c3)](),_0x2cbf1e[_0x1a63d1(0x23c)]()[_0x1a63d1(0x1d5)]();}function positionContextMenu(_0x1621d8,_0x473e29){const _0x239368=_0x3c7b05;_0x1621d8[_0x239368(0x281)][_0x239368(0x2b6)]=_0x239368(0x2a6),_0x1621d8[_0x239368(0x281)][_0x239368(0x2a2)]=_0x239368(0x1f9),_0x1621d8[_0x239368(0x281)][_0x239368(0x256)]='0',_0x1621d8[_0x239368(0x281)][_0x239368(0x248)]=_0x239368(0x2ae),_0x1621d8[_0x239368(0x281)]['marginTop']='',_0x1621d8[_0x239368(0x281)][_0x239368(0x26c)]='',_0x1621d8[_0x239368(0x281)][_0x239368(0x23b)]='',_0x1621d8['style'][_0x239368(0x1df)]='';const _0x47757a=window['innerHeight'],_0x11b587=_0x473e29[_0x239368(0x275)](),_0x8fb491=0xc8,_0x357c0e=_0x473e29['closest'](_0x239368(0x2c7)),_0x4e3089=_0x357c0e?_0x357c0e[_0x239368(0x275)]():{'top':0x0,'bottom':_0x47757a},_0x463d28=Math[_0x239368(0x2b7)](_0x47757a,_0x4e3089[_0x239368(0x2bf)])-_0x11b587[_0x239368(0x2bf)],_0x429f0a=_0x11b587['top']-Math['max'](0x0,_0x4e3089[_0x239368(0x2a5)]);_0x463d28<_0x8fb491&&_0x429f0a>_0x463d28?(_0x1621d8[_0x239368(0x281)][_0x239368(0x2a5)]=_0x239368(0x2ae),_0x1621d8[_0x239368(0x281)][_0x239368(0x2bf)]=_0x239368(0x2c6),_0x1621d8[_0x239368(0x281)][_0x239368(0x26c)]=_0x239368(0x27c)):(_0x1621d8[_0x239368(0x281)][_0x239368(0x2a5)]=_0x239368(0x2c6),_0x1621d8[_0x239368(0x281)]['bottom']=_0x239368(0x2ae),_0x1621d8['style'][_0x239368(0x24a)]='2px');const _0x34a4f0=0xa0,_0x57bee3=_0x473e29[_0x239368(0x1bf)](_0x239368(0x254)),_0x4d7c46=_0x57bee3?_0x57bee3[_0x239368(0x1bf)](_0x239368(0x21c)):null;if(_0x4d7c46){const _0x2ea02a=_0x4d7c46[_0x239368(0x275)](),_0x32844b=_0x11b587['left']-_0x2ea02a[_0x239368(0x256)];_0x32844b+_0x34a4f0>_0x2ea02a['width']-0x14&&(_0x1621d8['style']['left']=_0x239368(0x2ae),_0x1621d8[_0x239368(0x281)][_0x239368(0x248)]='0');}}export function renderTables(){const _0x4f421c=_0x3c7b05;let _0x5b4a1d=_0x22228c['getMemoryState']();!_0x5b4a1d&&(log('内存状态为空，从聊天记录加载作为后备。',_0x4f421c(0x284)),_0x5b4a1d=_0x22228c['loadTables']());const _0x143963=getAllTablesContainer();if(!_0x5b4a1d||!_0x143963){console[_0x4f421c(0x28b)](_0x4f421c(0x268));return;}const _0x5933b6=_0x22228c[_0x4f421c(0x2c8)](),_0x387cf8=document['getElementById']('add-table-placeholder');_0x387cf8&&_0x387cf8['remove'](),_0x143963['innerHTML']='',_0x5b4a1d[_0x4f421c(0x20d)]((_0x356026,_0x5e9f09)=>{const _0x5cdd32=_0x4f421c,_0xddb88d=document[_0x5cdd32(0x1c8)](_0x5cdd32(0x1ce));_0xddb88d['style'][_0x5cdd32(0x1d1)]=_0x5cdd32(0x222),_0xddb88d[_0x5cdd32(0x281)][_0x5cdd32(0x226)]=_0x5cdd32(0x1de),_0xddb88d[_0x5cdd32(0x281)]['alignItems']=_0x5cdd32(0x2b1);const _0x317a68=document['createElement']('h3');_0x317a68[_0x5cdd32(0x27d)]=_0x5cdd32(0x262)+_0x356026[_0x5cdd32(0x1c6)];const _0x1ad293=document[_0x5cdd32(0x1c8)](_0x5cdd32(0x1ce));_0x1ad293['className']=_0x5cdd32(0x257);const _0x56c618=_0x5e9f09>0x0?_0x5cdd32(0x2aa)+_0x5e9f09+_0x5cdd32(0x276):'',_0x13ff89=_0x5e9f09<_0x5b4a1d[_0x5cdd32(0x2a9)]-0x1?'<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22'+_0x5e9f09+_0x5cdd32(0x1c2):'';_0x1ad293['innerHTML']=_0x5cdd32(0x24b)+_0x56c618+_0x5cdd32(0x24b)+_0x13ff89+_0x5cdd32(0x210)+_0x5e9f09+_0x5cdd32(0x1d8)+_0x5e9f09+_0x5cdd32(0x1e8),_0xddb88d['appendChild'](_0x317a68),_0xddb88d[_0x5cdd32(0x22e)](_0x1ad293),_0x143963[_0x5cdd32(0x22e)](_0xddb88d);const _0x414da3=document[_0x5cdd32(0x1c8)]('table');_0x414da3['style'][_0x5cdd32(0x1d1)]='block',_0x414da3['style']['overflowX']='auto',_0x414da3['id']=_0x5cdd32(0x2af)+_0x5e9f09,_0x414da3[_0x5cdd32(0x215)][_0x5cdd32(0x25e)]=_0x5e9f09;const _0x3c4285=_0x414da3[_0x5cdd32(0x1ff)](),_0x1d3d71=_0x3c4285[_0x5cdd32(0x229)](),_0x4e85e3=document['createElement']('th');_0x4e85e3[_0x5cdd32(0x1ec)]=_0x5cdd32(0x1dd),_0x4e85e3[_0x5cdd32(0x2ab)]='#',_0x1d3d71[_0x5cdd32(0x22e)](_0x4e85e3),_0x356026['headers']['forEach']((_0x21b360,_0x18865e)=>{const _0x1c269a=_0x5cdd32,_0x7ad4cf=document[_0x1c269a(0x1c8)]('th');_0x7ad4cf[_0x1c269a(0x215)][_0x1c269a(0x273)]=_0x18865e,_0x7ad4cf['style'][_0x1c269a(0x223)]=_0x1c269a(0x1e0);const _0x58501f=document[_0x1c269a(0x1c8)](_0x1c269a(0x26f));_0x58501f['className']='amily2-header-text',_0x58501f[_0x1c269a(0x2ab)]=_0x21b360,_0x7ad4cf[_0x1c269a(0x22e)](_0x58501f);const _0x203c4f=document[_0x1c269a(0x1c8)](_0x1c269a(0x1ce));_0x203c4f[_0x1c269a(0x1ec)]=_0x1c269a(0x1c4);const _0x432a94=[{'label':_0x1c269a(0x2b0),'action':'move-left','icon':'fa-arrow-left'},{'label':_0x1c269a(0x1ed),'action':_0x1c269a(0x26d),'icon':_0x1c269a(0x224)},{'label':_0x1c269a(0x1f6),'action':'add-left','icon':_0x1c269a(0x1ee)},{'label':_0x1c269a(0x233),'action':_0x1c269a(0x20a),'icon':'fa-plus-circle'},{'label':_0x1c269a(0x291),'action':_0x1c269a(0x250),'icon':_0x1c269a(0x244)},{'label':_0x1c269a(0x25a),'action':_0x1c269a(0x260),'icon':_0x1c269a(0x1e6),'isDanger':!![]}];_0x432a94[_0x1c269a(0x20d)](({label:_0x27d29a,action:_0x745092,icon:_0x17846d,isDanger:_0x4a603d})=>{const _0x2fcd49=_0x1c269a,_0x5846ac=document[_0x2fcd49(0x1c8)](_0x2fcd49(0x1c5));_0x5846ac[_0x2fcd49(0x2ab)]=_0x27d29a,_0x5846ac[_0x2fcd49(0x1ec)]='menu_button\x20small_button';if(_0x4a603d)_0x5846ac['classList']['add'](_0x2fcd49(0x265));_0x5846ac[_0x2fcd49(0x1e7)](_0x2fcd49(0x264),_0x21e10b=>{const _0x2a7270=_0x2fcd49;_0x21e10b[_0x2a7270(0x27b)]();switch(_0x745092){case _0x2a7270(0x209):_0x22228c[_0x2a7270(0x290)](_0x5e9f09,_0x18865e,_0x2a7270(0x256));break;case _0x2a7270(0x26d):_0x22228c['moveColumn'](_0x5e9f09,_0x18865e,'right');break;case'add-left':_0x22228c[_0x2a7270(0x20c)](_0x5e9f09,_0x18865e,_0x2a7270(0x256));break;case'add-right':_0x22228c['insertColumn'](_0x5e9f09,_0x18865e,_0x2a7270(0x248));break;case _0x2a7270(0x250):showColumnNameEditor(_0x5e9f09,_0x18865e,_0x21b360);break;case'delete':confirm(_0x2a7270(0x271)+_0x21b360+_0x2a7270(0x282))&&_0x22228c[_0x2a7270(0x23d)](_0x5e9f09,_0x18865e);break;}renderTables();}),_0x203c4f[_0x2fcd49(0x22e)](_0x5846ac);}),_0x7ad4cf[_0x1c269a(0x22e)](_0x203c4f),_0x1d3d71[_0x1c269a(0x22e)](_0x7ad4cf);});const _0x4d8957=_0x414da3[_0x5cdd32(0x1f8)]();_0x356026[_0x5cdd32(0x22f)]&&_0x356026[_0x5cdd32(0x22f)][_0x5cdd32(0x2a9)]>0x0&&_0x356026['rows'][_0x5cdd32(0x20d)]((_0xc3a934,_0x25cc53)=>{const _0x45dd33=_0x5cdd32,_0x347f59=_0x4d8957[_0x45dd33(0x229)]();_0x347f59[_0x45dd33(0x215)][_0x45dd33(0x1fe)]=_0x25cc53;const _0xa8831c=_0x347f59[_0x45dd33(0x230)]();_0xa8831c['className']='index-col';const _0x1f50d9=document[_0x45dd33(0x1c8)](_0x45dd33(0x26f));_0x1f50d9[_0x45dd33(0x2ab)]=_0x25cc53+0x1,_0xa8831c['appendChild'](_0x1f50d9);const _0x5880c2=document[_0x45dd33(0x1c8)](_0x45dd33(0x1ce));_0x5880c2[_0x45dd33(0x1ec)]='amily2-context-menu\x20amily2-row-context-menu';const _0xe38360=[{'label':_0x45dd33(0x1da),'action':_0x45dd33(0x29a),'icon':_0x45dd33(0x2ba)},{'label':_0x45dd33(0x1fd),'action':_0x45dd33(0x236),'icon':_0x45dd33(0x29e)},{'label':_0x45dd33(0x1e3),'action':_0x45dd33(0x292),'icon':'fa-plus-circle'},{'label':_0x45dd33(0x20f),'action':'add-below','icon':_0x45dd33(0x1ee)},{'label':_0x45dd33(0x294),'action':_0x45dd33(0x2a0),'icon':_0x45dd33(0x1e6),'isDanger':!![]}];_0xe38360[_0x45dd33(0x20d)](({label:_0x2e7d70,action:_0x3fb7db,icon:_0x2e2d52,isDanger:_0xd484bf})=>{const _0x499ece=_0x45dd33,_0x49fd3d=document[_0x499ece(0x1c8)](_0x499ece(0x1c5));_0x49fd3d[_0x499ece(0x27d)]=_0x499ece(0x247)+_0x2e2d52+_0x499ece(0x269)+_0x2e7d70,_0x49fd3d[_0x499ece(0x1ec)]=_0x499ece(0x28f);if(_0xd484bf)_0x49fd3d['classList'][_0x499ece(0x1f5)](_0x499ece(0x265));_0x49fd3d['addEventListener']('click',_0x9bc029=>{const _0x1c18cf=_0x499ece;_0x9bc029['stopPropagation']();switch(_0x3fb7db){case _0x1c18cf(0x29a):_0x22228c['moveRow'](_0x5e9f09,_0x25cc53,'up');break;case _0x1c18cf(0x236):_0x22228c[_0x1c18cf(0x2b2)](_0x5e9f09,_0x25cc53,_0x1c18cf(0x27a));break;case _0x1c18cf(0x292):_0x22228c[_0x1c18cf(0x229)](_0x5e9f09,_0x25cc53,_0x1c18cf(0x205));break;case'add-below':_0x22228c['insertRow'](_0x5e9f09,_0x25cc53,_0x1c18cf(0x225));break;case'delete-row':confirm(_0x1c18cf(0x1d0)+(_0x25cc53+0x1)+_0x1c18cf(0x1c7))&&_0x22228c[_0x1c18cf(0x23f)](_0x5e9f09,_0x25cc53);break;}renderTables();}),_0x5880c2[_0x499ece(0x22e)](_0x49fd3d);}),_0xa8831c['appendChild'](_0x5880c2),_0xc3a934[_0x45dd33(0x20d)]((_0x4f8542,_0x200f23)=>{const _0x566db4=_0x45dd33,_0x52fe67=_0x347f59[_0x566db4(0x230)]();_0x52fe67[_0x566db4(0x2ab)]=_0x4f8542;const _0x58163e=()=>_0x566db4(0x2be)in window||navigator[_0x566db4(0x24c)]>0x0;!_0x58163e()&&_0x52fe67['setAttribute'](_0x566db4(0x21f),_0x566db4(0x288));_0x52fe67[_0x566db4(0x215)][_0x566db4(0x273)]=_0x200f23,_0x52fe67[_0x566db4(0x215)][_0x566db4(0x2c0)]=_0x356026[_0x566db4(0x1d4)][_0x200f23]||'';const _0x41230a=_0x5e9f09+'-'+_0x25cc53+'-'+_0x200f23;_0x5933b6[_0x566db4(0x241)](_0x41230a)&&_0x52fe67[_0x566db4(0x1c1)][_0x566db4(0x1f5)](_0x566db4(0x1e9));});}),_0x143963[_0x5cdd32(0x22e)](_0x414da3);}),_0x387cf8&&_0x143963[_0x4f421c(0x22e)](_0x387cf8);}function openRuleEditor(_0x5062e6){const _0x15a598=_0x3c7b05,_0x4d5cb6=_0x22228c['getMemoryState']();if(!_0x4d5cb6||!_0x4d5cb6[_0x5062e6])return;const _0x27a341=_0x4d5cb6[_0x5062e6],_0x560f4e=_0x15a598(0x28c)+_0x27a341[_0x15a598(0x1c6)]+_0x15a598(0x237)+(_0x27a341['note']||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x27a341[_0x15a598(0x1d9)]||'')+_0x15a598(0x243)+(_0x27a341[_0x15a598(0x280)]||'')+_0x15a598(0x289)+(_0x27a341['rule_update']||'')+_0x15a598(0x22d),_0x1b24ba=$(_0x560f4e)[_0x15a598(0x25f)](_0x15a598(0x1d3)),_0x1cff20=()=>{_0x1b24ba[0x0]['close'](),_0x1b24ba['remove']();};_0x1b24ba[_0x15a598(0x29b)](_0x15a598(0x1e4))['on'](_0x15a598(0x264),()=>{const _0x4b4312=_0x15a598,_0x3478c8={'note':_0x1b24ba['find'](_0x4b4312(0x1f3))[_0x4b4312(0x221)](),'rule_add':_0x1b24ba[_0x4b4312(0x29b)]('#rule-add')[_0x4b4312(0x221)](),'rule_delete':_0x1b24ba[_0x4b4312(0x29b)](_0x4b4312(0x2a7))[_0x4b4312(0x221)](),'rule_update':_0x1b24ba[_0x4b4312(0x29b)]('#rule-update')[_0x4b4312(0x221)]()};_0x22228c['updateTableRules'](_0x5062e6,_0x3478c8),_0x1cff20();}),_0x1b24ba[_0x15a598(0x29b)](_0x15a598(0x25d))['on'](_0x15a598(0x264),_0x1cff20),_0x1b24ba[0x0][_0x15a598(0x1c3)]();}function bindInjectionSettings(){const _0x13d6bb=_0x3c7b05,_0x2f3d33=extension_settings[extensionName],_0x2f065d=document[_0x13d6bb(0x24f)]('table-system-master-switch'),_0x394f8c=document[_0x13d6bb(0x24f)]('table-injection-enabled'),_0xe05487=document[_0x13d6bb(0x24f)](_0x13d6bb(0x238)),_0x4de4a6=document[_0x13d6bb(0x24f)](_0x13d6bb(0x253)),_0x2037a4=document[_0x13d6bb(0x207)](_0x13d6bb(0x261));if(!_0x2f065d||!_0x394f8c||!_0xe05487||!_0x4de4a6||!_0x2037a4[_0x13d6bb(0x2a9)])return;const _0x379795=()=>{const _0x227dd7=_0x13d6bb,_0x4d1420=_0xe05487[_0x227dd7(0x266)],_0x3cc99d=_0x2f065d[_0x227dd7(0x2ad)],_0x3e26ec=_0x4d1420==='1';_0x394f8c[_0x227dd7(0x1ef)]=!_0x3cc99d,_0xe05487[_0x227dd7(0x1ef)]=!_0x3cc99d,_0x4de4a6[_0x227dd7(0x1ef)]=!_0x3cc99d||!_0x3e26ec,_0x2037a4[_0x227dd7(0x20d)](_0x265677=>_0x265677[_0x227dd7(0x1ef)]=!_0x3cc99d||!_0x3e26ec);const _0x572f97=_0x3cc99d?'1':_0x227dd7(0x29f);_0x394f8c[_0x227dd7(0x281)][_0x227dd7(0x1cc)]=_0x572f97;_0x394f8c[_0x227dd7(0x1bf)](_0x227dd7(0x2a4))&&(_0x394f8c['closest']('.control-block-with-switch')[_0x227dd7(0x281)][_0x227dd7(0x1cc)]=_0x572f97);_0xe05487[_0x227dd7(0x281)][_0x227dd7(0x1cc)]=_0x572f97;_0xe05487[_0x227dd7(0x216)]&&(_0xe05487[_0x227dd7(0x216)][_0x227dd7(0x281)]['opacity']=_0x572f97);const _0x379bf5=_0x3cc99d&&_0x3e26ec?'1':_0x227dd7(0x29f);_0x4de4a6['style'][_0x227dd7(0x1cc)]=_0x379bf5;_0x4de4a6[_0x227dd7(0x216)]&&(_0x4de4a6[_0x227dd7(0x216)][_0x227dd7(0x281)][_0x227dd7(0x1cc)]=_0x379bf5);const _0x3ad226=_0x3cc99d&&_0x3e26ec?'1':_0x227dd7(0x29f),_0x106203=document[_0x227dd7(0x24f)](_0x227dd7(0x206))?.['closest'](_0x227dd7(0x200));_0x106203&&(_0x106203[_0x227dd7(0x281)]['opacity']=_0x3ad226,_0x106203[_0x227dd7(0x216)]&&(_0x106203[_0x227dd7(0x216)]['style'][_0x227dd7(0x1cc)]=_0x3ad226));const _0x4533a6=document['querySelectorAll'](_0x227dd7(0x28e));_0x4533a6[_0x227dd7(0x20d)](_0x1cfc4e=>{const _0x39075d=_0x227dd7;_0x1cfc4e[_0x39075d(0x1ef)]=!_0x3cc99d;const _0x3be99a=_0x1cfc4e[_0x39075d(0x1bf)](_0x39075d(0x2c0));_0x3be99a&&(_0x3be99a[_0x39075d(0x281)][_0x39075d(0x1cc)]=_0x3cc99d?'1':_0x39075d(0x29f));});const _0x1c6d0b=document[_0x227dd7(0x24f)](_0x227dd7(0x1e1));_0x1c6d0b&&(_0x1c6d0b['disabled']=!_0x3cc99d,_0x1c6d0b[_0x227dd7(0x281)][_0x227dd7(0x1cc)]=_0x3cc99d?'1':'0.5');};_0x2f065d['checked']=_0x2f3d33['table_system_enabled']!==![],_0x394f8c[_0x13d6bb(0x2ad)]=_0x2f3d33[_0x13d6bb(0x1fb)],_0xe05487[_0x13d6bb(0x266)]=_0x2f3d33[_0x13d6bb(0x1f7)][_0x13d6bb(0x2b6)],_0x4de4a6['value']=_0x2f3d33[_0x13d6bb(0x1f7)][_0x13d6bb(0x2b5)],_0x2037a4[_0x13d6bb(0x20d)](_0x2bfaa9=>{const _0x54bb29=_0x13d6bb;parseInt(_0x2bfaa9[_0x54bb29(0x266)],0xa)===_0x2f3d33[_0x54bb29(0x1f7)][_0x54bb29(0x1e2)]&&(_0x2bfaa9[_0x54bb29(0x2ad)]=!![]);}),_0x379795(),_0x2f065d['addEventListener'](_0x13d6bb(0x28a),()=>{const _0x105bf9=_0x13d6bb;_0x2f3d33[_0x105bf9(0x219)]=_0x2f065d[_0x105bf9(0x2ad)],saveSettingsDebounced(),_0x379795();const _0x7d3368=_0x2f065d[_0x105bf9(0x2ad)]?'已启用':_0x105bf9(0x249);toastr[_0x105bf9(0x231)](_0x105bf9(0x1db)+_0x7d3368+'。'),log('表格系统总开关'+_0x7d3368+'。',_0x105bf9(0x231));}),_0x394f8c[_0x13d6bb(0x1e7)](_0x13d6bb(0x28a),()=>{const _0x272040=_0x13d6bb;_0x2f3d33[_0x272040(0x1fb)]=_0x394f8c[_0x272040(0x2ad)],saveSettingsDebounced();}),_0xe05487['addEventListener'](_0x13d6bb(0x28a),()=>{const _0x268aa2=_0x13d6bb;_0x2f3d33[_0x268aa2(0x1f7)][_0x268aa2(0x2b6)]=parseInt(_0xe05487[_0x268aa2(0x266)],0xa),saveSettingsDebounced(),_0x379795();}),_0x4de4a6[_0x13d6bb(0x1e7)](_0x13d6bb(0x25c),()=>{const _0x5260c3=_0x13d6bb;_0x2f3d33[_0x5260c3(0x1f7)][_0x5260c3(0x2b5)]=parseInt(_0x4de4a6[_0x5260c3(0x266)],0xa),saveSettingsDebounced();}),_0x2037a4[_0x13d6bb(0x20d)](_0x26ef05=>{const _0x1201da=_0x13d6bb;_0x26ef05[_0x1201da(0x1e7)](_0x1201da(0x28a),()=>{const _0x29f11d=_0x1201da;_0x26ef05['checked']&&(_0x2f3d33[_0x29f11d(0x1f7)][_0x29f11d(0x1e2)]=parseInt(_0x26ef05[_0x29f11d(0x266)],0xa),saveSettingsDebounced());});}),log('表格注入设置已成功绑定。',_0x13d6bb(0x2b3));}function updateAndSaveTableSetting(_0xcec6ea,_0x4b0be1){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0xcec6ea]=_0x4b0be1,saveSettingsDebounced();}export function bindTableEvents(){const _0x57d326=_0x3c7b05,_0x4dd773=document[_0x57d326(0x24f)]('amily2_memorisation_forms_panel');if(!_0x4dd773||_0x4dd773[_0x57d326(0x215)][_0x57d326(0x2b4)])return;log(_0x57d326(0x2c2),'info');const _0x3ffb04=_0x4dd773[_0x57d326(0x207)](_0x57d326(0x28e)),_0xb01b77=()=>{const _0x2b35f4=_0x57d326,_0x49d036=extension_settings[extensionName]?.['filling_mode']||_0x2b35f4(0x2c3);_0x3ffb04['forEach'](_0x2fad26=>{const _0x3c7cdc=_0x2b35f4;_0x2fad26[_0x3c7cdc(0x2ad)]=_0x2fad26[_0x3c7cdc(0x266)]===_0x49d036;});};_0x3ffb04[_0x57d326(0x20d)](_0x47acfa=>{_0x47acfa['addEventListener']('change',function(){const _0x5619ab=_0x1d86,_0x2df92d=this[_0x5619ab(0x266)];updateAndSaveTableSetting(_0x5619ab(0x2b8),_0x2df92d);let _0x34d2da=_0x5619ab(0x279);if(_0x2df92d==='secondary-api')_0x34d2da='分步填表';if(_0x2df92d===_0x5619ab(0x1ca))_0x34d2da=_0x5619ab(0x2ac);toastr[_0x5619ab(0x231)](_0x5619ab(0x286)+_0x34d2da+'。'),_0xb01b77();});}),_0xb01b77();const _0x5b56c3=()=>{renderTables(),bindInjectionSettings();};_0x5b56c3(),bindBatchFillButton(),bindTemplateEditors();const _0x1b1768=document[_0x57d326(0x272)](_0x57d326(0x1cf));_0x1b1768&&_0x1b1768[_0x57d326(0x1e7)](_0x57d326(0x264),_0x3dc95d=>{const _0x3cc944=_0x57d326,_0x50b9ea=_0x3dc95d['target']['closest'](_0x3cc944(0x26a));if(!_0x50b9ea)return;const _0x399bff=_0x50b9ea['dataset'][_0x3cc944(0x1f2)];if(!_0x399bff)return;const _0x25f1bc=_0x50b9ea[_0x3cc944(0x1bf)](_0x3cc944(0x212));if(!_0x25f1bc)return;_0x25f1bc[_0x3cc944(0x207)](_0x3cc944(0x26a))[_0x3cc944(0x20d)](_0x16a0ff=>_0x16a0ff[_0x3cc944(0x1c1)][_0x3cc944(0x299)](_0x3cc944(0x252))),_0x50b9ea['classList'][_0x3cc944(0x1f5)](_0x3cc944(0x252)),_0x25f1bc[_0x3cc944(0x207)](_0x3cc944(0x285))['forEach'](_0x4d3a8c=>_0x4d3a8c[_0x3cc944(0x1c1)]['remove']('active'));const _0x4df9bb=_0x25f1bc[_0x3cc944(0x272)](_0x3cc944(0x202)+_0x399bff+_0x3cc944(0x21e));_0x4df9bb&&_0x4df9bb[_0x3cc944(0x1c1)][_0x3cc944(0x1f5)](_0x3cc944(0x252));});const _0x4e9311=document[_0x57d326(0x24f)](_0x57d326(0x22c)),_0xf5e22b=document['getElementById'](_0x57d326(0x24e)),_0x380add=document[_0x57d326(0x24f)](_0x57d326(0x2bd));_0x4e9311&&_0x4e9311[_0x57d326(0x1e7)]('click',()=>_0x22228c[_0x57d326(0x220)]());_0xf5e22b&&_0xf5e22b[_0x57d326(0x1e7)]('click',()=>_0x22228c[_0x57d326(0x28d)]());_0x380add&&_0x380add[_0x57d326(0x1e7)](_0x57d326(0x264),()=>_0x22228c['importPreset'](_0x5b56c3));const _0xb44432=document[_0x57d326(0x24f)](_0x57d326(0x2a1));_0xb44432&&_0xb44432[_0x57d326(0x1e7)](_0x57d326(0x264),()=>{const _0x4fe403=_0x57d326;confirm('【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。')&&(_0x22228c[_0x4fe403(0x213)](),_0x5b56c3());});const _0x446e1b=document[_0x57d326(0x24f)]('add-table-placeholder');_0x446e1b&&_0x446e1b['addEventListener']('click',()=>{const _0x45157d=_0x57d326,_0x1aa512=prompt(_0x45157d(0x27e),_0x45157d(0x1d7));_0x1aa512&&_0x1aa512['trim']()&&(_0x22228c['addTable'](_0x1aa512['trim']()),_0x5b56c3());});const _0x5546b9=getAllTablesContainer();if(_0x5546b9){_0x5546b9[_0x57d326(0x1e7)](_0x57d326(0x264),_0x27740a=>{const _0x2f054a=_0x57d326,_0x510584=_0x27740a[_0x2f054a(0x240)][_0x2f054a(0x1bf)]('th');if(_0x510584&&!_0x510584[_0x2f054a(0x1c1)]['contains'](_0x2f054a(0x1dd))){toggleColumnContextMenu(_0x27740a);return;}const _0xb139b5=_0x27740a[_0x2f054a(0x240)]['closest']('td.index-col');if(_0xb139b5){toggleRowContextMenu(_0x27740a);return;}const _0x58c694=_0x27740a['target']['closest']('button');if(!_0x58c694)return;const _0x46c6bd=parseInt(_0x58c694[_0x2f054a(0x215)][_0x2f054a(0x25e)],0xa);if(_0x58c694['matches'](_0x2f054a(0x234)))_0x22228c[_0x2f054a(0x287)](_0x46c6bd),_0x5b56c3();else{if(_0x58c694[_0x2f054a(0x298)](_0x2f054a(0x263)))_0x22228c[_0x2f054a(0x2a8)](_0x46c6bd),_0x5b56c3();else{if(_0x58c694[_0x2f054a(0x298)]('.move-table-up-btn')||_0x58c694[_0x2f054a(0x298)](_0x2f054a(0x297))){const _0x33446a=_0x58c694[_0x2f054a(0x1c1)][_0x2f054a(0x251)](_0x2f054a(0x1f1))?'up':_0x2f054a(0x27a);_0x22228c[_0x2f054a(0x293)](_0x46c6bd,_0x33446a),_0x5b56c3();}else{if(_0x58c694[_0x2f054a(0x298)](_0x2f054a(0x25b)))openRuleEditor(_0x46c6bd);else{if(_0x58c694[_0x2f054a(0x298)](_0x2f054a(0x203))){const _0x391540=_0x22228c[_0x2f054a(0x246)](),_0x43e78c=_0x391540[_0x46c6bd]?.[_0x2f054a(0x1c6)]||_0x2f054a(0x214);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x43e78c+_0x2f054a(0x22a))&&(_0x22228c[_0x2f054a(0x1eb)](_0x46c6bd),_0x5b56c3());}}}}}});const _0x153286=()=>_0x57d326(0x2be)in window||navigator['maxTouchPoints']>0x0;if(_0x153286()){let _0x4f20da=0x0,_0x18b6b6=null;_0x5546b9[_0x57d326(0x1e7)](_0x57d326(0x217),_0x3a5a8d=>{const _0x4dd34a=_0x57d326,_0x4225c2=_0x3a5a8d[_0x4dd34a(0x240)][_0x4dd34a(0x1bf)]('td');if(!_0x4225c2||_0x4225c2[_0x4dd34a(0x215)][_0x4dd34a(0x273)]===undefined)return;const _0xb13821=new Date()[_0x4dd34a(0x227)](),_0x4b71cf=_0xb13821-_0x4f20da;_0x4b71cf<0x12c&&_0x4b71cf>0x0&&_0x18b6b6===_0x4225c2&&(_0x3a5a8d['preventDefault'](),_0x4225c2[_0x4dd34a(0x259)](_0x4dd34a(0x21f))!==_0x4dd34a(0x288)&&(_0x4225c2[_0x4dd34a(0x2c4)](_0x4dd34a(0x21f),'true'),setTimeout(()=>_0x4225c2[_0x4dd34a(0x23c)](),0x0))),_0x4f20da=_0xb13821,_0x18b6b6=_0x4225c2;});}_0x5546b9['addEventListener']('blur',_0x3023ba=>{const _0x52875f=_0x57d326,_0x14acd8=_0x3023ba[_0x52875f(0x240)];if(_0x14acd8[_0x52875f(0x21b)]!=='TD'||_0x14acd8[_0x52875f(0x259)](_0x52875f(0x21f))!==_0x52875f(0x288))return;const _0x44e235=()=>'ontouchstart'in window||navigator[_0x52875f(0x24c)]>0x0;_0x44e235()&&_0x14acd8['setAttribute'](_0x52875f(0x21f),_0x52875f(0x239));const _0x1f2256=_0x14acd8['closest'](_0x52875f(0x254));if(!_0x1f2256)return;const _0x1403b7=parseInt(_0x1f2256[_0x52875f(0x215)][_0x52875f(0x25e)],0xa),_0x3e9b7a=parseInt(_0x14acd8[_0x52875f(0x1bf)]('tr')[_0x52875f(0x215)][_0x52875f(0x1fe)],0xa),_0x5a2681=parseInt(_0x14acd8[_0x52875f(0x215)][_0x52875f(0x273)],0xa),_0x53d550=_0x14acd8[_0x52875f(0x2ab)];_0x22228c[_0x52875f(0x283)](_0x1403b7,_0x3e9b7a,_0x5a2681);const _0x33f143={[_0x5a2681]:_0x53d550};_0x22228c[_0x52875f(0x1d6)](_0x1403b7,_0x3e9b7a,_0x33f143),_0x5b56c3();},!![]);}_0x4dd773[_0x57d326(0x215)][_0x57d326(0x2b4)]='true',log(_0x57d326(0x1e5),_0x57d326(0x2b3));}function bindBatchFillButton(){const _0x1ae10b=_0x3c7b05,_0x339d97=document[_0x1ae10b(0x24f)]('fill-table-now-btn');if(_0x339d97){if(_0x339d97[_0x1ae10b(0x215)][_0x1ae10b(0x21d)])return;_0x339d97[_0x1ae10b(0x1e7)](_0x1ae10b(0x264),_0x24eb80=>{const _0x4dcf29=_0x1ae10b,_0x55301e=extension_settings[extensionName],_0x41c775=_0x55301e[_0x4dcf29(0x219)]!==![];if(!_0x41c775){_0x24eb80[_0x4dcf29(0x1c0)](),toastr[_0x4dcf29(0x232)](_0x4dcf29(0x270));return;}startBatchFilling();}),_0x339d97[_0x1ae10b(0x215)][_0x1ae10b(0x21d)]=_0x1ae10b(0x288),log('\x22立即填表\x22按钮已成功绑定。','success');}}function bindTemplateEditors(){const _0x559b63=_0x3c7b05,_0x5821a0=document[_0x559b63(0x24f)](_0x559b63(0x1cb)),_0x5b6022=document[_0x559b63(0x24f)](_0x559b63(0x1d2)),_0x31f064=document['getElementById'](_0x559b63(0x235)),_0x2ce799=document[_0x559b63(0x24f)]('ai-flow-template-editor'),_0x2a3534=document[_0x559b63(0x24f)](_0x559b63(0x201)),_0x2fc751=document[_0x559b63(0x24f)](_0x559b63(0x245));if(!_0x5821a0||!_0x2ce799){log(_0x559b63(0x2c1),_0x559b63(0x284));return;}_0x5821a0[_0x559b63(0x266)]=_0x22228c[_0x559b63(0x1dc)](),_0x2ce799[_0x559b63(0x266)]=_0x22228c[_0x559b63(0x208)](),_0x5b6022['addEventListener'](_0x559b63(0x264),()=>{const _0x4ba025=_0x559b63;_0x22228c[_0x4ba025(0x26b)](_0x5821a0[_0x4ba025(0x266)]),toastr[_0x4ba025(0x2b3)]('规则提示词已保存。'),log(_0x4ba025(0x2c5),_0x4ba025(0x2b3));}),_0x2a3534[_0x559b63(0x1e7)](_0x559b63(0x264),()=>{const _0xc1d0b8=_0x559b63;_0x22228c[_0xc1d0b8(0x22b)](_0x2ce799[_0xc1d0b8(0x266)]),toastr['success'](_0xc1d0b8(0x27f)),log('批量填表-流程提示词已保存。','success');}),_0x31f064[_0x559b63(0x1e7)]('click',()=>{const _0x40dd92=_0x559b63;confirm('您确定要将规则提示词恢复为默认设置吗？')&&(_0x5821a0[_0x40dd92(0x266)]=DEFAULT_AI_RULE_TEMPLATE,_0x22228c[_0x40dd92(0x26b)](_0x5821a0[_0x40dd92(0x266)]),toastr[_0x40dd92(0x231)](_0x40dd92(0x255)),log(_0x40dd92(0x242),'info'));}),_0x2fc751['addEventListener']('click',()=>{const _0x51f265=_0x559b63;confirm('您确定要将流程提示词恢复为默认设置吗？')&&(_0x2ce799[_0x51f265(0x266)]=DEFAULT_AI_FLOW_TEMPLATE,_0x22228c[_0x51f265(0x22b)](_0x2ce799[_0x51f265(0x266)]),toastr[_0x51f265(0x231)](_0x51f265(0x23a)),log(_0x51f265(0x1c9),_0x51f265(0x231)));}),log(_0x559b63(0x2b9),_0x559b63(0x2b3));}
