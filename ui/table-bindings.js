(function(_0x5a1930,_0x53a9b5){const _0x3a79e4=_0x4f9d,_0x3c2a4b=_0x5a1930();while(!![]){try{const _0x1792ba=parseInt(_0x3a79e4(0x131))/0x1+-parseInt(_0x3a79e4(0xfb))/0x2+-parseInt(_0x3a79e4(0x150))/0x3*(-parseInt(_0x3a79e4(0x132))/0x4)+-parseInt(_0x3a79e4(0x13b))/0x5+-parseInt(_0x3a79e4(0xfe))/0x6+-parseInt(_0x3a79e4(0x1a2))/0x7+parseInt(_0x3a79e4(0x118))/0x8*(parseInt(_0x3a79e4(0xe8))/0x9);if(_0x1792ba===_0x53a9b5)break;else _0x3c2a4b['push'](_0x3c2a4b['shift']());}catch(_0x50472d){_0x3c2a4b['push'](_0x3c2a4b['shift']());}}}(_0x2aa8,0xdd39c));import*as _0x2f440f from'../core/table-system/manager.js';function _0x2aa8(){const _0x401424=['length','remove','innerHTML','checked','您确定要将规则提示词恢复为默认设置吗？','规则提示词已恢复为默认。','clearAllTables','button','您确定要删除第\x20','menu_button\x20small_button','add-table-placeholder','rule_add','main-api','value','trim','”\x20列吗？','moveTable','importPreset','removeEventListener','querySelectorAll','eventsBound','amily2-import-preset-btn','closest','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','填表模式已切换为\x20','justifyContent','exportPresetFull','table-injection-depth','.sinan-nav-item','body','appendTo','9279FQYFvC','在上加行','开始为表格视图绑定交互事件...','down','success','display','delete','deleteTable','请输入新表格的名称：','在下加行','0.5','style','“立即填表”按钮已成功绑定。','above','updateRow','fa-arrow-right','在右加列','tab','dblclick','992688tnZrcW','td.index-col','addEventListener','3559452LtknWK','maxTouchPoints','.move-table-down-btn','info','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','space-between','amily2-menu-active','move-right','向上移动','index-col','amily2_memorisation_forms_panel','批量填表-流程提示词已恢复默认。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','preventDefault','querySelector','.popup-button-cancel','move-up','div',']”\x20吗？此操作不可逆！','showModal','previousElementSibling','.add-col-btn','amily2-context-menu','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','warn','13784UpQlhp','table','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','指令模板编辑器已成功绑定。','fa-trash-alt','getElementById','overflowX','rows','optimized','分步填表','fa-pen','.amily2-context-menu','colIndex','headers','.amily2-context-menu.amily2-menu-active','label','dataset','note','classList','原始填表','ontouchstart','stopPropagation','未知表格','amily2-clear-all-tables-btn','table-injection-enabled','1375101XfcxvN','687916moOvIb','insertColumn','向下移动','moveColumn','table-injection-position','center','getBatchFillerRuleTemplate','add-above','flex','3695170WLuLwp','batchEventBound','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','<i\x20class=\x22fas\x20','input','false','addColumn','getBatchFillerFlowTemplate','moveRow','alignItems','rule_delete','ai-rule-template-restore-btn','【最终警告】您确定要永久废黜表格\x20“[','contenteditable','textContent','createTBody','move-table-up-btn','rowIndex','.sinan-tab-pane','ai-flow-template-restore-btn','fa-arrow-left','3tNDNJd','click','blur','fill-table-now-btn','接收到强制UI重载事件，正在刷新表格UI...','.settings-group','cursor','contains','.delete-table-btn','insertRow','amily2-force-ui-reload','请输入新的列名：','move-left','saveBatchFillerFlowTemplate','您确定要删除\x20“','error','您确定要将流程提示词恢复为默认设置吗？','add-right','matches','below','getMemoryState','target','close','getAttribute','opacity','danger','编辑列名','appendChild','input[name=\x22filling-mode\x22]','amily2-export-preset-btn','\x20行吗？','left','.popup-button-ok','move-down','规则提示词已保存。','className','向左移动','right','ai-flow-template-save-btn','exportPreset','createTHead','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','rename','true','loadTables','批量填表-规则提示词已保存。','rule_update','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','tagName','amily2-export-preset-full-btn','val','add','add-below','forEach','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','#rule-update','delete-row','批量填表-流程提示词已保存。','table_injection_role','setAttribute','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','pointer','createElement','ai-flow-template-editor','流程提示词已恢复为默认。','#sinan-','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','.edit-rules-btn','\x22></i>\x20','表格视图交互事件已成功绑定。','find','active','span','change','insertCell','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','fa-plus-circle','addRow','focus','amily2-table-','table_injection_enabled','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','4121131zClMpS','table_injection_position','ai-rule-template-editor','add-left','name','#rule-delete','disabled','.move-table-up-btn','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','table_injection_depth'];_0x2aa8=function(){return _0x401424;};return _0x2aa8();}import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document['getElementById']('all-tables-container');function _0x4f9d(_0x17bbf5,_0x4fb780){const _0x2aa891=_0x2aa8();return _0x4f9d=function(_0x4f9d1e,_0x1ae811){_0x4f9d1e=_0x4f9d1e-0xe8;let _0x27d12e=_0x2aa891[_0x4f9d1e];return _0x27d12e;},_0x4f9d(_0x17bbf5,_0x4fb780);}function toggleRowContextMenu(_0x2b9fee){const _0x40dc5d=_0x4f9d;_0x2b9fee[_0x40dc5d(0x10c)](),_0x2b9fee[_0x40dc5d(0x12d)]();const _0x197bbf=_0x2b9fee[_0x40dc5d(0x165)]['closest']('td.index-col');if(!_0x197bbf)return;const _0x56940c=_0x197bbf[_0x40dc5d(0x10d)](_0x40dc5d(0x123));if(!_0x56940c)return;const _0x3e126b=_0x56940c[_0x40dc5d(0x12a)][_0x40dc5d(0x157)](_0x40dc5d(0x104));document[_0x40dc5d(0x1bf)](_0x40dc5d(0x126))['forEach'](_0x5565d2=>{const _0x2b9842=_0x40dc5d;_0x5565d2[_0x2b9842(0x12a)]['remove'](_0x2b9842(0x104));});!_0x3e126b&&_0x56940c['classList'][_0x40dc5d(0x183)](_0x40dc5d(0x104));const _0xa1fce4=_0x162c8a=>{const _0x397631=_0x40dc5d;!_0x56940c[_0x397631(0x157)](_0x162c8a[_0x397631(0x165)])&&(_0x56940c[_0x397631(0x12a)]['remove'](_0x397631(0x104)),document['removeEventListener']('click',_0xa1fce4,!![]));};setTimeout(()=>{const _0x22140e=_0x40dc5d;_0x56940c[_0x22140e(0x12a)][_0x22140e(0x157)](_0x22140e(0x104))&&document['addEventListener'](_0x22140e(0x151),_0xa1fce4,!![]);},0x0);}function toggleColumnContextMenu(_0xfc0c34){const _0xd60dba=_0x4f9d;_0xfc0c34[_0xd60dba(0x10c)](),_0xfc0c34['stopPropagation']();const _0x55009d=_0xfc0c34[_0xd60dba(0x165)][_0xd60dba(0x1c2)]('th');if(!_0x55009d)return;const _0x34b49b=_0x55009d[_0xd60dba(0x10d)](_0xd60dba(0x123));if(!_0x34b49b)return;const _0x2f3b95=_0x34b49b[_0xd60dba(0x12a)][_0xd60dba(0x157)](_0xd60dba(0x104));document[_0xd60dba(0x1bf)](_0xd60dba(0x126))[_0xd60dba(0x185)](_0x294823=>{const _0x1dcd23=_0xd60dba;_0x294823[_0x1dcd23(0x12a)]['remove'](_0x1dcd23(0x104));});!_0x2f3b95&&_0x34b49b[_0xd60dba(0x12a)]['add'](_0xd60dba(0x104));const _0xb84230=_0x429d59=>{const _0x2d9322=_0xd60dba;!_0x34b49b['contains'](_0x429d59[_0x2d9322(0x165)])&&(_0x34b49b['classList'][_0x2d9322(0x1ad)](_0x2d9322(0x104)),document[_0x2d9322(0x1be)](_0x2d9322(0x151),_0xb84230,!![]));};setTimeout(()=>{const _0x244beb=_0xd60dba;_0x34b49b['classList'][_0x244beb(0x157)](_0x244beb(0x104))&&document[_0x244beb(0xfd)](_0x244beb(0x151),_0xb84230,!![]);},0x0);}export function renderTables(){const _0x455569=_0x4f9d;let _0x14ee94=_0x2f440f[_0x455569(0x164)]();!_0x14ee94&&(log('内存状态为空，从聊天记录加载作为后备。',_0x455569(0x117)),_0x14ee94=_0x2f440f[_0x455569(0x17c)]());const _0x139c19=getAllTablesContainer();if(!_0x14ee94||!_0x139c19){console[_0x455569(0x15f)](_0x455569(0x19b));return;}const _0xfe299e=document[_0x455569(0x11d)](_0x455569(0x1b6));_0xfe299e&&_0xfe299e['remove'](),_0x139c19[_0x455569(0x1ae)]='',_0x14ee94[_0x455569(0x185)]((_0x435c88,_0x55d315)=>{const _0x1aba55=_0x455569,_0x548a29=document[_0x1aba55(0x18e)]('div');_0x548a29[_0x1aba55(0xf3)][_0x1aba55(0xed)]=_0x1aba55(0x13a),_0x548a29['style'][_0x1aba55(0x1c5)]=_0x1aba55(0x103),_0x548a29[_0x1aba55(0xf3)][_0x1aba55(0x144)]=_0x1aba55(0x137);const _0x43f2e1=document[_0x1aba55(0x18e)]('h3');_0x43f2e1[_0x1aba55(0x1ae)]=_0x1aba55(0x10b)+_0x435c88[_0x1aba55(0x1a6)];const _0x3657dd=document[_0x1aba55(0x18e)](_0x1aba55(0x110));_0x3657dd['className']='table-controls';const _0x2862ea=_0x55d315>0x0?_0x1aba55(0x192)+_0x55d315+_0x1aba55(0x1aa):'',_0x48c38c=_0x55d315<_0x14ee94[_0x1aba55(0x1ac)]-0x1?'<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22'+_0x55d315+'\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>':'';_0x3657dd[_0x1aba55(0x1ae)]=_0x1aba55(0x10a)+_0x2862ea+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x48c38c+_0x1aba55(0x102)+_0x55d315+_0x1aba55(0x1c3)+_0x55d315+_0x1aba55(0x11a),_0x548a29[_0x1aba55(0x16b)](_0x43f2e1),_0x548a29['appendChild'](_0x3657dd),_0x139c19['appendChild'](_0x548a29);const _0x19241e=document[_0x1aba55(0x18e)](_0x1aba55(0x110));_0x19241e[_0x1aba55(0xf3)][_0x1aba55(0x11e)]='auto';const _0x2da0ef=document[_0x1aba55(0x18e)](_0x1aba55(0x119));_0x2da0ef['id']=_0x1aba55(0x19f)+_0x55d315,_0x2da0ef['dataset']['tableIndex']=_0x55d315;const _0x3e84f2=_0x2da0ef[_0x1aba55(0x178)](),_0x204091=_0x3e84f2[_0x1aba55(0x159)](),_0x40259c=document['createElement']('th');_0x40259c['className']='index-col',_0x40259c[_0x1aba55(0x149)]='#',_0x204091['appendChild'](_0x40259c),_0x435c88[_0x1aba55(0x125)][_0x1aba55(0x185)]((_0x3af688,_0x39df8f)=>{const _0x93725c=_0x1aba55,_0x1fe34e=document[_0x93725c(0x18e)]('th');_0x1fe34e[_0x93725c(0x128)][_0x93725c(0x124)]=_0x39df8f,_0x1fe34e[_0x93725c(0xf3)][_0x93725c(0x156)]=_0x93725c(0x18d);const _0xcb5686=document['createElement'](_0x93725c(0x198));_0xcb5686['textContent']=_0x3af688,_0x1fe34e[_0x93725c(0x16b)](_0xcb5686);const _0x42d89f=document[_0x93725c(0x18e)](_0x93725c(0x110));_0x42d89f[_0x93725c(0x173)]=_0x93725c(0x115);const _0xf1b157=[{'label':_0x93725c(0x174),'action':_0x93725c(0x15c),'icon':_0x93725c(0x14f)},{'label':'向右移动','action':_0x93725c(0x105),'icon':_0x93725c(0xf7)},{'label':'在左加列','action':_0x93725c(0x1a5),'icon':_0x93725c(0x19c)},{'label':_0x93725c(0xf8),'action':_0x93725c(0x161),'icon':_0x93725c(0x19c)},{'label':_0x93725c(0x16a),'action':_0x93725c(0x17a),'icon':_0x93725c(0x122)},{'label':'删除该列','action':'delete','icon':_0x93725c(0x11c),'isDanger':!![]}];_0xf1b157['forEach'](({label:_0x243c78,action:_0x1523cc,icon:_0x34a27e,isDanger:_0x4ef6d5})=>{const _0x5d1ed3=_0x93725c,_0x3c2dc9=document[_0x5d1ed3(0x18e)](_0x5d1ed3(0x1b3));_0x3c2dc9[_0x5d1ed3(0x1ae)]=_0x5d1ed3(0x13e)+_0x34a27e+_0x5d1ed3(0x194)+_0x243c78,_0x3c2dc9[_0x5d1ed3(0x173)]=_0x5d1ed3(0x1b5);if(_0x4ef6d5)_0x3c2dc9[_0x5d1ed3(0x12a)][_0x5d1ed3(0x183)](_0x5d1ed3(0x169));_0x3c2dc9[_0x5d1ed3(0xfd)](_0x5d1ed3(0x151),_0x576223=>{const _0x8a94a2=_0x5d1ed3;_0x576223[_0x8a94a2(0x12d)]();switch(_0x1523cc){case'move-left':_0x2f440f[_0x8a94a2(0x135)](_0x55d315,_0x39df8f,_0x8a94a2(0x16f));break;case _0x8a94a2(0x105):_0x2f440f[_0x8a94a2(0x135)](_0x55d315,_0x39df8f,_0x8a94a2(0x175));break;case _0x8a94a2(0x1a5):_0x2f440f['insertColumn'](_0x55d315,_0x39df8f,_0x8a94a2(0x16f));break;case _0x8a94a2(0x161):_0x2f440f[_0x8a94a2(0x133)](_0x55d315,_0x39df8f,_0x8a94a2(0x175));break;case _0x8a94a2(0x17a):const _0x21e066=prompt(_0x8a94a2(0x15b),_0x3af688);_0x21e066!==null&&_0x2f440f['updateHeader'](_0x55d315,_0x39df8f,_0x21e066);break;case _0x8a94a2(0xee):confirm(_0x8a94a2(0x15e)+_0x3af688+_0x8a94a2(0x1bb))&&_0x2f440f['deleteColumn'](_0x55d315,_0x39df8f);break;}renderTables();}),_0x42d89f[_0x5d1ed3(0x16b)](_0x3c2dc9);}),_0x1fe34e['appendChild'](_0x42d89f),_0x204091[_0x93725c(0x16b)](_0x1fe34e);});const _0x276a72=_0x2da0ef[_0x1aba55(0x14a)]();_0x435c88[_0x1aba55(0x11f)]&&_0x435c88[_0x1aba55(0x11f)][_0x1aba55(0x1ac)]>0x0&&_0x435c88['rows'][_0x1aba55(0x185)]((_0x202485,_0x3f36d4)=>{const _0x518fa9=_0x1aba55,_0x15aa12=_0x276a72['insertRow']();_0x15aa12['dataset']['rowIndex']=_0x3f36d4;const _0x31978a=_0x15aa12[_0x518fa9(0x19a)]();_0x31978a['className']=_0x518fa9(0x107);const _0x233036=document[_0x518fa9(0x18e)](_0x518fa9(0x198));_0x233036[_0x518fa9(0x149)]=_0x3f36d4+0x1,_0x31978a[_0x518fa9(0x16b)](_0x233036);const _0x19c503=document['createElement'](_0x518fa9(0x110));_0x19c503[_0x518fa9(0x173)]='amily2-context-menu\x20amily2-row-context-menu';const _0x4ddf28=[{'label':_0x518fa9(0x106),'action':_0x518fa9(0x10f),'icon':'fa-arrow-up'},{'label':_0x518fa9(0x134),'action':_0x518fa9(0x171),'icon':'fa-arrow-down'},{'label':_0x518fa9(0xe9),'action':_0x518fa9(0x139),'icon':_0x518fa9(0x19c)},{'label':_0x518fa9(0xf1),'action':_0x518fa9(0x184),'icon':_0x518fa9(0x19c)},{'label':'删除该行','action':_0x518fa9(0x188),'icon':_0x518fa9(0x11c),'isDanger':!![]}];_0x4ddf28[_0x518fa9(0x185)](({label:_0x246704,action:_0x20762e,icon:_0x6aa0d6,isDanger:_0x738dd2})=>{const _0xf9a688=_0x518fa9,_0x40a1d2=document['createElement'](_0xf9a688(0x1b3));_0x40a1d2['innerHTML']=_0xf9a688(0x13e)+_0x6aa0d6+'\x22></i>\x20'+_0x246704,_0x40a1d2[_0xf9a688(0x173)]=_0xf9a688(0x1b5);if(_0x738dd2)_0x40a1d2[_0xf9a688(0x12a)][_0xf9a688(0x183)]('danger');_0x40a1d2[_0xf9a688(0xfd)](_0xf9a688(0x151),_0x281bec=>{const _0xe7cbf3=_0xf9a688;_0x281bec[_0xe7cbf3(0x12d)]();switch(_0x20762e){case'move-up':_0x2f440f[_0xe7cbf3(0x143)](_0x55d315,_0x3f36d4,'up');break;case _0xe7cbf3(0x171):_0x2f440f[_0xe7cbf3(0x143)](_0x55d315,_0x3f36d4,_0xe7cbf3(0xeb));break;case _0xe7cbf3(0x139):_0x2f440f[_0xe7cbf3(0x159)](_0x55d315,_0x3f36d4,_0xe7cbf3(0xf5));break;case _0xe7cbf3(0x184):_0x2f440f[_0xe7cbf3(0x159)](_0x55d315,_0x3f36d4,_0xe7cbf3(0x163));break;case _0xe7cbf3(0x188):confirm(_0xe7cbf3(0x1b4)+(_0x3f36d4+0x1)+_0xe7cbf3(0x16e))&&_0x2f440f['deleteRow'](_0x55d315,_0x3f36d4);break;}renderTables();}),_0x19c503[_0xf9a688(0x16b)](_0x40a1d2);}),_0x31978a[_0x518fa9(0x16b)](_0x19c503),_0x202485['forEach']((_0x3719c1,_0x57994f)=>{const _0x167eef=_0x518fa9,_0x1a048d=_0x15aa12['insertCell']();_0x1a048d[_0x167eef(0x149)]=_0x3719c1;const _0x2adad7=()=>'ontouchstart'in window||navigator[_0x167eef(0xff)]>0x0;!_0x2adad7()&&_0x1a048d[_0x167eef(0x18b)](_0x167eef(0x148),'true'),_0x1a048d[_0x167eef(0x128)][_0x167eef(0x124)]=_0x57994f,_0x1a048d[_0x167eef(0x128)][_0x167eef(0x127)]=_0x435c88['headers'][_0x57994f]||'';});}),_0x19241e[_0x1aba55(0x16b)](_0x2da0ef),_0x139c19[_0x1aba55(0x16b)](_0x19241e);}),_0xfe299e&&_0x139c19['appendChild'](_0xfe299e);}function openRuleEditor(_0x15a73b){const _0x44aabf=_0x4f9d,_0x5787d5=_0x2f440f['getMemoryState']();if(!_0x5787d5||!_0x5787d5[_0x15a73b])return;const _0xa4da24=_0x5787d5[_0x15a73b],_0x3b730e=_0x44aabf(0x13d)+_0xa4da24[_0x44aabf(0x1a6)]+_0x44aabf(0x17f)+(_0xa4da24[_0x44aabf(0x129)]||'')+_0x44aabf(0x18c)+(_0xa4da24[_0x44aabf(0x1b7)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0xa4da24[_0x44aabf(0x145)]||'')+_0x44aabf(0x116)+(_0xa4da24[_0x44aabf(0x17e)]||'')+_0x44aabf(0x179),_0x28e2c1=$(_0x3b730e)[_0x44aabf(0x1ca)](_0x44aabf(0x1c9)),_0x32d9d9=()=>{const _0x5e60dc=_0x44aabf;_0x28e2c1[0x0][_0x5e60dc(0x166)](),_0x28e2c1[_0x5e60dc(0x1ad)]();};_0x28e2c1[_0x44aabf(0x196)](_0x44aabf(0x170))['on']('click',()=>{const _0x3859b8=_0x44aabf,_0x814a8d={'note':_0x28e2c1['find']('#rule-note')[_0x3859b8(0x182)](),'rule_add':_0x28e2c1[_0x3859b8(0x196)]('#rule-add')[_0x3859b8(0x182)](),'rule_delete':_0x28e2c1[_0x3859b8(0x196)](_0x3859b8(0x1a7))['val'](),'rule_update':_0x28e2c1[_0x3859b8(0x196)](_0x3859b8(0x187))[_0x3859b8(0x182)]()};_0x2f440f['updateTableRules'](_0x15a73b,_0x814a8d),_0x32d9d9();}),_0x28e2c1['find'](_0x44aabf(0x10e))['on'](_0x44aabf(0x151),_0x32d9d9),_0x28e2c1[0x0][_0x44aabf(0x112)]();}function bindInjectionSettings(){const _0xeb0e1f=_0x4f9d,_0x4e8c1c=extension_settings[extensionName],_0x57ee46=document[_0xeb0e1f(0x11d)](_0xeb0e1f(0x130)),_0x22f1b4=document[_0xeb0e1f(0x11d)](_0xeb0e1f(0x136)),_0x447ac9=document[_0xeb0e1f(0x11d)](_0xeb0e1f(0x1c7)),_0x590603=document[_0xeb0e1f(0x11d)]('table-injection-role');if(!_0x57ee46||!_0x22f1b4||!_0x447ac9||!_0x590603)return;const _0x2e2b89=()=>{const _0x3c9bfa=_0xeb0e1f,_0x1e8b38=_0x22f1b4[_0x3c9bfa(0x1b9)],_0x15048a=_0x1e8b38==='1';_0x447ac9[_0x3c9bfa(0x1a8)]=!_0x15048a,_0x590603[_0x3c9bfa(0x1a8)]=!_0x15048a;const _0x1e6dab=_0x15048a?'1':_0x3c9bfa(0xf2);_0x447ac9[_0x3c9bfa(0xf3)][_0x3c9bfa(0x168)]=_0x1e6dab;_0x447ac9[_0x3c9bfa(0x113)]&&(_0x447ac9['previousElementSibling']['style'][_0x3c9bfa(0x168)]=_0x1e6dab);const _0x165a1d=_0x15048a?'1':_0x3c9bfa(0xf2);_0x590603[_0x3c9bfa(0xf3)][_0x3c9bfa(0x168)]=_0x165a1d,_0x590603[_0x3c9bfa(0x113)]&&(_0x590603['previousElementSibling'][_0x3c9bfa(0xf3)][_0x3c9bfa(0x168)]=_0x165a1d);};_0x57ee46[_0xeb0e1f(0x1af)]=_0x4e8c1c[_0xeb0e1f(0x1a0)],_0x22f1b4[_0xeb0e1f(0x1b9)]=_0x4e8c1c['table_injection_position'],_0x447ac9[_0xeb0e1f(0x1b9)]=_0x4e8c1c['table_injection_depth'],_0x590603['value']=_0x4e8c1c['table_injection_role'],_0x2e2b89(),_0x57ee46[_0xeb0e1f(0xfd)](_0xeb0e1f(0x199),()=>{const _0x5a66f3=_0xeb0e1f;_0x4e8c1c['table_injection_enabled']=_0x57ee46[_0x5a66f3(0x1af)],saveSettingsDebounced();}),_0x22f1b4[_0xeb0e1f(0xfd)](_0xeb0e1f(0x199),()=>{const _0x3aa2de=_0xeb0e1f;_0x4e8c1c[_0x3aa2de(0x1a3)]=parseInt(_0x22f1b4[_0x3aa2de(0x1b9)],0xa),saveSettingsDebounced(),_0x2e2b89();}),_0x447ac9[_0xeb0e1f(0xfd)](_0xeb0e1f(0x13f),()=>{const _0x1af6a7=_0xeb0e1f;_0x4e8c1c[_0x1af6a7(0x1ab)]=parseInt(_0x447ac9[_0x1af6a7(0x1b9)],0xa),saveSettingsDebounced();}),_0x590603[_0xeb0e1f(0xfd)](_0xeb0e1f(0x199),()=>{const _0x1e2171=_0xeb0e1f;_0x4e8c1c[_0x1e2171(0x18a)]=_0x590603[_0x1e2171(0x1b9)],saveSettingsDebounced();}),log('表格注入设置已成功绑定。',_0xeb0e1f(0xec));}function updateAndSaveTableSetting(_0x37e06c,_0x4e934c){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x37e06c]=_0x4e934c,saveSettingsDebounced();}export function bindTableEvents(){const _0x42ea78=_0x4f9d,_0x3e7b2d=document[_0x42ea78(0x11d)](_0x42ea78(0x108));if(!_0x3e7b2d||_0x3e7b2d[_0x42ea78(0x128)][_0x42ea78(0x1c0)])return;log(_0x42ea78(0xea),'info');const _0x524e29=_0x3e7b2d[_0x42ea78(0x1bf)](_0x42ea78(0x16c)),_0x106c31=()=>{const _0x5b75fe=_0x42ea78,_0x3bd412=extension_settings[extensionName]?.['filling_mode']||_0x5b75fe(0x1b8);_0x524e29['forEach'](_0x32ae7a=>{const _0x23fe80=_0x5b75fe;_0x32ae7a[_0x23fe80(0x1af)]=_0x32ae7a[_0x23fe80(0x1b9)]===_0x3bd412;});};_0x524e29['forEach'](_0x3a6e19=>{const _0x37eb0c=_0x42ea78;_0x3a6e19[_0x37eb0c(0xfd)](_0x37eb0c(0x199),function(){const _0x53dd40=_0x37eb0c,_0x4d4f76=this[_0x53dd40(0x1b9)];updateAndSaveTableSetting('filling_mode',_0x4d4f76);let _0x2185af=_0x53dd40(0x12b);if(_0x4d4f76==='secondary-api')_0x2185af=_0x53dd40(0x121);if(_0x4d4f76===_0x53dd40(0x120))_0x2185af='优化中填表';toastr[_0x53dd40(0x101)](_0x53dd40(0x1c4)+_0x2185af+'。'),_0x106c31();});}),_0x106c31();const _0x180398=()=>{renderTables(),bindInjectionSettings();};_0x180398(),bindBatchFillButton(),bindTemplateEditors();const _0x56c3ef=document[_0x42ea78(0x10d)](_0x42ea78(0x1a1));_0x56c3ef&&_0x56c3ef[_0x42ea78(0xfd)]('click',_0x1b8ece=>{const _0x33b834=_0x42ea78,_0x204c86=_0x1b8ece[_0x33b834(0x165)][_0x33b834(0x1c2)](_0x33b834(0x1c8));if(!_0x204c86)return;const _0x2f1e9e=_0x204c86[_0x33b834(0x128)][_0x33b834(0xf9)];if(!_0x2f1e9e)return;const _0x255710=_0x204c86[_0x33b834(0x1c2)](_0x33b834(0x155));if(!_0x255710)return;_0x255710['querySelectorAll'](_0x33b834(0x1c8))[_0x33b834(0x185)](_0x2c10aa=>_0x2c10aa['classList'][_0x33b834(0x1ad)](_0x33b834(0x197))),_0x204c86[_0x33b834(0x12a)][_0x33b834(0x183)](_0x33b834(0x197)),_0x255710[_0x33b834(0x1bf)](_0x33b834(0x14d))[_0x33b834(0x185)](_0x15b839=>_0x15b839[_0x33b834(0x12a)][_0x33b834(0x1ad)](_0x33b834(0x197)));const _0x27b450=_0x255710[_0x33b834(0x10d)](_0x33b834(0x191)+_0x2f1e9e+'-tab');_0x27b450&&_0x27b450[_0x33b834(0x12a)][_0x33b834(0x183)](_0x33b834(0x197));});const _0x2f6787=document['getElementById'](_0x42ea78(0x16d)),_0x1d7aa8=document[_0x42ea78(0x11d)](_0x42ea78(0x181)),_0x18fe6f=document[_0x42ea78(0x11d)](_0x42ea78(0x1c1));_0x2f6787&&_0x2f6787[_0x42ea78(0xfd)](_0x42ea78(0x151),()=>_0x2f440f[_0x42ea78(0x177)]());_0x1d7aa8&&_0x1d7aa8[_0x42ea78(0xfd)](_0x42ea78(0x151),()=>_0x2f440f[_0x42ea78(0x1c6)]());_0x18fe6f&&_0x18fe6f[_0x42ea78(0xfd)]('click',()=>_0x2f440f[_0x42ea78(0x1bd)](_0x180398));const _0x3f27a7=document[_0x42ea78(0x11d)](_0x42ea78(0x12f));_0x3f27a7&&_0x3f27a7[_0x42ea78(0xfd)](_0x42ea78(0x151),()=>{const _0x473008=_0x42ea78;confirm(_0x473008(0x186))&&(_0x2f440f[_0x473008(0x1b2)](),_0x180398());});const _0x7c47aa=document[_0x42ea78(0x11d)](_0x42ea78(0x1b6));_0x7c47aa&&_0x7c47aa['addEventListener']('click',()=>{const _0x2dfd87=_0x42ea78,_0x20aed9=prompt(_0x2dfd87(0xf0),'新表格');_0x20aed9&&_0x20aed9['trim']()&&(_0x2f440f['addTable'](_0x20aed9[_0x2dfd87(0x1ba)]()),_0x180398());});const _0x50c6a2=getAllTablesContainer();if(_0x50c6a2){_0x50c6a2[_0x42ea78(0xfd)](_0x42ea78(0x151),_0x3fa02a=>{const _0x40e760=_0x42ea78,_0xa9704a=_0x3fa02a[_0x40e760(0x165)]['closest']('th');if(_0xa9704a&&!_0xa9704a[_0x40e760(0x12a)][_0x40e760(0x157)](_0x40e760(0x107))){toggleColumnContextMenu(_0x3fa02a);return;}const _0x15dd17=_0x3fa02a[_0x40e760(0x165)][_0x40e760(0x1c2)](_0x40e760(0xfc));if(_0x15dd17){toggleRowContextMenu(_0x3fa02a);return;}const _0x5e2d97=_0x3fa02a['target'][_0x40e760(0x1c2)]('button');if(!_0x5e2d97)return;const _0xeeb464=parseInt(_0x5e2d97[_0x40e760(0x128)]['tableIndex'],0xa);if(_0x5e2d97[_0x40e760(0x162)]('.add-row-btn'))_0x2f440f[_0x40e760(0x19d)](_0xeeb464),_0x180398();else{if(_0x5e2d97['matches'](_0x40e760(0x114)))_0x2f440f[_0x40e760(0x141)](_0xeeb464),_0x180398();else{if(_0x5e2d97[_0x40e760(0x162)](_0x40e760(0x1a9))||_0x5e2d97[_0x40e760(0x162)](_0x40e760(0x100))){const _0x4171a8=_0x5e2d97[_0x40e760(0x12a)]['contains'](_0x40e760(0x14b))?'up':_0x40e760(0xeb);_0x2f440f[_0x40e760(0x1bc)](_0xeeb464,_0x4171a8),_0x180398();}else{if(_0x5e2d97[_0x40e760(0x162)](_0x40e760(0x193)))openRuleEditor(_0xeeb464);else{if(_0x5e2d97[_0x40e760(0x162)](_0x40e760(0x158))){const _0x36f6ba=_0x2f440f[_0x40e760(0x164)](),_0x55ad9a=_0x36f6ba[_0xeeb464]?.['name']||_0x40e760(0x12e);confirm(_0x40e760(0x147)+_0x55ad9a+_0x40e760(0x111))&&(_0x2f440f[_0x40e760(0xef)](_0xeeb464),_0x180398());}}}}}});const _0x567b21=()=>_0x42ea78(0x12c)in window||navigator['maxTouchPoints']>0x0;_0x567b21()&&_0x50c6a2[_0x42ea78(0xfd)](_0x42ea78(0xfa),_0x46a1a5=>{const _0x3675f9=_0x42ea78,_0x1ecf2a=_0x46a1a5[_0x3675f9(0x165)]['closest']('td');_0x1ecf2a&&_0x1ecf2a['dataset'][_0x3675f9(0x124)]!==undefined&&_0x1ecf2a[_0x3675f9(0x167)](_0x3675f9(0x148))!==_0x3675f9(0x17b)&&(_0x1ecf2a[_0x3675f9(0x18b)]('contenteditable',_0x3675f9(0x17b)),_0x1ecf2a[_0x3675f9(0x19e)]());}),_0x50c6a2['addEventListener'](_0x42ea78(0x152),_0x8c89ba=>{const _0xdfc194=_0x42ea78,_0x1ab457=_0x8c89ba[_0xdfc194(0x165)];if(_0x1ab457[_0xdfc194(0x180)]!=='TD'||_0x1ab457[_0xdfc194(0x167)](_0xdfc194(0x148))!==_0xdfc194(0x17b))return;const _0x2d6f76=()=>_0xdfc194(0x12c)in window||navigator[_0xdfc194(0xff)]>0x0;_0x2d6f76()&&_0x1ab457[_0xdfc194(0x18b)](_0xdfc194(0x148),_0xdfc194(0x140));const _0x5e9628=_0x1ab457[_0xdfc194(0x1c2)](_0xdfc194(0x119));if(!_0x5e9628)return;const _0x5e9786=parseInt(_0x5e9628[_0xdfc194(0x128)]['tableIndex'],0xa),_0x179360=parseInt(_0x1ab457[_0xdfc194(0x1c2)]('tr')[_0xdfc194(0x128)][_0xdfc194(0x14c)],0xa),_0x6ed706=parseInt(_0x1ab457[_0xdfc194(0x128)][_0xdfc194(0x124)],0xa),_0x578dd1=_0x1ab457[_0xdfc194(0x149)],_0x241635={[_0x6ed706]:_0x578dd1};_0x2f440f[_0xdfc194(0xf6)](_0x5e9786,_0x179360,_0x241635),_0x180398();},!![]);}_0x3e7b2d[_0x42ea78(0x128)][_0x42ea78(0x1c0)]='true',log(_0x42ea78(0x195),'success'),document[_0x42ea78(0xfd)](_0x42ea78(0x15a),()=>{const _0x249f7e=_0x42ea78;log(_0x249f7e(0x154),_0x249f7e(0x101)),_0x180398();});}function bindBatchFillButton(){const _0x3e0411=_0x4f9d,_0x36833c=document[_0x3e0411(0x11d)](_0x3e0411(0x153));if(_0x36833c){if(_0x36833c[_0x3e0411(0x128)]['batchEventBound'])return;_0x36833c[_0x3e0411(0xfd)](_0x3e0411(0x151),startBatchFilling),_0x36833c[_0x3e0411(0x128)][_0x3e0411(0x13c)]=_0x3e0411(0x17b),log(_0x3e0411(0xf4),_0x3e0411(0xec));}}function bindTemplateEditors(){const _0x48c773=_0x4f9d,_0x17dfc0=document[_0x48c773(0x11d)](_0x48c773(0x1a4)),_0x1a3645=document[_0x48c773(0x11d)]('ai-rule-template-save-btn'),_0x518c42=document[_0x48c773(0x11d)](_0x48c773(0x146)),_0x201ee3=document[_0x48c773(0x11d)](_0x48c773(0x18f)),_0x540069=document[_0x48c773(0x11d)](_0x48c773(0x176)),_0x5bdb31=document[_0x48c773(0x11d)](_0x48c773(0x14e));if(!_0x17dfc0||!_0x201ee3){log('无法找到指令模板编辑器，绑定失败。',_0x48c773(0x117));return;}_0x17dfc0[_0x48c773(0x1b9)]=_0x2f440f[_0x48c773(0x138)](),_0x201ee3['value']=_0x2f440f[_0x48c773(0x142)](),_0x1a3645[_0x48c773(0xfd)](_0x48c773(0x151),()=>{const _0x1eda9f=_0x48c773;_0x2f440f['saveBatchFillerRuleTemplate'](_0x17dfc0[_0x1eda9f(0x1b9)]),toastr[_0x1eda9f(0xec)](_0x1eda9f(0x172)),log(_0x1eda9f(0x17d),_0x1eda9f(0xec));}),_0x540069['addEventListener'](_0x48c773(0x151),()=>{const _0x447b06=_0x48c773;_0x2f440f[_0x447b06(0x15d)](_0x201ee3[_0x447b06(0x1b9)]),toastr[_0x447b06(0xec)]('流程提示词已保存。'),log(_0x447b06(0x189),_0x447b06(0xec));}),_0x518c42[_0x48c773(0xfd)]('click',()=>{const _0xa815bf=_0x48c773;confirm(_0xa815bf(0x1b0))&&(_0x17dfc0[_0xa815bf(0x1b9)]=DEFAULT_AI_RULE_TEMPLATE,_0x2f440f['saveBatchFillerRuleTemplate'](_0x17dfc0['value']),toastr['info'](_0xa815bf(0x1b1)),log('批量填表-规则提示词已恢复默认。','info'));}),_0x5bdb31[_0x48c773(0xfd)](_0x48c773(0x151),()=>{const _0x942150=_0x48c773;confirm(_0x942150(0x160))&&(_0x201ee3[_0x942150(0x1b9)]=DEFAULT_AI_FLOW_TEMPLATE,_0x2f440f['saveBatchFillerFlowTemplate'](_0x201ee3[_0x942150(0x1b9)]),toastr['info'](_0x942150(0x190)),log(_0x942150(0x109),_0x942150(0x101)));}),log(_0x48c773(0x11b),'success');}
