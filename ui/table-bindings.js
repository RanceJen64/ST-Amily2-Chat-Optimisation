const _0x17ce89=_0xc0a1;(function(_0x4827eb,_0x173f0c){const _0x3a5b93=_0xc0a1,_0x44b10f=_0x4827eb();while(!![]){try{const _0x1153e6=parseInt(_0x3a5b93(0x23c))/0x1*(-parseInt(_0x3a5b93(0x253))/0x2)+-parseInt(_0x3a5b93(0x22d))/0x3*(-parseInt(_0x3a5b93(0x1e3))/0x4)+-parseInt(_0x3a5b93(0x187))/0x5*(-parseInt(_0x3a5b93(0x228))/0x6)+parseInt(_0x3a5b93(0x24b))/0x7+-parseInt(_0x3a5b93(0x1a1))/0x8+parseInt(_0x3a5b93(0x26f))/0x9+-parseInt(_0x3a5b93(0x22e))/0xa*(-parseInt(_0x3a5b93(0x25a))/0xb);if(_0x1153e6===_0x173f0c)break;else _0x44b10f['push'](_0x44b10f['shift']());}catch(_0x495e09){_0x44b10f['push'](_0x44b10f['shift']());}}}(_0x38f3,0x1c933));import*as _0x5af16c from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x17ce89(0x258)](_0x17ce89(0x209));function toggleRowContextMenu(_0x1e3826){const _0x978d25=_0x17ce89;_0x1e3826['preventDefault'](),_0x1e3826['stopPropagation']();const _0x376872=_0x1e3826[_0x978d25(0x1e8)][_0x978d25(0x278)]('td.index-col');if(!_0x376872)return;const _0x358a55=_0x376872['querySelector'](_0x978d25(0x249));if(!_0x358a55)return;const _0x4c027e=_0x358a55[_0x978d25(0x215)][_0x978d25(0x1e0)](_0x978d25(0x235));document[_0x978d25(0x257)](_0x978d25(0x1e2))['forEach'](_0xd595ee=>{const _0xbd4aac=_0x978d25;_0xd595ee[_0xbd4aac(0x215)][_0xbd4aac(0x20c)](_0xbd4aac(0x235));});!_0x4c027e&&_0x358a55['classList'][_0x978d25(0x194)](_0x978d25(0x235));const _0x287088=_0x3dc0a0=>{const _0x366b92=_0x978d25;!_0x358a55[_0x366b92(0x1e0)](_0x3dc0a0[_0x366b92(0x1e8)])&&(_0x358a55[_0x366b92(0x215)][_0x366b92(0x20c)](_0x366b92(0x235)),document[_0x366b92(0x1b0)](_0x366b92(0x1ce),_0x287088,!![]));};setTimeout(()=>{const _0x4f5895=_0x978d25;_0x358a55[_0x4f5895(0x215)][_0x4f5895(0x1e0)](_0x4f5895(0x235))&&document[_0x4f5895(0x18c)](_0x4f5895(0x1ce),_0x287088,!![]);},0x0);}function toggleColumnContextMenu(_0x446c1d){const _0x52cf01=_0x17ce89;_0x446c1d[_0x52cf01(0x1a0)](),_0x446c1d[_0x52cf01(0x20d)]();const _0x17813d=_0x446c1d[_0x52cf01(0x1e8)][_0x52cf01(0x278)]('th');if(!_0x17813d)return;const _0x361959=_0x17813d[_0x52cf01(0x215)][_0x52cf01(0x1e0)](_0x52cf01(0x20b));document['querySelectorAll']('th.amily2-menu-open')[_0x52cf01(0x254)](_0x46ef6a=>{const _0x1ddc3a=_0x52cf01;_0x46ef6a['classList'][_0x1ddc3a(0x20c)](_0x1ddc3a(0x20b));});!_0x361959&&_0x17813d[_0x52cf01(0x215)][_0x52cf01(0x194)]('amily2-menu-open');const _0x4c15c5=_0xb9641d=>{const _0x3fadf3=_0x52cf01;!_0x17813d['contains'](_0xb9641d[_0x3fadf3(0x1e8)])&&(_0x17813d[_0x3fadf3(0x215)][_0x3fadf3(0x20c)]('amily2-menu-open'),document[_0x3fadf3(0x1b0)](_0x3fadf3(0x1ce),_0x4c15c5,!![]));};setTimeout(()=>{const _0x3207bc=_0x52cf01;_0x17813d['classList'][_0x3207bc(0x1e0)](_0x3207bc(0x20b))&&document[_0x3207bc(0x18c)](_0x3207bc(0x1ce),_0x4c15c5,!![]);},0x0);}function showInputDialog({title:_0x449339,label:_0x179310,currentValue:_0x330b7e,placeholder:_0x562f25,onSave:_0x2797df}){const _0x1e9501=_0x17ce89,_0x3046c6=_0x1e9501(0x1c0)+_0x449339+_0x1e9501(0x1bd)+_0x179310+_0x1e9501(0x220)+_0x330b7e+_0x1e9501(0x1fa)+_0x562f25+_0x1e9501(0x184),_0x5e5dcf=$(_0x3046c6)['appendTo']('body'),_0x5a775f=_0x5e5dcf[_0x1e9501(0x26b)](_0x1e9501(0x26d)),_0x37fb14=()=>{const _0x381b56=_0x1e9501;_0x5e5dcf[0x0][_0x381b56(0x181)](),_0x5e5dcf[_0x381b56(0x20c)]();},_0x3bd8f2=()=>{const _0x1ca3c8=_0x1e9501,_0x20db57=_0x5a775f[_0x1ca3c8(0x22c)]()[_0x1ca3c8(0x1ee)]();if(_0x20db57&&_0x20db57!==_0x330b7e)_0x2797df(_0x20db57);else{if(!_0x20db57){toastr[_0x1ca3c8(0x1df)](_0x1ca3c8(0x272)),_0x5a775f['focus']();return;}}_0x37fb14();};_0x5e5dcf[_0x1e9501(0x26b)]('.popup-button-ok')['on'](_0x1e9501(0x1ce),_0x3bd8f2),_0x5e5dcf[_0x1e9501(0x26b)](_0x1e9501(0x232))['on'](_0x1e9501(0x1ce),_0x37fb14),_0x5a775f['on'](_0x1e9501(0x20a),_0x2bd51b=>{const _0x387d6d=_0x1e9501;if(_0x2bd51b[_0x387d6d(0x25d)]===0xd)_0x3bd8f2();}),_0x5a775f['on'](_0x1e9501(0x1fe),_0x5e4343=>{const _0x3a919e=_0x1e9501;if(_0x5e4343[_0x3a919e(0x25d)]===0x1b)_0x37fb14();}),_0x5e5dcf[0x0][_0x1e9501(0x188)](),_0x5a775f['focus']()[_0x1e9501(0x1f6)]();}function showColumnNameEditor(_0x517992,_0x6e1826,_0x12e6b3){const _0x38a9c0=_0x17ce89;showInputDialog({'title':_0x38a9c0(0x24e),'label':'列名：','currentValue':_0x12e6b3,'placeholder':'请输入列名...','onSave':_0x3cc33c=>{const _0x42de40=_0x38a9c0;_0x5af16c[_0x42de40(0x17a)](_0x517992,_0x6e1826,_0x3cc33c),renderTables(),toastr['success'](_0x42de40(0x1be)+_0x3cc33c+'\x22');}});}function showTableNameEditor(_0x2223cf,_0x3a85c4){const _0x40a955=_0x17ce89;showInputDialog({'title':_0x40a955(0x197),'label':_0x40a955(0x222),'currentValue':_0x3a85c4,'placeholder':_0x40a955(0x218),'onSave':_0x24e1a1=>{const _0x24ef1a=_0x40a955;_0x5af16c[_0x24ef1a(0x246)](_0x2223cf,_0x24e1a1),renderTables(),toastr[_0x24ef1a(0x22f)](_0x24ef1a(0x189)+_0x24e1a1+'\x22');}});}function positionContextMenu(_0x10ef96,_0x458eff){const _0x220b8b=_0x17ce89;_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x25f)]='absolute',_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x24a)]=_0x220b8b(0x237),_0x10ef96[_0x220b8b(0x1c6)]['left']='0',_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1fc)]=_0x220b8b(0x1cb),_0x10ef96['style']['marginTop']='',_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1a8)]='',_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1ff)]='',_0x10ef96[_0x220b8b(0x1c6)]['overflowY']='';const _0x63bb4=window['innerHeight'],_0xdfadf3=_0x458eff[_0x220b8b(0x265)](),_0x29443c=0xc8,_0x8b393e=_0x458eff[_0x220b8b(0x278)](_0x220b8b(0x1d5)),_0x1615dc=_0x8b393e?_0x8b393e[_0x220b8b(0x265)]():{'top':0x0,'bottom':_0x63bb4},_0x320f98=Math[_0x220b8b(0x1dd)](_0x63bb4,_0x1615dc[_0x220b8b(0x24d)])-_0xdfadf3[_0x220b8b(0x24d)],_0x11f1de=_0xdfadf3[_0x220b8b(0x1d4)]-Math[_0x220b8b(0x1b7)](0x0,_0x1615dc[_0x220b8b(0x1d4)]);_0x320f98<_0x29443c&&_0x11f1de>_0x320f98?(_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1d4)]='auto',_0x10ef96['style'][_0x220b8b(0x24d)]=_0x220b8b(0x225),_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1a8)]='2px'):(_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1d4)]=_0x220b8b(0x225),_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x24d)]=_0x220b8b(0x1cb),_0x10ef96['style'][_0x220b8b(0x196)]=_0x220b8b(0x1d0));const _0x316d68=0xa0,_0x3cb971=_0x458eff[_0x220b8b(0x278)](_0x220b8b(0x1ad)),_0x2b7ff6=_0x3cb971?_0x3cb971['closest'](_0x220b8b(0x291)):null;if(_0x2b7ff6){const _0x55d507=_0x2b7ff6[_0x220b8b(0x265)](),_0x12a09c=_0xdfadf3[_0x220b8b(0x1ef)]-_0x55d507[_0x220b8b(0x1ef)];_0x12a09c+_0x316d68>_0x55d507[_0x220b8b(0x213)]-0x14&&(_0x10ef96[_0x220b8b(0x1c6)][_0x220b8b(0x1ef)]='auto',_0x10ef96[_0x220b8b(0x1c6)]['right']='0');}}export function renderTables(){const _0x58a508=_0x17ce89;let _0x346ba9=_0x5af16c['getMemoryState']();!_0x346ba9&&(log(_0x58a508(0x255),_0x58a508(0x1b8)),_0x346ba9=_0x5af16c[_0x58a508(0x1f3)]());const _0x200cbc=getAllTablesContainer();if(!_0x346ba9||!_0x200cbc){console['error'](_0x58a508(0x1b2));return;}const _0x5435f1=_0x5af16c[_0x58a508(0x19c)](),_0x4b2f25=document[_0x58a508(0x258)](_0x58a508(0x282));_0x4b2f25&&_0x4b2f25[_0x58a508(0x20c)](),_0x200cbc[_0x58a508(0x17c)]='',_0x346ba9[_0x58a508(0x254)]((_0x136c3b,_0x3a3114)=>{const _0x5697e3=_0x58a508,_0x3f8516=document[_0x5697e3(0x1bb)](_0x5697e3(0x26a));_0x3f8516[_0x5697e3(0x1c6)][_0x5697e3(0x1bc)]='flex',_0x3f8516[_0x5697e3(0x1c6)][_0x5697e3(0x1eb)]=_0x5697e3(0x1e6),_0x3f8516[_0x5697e3(0x1c6)][_0x5697e3(0x18b)]=_0x5697e3(0x179);const _0x3e4196=document[_0x5697e3(0x1bb)]('h3');_0x3e4196[_0x5697e3(0x17c)]=_0x5697e3(0x22a)+_0x3a3114+'\x22\x20title=\x22重命名\x22></i>\x20'+_0x136c3b['name'];const _0x20b82b=document[_0x5697e3(0x1bb)]('div');_0x20b82b[_0x5697e3(0x17e)]=_0x5697e3(0x1b4);const _0x30f584=_0x3a3114>0x0?'<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22'+_0x3a3114+_0x5697e3(0x261):'',_0x2052d3=_0x3a3114<_0x346ba9['length']-0x1?_0x5697e3(0x280)+_0x3a3114+'\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>':'';_0x20b82b['innerHTML']=_0x5697e3(0x1b9)+_0x30f584+_0x5697e3(0x1b9)+_0x2052d3+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22'+_0x3a3114+_0x5697e3(0x26e)+_0x3a3114+_0x5697e3(0x21c),_0x3f8516['appendChild'](_0x3e4196),_0x3f8516[_0x5697e3(0x21e)](_0x20b82b),_0x200cbc[_0x5697e3(0x21e)](_0x3f8516);const _0x176f23=document[_0x5697e3(0x1bb)](_0x5697e3(0x1ad));_0x176f23[_0x5697e3(0x1c6)][_0x5697e3(0x1bc)]='block',_0x176f23[_0x5697e3(0x1c6)][_0x5697e3(0x208)]=_0x5697e3(0x1cb),_0x176f23['id']='amily2-table-'+_0x3a3114,_0x176f23[_0x5697e3(0x28b)][_0x5697e3(0x238)]=_0x3a3114;const _0x39098d=_0x176f23[_0x5697e3(0x1c1)](),_0xae030f=_0x39098d['insertRow'](),_0x4c9e64=document['createElement']('th');_0x4c9e64[_0x5697e3(0x17e)]=_0x5697e3(0x1fd),_0x4c9e64[_0x5697e3(0x288)]='#',_0xae030f[_0x5697e3(0x21e)](_0x4c9e64),_0x136c3b[_0x5697e3(0x226)]['forEach']((_0x2ccbb2,_0x2eb8f1)=>{const _0x48e89c=_0x5697e3,_0x3a3365=document[_0x48e89c(0x1bb)]('th');_0x3a3365[_0x48e89c(0x28b)][_0x48e89c(0x27d)]=_0x2eb8f1,_0x3a3365[_0x48e89c(0x1c6)]['cursor']=_0x48e89c(0x180);const _0x2889ca=document[_0x48e89c(0x1bb)](_0x48e89c(0x268));_0x2889ca[_0x48e89c(0x17e)]='amily2-header-text',_0x2889ca[_0x48e89c(0x288)]=_0x2ccbb2,_0x3a3365['appendChild'](_0x2889ca);const _0x2a977a=document['createElement'](_0x48e89c(0x26a));_0x2a977a[_0x48e89c(0x17e)]=_0x48e89c(0x201);const _0x579aba=[{'label':'向左移动','action':_0x48e89c(0x25e),'icon':_0x48e89c(0x242)},{'label':_0x48e89c(0x252),'action':_0x48e89c(0x202),'icon':_0x48e89c(0x1ec)},{'label':'在左加列','action':_0x48e89c(0x177),'icon':_0x48e89c(0x185)},{'label':'在右加列','action':_0x48e89c(0x1b6),'icon':_0x48e89c(0x185)},{'label':_0x48e89c(0x24e),'action':'rename','icon':_0x48e89c(0x1d6)},{'label':_0x48e89c(0x1af),'action':_0x48e89c(0x1aa),'icon':_0x48e89c(0x277),'isDanger':!![]}];_0x579aba['forEach'](({label:_0xc155b1,action:_0x3ed20f,icon:_0x3be417,isDanger:_0x9e369c})=>{const _0x7e7cb7=_0x48e89c,_0x4f5ca8=document[_0x7e7cb7(0x1bb)](_0x7e7cb7(0x274));_0x4f5ca8['textContent']=_0xc155b1,_0x4f5ca8[_0x7e7cb7(0x17e)]=_0x7e7cb7(0x195);if(_0x9e369c)_0x4f5ca8[_0x7e7cb7(0x215)][_0x7e7cb7(0x194)](_0x7e7cb7(0x240));_0x4f5ca8['addEventListener'](_0x7e7cb7(0x1ce),_0x1ae41b=>{const _0x5c31c8=_0x7e7cb7;_0x1ae41b[_0x5c31c8(0x20d)]();switch(_0x3ed20f){case _0x5c31c8(0x25e):_0x5af16c['moveColumn'](_0x3a3114,_0x2eb8f1,'left');break;case'move-right':_0x5af16c['moveColumn'](_0x3a3114,_0x2eb8f1,_0x5c31c8(0x1fc));break;case'add-left':_0x5af16c[_0x5c31c8(0x1c5)](_0x3a3114,_0x2eb8f1,_0x5c31c8(0x1ef));break;case'add-right':_0x5af16c['insertColumn'](_0x3a3114,_0x2eb8f1,_0x5c31c8(0x1fc));break;case _0x5c31c8(0x250):showColumnNameEditor(_0x3a3114,_0x2eb8f1,_0x2ccbb2);break;case _0x5c31c8(0x1aa):confirm(_0x5c31c8(0x1e9)+_0x2ccbb2+_0x5c31c8(0x1db))&&_0x5af16c[_0x5c31c8(0x186)](_0x3a3114,_0x2eb8f1);break;}renderTables();}),_0x2a977a[_0x7e7cb7(0x21e)](_0x4f5ca8);}),_0x3a3365['appendChild'](_0x2a977a),_0xae030f[_0x48e89c(0x21e)](_0x3a3365);});const _0x5b8eac=_0x176f23['createTBody']();_0x136c3b[_0x5697e3(0x233)]&&_0x136c3b[_0x5697e3(0x233)][_0x5697e3(0x26c)]>0x0&&_0x136c3b[_0x5697e3(0x233)][_0x5697e3(0x254)]((_0x224861,_0xa06a49)=>{const _0x46fd11=_0x5697e3,_0x153eca=_0x5b8eac['insertRow']();_0x153eca[_0x46fd11(0x28b)][_0x46fd11(0x275)]=_0xa06a49;const _0x49a8ad=_0x153eca[_0x46fd11(0x281)]();_0x49a8ad[_0x46fd11(0x17e)]=_0x46fd11(0x1fd);const _0x2a53a8=document[_0x46fd11(0x1bb)](_0x46fd11(0x268));_0x2a53a8['textContent']=_0xa06a49+0x1,_0x49a8ad['appendChild'](_0x2a53a8);const _0x37096b=document[_0x46fd11(0x1bb)](_0x46fd11(0x26a));_0x37096b[_0x46fd11(0x17e)]='amily2-context-menu\x20amily2-row-context-menu';const _0x2638ad=[{'label':'向上移动','action':_0x46fd11(0x247),'icon':_0x46fd11(0x1f4)},{'label':_0x46fd11(0x269),'action':_0x46fd11(0x227),'icon':_0x46fd11(0x1da)},{'label':_0x46fd11(0x1ed),'action':_0x46fd11(0x1cf),'icon':'fa-plus-circle'},{'label':_0x46fd11(0x1f5),'action':_0x46fd11(0x1e5),'icon':_0x46fd11(0x185)},{'label':_0x46fd11(0x1a6),'action':_0x46fd11(0x1ca),'icon':_0x46fd11(0x277),'isDanger':!![]}];_0x2638ad[_0x46fd11(0x254)](({label:_0x5bf3cd,action:_0x3a4f52,icon:_0x324bbd,isDanger:_0x5ab1d1})=>{const _0x465425=_0x46fd11,_0x58daeb=document[_0x465425(0x1bb)](_0x465425(0x274));_0x58daeb['innerHTML']=_0x465425(0x21b)+_0x324bbd+_0x465425(0x1a2)+_0x5bf3cd,_0x58daeb['className']=_0x465425(0x195);if(_0x5ab1d1)_0x58daeb[_0x465425(0x215)][_0x465425(0x194)](_0x465425(0x240));_0x58daeb[_0x465425(0x18c)](_0x465425(0x1ce),_0x71e04=>{const _0x1810a2=_0x465425;_0x71e04['stopPropagation']();switch(_0x3a4f52){case _0x1810a2(0x247):_0x5af16c[_0x1810a2(0x1b1)](_0x3a3114,_0xa06a49,'up');break;case _0x1810a2(0x227):_0x5af16c[_0x1810a2(0x1b1)](_0x3a3114,_0xa06a49,_0x1810a2(0x21a));break;case _0x1810a2(0x1cf):_0x5af16c['insertRow'](_0x3a3114,_0xa06a49,_0x1810a2(0x1f9));break;case _0x1810a2(0x1e5):_0x5af16c[_0x1810a2(0x1d9)](_0x3a3114,_0xa06a49,_0x1810a2(0x273));break;case _0x1810a2(0x1ca):confirm('您确定要删除第\x20'+(_0xa06a49+0x1)+_0x1810a2(0x1fb))&&_0x5af16c[_0x1810a2(0x23a)](_0x3a3114,_0xa06a49);break;}renderTables();}),_0x37096b['appendChild'](_0x58daeb);}),_0x49a8ad[_0x46fd11(0x21e)](_0x37096b),_0x224861[_0x46fd11(0x254)]((_0x14642f,_0x43a8fe)=>{const _0x4c28b4=_0x46fd11,_0x5a35ab=_0x153eca[_0x4c28b4(0x281)]();_0x5a35ab[_0x4c28b4(0x288)]=_0x14642f;const _0x127dd1=()=>_0x4c28b4(0x285)in window||navigator[_0x4c28b4(0x204)]>0x0;!_0x127dd1()&&_0x5a35ab[_0x4c28b4(0x267)](_0x4c28b4(0x1f2),'true');_0x5a35ab[_0x4c28b4(0x28b)][_0x4c28b4(0x27d)]=_0x43a8fe,_0x5a35ab[_0x4c28b4(0x28b)][_0x4c28b4(0x1d1)]=_0x136c3b['headers'][_0x43a8fe]||'';const _0x314288=_0x3a3114+'-'+_0xa06a49+'-'+_0x43a8fe;_0x5435f1[_0x4c28b4(0x1d7)](_0x314288)&&_0x5a35ab['classList'][_0x4c28b4(0x194)](_0x4c28b4(0x25c));});}),_0x200cbc['appendChild'](_0x176f23);}),_0x4b2f25&&_0x200cbc[_0x58a508(0x21e)](_0x4b2f25);}function _0xc0a1(_0x51d87e,_0x25997b){const _0x38f30f=_0x38f3();return _0xc0a1=function(_0xc0a1fd,_0x4788b7){_0xc0a1fd=_0xc0a1fd-0x177;let _0x3cd642=_0x38f30f[_0xc0a1fd];return _0x3cd642;},_0xc0a1(_0x51d87e,_0x25997b);}function openRuleEditor(_0x28364e){const _0x41e6c1=_0x17ce89,_0x340487=_0x5af16c['getMemoryState']();if(!_0x340487||!_0x340487[_0x28364e])return;const _0x4d5123=_0x340487[_0x28364e],_0x335ea1=_0x41e6c1(0x1ab)+_0x4d5123[_0x41e6c1(0x236)]+_0x41e6c1(0x198)+(_0x4d5123[_0x41e6c1(0x23b)]||'')+_0x41e6c1(0x23f)+(_0x4d5123[_0x41e6c1(0x22b)]||'')+_0x41e6c1(0x19d)+(_0x4d5123[_0x41e6c1(0x27f)]||'')+_0x41e6c1(0x1e7)+(_0x4d5123[_0x41e6c1(0x28e)]||'')+_0x41e6c1(0x1cc),_0x3425e7=$(_0x335ea1)[_0x41e6c1(0x1b5)](_0x41e6c1(0x17f)),_0x13f81e=()=>{const _0x485009=_0x41e6c1;_0x3425e7[0x0][_0x485009(0x181)](),_0x3425e7[_0x485009(0x20c)]();};_0x3425e7['find'](_0x41e6c1(0x18e))['on'](_0x41e6c1(0x1ce),()=>{const _0xb9fdf0=_0x41e6c1,_0x1e7ff7={'note':_0x3425e7[_0xb9fdf0(0x26b)]('#rule-note')[_0xb9fdf0(0x22c)](),'rule_add':_0x3425e7[_0xb9fdf0(0x26b)](_0xb9fdf0(0x223))[_0xb9fdf0(0x22c)](),'rule_delete':_0x3425e7[_0xb9fdf0(0x26b)]('#rule-delete')['val'](),'rule_update':_0x3425e7[_0xb9fdf0(0x26b)](_0xb9fdf0(0x17b))[_0xb9fdf0(0x22c)]()};_0x5af16c[_0xb9fdf0(0x229)](_0x28364e,_0x1e7ff7),_0x13f81e();}),_0x3425e7[_0x41e6c1(0x26b)]('.popup-button-cancel')['on'](_0x41e6c1(0x1ce),_0x13f81e),_0x3425e7[0x0][_0x41e6c1(0x188)]();}function bindInjectionSettings(){const _0x4b672a=_0x17ce89,_0x3fd6e6=extension_settings[extensionName],_0x5cf632=document[_0x4b672a(0x258)]('table-system-master-switch'),_0x18c6ef=document[_0x4b672a(0x258)](_0x4b672a(0x1f7)),_0x4f42c1=document[_0x4b672a(0x258)](_0x4b672a(0x245)),_0x3bedad=document[_0x4b672a(0x258)](_0x4b672a(0x221)),_0x427c24=document[_0x4b672a(0x257)](_0x4b672a(0x1e1));if(!_0x5cf632||!_0x18c6ef||!_0x4f42c1||!_0x3bedad||!_0x427c24['length'])return;const _0x260021=()=>{const _0x6d10a4=_0x4b672a,_0x3c9a55=_0x4f42c1[_0x6d10a4(0x1c3)],_0x3e96c4=_0x5cf632['checked'],_0x1c00a7=_0x3c9a55==='1';_0x18c6ef['disabled']=!_0x3e96c4,_0x4f42c1['disabled']=!_0x3e96c4,_0x3bedad[_0x6d10a4(0x234)]=!_0x3e96c4||!_0x1c00a7,_0x427c24[_0x6d10a4(0x254)](_0xe1b43=>_0xe1b43[_0x6d10a4(0x234)]=!_0x3e96c4||!_0x1c00a7);const _0x4ca3f8=_0x3e96c4?'1':_0x6d10a4(0x19a);_0x18c6ef[_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x4ca3f8;_0x18c6ef['closest'](_0x6d10a4(0x286))&&(_0x18c6ef[_0x6d10a4(0x278)]('.control-block-with-switch')['style']['opacity']=_0x4ca3f8);_0x4f42c1['style']['opacity']=_0x4ca3f8;_0x4f42c1[_0x6d10a4(0x1a5)]&&(_0x4f42c1[_0x6d10a4(0x1a5)][_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x4ca3f8);const _0x25de4f=_0x3e96c4&&_0x1c00a7?'1':_0x6d10a4(0x19a);_0x3bedad[_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x25de4f;_0x3bedad[_0x6d10a4(0x1a5)]&&(_0x3bedad[_0x6d10a4(0x1a5)][_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x25de4f);const _0x440bc1=_0x3e96c4&&_0x1c00a7?'1':'0.5',_0x1325f4=document[_0x6d10a4(0x258)]('table-role-system')?.[_0x6d10a4(0x278)]('.radio-group');_0x1325f4&&(_0x1325f4[_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x440bc1,_0x1325f4[_0x6d10a4(0x1a5)]&&(_0x1325f4[_0x6d10a4(0x1a5)][_0x6d10a4(0x1c6)][_0x6d10a4(0x279)]=_0x440bc1));const _0x34c2b6=document['querySelectorAll'](_0x6d10a4(0x212));_0x34c2b6[_0x6d10a4(0x254)](_0x36aad1=>{const _0x5d9d28=_0x6d10a4;_0x36aad1['disabled']=!_0x3e96c4;const _0x547f58=_0x36aad1[_0x5d9d28(0x278)](_0x5d9d28(0x1d1));_0x547f58&&(_0x547f58[_0x5d9d28(0x1c6)][_0x5d9d28(0x279)]=_0x3e96c4?'1':_0x5d9d28(0x19a));});const _0x571a16=document[_0x6d10a4(0x258)]('fill-table-now-btn');_0x571a16&&(_0x571a16[_0x6d10a4(0x234)]=!_0x3e96c4,_0x571a16['style'][_0x6d10a4(0x279)]=_0x3e96c4?'1':'0.5');};_0x5cf632[_0x4b672a(0x287)]=_0x3fd6e6[_0x4b672a(0x28f)]!==![],_0x18c6ef['checked']=_0x3fd6e6[_0x4b672a(0x244)],_0x4f42c1[_0x4b672a(0x1c3)]=_0x3fd6e6[_0x4b672a(0x190)][_0x4b672a(0x25f)],_0x3bedad['value']=_0x3fd6e6[_0x4b672a(0x190)][_0x4b672a(0x19e)],_0x427c24[_0x4b672a(0x254)](_0x512e53=>{const _0x197447=_0x4b672a;parseInt(_0x512e53[_0x197447(0x1c3)],0xa)===_0x3fd6e6[_0x197447(0x190)][_0x197447(0x1c8)]&&(_0x512e53[_0x197447(0x287)]=!![]);}),_0x260021(),_0x5cf632['addEventListener'](_0x4b672a(0x284),()=>{const _0x323da6=_0x4b672a;_0x3fd6e6[_0x323da6(0x28f)]=_0x5cf632[_0x323da6(0x287)],saveSettingsDebounced(),_0x260021();const _0x5ea65b=_0x5cf632[_0x323da6(0x287)]?'已启用':_0x323da6(0x192);toastr['info'](_0x323da6(0x17d)+_0x5ea65b+'。'),log(_0x323da6(0x17d)+_0x5ea65b+'。',_0x323da6(0x264));}),_0x18c6ef[_0x4b672a(0x18c)]('change',()=>{const _0x28285c=_0x4b672a;_0x3fd6e6[_0x28285c(0x244)]=_0x18c6ef['checked'],saveSettingsDebounced();}),_0x4f42c1['addEventListener']('change',()=>{const _0x17df00=_0x4b672a;_0x3fd6e6[_0x17df00(0x190)]['position']=parseInt(_0x4f42c1[_0x17df00(0x1c3)],0xa),saveSettingsDebounced(),_0x260021();}),_0x3bedad[_0x4b672a(0x18c)]('input',()=>{const _0x39efbd=_0x4b672a;_0x3fd6e6[_0x39efbd(0x190)][_0x39efbd(0x19e)]=parseInt(_0x3bedad[_0x39efbd(0x1c3)],0xa),saveSettingsDebounced();}),_0x427c24[_0x4b672a(0x254)](_0x143c94=>{const _0x5a541c=_0x4b672a;_0x143c94[_0x5a541c(0x18c)](_0x5a541c(0x284),()=>{const _0x4b0933=_0x5a541c;_0x143c94[_0x4b0933(0x287)]&&(_0x3fd6e6[_0x4b0933(0x190)][_0x4b0933(0x1c8)]=parseInt(_0x143c94['value'],0xa),saveSettingsDebounced());});}),log('表格注入设置已成功绑定。',_0x4b672a(0x22f));}function updateAndSaveTableSetting(_0x36f3ce,_0x1bf730){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x36f3ce]=_0x1bf730,saveSettingsDebounced();}function _0x38f3(){const _0x1e50ed=['currentEventBound','click','add-above','2px','label','exportPreset','true','top','.hly-scroll','fa-pen','has','matches','insertRow','fa-arrow-down','”\x20列吗？','importPreset','min','then','warning','contains','input[name=\x22table-injection-role\x22]','.amily2-context-menu.amily2-menu-active','20696rDtyls','.add-row-btn','add-below','space-between','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','target','您确定要删除\x20“','clearGlobalPreset','justifyContent','fa-arrow-right','在上加行','trim','left','.sinan-tab-pane','表格视图交互事件已成功绑定。','contenteditable','loadTables','fa-arrow-up','在下加行','select','table-injection-enabled','【最终警告】您确定要永久废黜表格\x20“[','above','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','\x20行吗？','right','index-col','keydown','maxHeight','startCurrentFloorFilling','amily2-context-menu','move-right','active','maxTouchPoints','原始填表','amily2-import-preset-btn','eventsBound','overflowX','all-tables-container','keypress','amily2-menu-open','remove','stopPropagation','.settings-group','main-api','.add-col-btn','addHighlight','input[name=\x22filling-mode\x22]','width','batchEventBound','classList',']”\x20吗？此操作不可逆！','amily2-clear-all-tables-btn','请输入表名...','.sinan-nav-item','down','<i\x20class=\x22fas\x20','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getTime','appendChild','querySelector','</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22generic-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','table-injection-depth','表名：','#rule-add','您确定要将流程提示词恢复为默认设置吗？','100%','headers','move-down','6vkbbtl','updateTableRules','<i\x20class=\x22fas\x20fa-table\x20table-rename-icon\x22\x20data-table-index=\x22','rule_add','val','6lBzJJX','78090LrQeEa','success','优化中填表','deleteTable','.popup-button-cancel','rows','disabled','amily2-menu-active','name','10000','tableIndex','表格系统总开关已关闭，请先启用总开关。','deleteRow','note','5vUtKgN','批量填表-流程提示词已恢复默认。','isCurrentTablesEmpty','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','danger','开始为表格视图绑定交互事件...','fa-arrow-left','.delete-table-btn','table_injection_enabled','table-injection-position','renameTable','move-up','addRow','.amily2-context-menu','zIndex','237678jLyFvv','updateRow','bottom','编辑列名','.table-rename-icon','rename','\x22选定楼层填表\x22按钮已成功绑定。','向右移动','6722JnukVt','forEach','内存状态为空，从聊天记录加载作为后备。','secondary-api','querySelectorAll','getElementById','起始楼层不能大于结束楼层。','22nuQcQm','楼层不能小于1。','cell-highlight','which','move-left','position','.move-table-down-btn','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','amily2-clear-global-preset-btn','请输入有效的起始楼层和结束楼层。','info','getBoundingClientRect','filling_mode','setAttribute','span','向下移动','div','find','length','#generic-input','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','505458PacSVx','getBatchFillerRuleTemplate','您确定要将规则提示词恢复为默认设置吗？','名称不能为空！','below','button','rowIndex','saveBatchFillerFlowTemplate','fa-trash-alt','closest','opacity','无法找到指令模板编辑器，绑定失败。','getBatchFillerFlowTemplate','focus','colIndex','../core/table-system/batch-filler.js','rule_delete','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','insertCell','add-table-placeholder','流程提示词已恢复为默认。','change','ontouchstart','.control-block-with-switch','checked','textContent','请输入新表格的名称：','fill-selected-floors-btn','dataset','getAttribute','分步填表','rule_update','table_system_enabled','批量填表-流程提示词已保存。','div[style*=\x22overflowX\x22]','add-left','规则提示词已恢复为默认。','center','updateHeader','#rule-update','innerHTML','表格系统总开关','className','body','pointer','close','floorEventBound','填表模式已切换为\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：输入内容将用于更新项目。</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','fa-plus-circle','deleteColumn','841220VSNdgh','showModal','表名已更新为\x20\x22','move-table-up-btn','alignItems','addEventListener','getMemoryState','.popup-button-ok','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','injection','importGlobalPreset','已禁用','addColumn','add','menu_button\x20small_button','marginTop','编辑表名','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','ai-flow-template-save-btn','0.5','amily2-export-preset-full-btn','getHighlights','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','depth','saveBatchFillerRuleTemplate','preventDefault','1203824gTSrbZ','\x22></i>\x20','tab','moveTable','previousElementSibling','删除该行','批量填表-规则提示词已恢复默认。','marginBottom','.move-table-up-btn','delete','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','规则提示词已保存。','table','ai-rule-template-restore-btn','删除该列','removeEventListener','moveRow','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','#sinan-','table-controls','appendTo','add-right','max','warn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','exportPresetFull','createElement','display','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>','列名已更新为\x20\x22','amily2_memorisation_forms_panel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20','createTHead','td.index-col','value','amily2-import-global-preset-btn','insertColumn','style','clearAllTables','role','blur','delete-row','auto','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>'];_0x38f3=function(){return _0x1e50ed;};return _0x38f3();}export function bindTableEvents(){const _0x2f8f7f=_0x17ce89,_0x2f34d0=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x1bf));if(!_0x2f34d0||_0x2f34d0[_0x2f8f7f(0x28b)][_0x2f8f7f(0x207)])return;log(_0x2f8f7f(0x241),_0x2f8f7f(0x264));const _0x33da77=_0x2f34d0[_0x2f8f7f(0x257)](_0x2f8f7f(0x212)),_0x1f5115=()=>{const _0x2f2fb8=_0x2f8f7f,_0x4e4de2=extension_settings[extensionName]?.[_0x2f2fb8(0x266)]||_0x2f2fb8(0x20f);_0x33da77[_0x2f2fb8(0x254)](_0x549813=>{_0x549813['checked']=_0x549813['value']===_0x4e4de2;});};_0x33da77[_0x2f8f7f(0x254)](_0x4cf397=>{const _0x508e18=_0x2f8f7f;_0x4cf397[_0x508e18(0x18c)](_0x508e18(0x284),function(){const _0x388cb6=_0x508e18,_0x25ee9d=this[_0x388cb6(0x1c3)];updateAndSaveTableSetting('filling_mode',_0x25ee9d);let _0x241de6=_0x388cb6(0x205);if(_0x25ee9d===_0x388cb6(0x256))_0x241de6=_0x388cb6(0x28d);if(_0x25ee9d==='optimized')_0x241de6=_0x388cb6(0x230);toastr[_0x388cb6(0x264)](_0x388cb6(0x183)+_0x241de6+'。'),_0x1f5115();});}),_0x1f5115();const _0x25b519=()=>{renderTables(),bindInjectionSettings();};_0x25b519(),bindBatchFillButton(),bindFloorFillButtons(),bindTemplateEditors();const _0x23f9ce=document[_0x2f8f7f(0x21f)]('#amily2_memorisation_forms_panel\x20.sinan-navigation-deck');_0x23f9ce&&_0x23f9ce[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),_0x3d83fa=>{const _0x3dd32f=_0x2f8f7f,_0x3be329=_0x3d83fa[_0x3dd32f(0x1e8)][_0x3dd32f(0x278)]('.sinan-nav-item');if(!_0x3be329)return;const _0x4ced0d=_0x3be329[_0x3dd32f(0x28b)][_0x3dd32f(0x1a3)];if(!_0x4ced0d)return;const _0x3e9dd5=_0x3be329[_0x3dd32f(0x278)](_0x3dd32f(0x20e));if(!_0x3e9dd5)return;_0x3e9dd5[_0x3dd32f(0x257)](_0x3dd32f(0x219))[_0x3dd32f(0x254)](_0x31d333=>_0x31d333[_0x3dd32f(0x215)][_0x3dd32f(0x20c)](_0x3dd32f(0x203))),_0x3be329[_0x3dd32f(0x215)][_0x3dd32f(0x194)]('active'),_0x3e9dd5[_0x3dd32f(0x257)](_0x3dd32f(0x1f0))['forEach'](_0x21938a=>_0x21938a[_0x3dd32f(0x215)][_0x3dd32f(0x20c)](_0x3dd32f(0x203)));const _0x5637b9=_0x3e9dd5[_0x3dd32f(0x21f)](_0x3dd32f(0x1b3)+_0x4ced0d+'-tab');_0x5637b9&&_0x5637b9[_0x3dd32f(0x215)][_0x3dd32f(0x194)](_0x3dd32f(0x203));});const _0x496d34=document[_0x2f8f7f(0x258)]('amily2-export-preset-btn'),_0x15af91=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x19b)),_0x26d96b=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x206)),_0x2c4203=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x1c4)),_0x44192e=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x262));_0x496d34&&_0x496d34[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),()=>_0x5af16c[_0x2f8f7f(0x1d2)]());_0x15af91&&_0x15af91[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),()=>_0x5af16c[_0x2f8f7f(0x1ba)]());_0x26d96b&&_0x26d96b[_0x2f8f7f(0x18c)]('click',()=>_0x5af16c[_0x2f8f7f(0x1dc)](_0x25b519));_0x2c4203&&_0x2c4203[_0x2f8f7f(0x18c)]('click',()=>{const _0x1e5b94=_0x2f8f7f,_0x55d5d7=_0x5af16c[_0x1e5b94(0x23e)]();_0x5af16c[_0x1e5b94(0x191)](()=>{const _0x3b1ab2=_0x1e5b94;_0x55d5d7&&(_0x5af16c[_0x3b1ab2(0x1f3)](),_0x25b519());});});_0x44192e&&_0x44192e[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),()=>{const _0x44c1fe=_0x2f8f7f,_0x2684ad=_0x5af16c[_0x44c1fe(0x23e)]();_0x5af16c[_0x44c1fe(0x1ea)](),_0x2684ad&&(_0x5af16c[_0x44c1fe(0x1f3)](),_0x25b519());});const _0x23e1ad=document[_0x2f8f7f(0x258)](_0x2f8f7f(0x217));_0x23e1ad&&_0x23e1ad[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),()=>{const _0xcf68b2=_0x2f8f7f;confirm(_0xcf68b2(0x18f))&&(_0x5af16c[_0xcf68b2(0x1c7)](),_0x25b519());});const _0x87d5fd=document[_0x2f8f7f(0x258)]('add-table-placeholder');_0x87d5fd&&_0x87d5fd[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),()=>{const _0x332928=_0x2f8f7f,_0x1c9af3=prompt(_0x332928(0x289),'新表格');_0x1c9af3&&_0x1c9af3[_0x332928(0x1ee)]()&&(_0x5af16c['addTable'](_0x1c9af3['trim']()),_0x25b519());});const _0x49fc75=getAllTablesContainer();if(_0x49fc75){_0x49fc75[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1ce),_0x31463d=>{const _0x7c44e3=_0x2f8f7f,_0x445e4d=_0x31463d[_0x7c44e3(0x1e8)]['closest']('th');if(_0x445e4d&&!_0x445e4d['classList'][_0x7c44e3(0x1e0)](_0x7c44e3(0x1fd))){toggleColumnContextMenu(_0x31463d);return;}const _0xf84cb9=_0x31463d[_0x7c44e3(0x1e8)][_0x7c44e3(0x278)](_0x7c44e3(0x1c2));if(_0xf84cb9){toggleRowContextMenu(_0x31463d);return;}const _0x2efeaf=_0x31463d[_0x7c44e3(0x1e8)][_0x7c44e3(0x278)](_0x7c44e3(0x24f));if(_0x2efeaf){const _0x4c517c=parseInt(_0x2efeaf[_0x7c44e3(0x28b)][_0x7c44e3(0x238)],0xa),_0x41454b=_0x5af16c[_0x7c44e3(0x18d)](),_0x502e94=_0x41454b[_0x4c517c]?.[_0x7c44e3(0x236)]||'';showTableNameEditor(_0x4c517c,_0x502e94);return;}const _0xbfc9c8=_0x31463d[_0x7c44e3(0x1e8)]['closest'](_0x7c44e3(0x274));if(!_0xbfc9c8)return;const _0x10f04e=parseInt(_0xbfc9c8[_0x7c44e3(0x28b)][_0x7c44e3(0x238)],0xa);if(_0xbfc9c8['matches'](_0x7c44e3(0x1e4)))_0x5af16c[_0x7c44e3(0x248)](_0x10f04e),_0x25b519();else{if(_0xbfc9c8['matches'](_0x7c44e3(0x210)))_0x5af16c[_0x7c44e3(0x193)](_0x10f04e),_0x25b519();else{if(_0xbfc9c8[_0x7c44e3(0x1d8)](_0x7c44e3(0x1a9))||_0xbfc9c8[_0x7c44e3(0x1d8)](_0x7c44e3(0x260))){const _0x47481f=_0xbfc9c8[_0x7c44e3(0x215)][_0x7c44e3(0x1e0)](_0x7c44e3(0x18a))?'up':_0x7c44e3(0x21a);_0x5af16c[_0x7c44e3(0x1a4)](_0x10f04e,_0x47481f),_0x25b519();}else{if(_0xbfc9c8[_0x7c44e3(0x1d8)]('.edit-rules-btn'))openRuleEditor(_0x10f04e);else{if(_0xbfc9c8[_0x7c44e3(0x1d8)](_0x7c44e3(0x243))){const _0x2f8810=_0x5af16c[_0x7c44e3(0x18d)](),_0x4f6fa9=_0x2f8810[_0x10f04e]?.['name']||'未知表格';confirm(_0x7c44e3(0x1f8)+_0x4f6fa9+_0x7c44e3(0x216))&&(_0x5af16c[_0x7c44e3(0x231)](_0x10f04e),_0x25b519());}}}}}});const _0x1523cd=()=>_0x2f8f7f(0x285)in window||navigator['maxTouchPoints']>0x0;if(_0x1523cd()){let _0x476b77=0x0,_0x3b7cc1=null;_0x49fc75[_0x2f8f7f(0x18c)]('touchstart',_0x3aa8cf=>{const _0x588c8e=_0x2f8f7f,_0xe2ae8=_0x3aa8cf[_0x588c8e(0x1e8)][_0x588c8e(0x278)]('td');if(!_0xe2ae8||_0xe2ae8['dataset'][_0x588c8e(0x27d)]===undefined)return;const _0x2bcd8f=new Date()[_0x588c8e(0x21d)](),_0x770061=_0x2bcd8f-_0x476b77;_0x770061<0x12c&&_0x770061>0x0&&_0x3b7cc1===_0xe2ae8&&(_0x3aa8cf['preventDefault'](),_0xe2ae8[_0x588c8e(0x28c)](_0x588c8e(0x1f2))!==_0x588c8e(0x1d3)&&(_0xe2ae8[_0x588c8e(0x267)](_0x588c8e(0x1f2),_0x588c8e(0x1d3)),setTimeout(()=>_0xe2ae8[_0x588c8e(0x27c)](),0x0))),_0x476b77=_0x2bcd8f,_0x3b7cc1=_0xe2ae8;});}_0x49fc75[_0x2f8f7f(0x18c)](_0x2f8f7f(0x1c9),_0x468b4c=>{const _0x15cfdf=_0x2f8f7f,_0x59131a=_0x468b4c[_0x15cfdf(0x1e8)];if(_0x59131a['tagName']!=='TD'||_0x59131a['getAttribute'](_0x15cfdf(0x1f2))!==_0x15cfdf(0x1d3))return;const _0x405078=()=>_0x15cfdf(0x285)in window||navigator[_0x15cfdf(0x204)]>0x0;_0x405078()&&_0x59131a[_0x15cfdf(0x267)](_0x15cfdf(0x1f2),'false');const _0x5ca5cb=_0x59131a[_0x15cfdf(0x278)](_0x15cfdf(0x1ad));if(!_0x5ca5cb)return;const _0x35316d=parseInt(_0x5ca5cb[_0x15cfdf(0x28b)][_0x15cfdf(0x238)],0xa),_0x2cc23d=parseInt(_0x59131a[_0x15cfdf(0x278)]('tr')[_0x15cfdf(0x28b)]['rowIndex'],0xa),_0xd53572=parseInt(_0x59131a[_0x15cfdf(0x28b)][_0x15cfdf(0x27d)],0xa),_0x5a64c3=_0x59131a[_0x15cfdf(0x288)];_0x5af16c[_0x15cfdf(0x211)](_0x35316d,_0x2cc23d,_0xd53572);const _0x3ab9b3={[_0xd53572]:_0x5a64c3};_0x5af16c[_0x15cfdf(0x24c)](_0x35316d,_0x2cc23d,_0x3ab9b3),_0x25b519();},!![]);}_0x2f34d0[_0x2f8f7f(0x28b)][_0x2f8f7f(0x207)]='true',log(_0x2f8f7f(0x1f1),_0x2f8f7f(0x22f));}function bindBatchFillButton(){const _0xcbbbda=_0x17ce89,_0x2e7793=document['getElementById']('fill-table-now-btn');if(_0x2e7793){if(_0x2e7793[_0xcbbbda(0x28b)][_0xcbbbda(0x214)])return;_0x2e7793[_0xcbbbda(0x18c)](_0xcbbbda(0x1ce),_0x212358=>{const _0x146cec=_0xcbbbda,_0x292a65=extension_settings[extensionName],_0x4e8965=_0x292a65[_0x146cec(0x28f)]!==![];if(!_0x4e8965){_0x212358[_0x146cec(0x1a0)](),toastr[_0x146cec(0x1df)](_0x146cec(0x239));return;}startBatchFilling();}),_0x2e7793[_0xcbbbda(0x28b)][_0xcbbbda(0x214)]=_0xcbbbda(0x1d3),log('\x22立即填表\x22按钮已成功绑定。','success');}}function bindFloorFillButtons(){const _0x55cf97=_0x17ce89,_0x22cb8b=document[_0x55cf97(0x258)](_0x55cf97(0x28a)),_0x5e1eaa=document['getElementById']('fill-current-floor-btn');if(_0x22cb8b){if(_0x22cb8b[_0x55cf97(0x28b)][_0x55cf97(0x182)])return;_0x22cb8b['addEventListener'](_0x55cf97(0x1ce),_0x42e541=>{const _0x409ac5=_0x55cf97,_0x58f870=extension_settings[extensionName],_0x4fa3c7=_0x58f870[_0x409ac5(0x28f)]!==![];if(!_0x4fa3c7){_0x42e541['preventDefault'](),toastr['warning'](_0x409ac5(0x239));return;}const _0x42de1e=document[_0x409ac5(0x258)]('floor-start-input'),_0x13d710=document[_0x409ac5(0x258)]('floor-end-input'),_0x230d93=parseInt(_0x42de1e[_0x409ac5(0x1c3)],0xa),_0x11bd38=parseInt(_0x13d710[_0x409ac5(0x1c3)],0xa);if(!_0x230d93||!_0x11bd38){toastr[_0x409ac5(0x1df)](_0x409ac5(0x263));return;}if(_0x230d93>_0x11bd38){toastr[_0x409ac5(0x1df)](_0x409ac5(0x259));return;}if(_0x230d93<0x1){toastr[_0x409ac5(0x1df)](_0x409ac5(0x25b));return;}import(_0x409ac5(0x27e))[_0x409ac5(0x1de)](_0x32252c=>{_0x32252c['startFloorRangeFilling'](_0x230d93,_0x11bd38);});}),_0x22cb8b[_0x55cf97(0x28b)][_0x55cf97(0x182)]=_0x55cf97(0x1d3),log(_0x55cf97(0x251),'success');}if(_0x5e1eaa){if(_0x5e1eaa[_0x55cf97(0x28b)][_0x55cf97(0x1cd)])return;_0x5e1eaa[_0x55cf97(0x18c)](_0x55cf97(0x1ce),_0x6c1e67=>{const _0x1b5436=_0x55cf97,_0x921ad2=extension_settings[extensionName],_0x5b98ec=_0x921ad2[_0x1b5436(0x28f)]!==![];if(!_0x5b98ec){_0x6c1e67[_0x1b5436(0x1a0)](),toastr[_0x1b5436(0x1df)]('表格系统总开关已关闭，请先启用总开关。');return;}import('../core/table-system/batch-filler.js')[_0x1b5436(0x1de)](_0x2fbd6f=>{const _0x26fae7=_0x1b5436;_0x2fbd6f[_0x26fae7(0x200)]();});}),_0x5e1eaa[_0x55cf97(0x28b)][_0x55cf97(0x1cd)]=_0x55cf97(0x1d3),log('\x22填当前楼层\x22按钮已成功绑定。',_0x55cf97(0x22f));}}function bindTemplateEditors(){const _0x408807=_0x17ce89,_0x33a1ad=document[_0x408807(0x258)]('ai-rule-template-editor'),_0x19c2e8=document['getElementById']('ai-rule-template-save-btn'),_0x1d9372=document[_0x408807(0x258)](_0x408807(0x1ae)),_0x195acb=document['getElementById']('ai-flow-template-editor'),_0x3f7dcc=document[_0x408807(0x258)](_0x408807(0x199)),_0x55ffba=document[_0x408807(0x258)]('ai-flow-template-restore-btn');if(!_0x33a1ad||!_0x195acb){log(_0x408807(0x27a),_0x408807(0x1b8));return;}_0x33a1ad[_0x408807(0x1c3)]=_0x5af16c[_0x408807(0x270)](),_0x195acb['value']=_0x5af16c[_0x408807(0x27b)](),_0x19c2e8['addEventListener'](_0x408807(0x1ce),()=>{const _0x3179f6=_0x408807;_0x5af16c['saveBatchFillerRuleTemplate'](_0x33a1ad[_0x3179f6(0x1c3)]),toastr[_0x3179f6(0x22f)](_0x3179f6(0x1ac)),log('批量填表-规则提示词已保存。','success');}),_0x3f7dcc[_0x408807(0x18c)]('click',()=>{const _0x2da95a=_0x408807;_0x5af16c[_0x2da95a(0x276)](_0x195acb[_0x2da95a(0x1c3)]),toastr['success']('流程提示词已保存。'),log(_0x2da95a(0x290),'success');}),_0x1d9372[_0x408807(0x18c)]('click',()=>{const _0x251bda=_0x408807;confirm(_0x251bda(0x271))&&(_0x33a1ad['value']=DEFAULT_AI_RULE_TEMPLATE,_0x5af16c[_0x251bda(0x19f)](_0x33a1ad[_0x251bda(0x1c3)]),toastr[_0x251bda(0x264)](_0x251bda(0x178)),log(_0x251bda(0x1a7),_0x251bda(0x264)));}),_0x55ffba[_0x408807(0x18c)](_0x408807(0x1ce),()=>{const _0x4b2001=_0x408807;confirm(_0x4b2001(0x224))&&(_0x195acb['value']=DEFAULT_AI_FLOW_TEMPLATE,_0x5af16c[_0x4b2001(0x276)](_0x195acb['value']),toastr[_0x4b2001(0x264)](_0x4b2001(0x283)),log(_0x4b2001(0x23d),_0x4b2001(0x264)));}),log('指令模板编辑器已成功绑定。',_0x408807(0x22f));}
