const _0x12db1b=_0xcfcd;(function(_0x50c4e1,_0x2d9ed3){const _0x1a2ab8=_0xcfcd,_0x14f9b0=_0x50c4e1();while(!![]){try{const _0x28bef0=-parseInt(_0x1a2ab8(0x1f8))/0x1*(parseInt(_0x1a2ab8(0x1e4))/0x2)+parseInt(_0x1a2ab8(0x195))/0x3*(parseInt(_0x1a2ab8(0x1ca))/0x4)+parseInt(_0x1a2ab8(0x224))/0x5*(-parseInt(_0x1a2ab8(0x1bc))/0x6)+-parseInt(_0x1a2ab8(0x1dc))/0x7*(-parseInt(_0x1a2ab8(0x226))/0x8)+-parseInt(_0x1a2ab8(0x223))/0x9*(-parseInt(_0x1a2ab8(0x20d))/0xa)+-parseInt(_0x1a2ab8(0x207))/0xb+parseInt(_0x1a2ab8(0x1bf))/0xc*(parseInt(_0x1a2ab8(0x189))/0xd);if(_0x28bef0===_0x2d9ed3)break;else _0x14f9b0['push'](_0x14f9b0['shift']());}catch(_0x3096eb){_0x14f9b0['push'](_0x14f9b0['shift']());}}}(_0x5394,0xa0965));import*as _0x29b278 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';function _0x5394(){const _0x3a03c4=['#rule-update','getBatchFillerRuleTemplate','closest','fill-table-now-btn','value','ai-flow-template-restore-btn','4247404iADNQf','dataset','您确定要删除表格\x20[','tab','saveBatchFillerRuleTemplate','开始为表格视图绑定交互事件...','amily2-export-preset-full-btn','stopPropagation','75322DKJTLf','流程提示词已保存。','\x20行吗？','rowIndex','loadTables','表格视图交互事件已成功绑定。','appendChild','tagName','rule_update','all-tables-container','.add-row-btn,\x20.add-col-btn','eventsBound','trim','table-instance-container','20px\x200','amily2_memorisation_forms_panel','insertCell','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','deleteRow','note','32bscrJQ','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-row-btn\x22\x20data-table-index=\x22','importPreset','headers','\x22>加列</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','您确定要将规则提示词恢复为默认设置吗？','batchEventBound','请输入新表格的名称：','active','opacity','ai-flow-template-editor','getElementById','insertRow','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','blur','12701546LRqPXs','textContent','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','rows','tableIndex','.sinan-nav-item','10JoDfYc','move-table-up-btn','close','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','rule_add','未知表格','borderStyle','querySelector','#rule-note','ai-flow-template-save-btn','批量填表-规则提示词已恢复默认。','index-col\x20delete-row-handle','checked','moveTable','table_injection_role','table_injection_depth','addColumn','updateHeader','table','deleteColumn','center','#sinan-','1409985KmsWVo','4435WBrFDN','space-between','16ghGZyT','contains','click','error','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','disabled','forEach','change','amily2-import-preset-btn','ai-rule-template-editor','warn','cursor','updateCell','className','input',']”\x20吗？此操作不可逆！','length','ai-rule-template-save-btn','无法找到指令模板编辑器，绑定失败。','index-col',']\x20的第\x20','批量填表-流程提示词已保存。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','justifyContent','14487083HQAGzP','table-injection-enabled','addRow','button','amily2-export-preset-btn','指令模板编辑器已成功绑定。','remove','内存状态为空，从聊天记录加载作为后备。','table_injection_position','true','add','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','290268wwhkRo','classList','amily2-clear-all-tables-btn','colIndex','saveBatchFillerFlowTemplate','createTHead','批量填表-流程提示词已恢复默认。','dashed','target','innerHTML','deleteTable','0.5','#rule-add','style','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','down','ai-rule-template-restore-btn','table_injection_enabled','exportPresetFull','div','getBatchFillerFlowTemplate','clearAllTables','add-col-btn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','borderColor','#rule-delete','alignItems','table-injection-role','previousElementSibling','.settings-group','“立即填表”按钮已成功绑定。','setAttribute','success','val','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','confirm','createElement','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','3594mQfacF','.move-table-up-btn','exportPreset','12orzNNL','contenteditable','find','add-row-btn','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','getMemoryState','table-controls','流程提示词已恢复为默认。','pointer','.move-table-down-btn','name','44gRGxtW','\x22>加行</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-col-btn\x22\x20data-table-index=\x22','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','info','规则提示词已保存。','body','addEventListener','margin','.edit-rules-btn','matches','您确定要将流程提示词恢复为默认设置吗？','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'];_0x5394=function(){return _0x3a03c4;};return _0x5394();}const getAllTablesContainer=()=>document[_0x12db1b(0x203)](_0x12db1b(0x1ed));export function renderTables(){const _0x34c537=_0x12db1b;let _0xccb31=_0x29b278[_0x34c537(0x1c4)]();!_0xccb31&&(log(_0x34c537(0x190),_0x34c537(0x17b)),_0xccb31=_0x29b278[_0x34c537(0x1e8)]());const _0x592592=getAllTablesContainer();if(!_0xccb31||!_0x592592){console[_0x34c537(0x174)](_0x34c537(0x1c3));return;}const _0x1e88b9=document['getElementById']('add-table-placeholder');_0x1e88b9&&_0x1e88b9[_0x34c537(0x18f)](),_0x592592['innerHTML']='',_0xccb31[_0x34c537(0x177)]((_0x34f1f1,_0xf15ee4)=>{const _0xefdbef=_0x34c537,_0x57c4d8=document[_0xefdbef(0x1b9)](_0xefdbef(0x1a8));_0x57c4d8[_0xefdbef(0x17e)]=_0xefdbef(0x1f1);const _0x92d07d=document['createElement']('div');_0x92d07d[_0xefdbef(0x1a2)]['display']='flex',_0x92d07d['style'][_0xefdbef(0x188)]=_0xefdbef(0x225),_0x92d07d[_0xefdbef(0x1a2)][_0xefdbef(0x1af)]=_0xefdbef(0x221);const _0x10869a=document[_0xefdbef(0x1b9)]('h3');_0x10869a['innerHTML']='<i\x20class=\x22fas\x20fa-table\x22></i>\x20'+_0x34f1f1[_0xefdbef(0x1c9)];const _0x1de969=document['createElement'](_0xefdbef(0x1a8));_0x1de969[_0xefdbef(0x17e)]=_0xefdbef(0x1c5);const _0x3a06ab=_0xf15ee4>0x0?_0xefdbef(0x1bb)+_0xf15ee4+_0xefdbef(0x1cc):'',_0x394c3c=_0xf15ee4<_0xccb31['length']-0x1?_0xefdbef(0x210)+_0xf15ee4+_0xefdbef(0x1ba):'';_0x1de969[_0xefdbef(0x19e)]=_0xefdbef(0x1a3)+_0x3a06ab+_0xefdbef(0x1a3)+_0x394c3c+_0xefdbef(0x187)+_0xf15ee4+_0xefdbef(0x1f9)+_0xf15ee4+_0xefdbef(0x1cb)+_0xf15ee4+_0xefdbef(0x1fc)+_0xf15ee4+_0xefdbef(0x205),_0x92d07d[_0xefdbef(0x1ea)](_0x10869a),_0x92d07d['appendChild'](_0x1de969),_0x592592[_0xefdbef(0x1ea)](_0x92d07d);const _0x39d670=document['createElement'](_0xefdbef(0x1a8));_0x39d670['style']['overflowX']='auto';const _0x2e979b=document[_0xefdbef(0x1b9)](_0xefdbef(0x21f));_0x2e979b['id']='amily2-table-'+_0xf15ee4,_0x2e979b[_0xefdbef(0x1dd)][_0xefdbef(0x20b)]=_0xf15ee4;const _0x48342e=_0x2e979b[_0xefdbef(0x19a)](),_0xc88c40=_0x48342e['insertRow'](),_0x25c764=document[_0xefdbef(0x1b9)]('th');_0x25c764[_0xefdbef(0x17e)]=_0xefdbef(0x184),_0x25c764[_0xefdbef(0x208)]='#',_0xc88c40[_0xefdbef(0x1ea)](_0x25c764),_0x34f1f1['headers'][_0xefdbef(0x177)]((_0x3a00bb,_0x18148a)=>{const _0x4c127f=_0xefdbef,_0x1cea32=document[_0x4c127f(0x1b9)]('th');_0x1cea32[_0x4c127f(0x208)]=_0x3a00bb,_0x1cea32[_0x4c127f(0x1b4)]('contenteditable','true'),_0x1cea32['dataset'][_0x4c127f(0x198)]=_0x18148a,_0xc88c40[_0x4c127f(0x1ea)](_0x1cea32);});const _0x5cb217=_0x2e979b['createTBody']();_0x34f1f1[_0xefdbef(0x20a)]&&_0x34f1f1[_0xefdbef(0x20a)]['length']>0x0&&_0x34f1f1['rows'][_0xefdbef(0x177)]((_0x235b0b,_0x20e50c)=>{const _0x3af49f=_0xefdbef,_0x15a461=_0x5cb217[_0x3af49f(0x204)]();_0x15a461['dataset']['rowIndex']=_0x20e50c;const _0x4a497d=_0x15a461[_0x3af49f(0x1f4)]();_0x4a497d[_0x3af49f(0x17e)]=_0x3af49f(0x218),_0x4a497d['title']='点击删除此行',_0x4a497d[_0x3af49f(0x208)]=_0x20e50c+0x1,_0x4a497d[_0x3af49f(0x1a2)][_0x3af49f(0x17c)]=_0x3af49f(0x1c7),_0x4a497d[_0x3af49f(0x1d0)]('click',async _0x4ffd1c=>{const _0x230a74=_0x3af49f;_0x4ffd1c[_0x230a74(0x1e3)](),window[_0x230a74(0x1b8)](_0x230a74(0x1de)+_0x34f1f1[_0x230a74(0x1c9)]+_0x230a74(0x185)+(_0x20e50c+0x1)+_0x230a74(0x1e6))&&(await _0x29b278[_0x230a74(0x1f6)](_0xf15ee4,_0x20e50c),renderTables());}),_0x235b0b[_0x3af49f(0x177)]((_0x483ee7,_0x53734e)=>{const _0x89636a=_0x3af49f,_0x2c6e5b=_0x15a461['insertCell']();_0x2c6e5b[_0x89636a(0x208)]=_0x483ee7,_0x2c6e5b[_0x89636a(0x1b4)](_0x89636a(0x1c0),_0x89636a(0x192)),_0x2c6e5b['dataset'][_0x89636a(0x198)]=_0x53734e,_0x2c6e5b['dataset']['label']=_0x34f1f1[_0x89636a(0x1fb)][_0x53734e]||'';});});_0x39d670[_0xefdbef(0x1ea)](_0x2e979b),_0x57c4d8[_0xefdbef(0x1ea)](_0x39d670);if(_0xf15ee4<_0xccb31[_0xefdbef(0x181)]-0x1){const _0x5f39cc=document[_0xefdbef(0x1b9)]('hr');_0x5f39cc[_0xefdbef(0x1a2)][_0xefdbef(0x213)]=_0xefdbef(0x19c),_0x5f39cc[_0xefdbef(0x1a2)][_0xefdbef(0x1d1)]=_0xefdbef(0x1f2),_0x5f39cc[_0xefdbef(0x1a2)][_0xefdbef(0x1ad)]='rgba(255,\x20255,\x20255,\x200.2)',_0x57c4d8[_0xefdbef(0x1ea)](_0x5f39cc);}_0x592592[_0xefdbef(0x1ea)](_0x57c4d8);}),_0x1e88b9&&_0x592592['appendChild'](_0x1e88b9);}function _0xcfcd(_0x5065f2,_0x2c6511){const _0x53942e=_0x5394();return _0xcfcd=function(_0xcfcddb,_0x490761){_0xcfcddb=_0xcfcddb-0x174;let _0x5ed5ae=_0x53942e[_0xcfcddb];return _0x5ed5ae;},_0xcfcd(_0x5065f2,_0x2c6511);}function openRuleEditor(_0x17d16a){const _0x3c7826=_0x12db1b,_0xf0556c=_0x29b278[_0x3c7826(0x1c4)]();if(!_0xf0556c||!_0xf0556c[_0x17d16a])return;const _0x40b5e6=_0xf0556c[_0x17d16a],_0x270533=_0x3c7826(0x1d5)+_0x40b5e6['name']+_0x3c7826(0x194)+(_0x40b5e6[_0x3c7826(0x1f7)]||'')+_0x3c7826(0x1f5)+(_0x40b5e6[_0x3c7826(0x211)]||'')+_0x3c7826(0x209)+(_0x40b5e6['rule_delete']||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x40b5e6[_0x3c7826(0x1ec)]||'')+_0x3c7826(0x1ac),_0x217e8a=$(_0x270533)['appendTo'](_0x3c7826(0x1cf)),_0x4d77db=()=>{const _0x2f3843=_0x3c7826;_0x217e8a[0x0][_0x2f3843(0x20f)](),_0x217e8a[_0x2f3843(0x18f)]();};_0x217e8a[_0x3c7826(0x1c1)]('.popup-button-ok')['on']('click',()=>{const _0x54ed47=_0x3c7826,_0x38cb38={'note':_0x217e8a[_0x54ed47(0x1c1)](_0x54ed47(0x215))[_0x54ed47(0x1b6)](),'rule_add':_0x217e8a['find'](_0x54ed47(0x1a1))[_0x54ed47(0x1b6)](),'rule_delete':_0x217e8a[_0x54ed47(0x1c1)](_0x54ed47(0x1ae))[_0x54ed47(0x1b6)](),'rule_update':_0x217e8a['find'](_0x54ed47(0x1d6))[_0x54ed47(0x1b6)]()};_0x29b278['updateTableRules'](_0x17d16a,_0x38cb38),_0x4d77db();}),_0x217e8a[_0x3c7826(0x1c1)]('.popup-button-cancel')['on'](_0x3c7826(0x228),_0x4d77db),_0x217e8a[0x0]['showModal']();}function bindInjectionSettings(){const _0x461d50=_0x12db1b,_0x4d7705=extension_settings[extensionName],_0x2b922f=document[_0x461d50(0x203)](_0x461d50(0x18a)),_0x34937b=document[_0x461d50(0x203)]('table-injection-position'),_0x39b3ba=document[_0x461d50(0x203)]('table-injection-depth'),_0x5e2df6=document[_0x461d50(0x203)](_0x461d50(0x1b0));if(!_0x2b922f||!_0x34937b||!_0x39b3ba||!_0x5e2df6)return;const _0x2a7cd3=()=>{const _0x3674a5=_0x461d50,_0x8c12ee=_0x34937b['value'],_0x1db29a=_0x8c12ee==='1';_0x39b3ba[_0x3674a5(0x176)]=!_0x1db29a,_0x5e2df6['disabled']=!_0x1db29a;const _0x3cf909=_0x1db29a?'1':'0.5';_0x39b3ba['style'][_0x3674a5(0x201)]=_0x3cf909;_0x39b3ba[_0x3674a5(0x1b1)]&&(_0x39b3ba[_0x3674a5(0x1b1)][_0x3674a5(0x1a2)][_0x3674a5(0x201)]=_0x3cf909);const _0x3460cb=_0x1db29a?'1':_0x3674a5(0x1a0);_0x5e2df6[_0x3674a5(0x1a2)]['opacity']=_0x3460cb,_0x5e2df6[_0x3674a5(0x1b1)]&&(_0x5e2df6[_0x3674a5(0x1b1)]['style'][_0x3674a5(0x201)]=_0x3460cb);};_0x2b922f[_0x461d50(0x219)]=_0x4d7705['table_injection_enabled'],_0x34937b[_0x461d50(0x1da)]=_0x4d7705[_0x461d50(0x191)],_0x39b3ba[_0x461d50(0x1da)]=_0x4d7705[_0x461d50(0x21c)],_0x5e2df6[_0x461d50(0x1da)]=_0x4d7705[_0x461d50(0x21b)],_0x2a7cd3(),_0x2b922f[_0x461d50(0x1d0)](_0x461d50(0x178),()=>{const _0x5155da=_0x461d50;_0x4d7705[_0x5155da(0x1a6)]=_0x2b922f['checked'],saveSettingsDebounced();}),_0x34937b['addEventListener'](_0x461d50(0x178),()=>{const _0x5ce4ef=_0x461d50;_0x4d7705[_0x5ce4ef(0x191)]=parseInt(_0x34937b[_0x5ce4ef(0x1da)],0xa),saveSettingsDebounced(),_0x2a7cd3();}),_0x39b3ba[_0x461d50(0x1d0)](_0x461d50(0x17f),()=>{const _0x1b1110=_0x461d50;_0x4d7705[_0x1b1110(0x21c)]=parseInt(_0x39b3ba[_0x1b1110(0x1da)],0xa),saveSettingsDebounced();}),_0x5e2df6[_0x461d50(0x1d0)](_0x461d50(0x178),()=>{const _0x5c9a01=_0x461d50;_0x4d7705['table_injection_role']=_0x5e2df6[_0x5c9a01(0x1da)],saveSettingsDebounced();}),log('表格注入设置已成功绑定。',_0x461d50(0x1b5));}export function bindTableEvents(){const _0x506a28=_0x12db1b,_0x225a89=document[_0x506a28(0x203)](_0x506a28(0x1f3));if(!_0x225a89||_0x225a89['dataset'][_0x506a28(0x1ef)])return;log(_0x506a28(0x1e1),_0x506a28(0x1cd));const _0x49094d=()=>{renderTables(),bindInjectionSettings();};_0x49094d(),bindBatchFillButton(),bindTemplateEditors();const _0x2a52b3=document[_0x506a28(0x214)](_0x506a28(0x1b7));_0x2a52b3&&_0x2a52b3[_0x506a28(0x1d0)]('click',_0x476e4d=>{const _0xc645f5=_0x506a28,_0x333b10=_0x476e4d[_0xc645f5(0x19d)]['closest'](_0xc645f5(0x20c));if(!_0x333b10)return;const _0x45d505=_0x333b10[_0xc645f5(0x1dd)][_0xc645f5(0x1df)];if(!_0x45d505)return;const _0x59aea5=_0x333b10['closest'](_0xc645f5(0x1b2));if(!_0x59aea5)return;_0x59aea5['querySelectorAll'](_0xc645f5(0x20c))['forEach'](_0x233682=>_0x233682[_0xc645f5(0x196)][_0xc645f5(0x18f)](_0xc645f5(0x200))),_0x333b10[_0xc645f5(0x196)][_0xc645f5(0x193)](_0xc645f5(0x200)),_0x59aea5['querySelectorAll']('.sinan-tab-pane')[_0xc645f5(0x177)](_0x50f13f=>_0x50f13f[_0xc645f5(0x196)][_0xc645f5(0x18f)]('active'));const _0x186952=_0x59aea5[_0xc645f5(0x214)](_0xc645f5(0x222)+_0x45d505+'-tab');_0x186952&&_0x186952[_0xc645f5(0x196)]['add'](_0xc645f5(0x200));});const _0x3ee6db=document[_0x506a28(0x203)](_0x506a28(0x18d)),_0x67b397=document[_0x506a28(0x203)](_0x506a28(0x1e2)),_0x84cbce=document[_0x506a28(0x203)](_0x506a28(0x179));_0x3ee6db&&_0x3ee6db[_0x506a28(0x1d0)]('click',()=>_0x29b278[_0x506a28(0x1be)]());_0x67b397&&_0x67b397[_0x506a28(0x1d0)](_0x506a28(0x228),()=>_0x29b278[_0x506a28(0x1a7)]());_0x84cbce&&_0x84cbce[_0x506a28(0x1d0)](_0x506a28(0x228),()=>_0x29b278[_0x506a28(0x1fa)](_0x49094d));const _0x56f8a3=document['getElementById'](_0x506a28(0x197));_0x56f8a3&&_0x56f8a3[_0x506a28(0x1d0)]('click',()=>{const _0x34ae21=_0x506a28;confirm(_0x34ae21(0x175))&&(_0x29b278[_0x34ae21(0x1aa)](),_0x49094d());});const _0x21dca0=document[_0x506a28(0x203)]('add-table-placeholder');_0x21dca0&&_0x21dca0[_0x506a28(0x1d0)](_0x506a28(0x228),()=>{const _0x1e19d7=_0x506a28,_0x45bbc5=prompt(_0x1e19d7(0x1ff),'新表格');_0x45bbc5&&_0x45bbc5[_0x1e19d7(0x1f0)]()&&(_0x29b278['addTable'](_0x45bbc5[_0x1e19d7(0x1f0)]()),_0x49094d());});const _0x592f72=getAllTablesContainer();_0x592f72&&(_0x592f72[_0x506a28(0x1d0)](_0x506a28(0x228),_0x49c078=>{const _0xaac816=_0x506a28,_0x2bd817=_0x49c078[_0xaac816(0x19d)]['closest'](_0xaac816(0x18c));if(!_0x2bd817)return;const _0x48022c=parseInt(_0x2bd817['dataset'][_0xaac816(0x20b)],0xa);if(_0x2bd817[_0xaac816(0x1d3)](_0xaac816(0x1ee))){if(_0x2bd817[_0xaac816(0x196)][_0xaac816(0x227)](_0xaac816(0x1c2)))_0x29b278[_0xaac816(0x18b)](_0x48022c);else{if(_0x2bd817['classList'][_0xaac816(0x227)](_0xaac816(0x1ab)))_0x29b278[_0xaac816(0x21d)](_0x48022c);}_0x49094d();}else{if(_0x2bd817['matches'](_0xaac816(0x1bd))||_0x2bd817[_0xaac816(0x1d3)](_0xaac816(0x1c8))){const _0x375904=_0x2bd817['classList']['contains'](_0xaac816(0x20e))?'up':_0xaac816(0x1a4);_0x29b278[_0xaac816(0x21a)](_0x48022c,_0x375904),_0x49094d();}else{if(_0x2bd817[_0xaac816(0x1d3)]('.delete-row-handle')){const _0x3615a0=parseInt(_0x2bd817[_0xaac816(0x1d8)]('tr')['dataset'][_0xaac816(0x1e7)],0xa);confirm('您确定要删除这一行吗？')&&(_0x29b278[_0xaac816(0x1f6)](_0x48022c,_0x3615a0),_0x49094d());}else{if(_0x2bd817['matches'](_0xaac816(0x1d2))||_0x2bd817[_0xaac816(0x1d8)]('.edit-rules-btn')){const _0xa81e3=_0x2bd817[_0xaac816(0x1d8)](_0xaac816(0x1d2)),_0x3a4ed1=parseInt(_0xa81e3['dataset']['tableIndex'],0xa);openRuleEditor(_0x3a4ed1);}else{if(_0x2bd817['matches']('.delete-table-btn')){const _0x1ca7f2=parseInt(_0x2bd817['dataset']['tableIndex'],0xa),_0x1ca71a=_0x29b278[_0xaac816(0x1c4)](),_0x58e403=_0x1ca71a[_0x1ca7f2]?.['name']||_0xaac816(0x212);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x58e403+_0xaac816(0x180))&&(_0x29b278[_0xaac816(0x19f)](_0x1ca7f2),_0x49094d());}}}}}}),_0x592f72[_0x506a28(0x1d0)](_0x506a28(0x206),_0x2fff24=>{const _0x502edd=_0x506a28,_0x3acc4f=_0x2fff24[_0x502edd(0x19d)],_0x2a3897=_0x3acc4f[_0x502edd(0x1d8)](_0x502edd(0x21f));if(!_0x2a3897)return;const _0x1d45ed=parseInt(_0x2a3897[_0x502edd(0x1dd)][_0x502edd(0x20b)],0xa),_0x303141=_0x3acc4f[_0x502edd(0x208)];if(_0x3acc4f['tagName']==='TD'){const _0x3a00db=parseInt(_0x3acc4f[_0x502edd(0x1d8)]('tr')[_0x502edd(0x1dd)][_0x502edd(0x1e7)],0xa),_0x351914=parseInt(_0x3acc4f['dataset'][_0x502edd(0x198)],0xa);_0x29b278[_0x502edd(0x17d)](_0x1d45ed,_0x3a00db,_0x351914,_0x303141);}else{if(_0x3acc4f[_0x502edd(0x1eb)]==='TH'&&!_0x3acc4f[_0x502edd(0x196)][_0x502edd(0x227)](_0x502edd(0x184))){const _0x4be926=parseInt(_0x3acc4f[_0x502edd(0x1dd)][_0x502edd(0x198)],0xa);_0x303141[_0x502edd(0x1f0)]()===''?confirm('您确定要通过清空表头来删除此列吗？')?(_0x29b278[_0x502edd(0x220)](_0x1d45ed,_0x4be926),_0x49094d()):_0x49094d():_0x29b278[_0x502edd(0x21e)](_0x1d45ed,_0x4be926,_0x303141);}}},!![])),_0x225a89[_0x506a28(0x1dd)][_0x506a28(0x1ef)]=_0x506a28(0x192),log(_0x506a28(0x1e9),'success');}function bindBatchFillButton(){const _0x5f302a=_0x12db1b,_0x2883e6=document[_0x5f302a(0x203)](_0x5f302a(0x1d9));if(_0x2883e6){if(_0x2883e6[_0x5f302a(0x1dd)][_0x5f302a(0x1fe)])return;_0x2883e6['addEventListener'](_0x5f302a(0x228),startBatchFilling),_0x2883e6[_0x5f302a(0x1dd)][_0x5f302a(0x1fe)]=_0x5f302a(0x192),log(_0x5f302a(0x1b3),'success');}}function bindTemplateEditors(){const _0x468dc7=_0x12db1b,_0x38b9e8=document['getElementById'](_0x468dc7(0x17a)),_0xaf2cd0=document[_0x468dc7(0x203)](_0x468dc7(0x182)),_0x372e24=document[_0x468dc7(0x203)](_0x468dc7(0x1a5)),_0x59b6ae=document['getElementById'](_0x468dc7(0x202)),_0x323a52=document[_0x468dc7(0x203)](_0x468dc7(0x216)),_0x48cbf7=document[_0x468dc7(0x203)](_0x468dc7(0x1db));if(!_0x38b9e8||!_0x59b6ae){log(_0x468dc7(0x183),_0x468dc7(0x17b));return;}_0x38b9e8['value']=_0x29b278[_0x468dc7(0x1d7)](),_0x59b6ae[_0x468dc7(0x1da)]=_0x29b278[_0x468dc7(0x1a9)](),_0xaf2cd0[_0x468dc7(0x1d0)]('click',()=>{const _0x146a1b=_0x468dc7;_0x29b278[_0x146a1b(0x1e0)](_0x38b9e8['value']),toastr[_0x146a1b(0x1b5)](_0x146a1b(0x1ce)),log('批量填表-规则提示词已保存。',_0x146a1b(0x1b5));}),_0x323a52[_0x468dc7(0x1d0)](_0x468dc7(0x228),()=>{const _0x3b2816=_0x468dc7;_0x29b278[_0x3b2816(0x199)](_0x59b6ae[_0x3b2816(0x1da)]),toastr[_0x3b2816(0x1b5)](_0x3b2816(0x1e5)),log(_0x3b2816(0x186),_0x3b2816(0x1b5));}),_0x372e24[_0x468dc7(0x1d0)](_0x468dc7(0x228),()=>{const _0x34f884=_0x468dc7;confirm(_0x34f884(0x1fd))&&(_0x38b9e8['value']=DEFAULT_AI_RULE_TEMPLATE,_0x29b278[_0x34f884(0x1e0)](_0x38b9e8[_0x34f884(0x1da)]),toastr[_0x34f884(0x1cd)]('规则提示词已恢复为默认。'),log(_0x34f884(0x217),'info'));}),_0x48cbf7[_0x468dc7(0x1d0)](_0x468dc7(0x228),()=>{const _0x57ff52=_0x468dc7;confirm(_0x57ff52(0x1d4))&&(_0x59b6ae[_0x57ff52(0x1da)]=DEFAULT_AI_FLOW_TEMPLATE,_0x29b278[_0x57ff52(0x199)](_0x59b6ae['value']),toastr[_0x57ff52(0x1cd)](_0x57ff52(0x1c6)),log(_0x57ff52(0x19b),'info'));}),log(_0x468dc7(0x18e),_0x468dc7(0x1b5));}
