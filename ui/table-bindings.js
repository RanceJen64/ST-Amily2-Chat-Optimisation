const _0x20a6e2=_0x1c78;(function(_0x446533,_0x5266a7){const _0x3ff529=_0x1c78,_0x279d5b=_0x446533();while(!![]){try{const _0x4dc0a9=parseInt(_0x3ff529(0x24d))/0x1+-parseInt(_0x3ff529(0x1ef))/0x2+-parseInt(_0x3ff529(0x23f))/0x3*(parseInt(_0x3ff529(0x254))/0x4)+parseInt(_0x3ff529(0x23b))/0x5*(-parseInt(_0x3ff529(0x246))/0x6)+-parseInt(_0x3ff529(0x27c))/0x7*(-parseInt(_0x3ff529(0x224))/0x8)+parseInt(_0x3ff529(0x24f))/0x9+parseInt(_0x3ff529(0x284))/0xa*(-parseInt(_0x3ff529(0x26d))/0xb);if(_0x4dc0a9===_0x5266a7)break;else _0x279d5b['push'](_0x279d5b['shift']());}catch(_0x5826cc){_0x279d5b['push'](_0x279d5b['shift']());}}}(_0x1207,0xd3e52));import*as _0x426042 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';function _0x1207(){const _0x1485c1=['table_injection_depth','updateTableRules','contenteditable','827704ERnnXy','getBatchFillerRuleTemplate','closest','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','.sinan-tab-pane','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','rows','addEventListener','trim','cursor','dashed','saveBatchFillerFlowTemplate','您确定要删除表格\x20[','您确定要将流程提示词恢复为默认设置吗？','rule_delete','active','表格视图交互事件已成功绑定。','loadTables','val','.popup-button-ok','space-between','add-table-placeholder','#rule-delete','length','table-injection-position','true','previousElementSibling','down','auto','updateHeader','amily2-table-','deleteRow','name','table','forEach','colIndex','exportPreset','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','moveTable','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','tableIndex','ai-rule-template-restore-btn','rule_update','getBatchFillerFlowTemplate','#rule-add','表格注入设置已成功绑定。',']\x20的第\x20','请输入新表格的名称：','className','appendChild','createTHead','saveBatchFillerRuleTemplate','rule_add','988440kXOBgY','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','clearAllTables','confirm','overflowX','批量填表-规则提示词已保存。','blur','setAttribute','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','classList','批量填表-规则提示词已恢复默认。','dataset','eventsBound','tagName','table-instance-container','table-injection-role','table_injection_position','\x20行吗？','target','.delete-row-handle','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','headers','您确定要通过清空表头来删除此列吗？','5KFHiZy','insertRow','amily2-export-preset-btn','.popup-button-cancel','153MTJSGS','center','innerHTML','table_injection_role','contains','.edit-rules-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','5520318TpUnat','input','batchEventBound','ai-flow-template-save-btn','add-col-btn','#rule-update','addColumn','1156162dUkRCe','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','14643621lUgToM','exportPresetFull','warn','click','index-col','87460LAFkGe','20px\x200','您确定要删除这一行吗？','rowIndex','justifyContent','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-row-btn\x22\x20data-table-index=\x22','insertCell','addRow','无法找到指令模板编辑器，绑定失败。','pointer','matches','amily2-import-preset-btn','querySelector','querySelectorAll','.move-table-down-btn','点击删除此行','开始为表格视图绑定交互事件...','error','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','amily2-clear-all-tables-btn','table_injection_enabled','.sinan-nav-item','table-injection-depth','move-table-up-btn','未知表格','8107jJKmBJ','rgba(255,\x20255,\x20255,\x200.2)','#sinan-','.add-row-btn,\x20.add-col-btn','内存状态为空，从聊天记录加载作为后备。','amily2-export-preset-full-btn','value','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','style','deleteColumn','borderColor','ai-rule-template-editor','find','alignItems','批量填表-流程提示词已保存。','56RPnYbi','updateCell','您确定要将规则提示词恢复为默认设置吗？','getMemoryState','remove','title','disabled','\x22>加行</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-col-btn\x22\x20data-table-index=\x22','6170UhnERB','success','ai-flow-template-editor','table-injection-enabled','tab','importPreset','table-controls','createElement','margin','getElementById','textContent','-tab','opacity','0.5','ai-flow-template-restore-btn','change','checked','div','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','.move-table-up-btn','index-col\x20delete-row-handle','body','all-tables-container','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','info','close','appendTo','add'];_0x1207=function(){return _0x1485c1;};return _0x1207();}import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';function _0x1c78(_0x5b6461,_0x5a0563){const _0x1207da=_0x1207();return _0x1c78=function(_0x1c78e0,_0x5b757e){_0x1c78e0=_0x1c78e0-0x1d4;let _0x3a00dd=_0x1207da[_0x1c78e0];return _0x3a00dd;},_0x1c78(_0x5b6461,_0x5a0563);}import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x20a6e2(0x1d9)](_0x20a6e2(0x1e6));export function renderTables(){const _0x5be6f6=_0x20a6e2;let _0x7b2284=_0x426042[_0x5be6f6(0x27f)]();!_0x7b2284&&(log(_0x5be6f6(0x271),_0x5be6f6(0x251)),_0x7b2284=_0x426042[_0x5be6f6(0x200)]());const _0xcc1132=getAllTablesContainer();if(!_0x7b2284||!_0xcc1132){console[_0x5be6f6(0x265)](_0x5be6f6(0x238));return;}const _0x528a3=document['getElementById'](_0x5be6f6(0x204));_0x528a3&&_0x528a3['remove'](),_0xcc1132[_0x5be6f6(0x241)]='',_0x7b2284[_0x5be6f6(0x211)]((_0x55a534,_0x320a8c)=>{const _0x34a1fd=_0x5be6f6,_0x44a8b3=document[_0x34a1fd(0x1d7)]('div');_0x44a8b3[_0x34a1fd(0x21f)]=_0x34a1fd(0x232);const _0x399e7d=document['createElement'](_0x34a1fd(0x1e1));_0x399e7d[_0x34a1fd(0x275)]['display']='flex',_0x399e7d[_0x34a1fd(0x275)][_0x34a1fd(0x258)]=_0x34a1fd(0x203),_0x399e7d[_0x34a1fd(0x275)][_0x34a1fd(0x27a)]=_0x34a1fd(0x240);const _0xf6cc66=document[_0x34a1fd(0x1d7)]('h3');_0xf6cc66['innerHTML']=_0x34a1fd(0x1f2)+_0x55a534[_0x34a1fd(0x20f)];const _0x1ba7cc=document['createElement']('div');_0x1ba7cc['className']=_0x34a1fd(0x1d6);const _0x5efda0=_0x320a8c>0x0?_0x34a1fd(0x214)+_0x320a8c+_0x34a1fd(0x1e7):'',_0x77cf4b=_0x320a8c<_0x7b2284['length']-0x1?_0x34a1fd(0x266)+_0x320a8c+_0x34a1fd(0x1f4):'';_0x1ba7cc['innerHTML']=_0x34a1fd(0x245)+_0x5efda0+_0x34a1fd(0x245)+_0x77cf4b+_0x34a1fd(0x216)+_0x320a8c+_0x34a1fd(0x259)+_0x320a8c+_0x34a1fd(0x283)+_0x320a8c+'\x22>加列</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22'+_0x320a8c+'\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x399e7d[_0x34a1fd(0x220)](_0xf6cc66),_0x399e7d[_0x34a1fd(0x220)](_0x1ba7cc),_0xcc1132[_0x34a1fd(0x220)](_0x399e7d);const _0x40ba52=document['createElement'](_0x34a1fd(0x1e1));_0x40ba52[_0x34a1fd(0x275)][_0x34a1fd(0x228)]=_0x34a1fd(0x20b);const _0x20fd9e=document[_0x34a1fd(0x1d7)](_0x34a1fd(0x210));_0x20fd9e['id']=_0x34a1fd(0x20d)+_0x320a8c,_0x20fd9e[_0x34a1fd(0x22f)][_0x34a1fd(0x217)]=_0x320a8c;const _0x53999a=_0x20fd9e[_0x34a1fd(0x221)](),_0x4cd408=_0x53999a[_0x34a1fd(0x23c)](),_0x4555e6=document[_0x34a1fd(0x1d7)]('th');_0x4555e6[_0x34a1fd(0x21f)]=_0x34a1fd(0x253),_0x4555e6[_0x34a1fd(0x1da)]='#',_0x4cd408[_0x34a1fd(0x220)](_0x4555e6),_0x55a534[_0x34a1fd(0x239)][_0x34a1fd(0x211)]((_0x4ddc9f,_0x3ff06b)=>{const _0x58d467=_0x34a1fd,_0xc9ae49=document[_0x58d467(0x1d7)]('th');_0xc9ae49[_0x58d467(0x1da)]=_0x4ddc9f,_0xc9ae49['setAttribute'](_0x58d467(0x1ee),_0x58d467(0x208)),_0xc9ae49[_0x58d467(0x22f)][_0x58d467(0x212)]=_0x3ff06b,_0x4cd408[_0x58d467(0x220)](_0xc9ae49);});const _0x447484=_0x20fd9e['createTBody']();_0x55a534[_0x34a1fd(0x1f5)]&&_0x55a534['rows']['length']>0x0&&_0x55a534[_0x34a1fd(0x1f5)]['forEach']((_0x1bc595,_0x28dfdc)=>{const _0x128e6a=_0x34a1fd,_0x1db725=_0x447484[_0x128e6a(0x23c)]();_0x1db725[_0x128e6a(0x22f)][_0x128e6a(0x257)]=_0x28dfdc;const _0x5e787f=_0x1db725[_0x128e6a(0x25a)]();_0x5e787f['className']=_0x128e6a(0x1e4),_0x5e787f[_0x128e6a(0x281)]=_0x128e6a(0x263),_0x5e787f[_0x128e6a(0x1da)]=_0x28dfdc+0x1,_0x5e787f[_0x128e6a(0x275)][_0x128e6a(0x1f8)]=_0x128e6a(0x25d),_0x5e787f[_0x128e6a(0x1f6)]('click',async _0xedb62c=>{const _0x8349e2=_0x128e6a;_0xedb62c['stopPropagation'](),window[_0x8349e2(0x227)](_0x8349e2(0x1fb)+_0x55a534[_0x8349e2(0x20f)]+_0x8349e2(0x21d)+(_0x28dfdc+0x1)+_0x8349e2(0x235))&&(await _0x426042[_0x8349e2(0x20e)](_0x320a8c,_0x28dfdc),renderTables());}),_0x1bc595[_0x128e6a(0x211)]((_0x4e585c,_0x12f78b)=>{const _0x52c62e=_0x128e6a,_0x4471ff=_0x1db725[_0x52c62e(0x25a)]();_0x4471ff[_0x52c62e(0x1da)]=_0x4e585c,_0x4471ff[_0x52c62e(0x22b)]('contenteditable','true'),_0x4471ff[_0x52c62e(0x22f)]['colIndex']=_0x12f78b;});});_0x40ba52[_0x34a1fd(0x220)](_0x20fd9e),_0x44a8b3[_0x34a1fd(0x220)](_0x40ba52);if(_0x320a8c<_0x7b2284[_0x34a1fd(0x206)]-0x1){const _0x2ada10=document['createElement']('hr');_0x2ada10[_0x34a1fd(0x275)]['borderStyle']=_0x34a1fd(0x1f9),_0x2ada10[_0x34a1fd(0x275)][_0x34a1fd(0x1d8)]=_0x34a1fd(0x255),_0x2ada10[_0x34a1fd(0x275)][_0x34a1fd(0x277)]=_0x34a1fd(0x26e),_0x44a8b3[_0x34a1fd(0x220)](_0x2ada10);}_0xcc1132[_0x34a1fd(0x220)](_0x44a8b3);}),_0x528a3&&_0xcc1132['appendChild'](_0x528a3);}function openRuleEditor(_0x4d6d18){const _0x3bdc12=_0x20a6e2,_0x2b818d=_0x426042[_0x3bdc12(0x27f)]();if(!_0x2b818d||!_0x2b818d[_0x4d6d18])return;const _0x49a11d=_0x2b818d[_0x4d6d18],_0x3c599e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'+_0x49a11d['name']+_0x3bdc12(0x225)+(_0x49a11d['note']||'')+_0x3bdc12(0x22c)+(_0x49a11d[_0x3bdc12(0x223)]||'')+_0x3bdc12(0x1e2)+(_0x49a11d[_0x3bdc12(0x1fd)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x49a11d[_0x3bdc12(0x219)]||'')+_0x3bdc12(0x274),_0x33b76a=$(_0x3c599e)[_0x3bdc12(0x1ea)](_0x3bdc12(0x1e5)),_0x2a00f7=()=>{const _0x5ecfdf=_0x3bdc12;_0x33b76a[0x0][_0x5ecfdf(0x1e9)](),_0x33b76a[_0x5ecfdf(0x280)]();};_0x33b76a[_0x3bdc12(0x279)](_0x3bdc12(0x202))['on'](_0x3bdc12(0x252),()=>{const _0x5cb76f=_0x3bdc12,_0x5e7d7d={'note':_0x33b76a['find']('#rule-note')[_0x5cb76f(0x201)](),'rule_add':_0x33b76a['find'](_0x5cb76f(0x21b))['val'](),'rule_delete':_0x33b76a[_0x5cb76f(0x279)](_0x5cb76f(0x205))['val'](),'rule_update':_0x33b76a[_0x5cb76f(0x279)](_0x5cb76f(0x24b))[_0x5cb76f(0x201)]()};_0x426042[_0x5cb76f(0x1ed)](_0x4d6d18,_0x5e7d7d),_0x2a00f7();}),_0x33b76a['find'](_0x3bdc12(0x23e))['on'](_0x3bdc12(0x252),_0x2a00f7),_0x33b76a[0x0]['showModal']();}function bindInjectionSettings(){const _0x2a0fc6=_0x20a6e2,_0x32a90a=extension_settings[extensionName],_0x24616b=document['getElementById'](_0x2a0fc6(0x287)),_0x541228=document['getElementById'](_0x2a0fc6(0x207)),_0x2131d3=document[_0x2a0fc6(0x1d9)](_0x2a0fc6(0x26a)),_0x466965=document[_0x2a0fc6(0x1d9)](_0x2a0fc6(0x233));if(!_0x24616b||!_0x541228||!_0x2131d3||!_0x466965)return;const _0x277ead=()=>{const _0x2dd9a9=_0x2a0fc6,_0x533a7b=_0x541228[_0x2dd9a9(0x273)],_0x2597ad=_0x533a7b==='1';_0x2131d3['disabled']=!_0x2597ad,_0x466965[_0x2dd9a9(0x282)]=!_0x2597ad;const _0x59bb1f=_0x2597ad?'1':'0.5';_0x2131d3['style'][_0x2dd9a9(0x1dc)]=_0x59bb1f;_0x2131d3['previousElementSibling']&&(_0x2131d3[_0x2dd9a9(0x209)][_0x2dd9a9(0x275)][_0x2dd9a9(0x1dc)]=_0x59bb1f);const _0x38db79=_0x2597ad?'1':_0x2dd9a9(0x1dd);_0x466965[_0x2dd9a9(0x275)][_0x2dd9a9(0x1dc)]=_0x38db79,_0x466965['previousElementSibling']&&(_0x466965[_0x2dd9a9(0x209)][_0x2dd9a9(0x275)][_0x2dd9a9(0x1dc)]=_0x38db79);};_0x24616b[_0x2a0fc6(0x1e0)]=_0x32a90a[_0x2a0fc6(0x268)],_0x541228[_0x2a0fc6(0x273)]=_0x32a90a[_0x2a0fc6(0x234)],_0x2131d3[_0x2a0fc6(0x273)]=_0x32a90a[_0x2a0fc6(0x1ec)],_0x466965[_0x2a0fc6(0x273)]=_0x32a90a[_0x2a0fc6(0x242)],_0x277ead(),_0x24616b[_0x2a0fc6(0x1f6)](_0x2a0fc6(0x1df),()=>{const _0xf1d4ad=_0x2a0fc6;_0x32a90a[_0xf1d4ad(0x268)]=_0x24616b[_0xf1d4ad(0x1e0)],saveSettingsDebounced();}),_0x541228[_0x2a0fc6(0x1f6)](_0x2a0fc6(0x1df),()=>{const _0x222f06=_0x2a0fc6;_0x32a90a[_0x222f06(0x234)]=parseInt(_0x541228['value'],0xa),saveSettingsDebounced(),_0x277ead();}),_0x2131d3[_0x2a0fc6(0x1f6)](_0x2a0fc6(0x247),()=>{const _0x18e70e=_0x2a0fc6;_0x32a90a[_0x18e70e(0x1ec)]=parseInt(_0x2131d3[_0x18e70e(0x273)],0xa),saveSettingsDebounced();}),_0x466965['addEventListener'](_0x2a0fc6(0x1df),()=>{const _0x384443=_0x2a0fc6;_0x32a90a[_0x384443(0x242)]=_0x466965['value'],saveSettingsDebounced();}),log(_0x2a0fc6(0x21c),_0x2a0fc6(0x285));}export function bindTableEvents(){const _0x46904a=_0x20a6e2,_0x3d4da7=document['getElementById']('amily2_memorisation_forms_panel');if(!_0x3d4da7||_0x3d4da7[_0x46904a(0x22f)][_0x46904a(0x230)])return;log(_0x46904a(0x264),_0x46904a(0x1e8));const _0x51493e=()=>{renderTables(),bindInjectionSettings();};_0x51493e(),bindBatchFillButton(),bindTemplateEditors();const _0x14180c=document['querySelector'](_0x46904a(0x24e));_0x14180c&&_0x14180c[_0x46904a(0x1f6)]('click',_0x11da3c=>{const _0x153c90=_0x46904a,_0x4c4dd3=_0x11da3c[_0x153c90(0x236)][_0x153c90(0x1f1)](_0x153c90(0x269));if(!_0x4c4dd3)return;const _0x3067ec=_0x4c4dd3[_0x153c90(0x22f)][_0x153c90(0x1d4)];if(!_0x3067ec)return;const _0x4cd2ba=_0x4c4dd3[_0x153c90(0x1f1)]('.settings-group');if(!_0x4cd2ba)return;_0x4cd2ba[_0x153c90(0x261)]('.sinan-nav-item')[_0x153c90(0x211)](_0x10032a=>_0x10032a['classList'][_0x153c90(0x280)]('active')),_0x4c4dd3[_0x153c90(0x22d)][_0x153c90(0x1eb)](_0x153c90(0x1fe)),_0x4cd2ba[_0x153c90(0x261)](_0x153c90(0x1f3))['forEach'](_0x42b001=>_0x42b001[_0x153c90(0x22d)][_0x153c90(0x280)](_0x153c90(0x1fe)));const _0xe9d13c=_0x4cd2ba[_0x153c90(0x260)](_0x153c90(0x26f)+_0x3067ec+_0x153c90(0x1db));_0xe9d13c&&_0xe9d13c[_0x153c90(0x22d)]['add'](_0x153c90(0x1fe));});const _0x58c510=document['getElementById'](_0x46904a(0x23d)),_0x146efe=document[_0x46904a(0x1d9)](_0x46904a(0x272)),_0x5175a6=document[_0x46904a(0x1d9)](_0x46904a(0x25f));_0x58c510&&_0x58c510[_0x46904a(0x1f6)](_0x46904a(0x252),()=>_0x426042[_0x46904a(0x213)]());_0x146efe&&_0x146efe['addEventListener'](_0x46904a(0x252),()=>_0x426042[_0x46904a(0x250)]());_0x5175a6&&_0x5175a6['addEventListener'](_0x46904a(0x252),()=>_0x426042[_0x46904a(0x1d5)](_0x51493e));const _0x52b41f=document[_0x46904a(0x1d9)](_0x46904a(0x267));_0x52b41f&&_0x52b41f[_0x46904a(0x1f6)]('click',()=>{const _0x2f8aaf=_0x46904a;confirm('【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。')&&(_0x426042[_0x2f8aaf(0x226)](),_0x51493e());});const _0x2249fc=document[_0x46904a(0x1d9)](_0x46904a(0x204));_0x2249fc&&_0x2249fc[_0x46904a(0x1f6)](_0x46904a(0x252),()=>{const _0x1a8614=_0x46904a,_0x2bfd88=prompt(_0x1a8614(0x21e),'新表格');_0x2bfd88&&_0x2bfd88[_0x1a8614(0x1f7)]()&&(_0x426042['addTable'](_0x2bfd88[_0x1a8614(0x1f7)]()),_0x51493e());});const _0x294b85=getAllTablesContainer();_0x294b85&&(_0x294b85['addEventListener'](_0x46904a(0x252),_0x4a0793=>{const _0x5d502a=_0x46904a,_0x2cb94c=_0x4a0793['target'][_0x5d502a(0x1f1)]('button');if(!_0x2cb94c)return;const _0x48ab0c=parseInt(_0x2cb94c[_0x5d502a(0x22f)][_0x5d502a(0x217)],0xa);if(_0x2cb94c['matches'](_0x5d502a(0x270))){if(_0x2cb94c['classList'][_0x5d502a(0x243)]('add-row-btn'))_0x426042[_0x5d502a(0x25b)](_0x48ab0c);else{if(_0x2cb94c[_0x5d502a(0x22d)][_0x5d502a(0x243)](_0x5d502a(0x24a)))_0x426042[_0x5d502a(0x24c)](_0x48ab0c);}_0x51493e();}else{if(_0x2cb94c[_0x5d502a(0x25e)](_0x5d502a(0x1e3))||_0x2cb94c['matches'](_0x5d502a(0x262))){const _0x3b4ff5=_0x2cb94c[_0x5d502a(0x22d)]['contains'](_0x5d502a(0x26b))?'up':_0x5d502a(0x20a);_0x426042[_0x5d502a(0x215)](_0x48ab0c,_0x3b4ff5),_0x51493e();}else{if(_0x2cb94c[_0x5d502a(0x25e)](_0x5d502a(0x237))){const _0xed7e8=parseInt(_0x2cb94c['closest']('tr')[_0x5d502a(0x22f)][_0x5d502a(0x257)],0xa);confirm(_0x5d502a(0x256))&&(_0x426042['deleteRow'](_0x48ab0c,_0xed7e8),_0x51493e());}else{if(_0x2cb94c[_0x5d502a(0x25e)](_0x5d502a(0x244))||_0x2cb94c['closest'](_0x5d502a(0x244))){const _0x44a264=_0x2cb94c[_0x5d502a(0x1f1)]('.edit-rules-btn'),_0x1cd6b7=parseInt(_0x44a264['dataset'][_0x5d502a(0x217)],0xa);openRuleEditor(_0x1cd6b7);}else{if(_0x2cb94c[_0x5d502a(0x25e)]('.delete-table-btn')){const _0x65f4=parseInt(_0x2cb94c[_0x5d502a(0x22f)]['tableIndex'],0xa),_0x2bd706=_0x426042[_0x5d502a(0x27f)](),_0x6c811e=_0x2bd706[_0x65f4]?.['name']||_0x5d502a(0x26c);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x6c811e+']”\x20吗？此操作不可逆！')&&(_0x426042['deleteTable'](_0x65f4),_0x51493e());}}}}}}),_0x294b85[_0x46904a(0x1f6)](_0x46904a(0x22a),_0x1b4ac8=>{const _0x2dc7d5=_0x46904a,_0x9daa7f=_0x1b4ac8['target'],_0x1004a7=_0x9daa7f[_0x2dc7d5(0x1f1)]('table');if(!_0x1004a7)return;const _0x4af8a6=parseInt(_0x1004a7['dataset'][_0x2dc7d5(0x217)],0xa),_0x47b306=_0x9daa7f[_0x2dc7d5(0x1da)];if(_0x9daa7f[_0x2dc7d5(0x231)]==='TD'){const _0x3036d8=parseInt(_0x9daa7f[_0x2dc7d5(0x1f1)]('tr')[_0x2dc7d5(0x22f)][_0x2dc7d5(0x257)],0xa),_0x574bc2=parseInt(_0x9daa7f[_0x2dc7d5(0x22f)][_0x2dc7d5(0x212)],0xa);_0x426042[_0x2dc7d5(0x27d)](_0x4af8a6,_0x3036d8,_0x574bc2,_0x47b306);}else{if(_0x9daa7f[_0x2dc7d5(0x231)]==='TH'&&!_0x9daa7f[_0x2dc7d5(0x22d)][_0x2dc7d5(0x243)](_0x2dc7d5(0x253))){const _0x57446b=parseInt(_0x9daa7f[_0x2dc7d5(0x22f)][_0x2dc7d5(0x212)],0xa);_0x47b306[_0x2dc7d5(0x1f7)]()===''?confirm(_0x2dc7d5(0x23a))?(_0x426042[_0x2dc7d5(0x276)](_0x4af8a6,_0x57446b),_0x51493e()):_0x51493e():_0x426042[_0x2dc7d5(0x20c)](_0x4af8a6,_0x57446b,_0x47b306);}}},!![])),_0x3d4da7[_0x46904a(0x22f)][_0x46904a(0x230)]='true',log(_0x46904a(0x1ff),_0x46904a(0x285));}function bindBatchFillButton(){const _0x112eef=_0x20a6e2,_0x14ae5d=document['getElementById']('fill-table-now-btn');if(_0x14ae5d){if(_0x14ae5d[_0x112eef(0x22f)][_0x112eef(0x248)])return;_0x14ae5d[_0x112eef(0x1f6)]('click',startBatchFilling),_0x14ae5d[_0x112eef(0x22f)][_0x112eef(0x248)]=_0x112eef(0x208),log('“立即填表”按钮已成功绑定。',_0x112eef(0x285));}}function bindTemplateEditors(){const _0x4e0ccf=_0x20a6e2,_0x4a9e5e=document[_0x4e0ccf(0x1d9)](_0x4e0ccf(0x278)),_0x2f0269=document[_0x4e0ccf(0x1d9)]('ai-rule-template-save-btn'),_0x139651=document[_0x4e0ccf(0x1d9)](_0x4e0ccf(0x218)),_0x23417f=document[_0x4e0ccf(0x1d9)](_0x4e0ccf(0x286)),_0x40ce4a=document[_0x4e0ccf(0x1d9)](_0x4e0ccf(0x249)),_0x32eb5f=document['getElementById'](_0x4e0ccf(0x1de));if(!_0x4a9e5e||!_0x23417f){log(_0x4e0ccf(0x25c),_0x4e0ccf(0x251));return;}_0x4a9e5e[_0x4e0ccf(0x273)]=_0x426042[_0x4e0ccf(0x1f0)](),_0x23417f['value']=_0x426042[_0x4e0ccf(0x21a)](),_0x2f0269[_0x4e0ccf(0x1f6)](_0x4e0ccf(0x252),()=>{const _0x4f5cc5=_0x4e0ccf;_0x426042[_0x4f5cc5(0x222)](_0x4a9e5e['value']),toastr[_0x4f5cc5(0x285)]('规则提示词已保存。'),log(_0x4f5cc5(0x229),'success');}),_0x40ce4a[_0x4e0ccf(0x1f6)](_0x4e0ccf(0x252),()=>{const _0x44f3f9=_0x4e0ccf;_0x426042['saveBatchFillerFlowTemplate'](_0x23417f[_0x44f3f9(0x273)]),toastr[_0x44f3f9(0x285)]('流程提示词已保存。'),log(_0x44f3f9(0x27b),_0x44f3f9(0x285));}),_0x139651[_0x4e0ccf(0x1f6)]('click',()=>{const _0x1078bd=_0x4e0ccf;confirm(_0x1078bd(0x27e))&&(_0x4a9e5e[_0x1078bd(0x273)]=DEFAULT_AI_RULE_TEMPLATE,_0x426042[_0x1078bd(0x222)](_0x4a9e5e['value']),toastr[_0x1078bd(0x1e8)]('规则提示词已恢复为默认。'),log(_0x1078bd(0x22e),'info'));}),_0x32eb5f['addEventListener']('click',()=>{const _0x181cee=_0x4e0ccf;confirm(_0x181cee(0x1fc))&&(_0x23417f[_0x181cee(0x273)]=DEFAULT_AI_FLOW_TEMPLATE,_0x426042[_0x181cee(0x1fa)](_0x23417f[_0x181cee(0x273)]),toastr[_0x181cee(0x1e8)]('流程提示词已恢复为默认。'),log('批量填表-流程提示词已恢复默认。',_0x181cee(0x1e8)));}),log('指令模板编辑器已成功绑定。','success');}
