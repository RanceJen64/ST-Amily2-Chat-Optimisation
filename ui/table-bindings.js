const _0x308cea=_0x3fd7;(function(_0x16f71b,_0x39bfd2){const _0x16dbb3=_0x3fd7,_0x2dfe50=_0x16f71b();while(!![]){try{const _0x25a140=parseInt(_0x16dbb3(0x20b))/0x1+parseInt(_0x16dbb3(0x286))/0x2*(parseInt(_0x16dbb3(0x287))/0x3)+-parseInt(_0x16dbb3(0x1e3))/0x4*(parseInt(_0x16dbb3(0x23c))/0x5)+parseInt(_0x16dbb3(0x223))/0x6*(-parseInt(_0x16dbb3(0x1b7))/0x7)+-parseInt(_0x16dbb3(0x261))/0x8*(parseInt(_0x16dbb3(0x25a))/0x9)+parseInt(_0x16dbb3(0x231))/0xa+-parseInt(_0x16dbb3(0x20a))/0xb;if(_0x25a140===_0x39bfd2)break;else _0x2dfe50['push'](_0x2dfe50['shift']());}catch(_0x25b569){_0x2dfe50['push'](_0x2dfe50['shift']());}}}(_0x8ffb,0xd2e16));import*as _0x3fac18 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';function _0x8ffb(){const _0x2a14ca=['active','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','querySelector','getHighlights','batchEventBound','rule_delete','删除该行','dataset','name','18434383gfjVyg','1698291eCIOXk','opacity','table_injection_position','span','warn','amily2-context-menu','setAttribute','move-down','.move-table-down-btn','在上加行','move-left','below','display','blur','dblclick','label','向下移动','fa-plus-circle','amily2-context-menu\x20amily2-row-context-menu','appendTo','#rule-add','开始为表格视图绑定交互事件...','index-col','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','96EdujfG','pointer','matches','ai-rule-template-restore-btn','innerHTML','amily2-export-preset-btn','tab','contenteditable','getAttribute','change','fill-table-now-btn','在下加行','length','amily2-menu-active','8790080ouhEMr','find','rows','amily2-import-preset-btn','auto','.popup-button-cancel','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','loadTables','“立即填表”按钮已成功绑定。','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','preventDefault','10libjEU','add','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','add-left','向左移动','无法找到指令模板编辑器，绑定失败。','【最终警告】您确定要永久废黜表格\x20“[','all-tables-container','value','amily2-table-','insertCell','moveTable','removeEventListener','table','right','forEach','contains','您确定要将规则提示词恢复为默认设置吗？','focus','click','error','classList','trim','left','delete','在右加列','新表格','updateTableRules','流程提示词已保存。','编辑列名','5463tNYXzQ','请输入新的列名：','.settings-group','addColumn','saveBatchFillerFlowTemplate','.sinan-tab-pane','您确定要将流程提示词恢复为默认设置吗？','1352NZZARO','tagName','stopPropagation','querySelectorAll','.delete-table-btn','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','ai-rule-template-editor','.add-col-btn','getBatchFillerFlowTemplate','showModal','overflowX','createTBody','body','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','checked','#sinan-','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','向上移动','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','批量填表-规则提示词已保存。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','指令模板编辑器已成功绑定。','flex','amily2-export-preset-full-btn','amily2-clear-all-tables-btn','add-below','流程提示词已恢复为默认。','add-right','ai-flow-template-save-btn','close','td.index-col','above','table_injection_depth','addHighlight','删除该列','menu_button\x20small_button','请输入新表格的名称：','2fkHJfX','4361685DVSedZ','addEventListener','move-table-up-btn','rowIndex','style','ai-flow-template-editor','updateRow','rename','importPreset','headers','false','规则提示词已恢复为默认。','table-controls','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','<i\x20class=\x22fas\x20','规则提示词已保存。','className','604037iIKGNB','批量填表-流程提示词已保存。','val','moveColumn','.amily2-context-menu.amily2-menu-active','createElement','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','insertColumn','.amily2-context-menu','在左加列','table-injection-depth','exportPreset','.sinan-nav-item','table_injection_enabled','space-between','maxTouchPoints','填表模式已切换为\x20','appendChild','addRow','\x20行吗？','tableIndex','textContent','clearAllTables','true','moveRow','insertRow','deleteColumn','success','table-injection-role','move-up','0.5','move-right','add-above','filling_mode','saveBatchFillerRuleTemplate','amily2_memorisation_forms_panel','remove','eventsBound','rule_add','info','getElementById','previousElementSibling','div','ontouchstart','16672ZseMJu','down','.move-table-up-btn','closest','批量填表-流程提示词已恢复默认。','target','表格视图交互事件已成功绑定。','\x22></i>\x20','cursor','ai-flow-template-restore-btn','button','#rule-update','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','add-table-placeholder','table-injection-position','#rule-delete','danger','main-api','colIndex','优化中填表','表格注入设置已成功绑定。','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','addTable','fa-arrow-left','原始填表','fa-trash-alt','cell-highlight','”\x20列吗？','fa-arrow-down','.add-row-btn'];_0x8ffb=function(){return _0x2a14ca;};return _0x8ffb();}import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';function _0x3fd7(_0x1344ec,_0x339e20){const _0x8ffb46=_0x8ffb();return _0x3fd7=function(_0x3fd737,_0x2117fc){_0x3fd737=_0x3fd737-0x1b5;let _0x45fcfc=_0x8ffb46[_0x3fd737];return _0x45fcfc;},_0x3fd7(_0x1344ec,_0x339e20);}const getAllTablesContainer=()=>document[_0x308cea(0x1df)](_0x308cea(0x243));function toggleRowContextMenu(_0x5dfd36){const _0x46cc42=_0x308cea;_0x5dfd36[_0x46cc42(0x23b)](),_0x5dfd36[_0x46cc42(0x263)]();const _0x55a111=_0x5dfd36[_0x46cc42(0x1e8)]['closest']('td.index-col');if(!_0x55a111)return;const _0x36edc0=_0x55a111['querySelector']('.amily2-context-menu');if(!_0x36edc0)return;const _0x1d1ecf=_0x36edc0[_0x46cc42(0x251)][_0x46cc42(0x24c)](_0x46cc42(0x230));document[_0x46cc42(0x264)]('.amily2-context-menu.amily2-menu-active')[_0x46cc42(0x24b)](_0x20e8c4=>{const _0xf1eb9e=_0x46cc42;_0x20e8c4[_0xf1eb9e(0x251)][_0xf1eb9e(0x1db)](_0xf1eb9e(0x230));});!_0x1d1ecf&&_0x36edc0['classList'][_0x46cc42(0x23d)]('amily2-menu-active');const _0x33b4c3=_0x6899ee=>{const _0x5438c3=_0x46cc42;!_0x36edc0[_0x5438c3(0x24c)](_0x6899ee['target'])&&(_0x36edc0[_0x5438c3(0x251)][_0x5438c3(0x1db)](_0x5438c3(0x230)),document['removeEventListener'](_0x5438c3(0x24f),_0x33b4c3,!![]));};setTimeout(()=>{const _0x3144f6=_0x46cc42;_0x36edc0[_0x3144f6(0x251)]['contains']('amily2-menu-active')&&document[_0x3144f6(0x288)](_0x3144f6(0x24f),_0x33b4c3,!![]);},0x0);}function toggleColumnContextMenu(_0x27b023){const _0x3847a1=_0x308cea;_0x27b023[_0x3847a1(0x23b)](),_0x27b023[_0x3847a1(0x263)]();const _0x58a128=_0x27b023[_0x3847a1(0x1e8)]['closest']('th');if(!_0x58a128)return;const _0x52b519=_0x58a128[_0x3847a1(0x203)](_0x3847a1(0x1bf));if(!_0x52b519)return;const _0x59c9c1=_0x52b519['classList']['contains'](_0x3847a1(0x230));document[_0x3847a1(0x264)](_0x3847a1(0x1bb))[_0x3847a1(0x24b)](_0x362dbb=>{const _0x47fdee=_0x3847a1;_0x362dbb['classList']['remove'](_0x47fdee(0x230));});!_0x59c9c1&&_0x52b519[_0x3847a1(0x251)]['add']('amily2-menu-active');const _0x4cd44b=_0x39107d=>{const _0x445067=_0x3847a1;!_0x52b519['contains'](_0x39107d[_0x445067(0x1e8)])&&(_0x52b519[_0x445067(0x251)]['remove'](_0x445067(0x230)),document[_0x445067(0x248)]('click',_0x4cd44b,!![]));};setTimeout(()=>{const _0x4ba2a1=_0x3847a1;_0x52b519[_0x4ba2a1(0x251)][_0x4ba2a1(0x24c)]('amily2-menu-active')&&document[_0x4ba2a1(0x288)](_0x4ba2a1(0x24f),_0x4cd44b,!![]);},0x0);}export function renderTables(){const _0x3d1bc8=_0x308cea;let _0x17a137=_0x3fac18['getMemoryState']();!_0x17a137&&(log('内存状态为空，从聊天记录加载作为后备。',_0x3d1bc8(0x20f)),_0x17a137=_0x3fac18[_0x3d1bc8(0x238)]());const _0x558295=getAllTablesContainer();if(!_0x17a137||!_0x558295){console[_0x3d1bc8(0x250)](_0x3d1bc8(0x1ef));return;}const _0x166fdd=_0x3fac18[_0x3d1bc8(0x204)](),_0x1986cb=document[_0x3d1bc8(0x1df)](_0x3d1bc8(0x1f0));_0x1986cb&&_0x1986cb[_0x3d1bc8(0x1db)](),_0x558295[_0x3d1bc8(0x227)]='',_0x17a137[_0x3d1bc8(0x24b)]((_0x1a389f,_0x3d80c6)=>{const _0x2c67a5=_0x3d1bc8,_0x277499=document['createElement'](_0x2c67a5(0x1e1));_0x277499[_0x2c67a5(0x28b)][_0x2c67a5(0x217)]=_0x2c67a5(0x277),_0x277499[_0x2c67a5(0x28b)]['justifyContent']=_0x2c67a5(0x1c5),_0x277499[_0x2c67a5(0x28b)]['alignItems']='center';const _0x1a99f8=document[_0x2c67a5(0x1bc)]('h3');_0x1a99f8[_0x2c67a5(0x227)]='<i\x20class=\x22fas\x20fa-table\x22></i>\x20'+_0x1a389f['name'];const _0x15ee29=document['createElement']('div');_0x15ee29[_0x2c67a5(0x1b6)]=_0x2c67a5(0x293);const _0x4c40ed=_0x3d80c6>0x0?_0x2c67a5(0x266)+_0x3d80c6+_0x2c67a5(0x1bd):'',_0x566c57=_0x3d80c6<_0x17a137[_0x2c67a5(0x22f)]-0x1?_0x2c67a5(0x294)+_0x3d80c6+_0x2c67a5(0x26e):'';_0x15ee29[_0x2c67a5(0x227)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4c40ed+_0x2c67a5(0x271)+_0x566c57+_0x2c67a5(0x275)+_0x3d80c6+_0x2c67a5(0x237)+_0x3d80c6+'\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x277499[_0x2c67a5(0x1c8)](_0x1a99f8),_0x277499['appendChild'](_0x15ee29),_0x558295[_0x2c67a5(0x1c8)](_0x277499);const _0x313c8b=document[_0x2c67a5(0x1bc)](_0x2c67a5(0x1e1));_0x313c8b[_0x2c67a5(0x28b)][_0x2c67a5(0x26b)]=_0x2c67a5(0x235);const _0x56c66d=document['createElement'](_0x2c67a5(0x249));_0x56c66d['id']=_0x2c67a5(0x245)+_0x3d80c6,_0x56c66d[_0x2c67a5(0x208)][_0x2c67a5(0x1cb)]=_0x3d80c6;const _0x43435d=_0x56c66d['createTHead'](),_0x30d33d=_0x43435d['insertRow'](),_0x1f1834=document[_0x2c67a5(0x1bc)]('th');_0x1f1834[_0x2c67a5(0x1b6)]=_0x2c67a5(0x221),_0x1f1834[_0x2c67a5(0x1cc)]='#',_0x30d33d[_0x2c67a5(0x1c8)](_0x1f1834),_0x1a389f[_0x2c67a5(0x290)]['forEach']((_0x2ce623,_0x431b8f)=>{const _0x291442=_0x2c67a5,_0x2dba88=document[_0x291442(0x1bc)]('th');_0x2dba88[_0x291442(0x208)][_0x291442(0x1f5)]=_0x431b8f,_0x2dba88[_0x291442(0x28b)][_0x291442(0x1eb)]=_0x291442(0x224);const _0x4cfd42=document[_0x291442(0x1bc)]('span');_0x4cfd42[_0x291442(0x1cc)]=_0x2ce623,_0x2dba88[_0x291442(0x1c8)](_0x4cfd42);const _0x21e7fb=document[_0x291442(0x1bc)]('div');_0x21e7fb[_0x291442(0x1b6)]=_0x291442(0x210);const _0x220077=[{'label':_0x291442(0x240),'action':_0x291442(0x215),'icon':_0x291442(0x1fa)},{'label':'向右移动','action':_0x291442(0x1d6),'icon':'fa-arrow-right'},{'label':_0x291442(0x1c0),'action':_0x291442(0x23f),'icon':'fa-plus-circle'},{'label':_0x291442(0x255),'action':_0x291442(0x27c),'icon':_0x291442(0x21c)},{'label':_0x291442(0x259),'action':_0x291442(0x28e),'icon':'fa-pen'},{'label':_0x291442(0x283),'action':_0x291442(0x254),'icon':_0x291442(0x1fc),'isDanger':!![]}];_0x220077[_0x291442(0x24b)](({label:_0x3724d8,action:_0x5c714d,icon:_0x18488c,isDanger:_0x4af952})=>{const _0x10bd7e=_0x291442,_0x7a40a0=document[_0x10bd7e(0x1bc)](_0x10bd7e(0x1ed));_0x7a40a0[_0x10bd7e(0x227)]='<i\x20class=\x22fas\x20'+_0x18488c+_0x10bd7e(0x1ea)+_0x3724d8,_0x7a40a0['className']='menu_button\x20small_button';if(_0x4af952)_0x7a40a0[_0x10bd7e(0x251)]['add'](_0x10bd7e(0x1f3));_0x7a40a0[_0x10bd7e(0x288)](_0x10bd7e(0x24f),_0x2ab17e=>{const _0x48831b=_0x10bd7e;_0x2ab17e[_0x48831b(0x263)]();switch(_0x5c714d){case _0x48831b(0x215):_0x3fac18[_0x48831b(0x1ba)](_0x3d80c6,_0x431b8f,_0x48831b(0x253));break;case _0x48831b(0x1d6):_0x3fac18[_0x48831b(0x1ba)](_0x3d80c6,_0x431b8f,'right');break;case _0x48831b(0x23f):_0x3fac18['insertColumn'](_0x3d80c6,_0x431b8f,_0x48831b(0x253));break;case _0x48831b(0x27c):_0x3fac18[_0x48831b(0x1be)](_0x3d80c6,_0x431b8f,_0x48831b(0x24a));break;case _0x48831b(0x28e):const _0x530af4=prompt(_0x48831b(0x25b),_0x2ce623);_0x530af4!==null&&_0x3fac18['updateHeader'](_0x3d80c6,_0x431b8f,_0x530af4);break;case _0x48831b(0x254):confirm('您确定要删除\x20“'+_0x2ce623+_0x48831b(0x1fe))&&_0x3fac18[_0x48831b(0x1d1)](_0x3d80c6,_0x431b8f);break;}renderTables();}),_0x21e7fb[_0x10bd7e(0x1c8)](_0x7a40a0);}),_0x2dba88[_0x291442(0x1c8)](_0x21e7fb),_0x30d33d['appendChild'](_0x2dba88);});const _0x17adb9=_0x56c66d[_0x2c67a5(0x26c)]();_0x1a389f[_0x2c67a5(0x233)]&&_0x1a389f[_0x2c67a5(0x233)][_0x2c67a5(0x22f)]>0x0&&_0x1a389f[_0x2c67a5(0x233)][_0x2c67a5(0x24b)]((_0x488426,_0x109f95)=>{const _0x5831fd=_0x2c67a5,_0x18c992=_0x17adb9[_0x5831fd(0x1d0)]();_0x18c992[_0x5831fd(0x208)][_0x5831fd(0x28a)]=_0x109f95;const _0x5a2053=_0x18c992['insertCell']();_0x5a2053[_0x5831fd(0x1b6)]=_0x5831fd(0x221);const _0x57192c=document['createElement'](_0x5831fd(0x20e));_0x57192c[_0x5831fd(0x1cc)]=_0x109f95+0x1,_0x5a2053[_0x5831fd(0x1c8)](_0x57192c);const _0x844455=document[_0x5831fd(0x1bc)]('div');_0x844455[_0x5831fd(0x1b6)]=_0x5831fd(0x21d);const _0x291d49=[{'label':_0x5831fd(0x272),'action':_0x5831fd(0x1d4),'icon':'fa-arrow-up'},{'label':_0x5831fd(0x21b),'action':_0x5831fd(0x212),'icon':_0x5831fd(0x1ff)},{'label':_0x5831fd(0x214),'action':_0x5831fd(0x1d7),'icon':_0x5831fd(0x21c)},{'label':_0x5831fd(0x22e),'action':_0x5831fd(0x27a),'icon':'fa-plus-circle'},{'label':_0x5831fd(0x207),'action':'delete-row','icon':'fa-trash-alt','isDanger':!![]}];_0x291d49['forEach'](({label:_0x44e404,action:_0x3935c0,icon:_0x33f5a2,isDanger:_0x38a0ff})=>{const _0x51f506=_0x5831fd,_0x4bf033=document['createElement'](_0x51f506(0x1ed));_0x4bf033[_0x51f506(0x227)]=_0x51f506(0x295)+_0x33f5a2+_0x51f506(0x1ea)+_0x44e404,_0x4bf033[_0x51f506(0x1b6)]=_0x51f506(0x284);if(_0x38a0ff)_0x4bf033[_0x51f506(0x251)][_0x51f506(0x23d)](_0x51f506(0x1f3));_0x4bf033[_0x51f506(0x288)](_0x51f506(0x24f),_0x4dd90c=>{const _0x593be0=_0x51f506;_0x4dd90c[_0x593be0(0x263)]();switch(_0x3935c0){case'move-up':_0x3fac18[_0x593be0(0x1cf)](_0x3d80c6,_0x109f95,'up');break;case _0x593be0(0x212):_0x3fac18[_0x593be0(0x1cf)](_0x3d80c6,_0x109f95,_0x593be0(0x1e4));break;case _0x593be0(0x1d7):_0x3fac18[_0x593be0(0x1d0)](_0x3d80c6,_0x109f95,_0x593be0(0x280));break;case _0x593be0(0x27a):_0x3fac18['insertRow'](_0x3d80c6,_0x109f95,_0x593be0(0x216));break;case'delete-row':confirm('您确定要删除第\x20'+(_0x109f95+0x1)+_0x593be0(0x1ca))&&_0x3fac18['deleteRow'](_0x3d80c6,_0x109f95);break;}renderTables();}),_0x844455['appendChild'](_0x4bf033);}),_0x5a2053[_0x5831fd(0x1c8)](_0x844455),_0x488426[_0x5831fd(0x24b)]((_0x36848f,_0x48e02a)=>{const _0x40f8a8=_0x5831fd,_0x4bcf94=_0x18c992[_0x40f8a8(0x246)]();_0x4bcf94['textContent']=_0x36848f;const _0x10a6ea=()=>_0x40f8a8(0x1e2)in window||navigator['maxTouchPoints']>0x0;!_0x10a6ea()&&_0x4bcf94[_0x40f8a8(0x211)](_0x40f8a8(0x22a),_0x40f8a8(0x1ce));_0x4bcf94[_0x40f8a8(0x208)][_0x40f8a8(0x1f5)]=_0x48e02a,_0x4bcf94['dataset'][_0x40f8a8(0x21a)]=_0x1a389f[_0x40f8a8(0x290)][_0x48e02a]||'';const _0x2940f8=_0x3d80c6+'-'+_0x109f95+'-'+_0x48e02a;_0x166fdd['has'](_0x2940f8)&&_0x4bcf94[_0x40f8a8(0x251)][_0x40f8a8(0x23d)](_0x40f8a8(0x1fd));});}),_0x313c8b[_0x2c67a5(0x1c8)](_0x56c66d),_0x558295[_0x2c67a5(0x1c8)](_0x313c8b);}),_0x1986cb&&_0x558295[_0x3d1bc8(0x1c8)](_0x1986cb);}function openRuleEditor(_0x3b1ba2){const _0x3e9f84=_0x308cea,_0x24f86c=_0x3fac18['getMemoryState']();if(!_0x24f86c||!_0x24f86c[_0x3b1ba2])return;const _0x5e7f0e=_0x24f86c[_0x3b1ba2],_0x3d3718=_0x3e9f84(0x23e)+_0x5e7f0e[_0x3e9f84(0x209)]+'”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>'+(_0x5e7f0e['note']||'')+_0x3e9f84(0x222)+(_0x5e7f0e[_0x3e9f84(0x1dd)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x5e7f0e[_0x3e9f84(0x206)]||'')+_0x3e9f84(0x1f8)+(_0x5e7f0e['rule_update']||'')+_0x3e9f84(0x273),_0x54e189=$(_0x3d3718)[_0x3e9f84(0x21e)](_0x3e9f84(0x26d)),_0x174a76=()=>{const _0x8a5a41=_0x3e9f84;_0x54e189[0x0][_0x8a5a41(0x27e)](),_0x54e189[_0x8a5a41(0x1db)]();};_0x54e189[_0x3e9f84(0x232)]('.popup-button-ok')['on'](_0x3e9f84(0x24f),()=>{const _0x7031f4=_0x3e9f84,_0x439898={'note':_0x54e189['find']('#rule-note')[_0x7031f4(0x1b9)](),'rule_add':_0x54e189[_0x7031f4(0x232)](_0x7031f4(0x21f))['val'](),'rule_delete':_0x54e189[_0x7031f4(0x232)](_0x7031f4(0x1f2))['val'](),'rule_update':_0x54e189[_0x7031f4(0x232)](_0x7031f4(0x1ee))[_0x7031f4(0x1b9)]()};_0x3fac18[_0x7031f4(0x257)](_0x3b1ba2,_0x439898),_0x174a76();}),_0x54e189['find'](_0x3e9f84(0x236))['on'](_0x3e9f84(0x24f),_0x174a76),_0x54e189[0x0][_0x3e9f84(0x26a)]();}function bindInjectionSettings(){const _0x123af3=_0x308cea,_0x3bda7c=extension_settings[extensionName],_0x341f81=document['getElementById']('table-injection-enabled'),_0x5ac0b7=document[_0x123af3(0x1df)](_0x123af3(0x1f1)),_0x123420=document[_0x123af3(0x1df)](_0x123af3(0x1c1)),_0x3ba85e=document[_0x123af3(0x1df)](_0x123af3(0x1d3));if(!_0x341f81||!_0x5ac0b7||!_0x123420||!_0x3ba85e)return;const _0x5267cc=()=>{const _0x57cf4f=_0x123af3,_0x4617b1=_0x5ac0b7[_0x57cf4f(0x244)],_0x58d085=_0x4617b1==='1';_0x123420['disabled']=!_0x58d085,_0x3ba85e['disabled']=!_0x58d085;const _0x301878=_0x58d085?'1':_0x57cf4f(0x1d5);_0x123420[_0x57cf4f(0x28b)][_0x57cf4f(0x20c)]=_0x301878;_0x123420[_0x57cf4f(0x1e0)]&&(_0x123420['previousElementSibling'][_0x57cf4f(0x28b)]['opacity']=_0x301878);const _0x1b375c=_0x58d085?'1':'0.5';_0x3ba85e[_0x57cf4f(0x28b)][_0x57cf4f(0x20c)]=_0x1b375c,_0x3ba85e['previousElementSibling']&&(_0x3ba85e[_0x57cf4f(0x1e0)][_0x57cf4f(0x28b)][_0x57cf4f(0x20c)]=_0x1b375c);};_0x341f81['checked']=_0x3bda7c[_0x123af3(0x1c4)],_0x5ac0b7['value']=_0x3bda7c[_0x123af3(0x20d)],_0x123420[_0x123af3(0x244)]=_0x3bda7c[_0x123af3(0x281)],_0x3ba85e[_0x123af3(0x244)]=_0x3bda7c['table_injection_role'],_0x5267cc(),_0x341f81['addEventListener'](_0x123af3(0x22c),()=>{const _0x19e33d=_0x123af3;_0x3bda7c[_0x19e33d(0x1c4)]=_0x341f81[_0x19e33d(0x26f)],saveSettingsDebounced();}),_0x5ac0b7[_0x123af3(0x288)](_0x123af3(0x22c),()=>{const _0x665e71=_0x123af3;_0x3bda7c[_0x665e71(0x20d)]=parseInt(_0x5ac0b7[_0x665e71(0x244)],0xa),saveSettingsDebounced(),_0x5267cc();}),_0x123420[_0x123af3(0x288)]('input',()=>{const _0x32cae0=_0x123af3;_0x3bda7c['table_injection_depth']=parseInt(_0x123420[_0x32cae0(0x244)],0xa),saveSettingsDebounced();}),_0x3ba85e[_0x123af3(0x288)](_0x123af3(0x22c),()=>{const _0x207931=_0x123af3;_0x3bda7c['table_injection_role']=_0x3ba85e[_0x207931(0x244)],saveSettingsDebounced();}),log(_0x123af3(0x1f7),'success');}function updateAndSaveTableSetting(_0x3938d8,_0x1d0b54){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x3938d8]=_0x1d0b54,saveSettingsDebounced();}export function bindTableEvents(){const _0x50cd42=_0x308cea,_0x158001=document[_0x50cd42(0x1df)](_0x50cd42(0x1da));if(!_0x158001||_0x158001[_0x50cd42(0x208)]['eventsBound'])return;log(_0x50cd42(0x220),_0x50cd42(0x1de));const _0x2dec1f=_0x158001[_0x50cd42(0x264)]('input[name=\x22filling-mode\x22]'),_0x4ad0f9=()=>{const _0x16a4b8=_0x50cd42,_0x59c6b8=extension_settings[extensionName]?.[_0x16a4b8(0x1d8)]||_0x16a4b8(0x1f4);_0x2dec1f[_0x16a4b8(0x24b)](_0x2ed50c=>{const _0x18c2d8=_0x16a4b8;_0x2ed50c[_0x18c2d8(0x26f)]=_0x2ed50c[_0x18c2d8(0x244)]===_0x59c6b8;});};_0x2dec1f[_0x50cd42(0x24b)](_0x4c8197=>{const _0xe5cf3e=_0x50cd42;_0x4c8197[_0xe5cf3e(0x288)](_0xe5cf3e(0x22c),function(){const _0x1dc649=_0xe5cf3e,_0x4aa11c=this[_0x1dc649(0x244)];updateAndSaveTableSetting('filling_mode',_0x4aa11c);let _0x3d2577=_0x1dc649(0x1fb);if(_0x4aa11c==='secondary-api')_0x3d2577='分步填表';if(_0x4aa11c==='optimized')_0x3d2577=_0x1dc649(0x1f6);toastr['info'](_0x1dc649(0x1c7)+_0x3d2577+'。'),_0x4ad0f9();});}),_0x4ad0f9();const _0x2b29da=()=>{renderTables(),bindInjectionSettings();};_0x2b29da(),bindBatchFillButton(),bindTemplateEditors();const _0x1cd8a8=document['querySelector'](_0x50cd42(0x202));_0x1cd8a8&&_0x1cd8a8[_0x50cd42(0x288)](_0x50cd42(0x24f),_0x45b3e6=>{const _0x1d95ca=_0x50cd42,_0x30a4bc=_0x45b3e6[_0x1d95ca(0x1e8)][_0x1d95ca(0x1e6)](_0x1d95ca(0x1c3));if(!_0x30a4bc)return;const _0x1e5378=_0x30a4bc[_0x1d95ca(0x208)][_0x1d95ca(0x229)];if(!_0x1e5378)return;const _0x3c3fe8=_0x30a4bc[_0x1d95ca(0x1e6)](_0x1d95ca(0x25c));if(!_0x3c3fe8)return;_0x3c3fe8[_0x1d95ca(0x264)](_0x1d95ca(0x1c3))[_0x1d95ca(0x24b)](_0x3f79f4=>_0x3f79f4[_0x1d95ca(0x251)][_0x1d95ca(0x1db)](_0x1d95ca(0x201))),_0x30a4bc['classList'][_0x1d95ca(0x23d)]('active'),_0x3c3fe8[_0x1d95ca(0x264)](_0x1d95ca(0x25f))[_0x1d95ca(0x24b)](_0x2e3e56=>_0x2e3e56[_0x1d95ca(0x251)][_0x1d95ca(0x1db)](_0x1d95ca(0x201)));const _0x41b96a=_0x3c3fe8[_0x1d95ca(0x203)](_0x1d95ca(0x270)+_0x1e5378+'-tab');_0x41b96a&&_0x41b96a[_0x1d95ca(0x251)]['add'](_0x1d95ca(0x201));});const _0x580f89=document[_0x50cd42(0x1df)](_0x50cd42(0x228)),_0xe6717c=document[_0x50cd42(0x1df)](_0x50cd42(0x278)),_0x17eedb=document[_0x50cd42(0x1df)](_0x50cd42(0x234));_0x580f89&&_0x580f89[_0x50cd42(0x288)](_0x50cd42(0x24f),()=>_0x3fac18[_0x50cd42(0x1c2)]());_0xe6717c&&_0xe6717c[_0x50cd42(0x288)](_0x50cd42(0x24f),()=>_0x3fac18['exportPresetFull']());_0x17eedb&&_0x17eedb[_0x50cd42(0x288)]('click',()=>_0x3fac18[_0x50cd42(0x28f)](_0x2b29da));const _0x319c69=document[_0x50cd42(0x1df)](_0x50cd42(0x279));_0x319c69&&_0x319c69[_0x50cd42(0x288)](_0x50cd42(0x24f),()=>{const _0x57e8fb=_0x50cd42;confirm(_0x57e8fb(0x23a))&&(_0x3fac18[_0x57e8fb(0x1cd)](),_0x2b29da());});const _0x4a4a49=document[_0x50cd42(0x1df)](_0x50cd42(0x1f0));_0x4a4a49&&_0x4a4a49[_0x50cd42(0x288)](_0x50cd42(0x24f),()=>{const _0x305827=_0x50cd42,_0x10936b=prompt(_0x305827(0x285),_0x305827(0x256));_0x10936b&&_0x10936b['trim']()&&(_0x3fac18[_0x305827(0x1f9)](_0x10936b[_0x305827(0x252)]()),_0x2b29da());});const _0xc736e4=getAllTablesContainer();if(_0xc736e4){_0xc736e4[_0x50cd42(0x288)](_0x50cd42(0x24f),_0x59f083=>{const _0x33aa4d=_0x50cd42,_0x43c2fa=_0x59f083[_0x33aa4d(0x1e8)][_0x33aa4d(0x1e6)]('th');if(_0x43c2fa&&!_0x43c2fa[_0x33aa4d(0x251)]['contains'](_0x33aa4d(0x221))){toggleColumnContextMenu(_0x59f083);return;}const _0x500f75=_0x59f083[_0x33aa4d(0x1e8)]['closest'](_0x33aa4d(0x27f));if(_0x500f75){toggleRowContextMenu(_0x59f083);return;}const _0x5dff8f=_0x59f083[_0x33aa4d(0x1e8)]['closest'](_0x33aa4d(0x1ed));if(!_0x5dff8f)return;const _0x1d0cee=parseInt(_0x5dff8f['dataset'][_0x33aa4d(0x1cb)],0xa);if(_0x5dff8f[_0x33aa4d(0x225)](_0x33aa4d(0x200)))_0x3fac18[_0x33aa4d(0x1c9)](_0x1d0cee),_0x2b29da();else{if(_0x5dff8f[_0x33aa4d(0x225)](_0x33aa4d(0x268)))_0x3fac18[_0x33aa4d(0x25d)](_0x1d0cee),_0x2b29da();else{if(_0x5dff8f[_0x33aa4d(0x225)](_0x33aa4d(0x1e5))||_0x5dff8f[_0x33aa4d(0x225)](_0x33aa4d(0x213))){const _0x364e5a=_0x5dff8f['classList'][_0x33aa4d(0x24c)](_0x33aa4d(0x289))?'up':_0x33aa4d(0x1e4);_0x3fac18[_0x33aa4d(0x247)](_0x1d0cee,_0x364e5a),_0x2b29da();}else{if(_0x5dff8f[_0x33aa4d(0x225)]('.edit-rules-btn'))openRuleEditor(_0x1d0cee);else{if(_0x5dff8f['matches'](_0x33aa4d(0x265))){const _0x2c3ef3=_0x3fac18['getMemoryState'](),_0x988aef=_0x2c3ef3[_0x1d0cee]?.['name']||'未知表格';confirm(_0x33aa4d(0x242)+_0x988aef+']”\x20吗？此操作不可逆！')&&(_0x3fac18['deleteTable'](_0x1d0cee),_0x2b29da());}}}}}});const _0x59a38b=()=>'ontouchstart'in window||navigator[_0x50cd42(0x1c6)]>0x0;_0x59a38b()&&_0xc736e4['addEventListener'](_0x50cd42(0x219),_0x58a36b=>{const _0x4946cb=_0x50cd42,_0x11167d=_0x58a36b[_0x4946cb(0x1e8)]['closest']('td');_0x11167d&&_0x11167d[_0x4946cb(0x208)][_0x4946cb(0x1f5)]!==undefined&&_0x11167d[_0x4946cb(0x22b)](_0x4946cb(0x22a))!=='true'&&(_0x11167d['setAttribute'](_0x4946cb(0x22a),_0x4946cb(0x1ce)),_0x11167d[_0x4946cb(0x24e)]());}),_0xc736e4[_0x50cd42(0x288)](_0x50cd42(0x218),_0x559a66=>{const _0x2473cb=_0x50cd42,_0x2a067f=_0x559a66['target'];if(_0x2a067f[_0x2473cb(0x262)]!=='TD'||_0x2a067f[_0x2473cb(0x22b)]('contenteditable')!=='true')return;const _0x2cad57=()=>_0x2473cb(0x1e2)in window||navigator[_0x2473cb(0x1c6)]>0x0;_0x2cad57()&&_0x2a067f[_0x2473cb(0x211)](_0x2473cb(0x22a),_0x2473cb(0x291));const _0x233416=_0x2a067f[_0x2473cb(0x1e6)](_0x2473cb(0x249));if(!_0x233416)return;const _0xb13905=parseInt(_0x233416[_0x2473cb(0x208)][_0x2473cb(0x1cb)],0xa),_0x415826=parseInt(_0x2a067f[_0x2473cb(0x1e6)]('tr')[_0x2473cb(0x208)][_0x2473cb(0x28a)],0xa),_0x525872=parseInt(_0x2a067f['dataset'][_0x2473cb(0x1f5)],0xa),_0x526ae5=_0x2a067f['textContent'];_0x3fac18[_0x2473cb(0x282)](_0xb13905,_0x415826,_0x525872);const _0x5d3d3f={[_0x525872]:_0x526ae5};_0x3fac18[_0x2473cb(0x28d)](_0xb13905,_0x415826,_0x5d3d3f),_0x2b29da();},!![]);}_0x158001[_0x50cd42(0x208)][_0x50cd42(0x1dc)]='true',log(_0x50cd42(0x1e9),_0x50cd42(0x1d2));}function bindBatchFillButton(){const _0x4b4ee9=_0x308cea,_0x66e46a=document[_0x4b4ee9(0x1df)](_0x4b4ee9(0x22d));if(_0x66e46a){if(_0x66e46a[_0x4b4ee9(0x208)][_0x4b4ee9(0x205)])return;_0x66e46a[_0x4b4ee9(0x288)](_0x4b4ee9(0x24f),startBatchFilling),_0x66e46a['dataset'][_0x4b4ee9(0x205)]='true',log(_0x4b4ee9(0x239),_0x4b4ee9(0x1d2));}}function bindTemplateEditors(){const _0xeec46d=_0x308cea,_0x505106=document[_0xeec46d(0x1df)](_0xeec46d(0x267)),_0x3c491b=document['getElementById']('ai-rule-template-save-btn'),_0x2e9d54=document[_0xeec46d(0x1df)](_0xeec46d(0x226)),_0x3c2538=document[_0xeec46d(0x1df)](_0xeec46d(0x28c)),_0x2e1a21=document[_0xeec46d(0x1df)](_0xeec46d(0x27d)),_0x274844=document['getElementById'](_0xeec46d(0x1ec));if(!_0x505106||!_0x3c2538){log(_0xeec46d(0x241),'warn');return;}_0x505106[_0xeec46d(0x244)]=_0x3fac18['getBatchFillerRuleTemplate'](),_0x3c2538['value']=_0x3fac18[_0xeec46d(0x269)](),_0x3c491b['addEventListener'](_0xeec46d(0x24f),()=>{const _0x118d9b=_0xeec46d;_0x3fac18[_0x118d9b(0x1d9)](_0x505106[_0x118d9b(0x244)]),toastr[_0x118d9b(0x1d2)](_0x118d9b(0x1b5)),log(_0x118d9b(0x274),_0x118d9b(0x1d2));}),_0x2e1a21['addEventListener'](_0xeec46d(0x24f),()=>{const _0x783893=_0xeec46d;_0x3fac18[_0x783893(0x25e)](_0x3c2538[_0x783893(0x244)]),toastr[_0x783893(0x1d2)](_0x783893(0x258)),log(_0x783893(0x1b8),_0x783893(0x1d2));}),_0x2e9d54[_0xeec46d(0x288)](_0xeec46d(0x24f),()=>{const _0x2d0c9a=_0xeec46d;confirm(_0x2d0c9a(0x24d))&&(_0x505106[_0x2d0c9a(0x244)]=DEFAULT_AI_RULE_TEMPLATE,_0x3fac18[_0x2d0c9a(0x1d9)](_0x505106['value']),toastr[_0x2d0c9a(0x1de)](_0x2d0c9a(0x292)),log('批量填表-规则提示词已恢复默认。',_0x2d0c9a(0x1de)));}),_0x274844['addEventListener'](_0xeec46d(0x24f),()=>{const _0x3a9588=_0xeec46d;confirm(_0x3a9588(0x260))&&(_0x3c2538[_0x3a9588(0x244)]=DEFAULT_AI_FLOW_TEMPLATE,_0x3fac18[_0x3a9588(0x25e)](_0x3c2538[_0x3a9588(0x244)]),toastr[_0x3a9588(0x1de)](_0x3a9588(0x27b)),log(_0x3a9588(0x1e7),_0x3a9588(0x1de)));}),log(_0xeec46d(0x276),'success');}
