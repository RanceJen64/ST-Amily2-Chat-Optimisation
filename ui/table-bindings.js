const _0x12a6f7=_0x162a;(function(_0x29f88c,_0x463645){const _0x5eecc2=_0x162a,_0x532063=_0x29f88c();while(!![]){try{const _0x1ce0d8=parseInt(_0x5eecc2(0x92))/0x1*(-parseInt(_0x5eecc2(0x114))/0x2)+parseInt(_0x5eecc2(0x8a))/0x3*(parseInt(_0x5eecc2(0x149))/0x4)+-parseInt(_0x5eecc2(0x136))/0x5*(-parseInt(_0x5eecc2(0xd0))/0x6)+-parseInt(_0x5eecc2(0x17d))/0x7*(-parseInt(_0x5eecc2(0xd6))/0x8)+-parseInt(_0x5eecc2(0x93))/0x9*(parseInt(_0x5eecc2(0x11f))/0xa)+-parseInt(_0x5eecc2(0x125))/0xb+parseInt(_0x5eecc2(0x9b))/0xc*(parseInt(_0x5eecc2(0x83))/0xd);if(_0x1ce0d8===_0x463645)break;else _0x532063['push'](_0x532063['shift']());}catch(_0xe73a6c){_0x532063['push'](_0x532063['shift']());}}}(_0x5112,0x32dec));import*as _0x19e661 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';function _0x162a(_0x5dafa5,_0x4c0e8e){const _0x5112da=_0x5112();return _0x162a=function(_0x162a77,_0x305148){_0x162a77=_0x162a77-0x83;let _0x4ebef1=_0x5112da[_0x162a77];return _0x4ebef1;},_0x162a(_0x5dafa5,_0x4c0e8e);}import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x12a6f7(0x16b)]('all-tables-container');function toggleRowContextMenu(_0x481405){const _0x267ef7=_0x12a6f7;_0x481405[_0x267ef7(0xb0)](),_0x481405[_0x267ef7(0xbb)]();const _0x54119a=_0x481405[_0x267ef7(0xef)][_0x267ef7(0x158)]('td.index-col');if(!_0x54119a)return;const _0x1ba2fd=_0x54119a[_0x267ef7(0xc7)](_0x267ef7(0x162));if(!_0x1ba2fd)return;const _0x1d4def=_0x1ba2fd[_0x267ef7(0x96)][_0x267ef7(0x166)](_0x267ef7(0xdb));document['querySelectorAll'](_0x267ef7(0xbe))['forEach'](_0x1da793=>{const _0x43f6da=_0x267ef7;_0x1da793['classList']['remove'](_0x43f6da(0xdb));});!_0x1d4def&&_0x1ba2fd['classList'][_0x267ef7(0x13a)]('amily2-menu-active');const _0x43c616=_0x1cd6c3=>{const _0xfe143a=_0x267ef7;!_0x1ba2fd['contains'](_0x1cd6c3['target'])&&(_0x1ba2fd[_0xfe143a(0x96)]['remove'](_0xfe143a(0xdb)),document['removeEventListener'](_0xfe143a(0x17f),_0x43c616,!![]));};setTimeout(()=>{const _0x39a274=_0x267ef7;_0x1ba2fd[_0x39a274(0x96)][_0x39a274(0x166)](_0x39a274(0xdb))&&document[_0x39a274(0xe2)](_0x39a274(0x17f),_0x43c616,!![]);},0x0);}function _0x5112(){const _0x43177f=['false','1145716ESxCcq','trim','moveTable','rule_update','overflowY','change','appendTo','insertRow','fill-table-now-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20编辑列名\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>列名：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22column-name-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','.sinan-nav-item','getMemoryState','opacity','select','block','closest','auto','position','批量填表-规则提示词已恢复默认。','deleteRow','remove','#rule-note','showModal','right','name','.amily2-context-menu','colIndex','length','amily2-import-preset-btn','contains','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','index-col','.add-col-btn','.edit-rules-btn','getElementById','#sinan-','addHighlight','getHighlights','编辑列名','已启用','amily2-clear-all-tables-btn','向上移动','input[name=\x22filling-mode\x22]','\x22></i>\x20','删除该列','createElement','previousElementSibling','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','maxTouchPoints','appendChild','insertColumn','down','652603BMnCfi','您确定要将流程提示词恢复为默认设置吗？','click','新表格','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','767YBPecU','depth','overflowX','move-down','add-below','table-injection-depth','”\x20列吗？','3QpBpmE','#rule-delete','.settings-group','div[style*=\x22overflowX\x22]','ai-rule-template-editor','向左移动','forEach','className','11409JyJMJr','1745865mCALqN','innerHTML','填表模式已切换为\x20','classList','在下加行','批量填表-流程提示词已保存。','向右移动','.move-table-down-btn','18012tBTnnh','cell-highlight','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','amily2-export-preset-full-btn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','danger','cursor','justifyContent','top','flex','.popup-button-ok','fa-arrow-left','display','table_injection_enabled','.hly-scroll','active','table-injection-enabled','\x22立即填表\x22按钮已成功绑定。','has','moveColumn','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','preventDefault','rule_add','deleteTable','bottom','您确定要删除第\x20','2px','ai-flow-template-save-btn','value','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','您确定要将规则提示词恢复为默认设置吗？','批量填表-规则提示词已保存。','stopPropagation','amily2-export-preset-btn','流程提示词已保存。','.amily2-context-menu.amily2-menu-active','marginBottom','label','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','find','button','指令模板编辑器已成功绑定。','dblclick','div','querySelector','importPreset','rows','keydown','table_system_enabled','未知表格','fa-plus-circle','matches','ai-flow-template-editor','6KqbXlA','delete-row','删除该行','focus','move-left','tableIndex','16yqtqne','.move-table-up-btn','在右加列','列名不能为空！','marginTop','amily2-menu-active','ai-flow-template-restore-btn','removeEventListener','您确定要删除\x20“','内存状态为空，从聊天记录加载作为后备。','表格系统总开关已关闭，请先启用总开关。','secondary-api','addEventListener','add-left','fa-trash-alt','delete','流程提示词已恢复为默认。','.radio-group','maxHeight','rule_delete','table-role-system','amily2-table-','开始为表格视图绑定交互事件...','dataset','alignItems','target','100%','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','move-up','在上加行','表格系统总开关','input','disabled','批量填表-流程提示词已恢复默认。','close','checked','main-api','span','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','#rule-update','列名已更新为\x20\x22','val','table-system-master-switch','innerHeight','warn','center','#column-name-input','rename','left','.control-block-with-switch','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','amily2-context-menu','0.5','getAttribute','tagName','success','fa-arrow-down','table-controls','setAttribute','querySelectorAll','ontouchstart','body','16dvPcbS','true','keypress','add-above','filling_mode','move-right','role','.sinan-tab-pane','updateRow','info','已禁用','10tAomIG','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','textContent','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','max','add-table-placeholder','2472635vtvNdG','createTHead','向下移动','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','below','moveRow','injection','amily2-menu-open','.popup-button-cancel','batchEventBound','优化中填表','fa-arrow-right','menu_button\x20small_button','contenteditable','exportPresetFull','headers','warning','784800epbLZh',']”\x20吗？此操作不可逆！','error','amily2-context-menu\x20amily2-row-context-menu','add','input[name=\x22table-injection-role\x22]','width','getBoundingClientRect','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','exportPreset','table','无法找到指令模板编辑器，绑定失败。','10000','表格注入设置已成功绑定。','table-injection-position','clearAllTables','style','add-right'];_0x5112=function(){return _0x43177f;};return _0x5112();}function toggleColumnContextMenu(_0x45bc56){const _0x31b157=_0x12a6f7;_0x45bc56[_0x31b157(0xb0)](),_0x45bc56[_0x31b157(0xbb)]();const _0x43375b=_0x45bc56[_0x31b157(0xef)][_0x31b157(0x158)]('th');if(!_0x43375b)return;const _0x2c8426=_0x43375b['classList']['contains'](_0x31b157(0x12c));document['querySelectorAll']('th.amily2-menu-open')['forEach'](_0x15b846=>{const _0x413faf=_0x31b157;_0x15b846[_0x413faf(0x96)][_0x413faf(0x15d)](_0x413faf(0x12c));});!_0x2c8426&&_0x43375b[_0x31b157(0x96)][_0x31b157(0x13a)]('amily2-menu-open');const _0x1ccb18=_0x30dd85=>{const _0x36f2f3=_0x31b157;!_0x43375b['contains'](_0x30dd85['target'])&&(_0x43375b[_0x36f2f3(0x96)][_0x36f2f3(0x15d)](_0x36f2f3(0x12c)),document[_0x36f2f3(0xdd)](_0x36f2f3(0x17f),_0x1ccb18,!![]));};setTimeout(()=>{const _0x4b33e5=_0x31b157;_0x43375b[_0x4b33e5(0x96)][_0x4b33e5(0x166)](_0x4b33e5(0x12c))&&document[_0x4b33e5(0xe2)]('click',_0x1ccb18,!![]);},0x0);}function showColumnNameEditor(_0xc9605f,_0x278c34,_0x573aed){const _0x2dc5cf=_0x12a6f7,_0x1ca980=_0x2dc5cf(0x152)+_0x573aed+'\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入列名...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：列名将用于标识此列的内容</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x4446fa=$(_0x1ca980)[_0x2dc5cf(0x14f)](_0x2dc5cf(0x113)),_0x2380ea=_0x4446fa[_0x2dc5cf(0xc2)](_0x2dc5cf(0x104)),_0x27f83b=()=>{const _0xe7185d=_0x2dc5cf;_0x4446fa[0x0][_0xe7185d(0xf8)](),_0x4446fa[_0xe7185d(0x15d)]();};_0x4446fa['find'](_0x2dc5cf(0xa5))['on'](_0x2dc5cf(0x17f),()=>{const _0x36dbe1=_0x2dc5cf,_0xeb2898=_0x2380ea[_0x36dbe1(0xff)]()[_0x36dbe1(0x14a)]();if(_0xeb2898&&_0xeb2898!==_0x573aed)_0x19e661['updateHeader'](_0xc9605f,_0x278c34,_0xeb2898),renderTables(),toastr[_0x36dbe1(0x10d)](_0x36dbe1(0xfe)+_0xeb2898+'\x22');else{if(!_0xeb2898){toastr[_0x36dbe1(0x135)](_0x36dbe1(0xd9)),_0x2380ea[_0x36dbe1(0xd3)]();return;}}_0x27f83b();}),_0x4446fa[_0x2dc5cf(0xc2)](_0x2dc5cf(0x12d))['on'](_0x2dc5cf(0x17f),_0x27f83b),_0x2380ea['on'](_0x2dc5cf(0x116),_0x12aa0e=>{const _0x33aaa8=_0x2dc5cf;_0x12aa0e['which']===0xd&&_0x4446fa[_0x33aaa8(0xc2)](_0x33aaa8(0xa5))[_0x33aaa8(0x17f)]();}),_0x2380ea['on'](_0x2dc5cf(0xca),_0x4769db=>{_0x4769db['which']===0x1b&&_0x27f83b();}),_0x4446fa[0x0][_0x2dc5cf(0x15f)](),_0x2380ea[_0x2dc5cf(0xd3)]()[_0x2dc5cf(0x156)]();}function positionContextMenu(_0x10b762,_0x4d17e2){const _0x1b0749=_0x12a6f7;_0x10b762['style'][_0x1b0749(0x15a)]='absolute',_0x10b762['style']['zIndex']=_0x1b0749(0x142),_0x10b762[_0x1b0749(0x146)][_0x1b0749(0x106)]='0',_0x10b762['style'][_0x1b0749(0x160)]=_0x1b0749(0x159),_0x10b762[_0x1b0749(0x146)][_0x1b0749(0xda)]='',_0x10b762[_0x1b0749(0x146)]['marginBottom']='',_0x10b762['style'][_0x1b0749(0xe8)]='',_0x10b762[_0x1b0749(0x146)][_0x1b0749(0x14d)]='';const _0x5bcd13=window[_0x1b0749(0x101)],_0x2f04b9=_0x4d17e2[_0x1b0749(0x13d)](),_0x24fd74=0xc8,_0x18afaa=_0x4d17e2[_0x1b0749(0x158)](_0x1b0749(0xa9)),_0x1fe61e=_0x18afaa?_0x18afaa[_0x1b0749(0x13d)]():{'top':0x0,'bottom':_0x5bcd13},_0x382e5b=Math['min'](_0x5bcd13,_0x1fe61e['bottom'])-_0x2f04b9[_0x1b0749(0xb3)],_0x4350fe=_0x2f04b9[_0x1b0749(0xa3)]-Math[_0x1b0749(0x123)](0x0,_0x1fe61e[_0x1b0749(0xa3)]);_0x382e5b<_0x24fd74&&_0x4350fe>_0x382e5b?(_0x10b762[_0x1b0749(0x146)][_0x1b0749(0xa3)]=_0x1b0749(0x159),_0x10b762['style'][_0x1b0749(0xb3)]=_0x1b0749(0xf0),_0x10b762[_0x1b0749(0x146)][_0x1b0749(0xbf)]=_0x1b0749(0xb5)):(_0x10b762[_0x1b0749(0x146)][_0x1b0749(0xa3)]=_0x1b0749(0xf0),_0x10b762[_0x1b0749(0x146)][_0x1b0749(0xb3)]=_0x1b0749(0x159),_0x10b762['style'][_0x1b0749(0xda)]=_0x1b0749(0xb5));const _0x299ab5=0xa0,_0x35b300=_0x4d17e2[_0x1b0749(0x158)]('table'),_0x41dbe5=_0x35b300?_0x35b300['closest'](_0x1b0749(0x8d)):null;if(_0x41dbe5){const _0x19b6b0=_0x41dbe5[_0x1b0749(0x13d)](),_0x458d2d=_0x2f04b9[_0x1b0749(0x106)]-_0x19b6b0[_0x1b0749(0x106)];_0x458d2d+_0x299ab5>_0x19b6b0[_0x1b0749(0x13c)]-0x14&&(_0x10b762[_0x1b0749(0x146)][_0x1b0749(0x106)]=_0x1b0749(0x159),_0x10b762[_0x1b0749(0x146)][_0x1b0749(0x160)]='0');}}export function renderTables(){const _0x17c3aa=_0x12a6f7;let _0x3d05c2=_0x19e661[_0x17c3aa(0x154)]();!_0x3d05c2&&(log(_0x17c3aa(0xdf),_0x17c3aa(0x102)),_0x3d05c2=_0x19e661['loadTables']());const _0x3feb94=getAllTablesContainer();if(!_0x3d05c2||!_0x3feb94){console[_0x17c3aa(0x138)](_0x17c3aa(0x13e));return;}const _0x102d8e=_0x19e661[_0x17c3aa(0x16e)](),_0x2a134a=document[_0x17c3aa(0x16b)]('add-table-placeholder');_0x2a134a&&_0x2a134a[_0x17c3aa(0x15d)](),_0x3feb94[_0x17c3aa(0x94)]='',_0x3d05c2['forEach']((_0x4b5c4c,_0x15fb11)=>{const _0x4c52f8=_0x17c3aa,_0x4e1ae7=document[_0x4c52f8(0x176)]('div');_0x4e1ae7[_0x4c52f8(0x146)][_0x4c52f8(0xa7)]=_0x4c52f8(0xa4),_0x4e1ae7['style'][_0x4c52f8(0xa2)]='space-between',_0x4e1ae7['style'][_0x4c52f8(0xee)]=_0x4c52f8(0x103);const _0x132b82=document[_0x4c52f8(0x176)]('h3');_0x132b82[_0x4c52f8(0x94)]=_0x4c52f8(0xaf)+_0x4b5c4c[_0x4c52f8(0x161)];const _0x3d4935=document[_0x4c52f8(0x176)]('div');_0x3d4935[_0x4c52f8(0x91)]=_0x4c52f8(0x10f);const _0x3070c9=_0x15fb11>0x0?_0x4c52f8(0x178)+_0x15fb11+'\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>':'',_0x12458f=_0x15fb11<_0x3d05c2[_0x4c52f8(0x164)]-0x1?_0x4c52f8(0xf1)+_0x15fb11+_0x4c52f8(0xc1):'';_0x3d4935[_0x4c52f8(0x94)]=_0x4c52f8(0xb8)+_0x3070c9+_0x4c52f8(0xb8)+_0x12458f+_0x4c52f8(0x128)+_0x15fb11+_0x4c52f8(0x120)+_0x15fb11+_0x4c52f8(0x9d),_0x4e1ae7['appendChild'](_0x132b82),_0x4e1ae7[_0x4c52f8(0x17a)](_0x3d4935),_0x3feb94[_0x4c52f8(0x17a)](_0x4e1ae7);const _0x27ccff=document[_0x4c52f8(0x176)](_0x4c52f8(0x140));_0x27ccff['style'][_0x4c52f8(0xa7)]=_0x4c52f8(0x157),_0x27ccff['style'][_0x4c52f8(0x85)]=_0x4c52f8(0x159),_0x27ccff['id']=_0x4c52f8(0xeb)+_0x15fb11,_0x27ccff[_0x4c52f8(0xed)][_0x4c52f8(0xd5)]=_0x15fb11;const _0x15f82d=_0x27ccff[_0x4c52f8(0x126)](),_0x512df4=_0x15f82d[_0x4c52f8(0x150)](),_0x1d8278=document[_0x4c52f8(0x176)]('th');_0x1d8278[_0x4c52f8(0x91)]='index-col',_0x1d8278[_0x4c52f8(0x121)]='#',_0x512df4['appendChild'](_0x1d8278),_0x4b5c4c[_0x4c52f8(0x134)][_0x4c52f8(0x90)]((_0x2759de,_0x2d055d)=>{const _0x34655f=_0x4c52f8,_0x4f6107=document[_0x34655f(0x176)]('th');_0x4f6107['dataset'][_0x34655f(0x163)]=_0x2d055d,_0x4f6107[_0x34655f(0x146)][_0x34655f(0xa1)]='pointer';const _0x28ca8d=document[_0x34655f(0x176)](_0x34655f(0xfb));_0x28ca8d[_0x34655f(0x91)]='amily2-header-text',_0x28ca8d[_0x34655f(0x121)]=_0x2759de,_0x4f6107['appendChild'](_0x28ca8d);const _0x9b8d6b=document['createElement'](_0x34655f(0xc6));_0x9b8d6b[_0x34655f(0x91)]=_0x34655f(0x109);const _0xaa0e2d=[{'label':_0x34655f(0x8f),'action':_0x34655f(0xd4),'icon':_0x34655f(0xa6)},{'label':_0x34655f(0x99),'action':_0x34655f(0x119),'icon':_0x34655f(0x130)},{'label':'在左加列','action':_0x34655f(0xe3),'icon':'fa-plus-circle'},{'label':_0x34655f(0xd8),'action':_0x34655f(0x147),'icon':_0x34655f(0xcd)},{'label':_0x34655f(0x16f),'action':_0x34655f(0x105),'icon':'fa-pen'},{'label':_0x34655f(0x175),'action':'delete','icon':'fa-trash-alt','isDanger':!![]}];_0xaa0e2d[_0x34655f(0x90)](({label:_0x2fbd86,action:_0x489b3b,icon:_0x59cd41,isDanger:_0x26b768})=>{const _0x2cb0dc=_0x34655f,_0x3ba870=document[_0x2cb0dc(0x176)](_0x2cb0dc(0xc3));_0x3ba870['textContent']=_0x2fbd86,_0x3ba870[_0x2cb0dc(0x91)]=_0x2cb0dc(0x131);if(_0x26b768)_0x3ba870['classList'][_0x2cb0dc(0x13a)]('danger');_0x3ba870[_0x2cb0dc(0xe2)](_0x2cb0dc(0x17f),_0x38e45a=>{const _0xe7fa43=_0x2cb0dc;_0x38e45a[_0xe7fa43(0xbb)]();switch(_0x489b3b){case _0xe7fa43(0xd4):_0x19e661[_0xe7fa43(0xae)](_0x15fb11,_0x2d055d,_0xe7fa43(0x106));break;case _0xe7fa43(0x119):_0x19e661[_0xe7fa43(0xae)](_0x15fb11,_0x2d055d,'right');break;case _0xe7fa43(0xe3):_0x19e661[_0xe7fa43(0x17b)](_0x15fb11,_0x2d055d,_0xe7fa43(0x106));break;case'add-right':_0x19e661['insertColumn'](_0x15fb11,_0x2d055d,_0xe7fa43(0x160));break;case'rename':showColumnNameEditor(_0x15fb11,_0x2d055d,_0x2759de);break;case _0xe7fa43(0xe5):confirm(_0xe7fa43(0xde)+_0x2759de+_0xe7fa43(0x89))&&_0x19e661['deleteColumn'](_0x15fb11,_0x2d055d);break;}renderTables();}),_0x9b8d6b[_0x2cb0dc(0x17a)](_0x3ba870);}),_0x4f6107[_0x34655f(0x17a)](_0x9b8d6b),_0x512df4['appendChild'](_0x4f6107);});const _0x4488c3=_0x27ccff['createTBody']();_0x4b5c4c[_0x4c52f8(0xc9)]&&_0x4b5c4c[_0x4c52f8(0xc9)][_0x4c52f8(0x164)]>0x0&&_0x4b5c4c[_0x4c52f8(0xc9)][_0x4c52f8(0x90)]((_0x3baf67,_0x11d466)=>{const _0x1670ea=_0x4c52f8,_0x371564=_0x4488c3['insertRow']();_0x371564[_0x1670ea(0xed)]['rowIndex']=_0x11d466;const _0x2b7dbd=_0x371564['insertCell']();_0x2b7dbd[_0x1670ea(0x91)]='index-col';const _0x1321f1=document[_0x1670ea(0x176)](_0x1670ea(0xfb));_0x1321f1[_0x1670ea(0x121)]=_0x11d466+0x1,_0x2b7dbd['appendChild'](_0x1321f1);const _0x33252c=document[_0x1670ea(0x176)]('div');_0x33252c[_0x1670ea(0x91)]=_0x1670ea(0x139);const _0x5ac4af=[{'label':_0x1670ea(0x172),'action':_0x1670ea(0xf2),'icon':'fa-arrow-up'},{'label':_0x1670ea(0x127),'action':'move-down','icon':_0x1670ea(0x10e)},{'label':_0x1670ea(0xf3),'action':_0x1670ea(0x117),'icon':'fa-plus-circle'},{'label':_0x1670ea(0x97),'action':_0x1670ea(0x87),'icon':_0x1670ea(0xcd)},{'label':_0x1670ea(0xd2),'action':'delete-row','icon':_0x1670ea(0xe4),'isDanger':!![]}];_0x5ac4af[_0x1670ea(0x90)](({label:_0x4cca35,action:_0x5bcf1f,icon:_0x5c71d2,isDanger:_0x1713cd})=>{const _0x1d0305=_0x1670ea,_0x5e8246=document[_0x1d0305(0x176)](_0x1d0305(0xc3));_0x5e8246[_0x1d0305(0x94)]='<i\x20class=\x22fas\x20'+_0x5c71d2+_0x1d0305(0x174)+_0x4cca35,_0x5e8246['className']=_0x1d0305(0x131);if(_0x1713cd)_0x5e8246['classList'][_0x1d0305(0x13a)](_0x1d0305(0xa0));_0x5e8246['addEventListener'](_0x1d0305(0x17f),_0x1f0905=>{const _0x516f98=_0x1d0305;_0x1f0905[_0x516f98(0xbb)]();switch(_0x5bcf1f){case _0x516f98(0xf2):_0x19e661[_0x516f98(0x12a)](_0x15fb11,_0x11d466,'up');break;case _0x516f98(0x86):_0x19e661[_0x516f98(0x12a)](_0x15fb11,_0x11d466,_0x516f98(0x17c));break;case _0x516f98(0x117):_0x19e661[_0x516f98(0x150)](_0x15fb11,_0x11d466,'above');break;case _0x516f98(0x87):_0x19e661[_0x516f98(0x150)](_0x15fb11,_0x11d466,_0x516f98(0x129));break;case _0x516f98(0xd1):confirm(_0x516f98(0xb4)+(_0x11d466+0x1)+'\x20行吗？')&&_0x19e661[_0x516f98(0x15c)](_0x15fb11,_0x11d466);break;}renderTables();}),_0x33252c[_0x1d0305(0x17a)](_0x5e8246);}),_0x2b7dbd[_0x1670ea(0x17a)](_0x33252c),_0x3baf67[_0x1670ea(0x90)]((_0x6835cd,_0xbed976)=>{const _0x13c8e3=_0x1670ea,_0x74552e=_0x371564['insertCell']();_0x74552e['textContent']=_0x6835cd;const _0x2d7ee0=()=>'ontouchstart'in window||navigator[_0x13c8e3(0x179)]>0x0;!_0x2d7ee0()&&_0x74552e[_0x13c8e3(0x110)](_0x13c8e3(0x132),'true');_0x74552e['dataset'][_0x13c8e3(0x163)]=_0xbed976,_0x74552e[_0x13c8e3(0xed)][_0x13c8e3(0xc0)]=_0x4b5c4c['headers'][_0xbed976]||'';const _0x2c7bc2=_0x15fb11+'-'+_0x11d466+'-'+_0xbed976;_0x102d8e[_0x13c8e3(0xad)](_0x2c7bc2)&&_0x74552e[_0x13c8e3(0x96)][_0x13c8e3(0x13a)](_0x13c8e3(0x9c));});}),_0x3feb94[_0x4c52f8(0x17a)](_0x27ccff);}),_0x2a134a&&_0x3feb94[_0x17c3aa(0x17a)](_0x2a134a);}function openRuleEditor(_0x232be1){const _0x145603=_0x12a6f7,_0xe82c16=_0x19e661['getMemoryState']();if(!_0xe82c16||!_0xe82c16[_0x232be1])return;const _0x17a3de=_0xe82c16[_0x232be1],_0x43d223='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'+_0x17a3de[_0x145603(0x161)]+_0x145603(0xfc)+(_0x17a3de['note']||'')+_0x145603(0x181)+(_0x17a3de[_0x145603(0xb1)]||'')+_0x145603(0x9f)+(_0x17a3de[_0x145603(0xe9)]||'')+_0x145603(0x122)+(_0x17a3de[_0x145603(0x14c)]||'')+_0x145603(0x108),_0x13bbe0=$(_0x43d223)[_0x145603(0x14f)]('body'),_0x4a8f8d=()=>{const _0xfa5ee8=_0x145603;_0x13bbe0[0x0][_0xfa5ee8(0xf8)](),_0x13bbe0['remove']();};_0x13bbe0[_0x145603(0xc2)](_0x145603(0xa5))['on'](_0x145603(0x17f),()=>{const _0x429d34=_0x145603,_0x501f5c={'note':_0x13bbe0[_0x429d34(0xc2)](_0x429d34(0x15e))[_0x429d34(0xff)](),'rule_add':_0x13bbe0['find']('#rule-add')[_0x429d34(0xff)](),'rule_delete':_0x13bbe0[_0x429d34(0xc2)](_0x429d34(0x8b))[_0x429d34(0xff)](),'rule_update':_0x13bbe0[_0x429d34(0xc2)](_0x429d34(0xfd))[_0x429d34(0xff)]()};_0x19e661['updateTableRules'](_0x232be1,_0x501f5c),_0x4a8f8d();}),_0x13bbe0[_0x145603(0xc2)](_0x145603(0x12d))['on'](_0x145603(0x17f),_0x4a8f8d),_0x13bbe0[0x0]['showModal']();}function bindInjectionSettings(){const _0x4a65c3=_0x12a6f7,_0x4a9180=extension_settings[extensionName],_0x13a4d6=document[_0x4a65c3(0x16b)](_0x4a65c3(0x100)),_0x107c1f=document[_0x4a65c3(0x16b)](_0x4a65c3(0xab)),_0x314ce4=document[_0x4a65c3(0x16b)](_0x4a65c3(0x144)),_0x149f10=document['getElementById'](_0x4a65c3(0x88)),_0x3a00c4=document[_0x4a65c3(0x111)](_0x4a65c3(0x13b));if(!_0x13a4d6||!_0x107c1f||!_0x314ce4||!_0x149f10||!_0x3a00c4[_0x4a65c3(0x164)])return;const _0x4209bb=()=>{const _0x4ffe09=_0x4a65c3,_0x33f043=_0x314ce4[_0x4ffe09(0xb7)],_0x17093c=_0x13a4d6[_0x4ffe09(0xf9)],_0x3d0a98=_0x33f043==='1';_0x107c1f[_0x4ffe09(0xf6)]=!_0x17093c,_0x314ce4[_0x4ffe09(0xf6)]=!_0x17093c,_0x149f10['disabled']=!_0x17093c||!_0x3d0a98,_0x3a00c4['forEach'](_0x306d5e=>_0x306d5e[_0x4ffe09(0xf6)]=!_0x17093c||!_0x3d0a98);const _0x16648f=_0x17093c?'1':_0x4ffe09(0x10a);_0x107c1f[_0x4ffe09(0x146)][_0x4ffe09(0x155)]=_0x16648f;_0x107c1f[_0x4ffe09(0x158)](_0x4ffe09(0x107))&&(_0x107c1f['closest'](_0x4ffe09(0x107))['style'][_0x4ffe09(0x155)]=_0x16648f);_0x314ce4[_0x4ffe09(0x146)]['opacity']=_0x16648f;_0x314ce4[_0x4ffe09(0x177)]&&(_0x314ce4[_0x4ffe09(0x177)]['style'][_0x4ffe09(0x155)]=_0x16648f);const _0x1e75d9=_0x17093c&&_0x3d0a98?'1':'0.5';_0x149f10[_0x4ffe09(0x146)]['opacity']=_0x1e75d9;_0x149f10['previousElementSibling']&&(_0x149f10[_0x4ffe09(0x177)][_0x4ffe09(0x146)][_0x4ffe09(0x155)]=_0x1e75d9);const _0x434274=_0x17093c&&_0x3d0a98?'1':_0x4ffe09(0x10a),_0x54d8fb=document['getElementById'](_0x4ffe09(0xea))?.['closest'](_0x4ffe09(0xe7));_0x54d8fb&&(_0x54d8fb['style'][_0x4ffe09(0x155)]=_0x434274,_0x54d8fb[_0x4ffe09(0x177)]&&(_0x54d8fb[_0x4ffe09(0x177)][_0x4ffe09(0x146)]['opacity']=_0x434274));const _0x1ea480=document[_0x4ffe09(0x111)](_0x4ffe09(0x173));_0x1ea480[_0x4ffe09(0x90)](_0x581cb5=>{const _0x3e639e=_0x4ffe09;_0x581cb5[_0x3e639e(0xf6)]=!_0x17093c;const _0x2fafd7=_0x581cb5[_0x3e639e(0x158)](_0x3e639e(0xc0));_0x2fafd7&&(_0x2fafd7[_0x3e639e(0x146)][_0x3e639e(0x155)]=_0x17093c?'1':_0x3e639e(0x10a));});const _0x3487b1=document[_0x4ffe09(0x16b)](_0x4ffe09(0x151));_0x3487b1&&(_0x3487b1[_0x4ffe09(0xf6)]=!_0x17093c,_0x3487b1[_0x4ffe09(0x146)][_0x4ffe09(0x155)]=_0x17093c?'1':'0.5');};_0x13a4d6['checked']=_0x4a9180[_0x4a65c3(0xcb)]!==![],_0x107c1f[_0x4a65c3(0xf9)]=_0x4a9180[_0x4a65c3(0xa8)],_0x314ce4[_0x4a65c3(0xb7)]=_0x4a9180[_0x4a65c3(0x12b)]['position'],_0x149f10[_0x4a65c3(0xb7)]=_0x4a9180[_0x4a65c3(0x12b)][_0x4a65c3(0x84)],_0x3a00c4['forEach'](_0x189063=>{const _0x12d6dd=_0x4a65c3;parseInt(_0x189063[_0x12d6dd(0xb7)],0xa)===_0x4a9180['injection']['role']&&(_0x189063[_0x12d6dd(0xf9)]=!![]);}),_0x4209bb(),_0x13a4d6[_0x4a65c3(0xe2)](_0x4a65c3(0x14e),()=>{const _0x3cb162=_0x4a65c3;_0x4a9180['table_system_enabled']=_0x13a4d6[_0x3cb162(0xf9)],saveSettingsDebounced(),_0x4209bb();const _0x4a270a=_0x13a4d6[_0x3cb162(0xf9)]?_0x3cb162(0x170):_0x3cb162(0x11e);toastr['info'](_0x3cb162(0xf4)+_0x4a270a+'。'),log(_0x3cb162(0xf4)+_0x4a270a+'。','info');}),_0x107c1f[_0x4a65c3(0xe2)]('change',()=>{const _0x1f9352=_0x4a65c3;_0x4a9180[_0x1f9352(0xa8)]=_0x107c1f[_0x1f9352(0xf9)],saveSettingsDebounced();}),_0x314ce4[_0x4a65c3(0xe2)]('change',()=>{const _0x4ed7fc=_0x4a65c3;_0x4a9180['injection'][_0x4ed7fc(0x15a)]=parseInt(_0x314ce4[_0x4ed7fc(0xb7)],0xa),saveSettingsDebounced(),_0x4209bb();}),_0x149f10[_0x4a65c3(0xe2)](_0x4a65c3(0xf5),()=>{const _0x40586b=_0x4a65c3;_0x4a9180[_0x40586b(0x12b)]['depth']=parseInt(_0x149f10[_0x40586b(0xb7)],0xa),saveSettingsDebounced();}),_0x3a00c4[_0x4a65c3(0x90)](_0x5c4f02=>{const _0xc6eaba=_0x4a65c3;_0x5c4f02[_0xc6eaba(0xe2)](_0xc6eaba(0x14e),()=>{const _0x40effd=_0xc6eaba;_0x5c4f02[_0x40effd(0xf9)]&&(_0x4a9180[_0x40effd(0x12b)][_0x40effd(0x11a)]=parseInt(_0x5c4f02[_0x40effd(0xb7)],0xa),saveSettingsDebounced());});}),log(_0x4a65c3(0x143),'success');}function updateAndSaveTableSetting(_0x26ef40,_0x17876a){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x26ef40]=_0x17876a,saveSettingsDebounced();}export function bindTableEvents(){const _0x45a4fd=_0x12a6f7,_0x39bf6b=document['getElementById']('amily2_memorisation_forms_panel');if(!_0x39bf6b||_0x39bf6b[_0x45a4fd(0xed)]['eventsBound'])return;log(_0x45a4fd(0xec),_0x45a4fd(0x11d));const _0x3aeef3=_0x39bf6b[_0x45a4fd(0x111)](_0x45a4fd(0x173)),_0x431b32=()=>{const _0x17a036=_0x45a4fd,_0x415453=extension_settings[extensionName]?.[_0x17a036(0x118)]||_0x17a036(0xfa);_0x3aeef3[_0x17a036(0x90)](_0x2f5c7d=>{const _0x33059b=_0x17a036;_0x2f5c7d[_0x33059b(0xf9)]=_0x2f5c7d[_0x33059b(0xb7)]===_0x415453;});};_0x3aeef3[_0x45a4fd(0x90)](_0x1dd0d0=>{const _0x12a96b=_0x45a4fd;_0x1dd0d0[_0x12a96b(0xe2)](_0x12a96b(0x14e),function(){const _0x28e1f5=_0x12a96b,_0x469f7c=this[_0x28e1f5(0xb7)];updateAndSaveTableSetting('filling_mode',_0x469f7c);let _0x5e3a20='原始填表';if(_0x469f7c===_0x28e1f5(0xe1))_0x5e3a20='分步填表';if(_0x469f7c==='optimized')_0x5e3a20=_0x28e1f5(0x12f);toastr[_0x28e1f5(0x11d)](_0x28e1f5(0x95)+_0x5e3a20+'。'),_0x431b32();});}),_0x431b32();const _0x690ff0=()=>{renderTables(),bindInjectionSettings();};_0x690ff0(),bindBatchFillButton(),bindTemplateEditors();const _0x55a2e7=document[_0x45a4fd(0xc7)]('#amily2_memorisation_forms_panel\x20.sinan-navigation-deck');_0x55a2e7&&_0x55a2e7[_0x45a4fd(0xe2)]('click',_0x5f4d40=>{const _0x4e9517=_0x45a4fd,_0x32e922=_0x5f4d40['target'][_0x4e9517(0x158)](_0x4e9517(0x153));if(!_0x32e922)return;const _0x464daa=_0x32e922[_0x4e9517(0xed)]['tab'];if(!_0x464daa)return;const _0x3421b6=_0x32e922[_0x4e9517(0x158)](_0x4e9517(0x8c));if(!_0x3421b6)return;_0x3421b6[_0x4e9517(0x111)]('.sinan-nav-item')[_0x4e9517(0x90)](_0x418d81=>_0x418d81['classList'][_0x4e9517(0x15d)](_0x4e9517(0xaa))),_0x32e922[_0x4e9517(0x96)]['add'](_0x4e9517(0xaa)),_0x3421b6[_0x4e9517(0x111)](_0x4e9517(0x11b))[_0x4e9517(0x90)](_0x48e580=>_0x48e580[_0x4e9517(0x96)][_0x4e9517(0x15d)](_0x4e9517(0xaa)));const _0x2a1412=_0x3421b6['querySelector'](_0x4e9517(0x16c)+_0x464daa+'-tab');_0x2a1412&&_0x2a1412[_0x4e9517(0x96)][_0x4e9517(0x13a)](_0x4e9517(0xaa));});const _0x4d82d2=document[_0x45a4fd(0x16b)](_0x45a4fd(0xbc)),_0x445192=document[_0x45a4fd(0x16b)](_0x45a4fd(0x9e)),_0x2e5401=document[_0x45a4fd(0x16b)](_0x45a4fd(0x165));_0x4d82d2&&_0x4d82d2[_0x45a4fd(0xe2)]('click',()=>_0x19e661[_0x45a4fd(0x13f)]());_0x445192&&_0x445192[_0x45a4fd(0xe2)](_0x45a4fd(0x17f),()=>_0x19e661[_0x45a4fd(0x133)]());_0x2e5401&&_0x2e5401[_0x45a4fd(0xe2)](_0x45a4fd(0x17f),()=>_0x19e661[_0x45a4fd(0xc8)](_0x690ff0));const _0x54cbbc=document[_0x45a4fd(0x16b)](_0x45a4fd(0x171));_0x54cbbc&&_0x54cbbc[_0x45a4fd(0xe2)](_0x45a4fd(0x17f),()=>{const _0x41a6ff=_0x45a4fd;confirm(_0x41a6ff(0x167))&&(_0x19e661[_0x41a6ff(0x145)](),_0x690ff0());});const _0x262c40=document[_0x45a4fd(0x16b)](_0x45a4fd(0x124));_0x262c40&&_0x262c40[_0x45a4fd(0xe2)]('click',()=>{const _0x509c2e=_0x45a4fd,_0x2a1f47=prompt('请输入新表格的名称：',_0x509c2e(0x180));_0x2a1f47&&_0x2a1f47[_0x509c2e(0x14a)]()&&(_0x19e661['addTable'](_0x2a1f47[_0x509c2e(0x14a)]()),_0x690ff0());});const _0x26221e=getAllTablesContainer();if(_0x26221e){_0x26221e[_0x45a4fd(0xe2)](_0x45a4fd(0x17f),_0x2d9de2=>{const _0x23005c=_0x45a4fd,_0x1a8586=_0x2d9de2['target'][_0x23005c(0x158)]('th');if(_0x1a8586&&!_0x1a8586[_0x23005c(0x96)]['contains'](_0x23005c(0x168))){toggleColumnContextMenu(_0x2d9de2);return;}const _0x4ab1fb=_0x2d9de2[_0x23005c(0xef)][_0x23005c(0x158)]('td.index-col');if(_0x4ab1fb){toggleRowContextMenu(_0x2d9de2);return;}const _0xad7a31=_0x2d9de2[_0x23005c(0xef)][_0x23005c(0x158)](_0x23005c(0xc3));if(!_0xad7a31)return;const _0x3b7a9c=parseInt(_0xad7a31[_0x23005c(0xed)][_0x23005c(0xd5)],0xa);if(_0xad7a31[_0x23005c(0xce)]('.add-row-btn'))_0x19e661['addRow'](_0x3b7a9c),_0x690ff0();else{if(_0xad7a31[_0x23005c(0xce)](_0x23005c(0x169)))_0x19e661['addColumn'](_0x3b7a9c),_0x690ff0();else{if(_0xad7a31['matches'](_0x23005c(0xd7))||_0xad7a31[_0x23005c(0xce)](_0x23005c(0x9a))){const _0x5ee0a0=_0xad7a31[_0x23005c(0x96)][_0x23005c(0x166)]('move-table-up-btn')?'up':_0x23005c(0x17c);_0x19e661[_0x23005c(0x14b)](_0x3b7a9c,_0x5ee0a0),_0x690ff0();}else{if(_0xad7a31[_0x23005c(0xce)](_0x23005c(0x16a)))openRuleEditor(_0x3b7a9c);else{if(_0xad7a31['matches']('.delete-table-btn')){const _0x4df1bb=_0x19e661[_0x23005c(0x154)](),_0x1b85f0=_0x4df1bb[_0x3b7a9c]?.['name']||_0x23005c(0xcc);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x1b85f0+_0x23005c(0x137))&&(_0x19e661[_0x23005c(0xb2)](_0x3b7a9c),_0x690ff0());}}}}}});const _0x1be16b=()=>_0x45a4fd(0x112)in window||navigator[_0x45a4fd(0x179)]>0x0;_0x1be16b()&&_0x26221e[_0x45a4fd(0xe2)](_0x45a4fd(0xc5),_0x542c08=>{const _0x3af5d2=_0x45a4fd,_0x594e1c=_0x542c08[_0x3af5d2(0xef)]['closest']('td');_0x594e1c&&_0x594e1c['dataset'][_0x3af5d2(0x163)]!==undefined&&_0x594e1c[_0x3af5d2(0x10b)]('contenteditable')!==_0x3af5d2(0x115)&&(_0x594e1c[_0x3af5d2(0x110)](_0x3af5d2(0x132),_0x3af5d2(0x115)),_0x594e1c[_0x3af5d2(0xd3)]());}),_0x26221e[_0x45a4fd(0xe2)]('blur',_0x2ef437=>{const _0x4b3a87=_0x45a4fd,_0x336e19=_0x2ef437[_0x4b3a87(0xef)];if(_0x336e19[_0x4b3a87(0x10c)]!=='TD'||_0x336e19[_0x4b3a87(0x10b)]('contenteditable')!==_0x4b3a87(0x115))return;const _0x397ca4=()=>_0x4b3a87(0x112)in window||navigator['maxTouchPoints']>0x0;_0x397ca4()&&_0x336e19[_0x4b3a87(0x110)]('contenteditable',_0x4b3a87(0x148));const _0x3dc452=_0x336e19[_0x4b3a87(0x158)](_0x4b3a87(0x140));if(!_0x3dc452)return;const _0x471141=parseInt(_0x3dc452[_0x4b3a87(0xed)][_0x4b3a87(0xd5)],0xa),_0x2a9b94=parseInt(_0x336e19[_0x4b3a87(0x158)]('tr')['dataset']['rowIndex'],0xa),_0x37f8ed=parseInt(_0x336e19['dataset'][_0x4b3a87(0x163)],0xa),_0x280c5c=_0x336e19[_0x4b3a87(0x121)];_0x19e661[_0x4b3a87(0x16d)](_0x471141,_0x2a9b94,_0x37f8ed);const _0x4011b8={[_0x37f8ed]:_0x280c5c};_0x19e661[_0x4b3a87(0x11c)](_0x471141,_0x2a9b94,_0x4011b8),_0x690ff0();},!![]);}_0x39bf6b[_0x45a4fd(0xed)]['eventsBound']=_0x45a4fd(0x115),log('表格视图交互事件已成功绑定。',_0x45a4fd(0x10d));}function bindBatchFillButton(){const _0x1a20fe=_0x12a6f7,_0x269507=document[_0x1a20fe(0x16b)](_0x1a20fe(0x151));if(_0x269507){if(_0x269507[_0x1a20fe(0xed)][_0x1a20fe(0x12e)])return;_0x269507['addEventListener'](_0x1a20fe(0x17f),_0x306ed2=>{const _0x57a082=_0x1a20fe,_0x64538=extension_settings[extensionName],_0x2d8f20=_0x64538[_0x57a082(0xcb)]!==![];if(!_0x2d8f20){_0x306ed2[_0x57a082(0xb0)](),toastr['warning'](_0x57a082(0xe0));return;}startBatchFilling();}),_0x269507[_0x1a20fe(0xed)][_0x1a20fe(0x12e)]=_0x1a20fe(0x115),log(_0x1a20fe(0xac),_0x1a20fe(0x10d));}}function bindTemplateEditors(){const _0x4c9d57=_0x12a6f7,_0x74d1b8=document[_0x4c9d57(0x16b)](_0x4c9d57(0x8e)),_0x2430e8=document[_0x4c9d57(0x16b)]('ai-rule-template-save-btn'),_0x44691a=document[_0x4c9d57(0x16b)]('ai-rule-template-restore-btn'),_0x262d84=document[_0x4c9d57(0x16b)](_0x4c9d57(0xcf)),_0x461aef=document['getElementById'](_0x4c9d57(0xb6)),_0x25d262=document[_0x4c9d57(0x16b)](_0x4c9d57(0xdc));if(!_0x74d1b8||!_0x262d84){log(_0x4c9d57(0x141),_0x4c9d57(0x102));return;}_0x74d1b8['value']=_0x19e661['getBatchFillerRuleTemplate'](),_0x262d84['value']=_0x19e661['getBatchFillerFlowTemplate'](),_0x2430e8['addEventListener'](_0x4c9d57(0x17f),()=>{const _0x770890=_0x4c9d57;_0x19e661['saveBatchFillerRuleTemplate'](_0x74d1b8[_0x770890(0xb7)]),toastr['success']('规则提示词已保存。'),log(_0x770890(0xba),_0x770890(0x10d));}),_0x461aef[_0x4c9d57(0xe2)](_0x4c9d57(0x17f),()=>{const _0x37e4f3=_0x4c9d57;_0x19e661['saveBatchFillerFlowTemplate'](_0x262d84[_0x37e4f3(0xb7)]),toastr[_0x37e4f3(0x10d)](_0x37e4f3(0xbd)),log(_0x37e4f3(0x98),_0x37e4f3(0x10d));}),_0x44691a['addEventListener'](_0x4c9d57(0x17f),()=>{const _0x633a67=_0x4c9d57;confirm(_0x633a67(0xb9))&&(_0x74d1b8[_0x633a67(0xb7)]=DEFAULT_AI_RULE_TEMPLATE,_0x19e661['saveBatchFillerRuleTemplate'](_0x74d1b8[_0x633a67(0xb7)]),toastr['info']('规则提示词已恢复为默认。'),log(_0x633a67(0x15b),_0x633a67(0x11d)));}),_0x25d262[_0x4c9d57(0xe2)](_0x4c9d57(0x17f),()=>{const _0x30141a=_0x4c9d57;confirm(_0x30141a(0x17e))&&(_0x262d84[_0x30141a(0xb7)]=DEFAULT_AI_FLOW_TEMPLATE,_0x19e661['saveBatchFillerFlowTemplate'](_0x262d84['value']),toastr[_0x30141a(0x11d)](_0x30141a(0xe6)),log(_0x30141a(0xf7),_0x30141a(0x11d)));}),log(_0x4c9d57(0xc4),_0x4c9d57(0x10d));}
