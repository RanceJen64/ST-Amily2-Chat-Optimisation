const _0x3fb332=_0x5ea8;(function(_0x3f2db3,_0x25a51c){const _0x1d4385=_0x5ea8,_0x587e72=_0x3f2db3();while(!![]){try{const _0x1bc200=-parseInt(_0x1d4385(0x114))/0x1*(-parseInt(_0x1d4385(0xf1))/0x2)+-parseInt(_0x1d4385(0x1e3))/0x3*(-parseInt(_0x1d4385(0xfd))/0x4)+-parseInt(_0x1d4385(0x197))/0x5*(parseInt(_0x1d4385(0x1bf))/0x6)+-parseInt(_0x1d4385(0x1bc))/0x7+parseInt(_0x1d4385(0x13c))/0x8*(-parseInt(_0x1d4385(0x169))/0x9)+-parseInt(_0x1d4385(0xe7))/0xa+parseInt(_0x1d4385(0x19d))/0xb;if(_0x1bc200===_0x25a51c)break;else _0x587e72['push'](_0x587e72['shift']());}catch(_0xf64f6f){_0x587e72['push'](_0x587e72['shift']());}}}(_0xd81b,0x3d055));import*as _0x5cc481 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';function _0x5ea8(_0x35c3ee,_0x8caac3){const _0xd81bbc=_0xd81b();return _0x5ea8=function(_0x5ea840,_0x3dbb41){_0x5ea840=_0x5ea840-0xe3;let _0x27615a=_0xd81bbc[_0x5ea840];return _0x27615a;},_0x5ea8(_0x35c3ee,_0x8caac3);}const getAllTablesContainer=()=>document[_0x3fb332(0x143)](_0x3fb332(0x175));function toggleRowContextMenu(_0x597439){const _0x1110de=_0x3fb332;_0x597439[_0x1110de(0x1bb)](),_0x597439[_0x1110de(0x1d3)]();const _0x279a00=_0x597439[_0x1110de(0x1d7)][_0x1110de(0xed)]('td.index-col');if(!_0x279a00)return;const _0xa74312=_0x279a00['querySelector'](_0x1110de(0x11c));if(!_0xa74312)return;const _0x4322bc=_0xa74312['classList'][_0x1110de(0x171)](_0x1110de(0x18e));document[_0x1110de(0x15a)]('.amily2-context-menu.amily2-menu-active')[_0x1110de(0xf0)](_0x2cf5ba=>{const _0x7e1aad=_0x1110de;_0x2cf5ba[_0x7e1aad(0x110)][_0x7e1aad(0x1ba)](_0x7e1aad(0x18e));});!_0x4322bc&&_0xa74312[_0x1110de(0x110)]['add']('amily2-menu-active');const _0x3574af=_0x267ae4=>{const _0x24f290=_0x1110de;!_0xa74312[_0x24f290(0x171)](_0x267ae4[_0x24f290(0x1d7)])&&(_0xa74312[_0x24f290(0x110)][_0x24f290(0x1ba)](_0x24f290(0x18e)),document[_0x24f290(0xe4)](_0x24f290(0x1ed),_0x3574af,!![]));};setTimeout(()=>{const _0x149625=_0x1110de;_0xa74312[_0x149625(0x110)]['contains'](_0x149625(0x18e))&&document[_0x149625(0x131)](_0x149625(0x1ed),_0x3574af,!![]);},0x0);}function toggleColumnContextMenu(_0x5163e8){const _0x2c8f63=_0x3fb332;_0x5163e8[_0x2c8f63(0x1bb)](),_0x5163e8[_0x2c8f63(0x1d3)]();const _0x5e46f0=_0x5163e8['target'][_0x2c8f63(0xed)]('th');if(!_0x5e46f0)return;const _0x5c7bc6=_0x5e46f0[_0x2c8f63(0x110)][_0x2c8f63(0x171)]('amily2-menu-open');document[_0x2c8f63(0x15a)]('th.amily2-menu-open')[_0x2c8f63(0xf0)](_0x4d382f=>{const _0x446fef=_0x2c8f63;_0x4d382f[_0x446fef(0x110)][_0x446fef(0x1ba)](_0x446fef(0x1c2));});!_0x5c7bc6&&_0x5e46f0['classList'][_0x2c8f63(0x160)](_0x2c8f63(0x1c2));const _0x55d9b5=_0x5249e2=>{const _0x3d2c23=_0x2c8f63;!_0x5e46f0[_0x3d2c23(0x171)](_0x5249e2['target'])&&(_0x5e46f0['classList'][_0x3d2c23(0x1ba)](_0x3d2c23(0x1c2)),document[_0x3d2c23(0xe4)](_0x3d2c23(0x1ed),_0x55d9b5,!![]));};setTimeout(()=>{const _0x321508=_0x2c8f63;_0x5e46f0[_0x321508(0x110)]['contains']('amily2-menu-open')&&document['addEventListener'](_0x321508(0x1ed),_0x55d9b5,!![]);},0x0);}function showColumnNameEditor(_0x57a436,_0x541a71,_0x101de7){const _0xa51574=_0x3fb332,_0x2d4cfb=_0xa51574(0x1ce)+_0x101de7+_0xa51574(0x14a),_0x14ee5e=$(_0x2d4cfb)['appendTo'](_0xa51574(0x19e)),_0x14de1f=_0x14ee5e[_0xa51574(0x1b0)]('#column-name-input'),_0x178fce=()=>{const _0x3b5545=_0xa51574;_0x14ee5e[0x0][_0x3b5545(0xf9)](),_0x14ee5e[_0x3b5545(0x1ba)]();};_0x14ee5e[_0xa51574(0x1b0)](_0xa51574(0x134))['on']('click',()=>{const _0x482c86=_0xa51574,_0x3c3488=_0x14de1f[_0x482c86(0x16b)]()[_0x482c86(0x198)]();if(_0x3c3488&&_0x3c3488!==_0x101de7)_0x5cc481[_0x482c86(0x100)](_0x57a436,_0x541a71,_0x3c3488),renderTables(),toastr[_0x482c86(0x193)](_0x482c86(0x1a7)+_0x3c3488+'\x22');else{if(!_0x3c3488){toastr[_0x482c86(0xe3)](_0x482c86(0x156)),_0x14de1f[_0x482c86(0x1eb)]();return;}}_0x178fce();}),_0x14ee5e[_0xa51574(0x1b0)]('.popup-button-cancel')['on']('click',_0x178fce),_0x14de1f['on'](_0xa51574(0x155),_0x84e050=>{const _0x45b6d6=_0xa51574;_0x84e050[_0x45b6d6(0x1e0)]===0xd&&_0x14ee5e['find'](_0x45b6d6(0x134))[_0x45b6d6(0x1ed)]();}),_0x14de1f['on']('keydown',_0x41555b=>{const _0x4ce23a=_0xa51574;_0x41555b[_0x4ce23a(0x1e0)]===0x1b&&_0x178fce();}),_0x14ee5e[0x0][_0xa51574(0x1a0)](),_0x14de1f[_0xa51574(0x1eb)]()[_0xa51574(0x1e1)]();}function positionContextMenu(_0x2df2b7,_0x4d16cd){const _0x533c60=_0x3fb332;_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x14f)]=_0x533c60(0x127),_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x1a2)]=_0x533c60(0x1ab),_0x2df2b7['style'][_0x533c60(0x16f)]='0',_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0xe9)]=_0x533c60(0x1d2),_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x1cf)]='',_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x13a)]='',_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x15d)]='',_0x2df2b7['style']['overflowY']='';const _0xf12810=window[_0x533c60(0x12c)],_0x224021=_0x4d16cd['getBoundingClientRect'](),_0x5731a8=0xc8,_0x48ab77=_0x4d16cd[_0x533c60(0xed)]('.hly-scroll'),_0x1866d4=_0x48ab77?_0x48ab77[_0x533c60(0x11f)]():{'top':0x0,'bottom':_0xf12810},_0x936bdf=Math[_0x533c60(0x128)](_0xf12810,_0x1866d4['bottom'])-_0x224021[_0x533c60(0x182)],_0x817e9d=_0x224021[_0x533c60(0xe5)]-Math['max'](0x0,_0x1866d4[_0x533c60(0xe5)]);_0x936bdf<_0x5731a8&&_0x817e9d>_0x936bdf?(_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0xe5)]=_0x533c60(0x1d2),_0x2df2b7['style'][_0x533c60(0x182)]=_0x533c60(0x142),_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x13a)]=_0x533c60(0x13f)):(_0x2df2b7['style'][_0x533c60(0xe5)]=_0x533c60(0x142),_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x182)]='auto',_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x1cf)]='2px');const _0xf99fc4=0xa0,_0x5aa737=_0x4d16cd['closest'](_0x533c60(0x1d9)),_0x36a2e5=_0x5aa737?_0x5aa737['closest']('div[style*=\x22overflowX\x22]'):null;if(_0x36a2e5){const _0x261c8c=_0x36a2e5[_0x533c60(0x11f)](),_0x4e1372=_0x224021['left']-_0x261c8c[_0x533c60(0x16f)];_0x4e1372+_0xf99fc4>_0x261c8c[_0x533c60(0x1b5)]-0x14&&(_0x2df2b7[_0x533c60(0x12e)][_0x533c60(0x16f)]=_0x533c60(0x1d2),_0x2df2b7['style']['right']='0');}}function _0xd81b(){const _0x20501f=['dataset','input[name=\x22filling-mode\x22]','button','startFloorRangeFilling','表格系统总开关已关闭，请先启用总开关。','.move-table-up-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','add-left','colIndex','【最终警告】您确定要永久废黜表格\x20“[','error','classList','#rule-note','table-controls','您确定要将规则提示词恢复为默认设置吗？','393QAoIHs','向左移动','note','currentEventBound','在上加行','depth','amily2-context-menu','loadTables','.amily2-context-menu','delete','add-below','getBoundingClientRect','down','fa-plus-circle','流程提示词已保存。','createElement','table-injection-depth','appendTo','在左加列','absolute','min','0.5','contenteditable','addTable','innerHeight','filling_mode','style','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','saveBatchFillerFlowTemplate','addEventListener','批量填表-规则提示词已恢复默认。','danger','.popup-button-ok','checked','move-left','optimized','deleteColumn','injection','marginBottom','role','2504KRBvxC','\x20行吗？','menu_button\x20small_button','2px','add-above','在右加列','100%','getElementById','amily2-import-global-preset-btn','maxTouchPoints','ai-rule-template-save-btn','move-up','table_injection_enabled','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入列名...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：列名将用于标识此列的内容</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','批量填表-流程提示词已恢复默认。','.edit-rules-btn','index-col','exportPresetFull','position','getBatchFillerRuleTemplate','updateRow','无法找到指令模板编辑器，绑定失败。','active','div','keypress','列名不能为空！','span','addColumn','true','querySelectorAll','ai-rule-template-restore-btn','display','maxHeight','flex','saveBatchFillerRuleTemplate','add','deleteTable','rowIndex','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','moveRow','name','rename','规则提示词已保存。','amily2-import-preset-btn','5535RHNrfU','向右移动','val','向下移动','space-between','向上移动','left','blur','contains','fa-arrow-left','楼层不能小于1。','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','all-tables-container','fa-arrow-right','请输入有效的起始楼层和结束楼层。','move-right','.add-col-btn','内存状态为空，从聊天记录加载作为后备。','删除该列','表格视图交互事件已成功绑定。','”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>','.add-row-btn','table-role-system','pointer','previousElementSibling','bottom','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','opacity','info','add-right','表格系统总开关','\x22选定楼层填表\x22按钮已成功绑定。','below','\x22></i>\x20','fa-pen','fill-table-now-btn','isCurrentTablesEmpty','amily2-menu-active','input[name=\x22table-injection-role\x22]','fill-selected-floors-btn','length','moveTable','success','ontouchstart','批量填表-流程提示词已保存。','delete-row','5RlhTen','trim','createTBody','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','change','move-table-up-btn','12402049uDIOmz','body','<i\x20class=\x22fas\x20','showModal','setAttribute','zIndex','center','编辑列名','#rule-delete','rule_delete','列名已更新为\x20\x22','floor-end-input','insertColumn','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','10000','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','touchstart','#rule-update','getBatchFillerFlowTemplate','find','.control-block-with-switch','getMemoryState','batchEventBound','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','width','\x22立即填表\x22按钮已成功绑定。','rows','eventsBound','rule_update','remove','preventDefault','842646AAYuTG','addHighlight','已禁用','1940790GSAbKH','规则提示词已恢复为默认。','您确定要删除第\x20','amily2-menu-open','className','floor-start-input','您确定要将流程提示词恢复为默认设置吗？','已启用','updateTableRules','textContent','above','fa-trash-alt','ai-rule-template-editor','importPreset','warn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20编辑列名\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>列名：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22column-name-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','marginTop','innerHTML','createTHead','auto','stopPropagation','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','tableIndex','disabled','target','在下加行','table','cursor','label','表格注入设置已成功绑定。','../core/table-system/batch-filler.js','appendChild','then','which','select','table-injection-position','41928dIzdAT','填表模式已切换为\x20','amily2-context-menu\x20amily2-row-context-menu','#sinan-','批量填表-规则提示词已保存。','startCurrentFloorFilling','.popup-button-cancel','overflowX','focus','querySelector','click','原始填表','input','amily2-table-','warning','removeEventListener','top','未知表格','3703050ZSWlXs','ai-flow-template-editor','right','tab','分步填表','.sinan-tab-pane','closest','.sinan-nav-item','value','forEach','586Bwjcfe','add-table-placeholder','”\x20列吗？','move-down','importGlobalPreset','insertRow','amily2_memorisation_forms_panel','insertCell','close','table-injection-enabled','moveColumn','amily2-export-preset-btn','4cuqoxd','table_system_enabled','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','updateHeader','fa-arrow-down','matches','block','floorEventBound'];_0xd81b=function(){return _0x20501f;};return _0xd81b();}export function renderTables(){const _0x3066c4=_0x3fb332;let _0x43f61b=_0x5cc481['getMemoryState']();!_0x43f61b&&(log(_0x3066c4(0x17a),_0x3066c4(0x1cd)),_0x43f61b=_0x5cc481[_0x3066c4(0x11b)]());const _0x32f67d=getAllTablesContainer();if(!_0x43f61b||!_0x32f67d){console[_0x3066c4(0x10f)]('[内存储司-工部]\x20缺少表格数据或容器，无法渲染。');return;}const _0x2b4dc1=_0x5cc481['getHighlights'](),_0x43be13=document[_0x3066c4(0x143)]('add-table-placeholder');_0x43be13&&_0x43be13['remove'](),_0x32f67d[_0x3066c4(0x1d0)]='',_0x43f61b[_0x3066c4(0xf0)]((_0x168437,_0x36aa06)=>{const _0x12b141=_0x3066c4,_0x4f3fe0=document['createElement'](_0x12b141(0x154));_0x4f3fe0['style'][_0x12b141(0x15c)]=_0x12b141(0x15e),_0x4f3fe0[_0x12b141(0x12e)]['justifyContent']=_0x12b141(0x16d),_0x4f3fe0['style']['alignItems']=_0x12b141(0x1a3);const _0x20ccb5=document['createElement']('h3');_0x20ccb5[_0x12b141(0x1d0)]=_0x12b141(0x19a)+_0x168437[_0x12b141(0x165)];const _0x39c134=document[_0x12b141(0x123)]('div');_0x39c134[_0x12b141(0x1c3)]=_0x12b141(0x112);const _0x491f47=_0x36aa06>0x0?'<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22'+_0x36aa06+'\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>':'',_0x1455c4=_0x36aa06<_0x43f61b['length']-0x1?_0x12b141(0x183)+_0x36aa06+_0x12b141(0x174):'';_0x39c134[_0x12b141(0x1d0)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x491f47+_0x12b141(0x10b)+_0x1455c4+_0x12b141(0x1b4)+_0x36aa06+_0x12b141(0x149)+_0x36aa06+_0x12b141(0x1aa),_0x4f3fe0[_0x12b141(0x1de)](_0x20ccb5),_0x4f3fe0[_0x12b141(0x1de)](_0x39c134),_0x32f67d[_0x12b141(0x1de)](_0x4f3fe0);const _0x9d969e=document[_0x12b141(0x123)]('table');_0x9d969e[_0x12b141(0x12e)]['display']=_0x12b141(0x103),_0x9d969e[_0x12b141(0x12e)][_0x12b141(0x1ea)]=_0x12b141(0x1d2),_0x9d969e['id']=_0x12b141(0x1f0)+_0x36aa06,_0x9d969e[_0x12b141(0x105)][_0x12b141(0x1d5)]=_0x36aa06;const _0x246ed2=_0x9d969e[_0x12b141(0x1d1)](),_0x4f5ce7=_0x246ed2[_0x12b141(0xf6)](),_0x5a85e7=document[_0x12b141(0x123)]('th');_0x5a85e7[_0x12b141(0x1c3)]='index-col',_0x5a85e7['textContent']='#',_0x4f5ce7['appendChild'](_0x5a85e7),_0x168437['headers'][_0x12b141(0xf0)]((_0x46a3ad,_0x819e5)=>{const _0x3dfab0=_0x12b141,_0x1be544=document[_0x3dfab0(0x123)]('th');_0x1be544[_0x3dfab0(0x105)]['colIndex']=_0x819e5,_0x1be544[_0x3dfab0(0x12e)][_0x3dfab0(0x1da)]=_0x3dfab0(0x180);const _0x137361=document['createElement'](_0x3dfab0(0x157));_0x137361[_0x3dfab0(0x1c3)]='amily2-header-text',_0x137361['textContent']=_0x46a3ad,_0x1be544[_0x3dfab0(0x1de)](_0x137361);const _0xcd6b7b=document[_0x3dfab0(0x123)]('div');_0xcd6b7b['className']=_0x3dfab0(0x11a);const _0x21d55e=[{'label':_0x3dfab0(0x115),'action':_0x3dfab0(0x136),'icon':_0x3dfab0(0x172)},{'label':_0x3dfab0(0x16a),'action':_0x3dfab0(0x178),'icon':_0x3dfab0(0x176)},{'label':_0x3dfab0(0x126),'action':_0x3dfab0(0x10c),'icon':_0x3dfab0(0x121)},{'label':_0x3dfab0(0x141),'action':_0x3dfab0(0x186),'icon':_0x3dfab0(0x121)},{'label':_0x3dfab0(0x1a4),'action':_0x3dfab0(0x166),'icon':_0x3dfab0(0x18b)},{'label':_0x3dfab0(0x17b),'action':_0x3dfab0(0x11d),'icon':_0x3dfab0(0x1ca),'isDanger':!![]}];_0x21d55e[_0x3dfab0(0xf0)](({label:_0x598581,action:_0x4f4eb1,icon:_0x3e064b,isDanger:_0x2e7ae4})=>{const _0x49c768=_0x3dfab0,_0x26d97e=document['createElement'](_0x49c768(0x107));_0x26d97e[_0x49c768(0x1c8)]=_0x598581,_0x26d97e['className']='menu_button\x20small_button';if(_0x2e7ae4)_0x26d97e[_0x49c768(0x110)][_0x49c768(0x160)](_0x49c768(0x133));_0x26d97e[_0x49c768(0x131)](_0x49c768(0x1ed),_0x3cd9cf=>{const _0x1eebff=_0x49c768;_0x3cd9cf[_0x1eebff(0x1d3)]();switch(_0x4f4eb1){case _0x1eebff(0x136):_0x5cc481[_0x1eebff(0xfb)](_0x36aa06,_0x819e5,_0x1eebff(0x16f));break;case'move-right':_0x5cc481['moveColumn'](_0x36aa06,_0x819e5,_0x1eebff(0xe9));break;case _0x1eebff(0x10c):_0x5cc481['insertColumn'](_0x36aa06,_0x819e5,'left');break;case _0x1eebff(0x186):_0x5cc481[_0x1eebff(0x1a9)](_0x36aa06,_0x819e5,_0x1eebff(0xe9));break;case _0x1eebff(0x166):showColumnNameEditor(_0x36aa06,_0x819e5,_0x46a3ad);break;case _0x1eebff(0x11d):confirm('您确定要删除\x20“'+_0x46a3ad+_0x1eebff(0xf3))&&_0x5cc481[_0x1eebff(0x138)](_0x36aa06,_0x819e5);break;}renderTables();}),_0xcd6b7b['appendChild'](_0x26d97e);}),_0x1be544[_0x3dfab0(0x1de)](_0xcd6b7b),_0x4f5ce7[_0x3dfab0(0x1de)](_0x1be544);});const _0x4d3efa=_0x9d969e[_0x12b141(0x199)]();_0x168437[_0x12b141(0x1b7)]&&_0x168437[_0x12b141(0x1b7)][_0x12b141(0x191)]>0x0&&_0x168437[_0x12b141(0x1b7)]['forEach']((_0x1791c3,_0x2e70a0)=>{const _0x4cf889=_0x12b141,_0x3f82d9=_0x4d3efa['insertRow']();_0x3f82d9['dataset'][_0x4cf889(0x162)]=_0x2e70a0;const _0x2fac3b=_0x3f82d9[_0x4cf889(0xf8)]();_0x2fac3b[_0x4cf889(0x1c3)]=_0x4cf889(0x14d);const _0x5f161c=document['createElement'](_0x4cf889(0x157));_0x5f161c[_0x4cf889(0x1c8)]=_0x2e70a0+0x1,_0x2fac3b[_0x4cf889(0x1de)](_0x5f161c);const _0x5af18f=document[_0x4cf889(0x123)](_0x4cf889(0x154));_0x5af18f[_0x4cf889(0x1c3)]=_0x4cf889(0x1e5);const _0x348063=[{'label':_0x4cf889(0x16e),'action':_0x4cf889(0x147),'icon':'fa-arrow-up'},{'label':_0x4cf889(0x16c),'action':_0x4cf889(0xf4),'icon':_0x4cf889(0x101)},{'label':_0x4cf889(0x118),'action':_0x4cf889(0x140),'icon':_0x4cf889(0x121)},{'label':_0x4cf889(0x1d8),'action':_0x4cf889(0x11e),'icon':_0x4cf889(0x121)},{'label':'删除该行','action':_0x4cf889(0x196),'icon':'fa-trash-alt','isDanger':!![]}];_0x348063[_0x4cf889(0xf0)](({label:_0x4d8f7c,action:_0x421d81,icon:_0x5a3dde,isDanger:_0x113ec6})=>{const _0x1e3d2b=_0x4cf889,_0x138bb4=document['createElement'](_0x1e3d2b(0x107));_0x138bb4[_0x1e3d2b(0x1d0)]=_0x1e3d2b(0x19f)+_0x5a3dde+_0x1e3d2b(0x18a)+_0x4d8f7c,_0x138bb4[_0x1e3d2b(0x1c3)]=_0x1e3d2b(0x13e);if(_0x113ec6)_0x138bb4['classList'][_0x1e3d2b(0x160)](_0x1e3d2b(0x133));_0x138bb4[_0x1e3d2b(0x131)]('click',_0x335a6=>{const _0xa3295c=_0x1e3d2b;_0x335a6[_0xa3295c(0x1d3)]();switch(_0x421d81){case _0xa3295c(0x147):_0x5cc481[_0xa3295c(0x164)](_0x36aa06,_0x2e70a0,'up');break;case _0xa3295c(0xf4):_0x5cc481['moveRow'](_0x36aa06,_0x2e70a0,_0xa3295c(0x120));break;case _0xa3295c(0x140):_0x5cc481[_0xa3295c(0xf6)](_0x36aa06,_0x2e70a0,_0xa3295c(0x1c9));break;case _0xa3295c(0x11e):_0x5cc481[_0xa3295c(0xf6)](_0x36aa06,_0x2e70a0,_0xa3295c(0x189));break;case _0xa3295c(0x196):confirm(_0xa3295c(0x1c1)+(_0x2e70a0+0x1)+_0xa3295c(0x13d))&&_0x5cc481['deleteRow'](_0x36aa06,_0x2e70a0);break;}renderTables();}),_0x5af18f[_0x1e3d2b(0x1de)](_0x138bb4);}),_0x2fac3b[_0x4cf889(0x1de)](_0x5af18f),_0x1791c3['forEach']((_0x54a971,_0xb93407)=>{const _0x3734fa=_0x4cf889,_0x208640=_0x3f82d9[_0x3734fa(0xf8)]();_0x208640['textContent']=_0x54a971;const _0xa68a51=()=>_0x3734fa(0x194)in window||navigator[_0x3734fa(0x145)]>0x0;!_0xa68a51()&&_0x208640['setAttribute'](_0x3734fa(0x12a),'true');_0x208640[_0x3734fa(0x105)][_0x3734fa(0x10d)]=_0xb93407,_0x208640['dataset']['label']=_0x168437['headers'][_0xb93407]||'';const _0x3e19bd=_0x36aa06+'-'+_0x2e70a0+'-'+_0xb93407;_0x2b4dc1['has'](_0x3e19bd)&&_0x208640[_0x3734fa(0x110)][_0x3734fa(0x160)]('cell-highlight');});}),_0x32f67d[_0x12b141(0x1de)](_0x9d969e);}),_0x43be13&&_0x32f67d[_0x3066c4(0x1de)](_0x43be13);}function openRuleEditor(_0xec8afb){const _0x3242a6=_0x3fb332,_0x2125aa=_0x5cc481['getMemoryState']();if(!_0x2125aa||!_0x2125aa[_0xec8afb])return;const _0x493974=_0x2125aa[_0xec8afb],_0x560a6d='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'+_0x493974[_0x3242a6(0x165)]+_0x3242a6(0x17d)+(_0x493974[_0x3242a6(0x116)]||'')+_0x3242a6(0x1d4)+(_0x493974['rule_add']||'')+_0x3242a6(0x163)+(_0x493974[_0x3242a6(0x1a6)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x493974[_0x3242a6(0x1b9)]||'')+_0x3242a6(0x12f),_0x56856f=$(_0x560a6d)[_0x3242a6(0x125)]('body'),_0x1f84a1=()=>{const _0x35656e=_0x3242a6;_0x56856f[0x0][_0x35656e(0xf9)](),_0x56856f['remove']();};_0x56856f[_0x3242a6(0x1b0)](_0x3242a6(0x134))['on'](_0x3242a6(0x1ed),()=>{const _0x5c0ca6=_0x3242a6,_0x2f0232={'note':_0x56856f['find'](_0x5c0ca6(0x111))[_0x5c0ca6(0x16b)](),'rule_add':_0x56856f[_0x5c0ca6(0x1b0)]('#rule-add')[_0x5c0ca6(0x16b)](),'rule_delete':_0x56856f['find'](_0x5c0ca6(0x1a5))[_0x5c0ca6(0x16b)](),'rule_update':_0x56856f[_0x5c0ca6(0x1b0)](_0x5c0ca6(0x1ae))[_0x5c0ca6(0x16b)]()};_0x5cc481[_0x5c0ca6(0x1c7)](_0xec8afb,_0x2f0232),_0x1f84a1();}),_0x56856f[_0x3242a6(0x1b0)](_0x3242a6(0x1e9))['on']('click',_0x1f84a1),_0x56856f[0x0]['showModal']();}function bindInjectionSettings(){const _0x181ab2=_0x3fb332,_0x1eacdd=extension_settings[extensionName],_0x44ec3b=document['getElementById']('table-system-master-switch'),_0x27d827=document[_0x181ab2(0x143)](_0x181ab2(0xfa)),_0x3f4226=document[_0x181ab2(0x143)](_0x181ab2(0x1e2)),_0x4d6b33=document['getElementById'](_0x181ab2(0x124)),_0xb3a239=document['querySelectorAll'](_0x181ab2(0x18f));if(!_0x44ec3b||!_0x27d827||!_0x3f4226||!_0x4d6b33||!_0xb3a239[_0x181ab2(0x191)])return;const _0x4f17d9=()=>{const _0x1f9ce9=_0x181ab2,_0x42528b=_0x3f4226['value'],_0x2bee59=_0x44ec3b[_0x1f9ce9(0x135)],_0x520110=_0x42528b==='1';_0x27d827[_0x1f9ce9(0x1d6)]=!_0x2bee59,_0x3f4226[_0x1f9ce9(0x1d6)]=!_0x2bee59,_0x4d6b33[_0x1f9ce9(0x1d6)]=!_0x2bee59||!_0x520110,_0xb3a239[_0x1f9ce9(0xf0)](_0x4c40f6=>_0x4c40f6[_0x1f9ce9(0x1d6)]=!_0x2bee59||!_0x520110);const _0x33fdc3=_0x2bee59?'1':'0.5';_0x27d827[_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x33fdc3;_0x27d827['closest']('.control-block-with-switch')&&(_0x27d827['closest'](_0x1f9ce9(0x1b1))[_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x33fdc3);_0x3f4226['style'][_0x1f9ce9(0x184)]=_0x33fdc3;_0x3f4226['previousElementSibling']&&(_0x3f4226['previousElementSibling'][_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x33fdc3);const _0x599242=_0x2bee59&&_0x520110?'1':_0x1f9ce9(0x129);_0x4d6b33['style'][_0x1f9ce9(0x184)]=_0x599242;_0x4d6b33[_0x1f9ce9(0x181)]&&(_0x4d6b33[_0x1f9ce9(0x181)][_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x599242);const _0x111638=_0x2bee59&&_0x520110?'1':_0x1f9ce9(0x129),_0x74e70e=document[_0x1f9ce9(0x143)](_0x1f9ce9(0x17f))?.[_0x1f9ce9(0xed)]('.radio-group');_0x74e70e&&(_0x74e70e[_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x111638,_0x74e70e['previousElementSibling']&&(_0x74e70e[_0x1f9ce9(0x181)][_0x1f9ce9(0x12e)]['opacity']=_0x111638));const _0x460157=document['querySelectorAll'](_0x1f9ce9(0x106));_0x460157[_0x1f9ce9(0xf0)](_0x41b395=>{const _0x3e7947=_0x1f9ce9;_0x41b395['disabled']=!_0x2bee59;const _0x1772d4=_0x41b395['closest'](_0x3e7947(0x1db));_0x1772d4&&(_0x1772d4[_0x3e7947(0x12e)]['opacity']=_0x2bee59?'1':_0x3e7947(0x129));});const _0x45c3d7=document[_0x1f9ce9(0x143)](_0x1f9ce9(0x18c));_0x45c3d7&&(_0x45c3d7[_0x1f9ce9(0x1d6)]=!_0x2bee59,_0x45c3d7[_0x1f9ce9(0x12e)][_0x1f9ce9(0x184)]=_0x2bee59?'1':_0x1f9ce9(0x129));};_0x44ec3b['checked']=_0x1eacdd[_0x181ab2(0xfe)]!==![],_0x27d827[_0x181ab2(0x135)]=_0x1eacdd[_0x181ab2(0x148)],_0x3f4226['value']=_0x1eacdd[_0x181ab2(0x139)][_0x181ab2(0x14f)],_0x4d6b33['value']=_0x1eacdd['injection'][_0x181ab2(0x119)],_0xb3a239[_0x181ab2(0xf0)](_0x3e601d=>{const _0x56c8ec=_0x181ab2;parseInt(_0x3e601d[_0x56c8ec(0xef)],0xa)===_0x1eacdd['injection'][_0x56c8ec(0x13b)]&&(_0x3e601d[_0x56c8ec(0x135)]=!![]);}),_0x4f17d9(),_0x44ec3b[_0x181ab2(0x131)](_0x181ab2(0x19b),()=>{const _0x2a8cd5=_0x181ab2;_0x1eacdd[_0x2a8cd5(0xfe)]=_0x44ec3b['checked'],saveSettingsDebounced(),_0x4f17d9();const _0x22c368=_0x44ec3b[_0x2a8cd5(0x135)]?_0x2a8cd5(0x1c6):_0x2a8cd5(0x1be);toastr['info'](_0x2a8cd5(0x187)+_0x22c368+'。'),log(_0x2a8cd5(0x187)+_0x22c368+'。','info');}),_0x27d827['addEventListener'](_0x181ab2(0x19b),()=>{const _0x26bdf5=_0x181ab2;_0x1eacdd[_0x26bdf5(0x148)]=_0x27d827[_0x26bdf5(0x135)],saveSettingsDebounced();}),_0x3f4226[_0x181ab2(0x131)]('change',()=>{const _0x23cdc9=_0x181ab2;_0x1eacdd[_0x23cdc9(0x139)][_0x23cdc9(0x14f)]=parseInt(_0x3f4226[_0x23cdc9(0xef)],0xa),saveSettingsDebounced(),_0x4f17d9();}),_0x4d6b33[_0x181ab2(0x131)](_0x181ab2(0x1ef),()=>{const _0x4e8b9b=_0x181ab2;_0x1eacdd[_0x4e8b9b(0x139)][_0x4e8b9b(0x119)]=parseInt(_0x4d6b33[_0x4e8b9b(0xef)],0xa),saveSettingsDebounced();}),_0xb3a239[_0x181ab2(0xf0)](_0x2dbff1=>{const _0xbd01e=_0x181ab2;_0x2dbff1['addEventListener'](_0xbd01e(0x19b),()=>{const _0x59e9d1=_0xbd01e;_0x2dbff1[_0x59e9d1(0x135)]&&(_0x1eacdd['injection'][_0x59e9d1(0x13b)]=parseInt(_0x2dbff1['value'],0xa),saveSettingsDebounced());});}),log(_0x181ab2(0x1dc),_0x181ab2(0x193));}function updateAndSaveTableSetting(_0x445bcc,_0x11e70f){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x445bcc]=_0x11e70f,saveSettingsDebounced();}export function bindTableEvents(){const _0x345b7f=_0x3fb332,_0x312543=document[_0x345b7f(0x143)](_0x345b7f(0xf7));if(!_0x312543||_0x312543['dataset']['eventsBound'])return;log('开始为表格视图绑定交互事件...',_0x345b7f(0x185));const _0xec4613=_0x312543[_0x345b7f(0x15a)](_0x345b7f(0x106)),_0x5541cf=()=>{const _0x499889=_0x345b7f,_0x246ae5=extension_settings[extensionName]?.['filling_mode']||'main-api';_0xec4613[_0x499889(0xf0)](_0x464a41=>{const _0x5ab3d2=_0x499889;_0x464a41[_0x5ab3d2(0x135)]=_0x464a41[_0x5ab3d2(0xef)]===_0x246ae5;});};_0xec4613[_0x345b7f(0xf0)](_0x2c621a=>{const _0x24a91d=_0x345b7f;_0x2c621a[_0x24a91d(0x131)](_0x24a91d(0x19b),function(){const _0x544d52=_0x24a91d,_0x146c5d=this['value'];updateAndSaveTableSetting(_0x544d52(0x12d),_0x146c5d);let _0x54ade9=_0x544d52(0x1ee);if(_0x146c5d==='secondary-api')_0x54ade9=_0x544d52(0xeb);if(_0x146c5d===_0x544d52(0x137))_0x54ade9='优化中填表';toastr['info'](_0x544d52(0x1e4)+_0x54ade9+'。'),_0x5541cf();});}),_0x5541cf();const _0x23ffd=()=>{renderTables(),bindInjectionSettings();};_0x23ffd(),bindBatchFillButton(),bindFloorFillButtons(),bindTemplateEditors();const _0x44f0d5=document[_0x345b7f(0x1ec)](_0x345b7f(0xff));_0x44f0d5&&_0x44f0d5[_0x345b7f(0x131)](_0x345b7f(0x1ed),_0x5b2237=>{const _0x5c2fef=_0x345b7f,_0xb65c85=_0x5b2237[_0x5c2fef(0x1d7)]['closest'](_0x5c2fef(0xee));if(!_0xb65c85)return;const _0x50cdd9=_0xb65c85['dataset'][_0x5c2fef(0xea)];if(!_0x50cdd9)return;const _0x314f1b=_0xb65c85[_0x5c2fef(0xed)]('.settings-group');if(!_0x314f1b)return;_0x314f1b[_0x5c2fef(0x15a)]('.sinan-nav-item')[_0x5c2fef(0xf0)](_0x3cadf2=>_0x3cadf2['classList']['remove'](_0x5c2fef(0x153))),_0xb65c85[_0x5c2fef(0x110)]['add']('active'),_0x314f1b['querySelectorAll'](_0x5c2fef(0xec))[_0x5c2fef(0xf0)](_0x160188=>_0x160188[_0x5c2fef(0x110)][_0x5c2fef(0x1ba)](_0x5c2fef(0x153)));const _0x174b8c=_0x314f1b['querySelector'](_0x5c2fef(0x1e6)+_0x50cdd9+'-tab');_0x174b8c&&_0x174b8c[_0x5c2fef(0x110)][_0x5c2fef(0x160)](_0x5c2fef(0x153));});const _0x3db03e=document[_0x345b7f(0x143)](_0x345b7f(0xfc)),_0x285083=document[_0x345b7f(0x143)]('amily2-export-preset-full-btn'),_0x2f539c=document[_0x345b7f(0x143)](_0x345b7f(0x168)),_0x5179ae=document[_0x345b7f(0x143)](_0x345b7f(0x144)),_0x5849b7=document[_0x345b7f(0x143)]('amily2-clear-global-preset-btn');_0x3db03e&&_0x3db03e[_0x345b7f(0x131)](_0x345b7f(0x1ed),()=>_0x5cc481['exportPreset']());_0x285083&&_0x285083[_0x345b7f(0x131)]('click',()=>_0x5cc481[_0x345b7f(0x14e)]());_0x2f539c&&_0x2f539c[_0x345b7f(0x131)](_0x345b7f(0x1ed),()=>_0x5cc481[_0x345b7f(0x1cc)](_0x23ffd));_0x5179ae&&_0x5179ae[_0x345b7f(0x131)](_0x345b7f(0x1ed),()=>{const _0x56afcf=_0x345b7f,_0x266efc=_0x5cc481[_0x56afcf(0x18d)]();_0x5cc481[_0x56afcf(0xf5)](()=>{_0x266efc&&(_0x5cc481['loadTables'](),_0x23ffd());});});_0x5849b7&&_0x5849b7[_0x345b7f(0x131)](_0x345b7f(0x1ed),()=>{const _0x51cf8d=_0x345b7f,_0x197e0c=_0x5cc481[_0x51cf8d(0x18d)]();_0x5cc481['clearGlobalPreset'](),_0x197e0c&&(_0x5cc481['loadTables'](),_0x23ffd());});const _0x1b947a=document[_0x345b7f(0x143)]('amily2-clear-all-tables-btn');_0x1b947a&&_0x1b947a[_0x345b7f(0x131)](_0x345b7f(0x1ed),()=>{const _0x22b573=_0x345b7f;confirm(_0x22b573(0x1ac))&&(_0x5cc481['clearAllTables'](),_0x23ffd());});const _0x2e8378=document[_0x345b7f(0x143)](_0x345b7f(0xf2));_0x2e8378&&_0x2e8378[_0x345b7f(0x131)]('click',()=>{const _0xe83090=_0x345b7f,_0x32668d=prompt('请输入新表格的名称：','新表格');_0x32668d&&_0x32668d[_0xe83090(0x198)]()&&(_0x5cc481[_0xe83090(0x12b)](_0x32668d[_0xe83090(0x198)]()),_0x23ffd());});const _0x609de8=getAllTablesContainer();if(_0x609de8){_0x609de8['addEventListener'](_0x345b7f(0x1ed),_0x26af2f=>{const _0x3811f6=_0x345b7f,_0x2afed4=_0x26af2f['target'][_0x3811f6(0xed)]('th');if(_0x2afed4&&!_0x2afed4[_0x3811f6(0x110)]['contains']('index-col')){toggleColumnContextMenu(_0x26af2f);return;}const _0x5ec409=_0x26af2f[_0x3811f6(0x1d7)][_0x3811f6(0xed)]('td.index-col');if(_0x5ec409){toggleRowContextMenu(_0x26af2f);return;}const _0x99ebd7=_0x26af2f[_0x3811f6(0x1d7)][_0x3811f6(0xed)]('button');if(!_0x99ebd7)return;const _0x23270c=parseInt(_0x99ebd7[_0x3811f6(0x105)][_0x3811f6(0x1d5)],0xa);if(_0x99ebd7['matches'](_0x3811f6(0x17e)))_0x5cc481['addRow'](_0x23270c),_0x23ffd();else{if(_0x99ebd7[_0x3811f6(0x102)](_0x3811f6(0x179)))_0x5cc481[_0x3811f6(0x158)](_0x23270c),_0x23ffd();else{if(_0x99ebd7[_0x3811f6(0x102)](_0x3811f6(0x10a))||_0x99ebd7[_0x3811f6(0x102)]('.move-table-down-btn')){const _0x8a0b86=_0x99ebd7[_0x3811f6(0x110)]['contains'](_0x3811f6(0x19c))?'up':'down';_0x5cc481[_0x3811f6(0x192)](_0x23270c,_0x8a0b86),_0x23ffd();}else{if(_0x99ebd7[_0x3811f6(0x102)](_0x3811f6(0x14c)))openRuleEditor(_0x23270c);else{if(_0x99ebd7[_0x3811f6(0x102)]('.delete-table-btn')){const _0xdb8c7e=_0x5cc481[_0x3811f6(0x1b2)](),_0x39e40d=_0xdb8c7e[_0x23270c]?.['name']||_0x3811f6(0xe6);confirm(_0x3811f6(0x10e)+_0x39e40d+']”\x20吗？此操作不可逆！')&&(_0x5cc481[_0x3811f6(0x161)](_0x23270c),_0x23ffd());}}}}}});const _0x6281a7=()=>'ontouchstart'in window||navigator[_0x345b7f(0x145)]>0x0;if(_0x6281a7()){let _0x45591f=0x0,_0x4b0207=null;_0x609de8[_0x345b7f(0x131)](_0x345b7f(0x1ad),_0x3986d3=>{const _0xc9edf9=_0x345b7f,_0x21e18d=_0x3986d3[_0xc9edf9(0x1d7)]['closest']('td');if(!_0x21e18d||_0x21e18d['dataset']['colIndex']===undefined)return;const _0x407a86=new Date()['getTime'](),_0x5e18e3=_0x407a86-_0x45591f;_0x5e18e3<0x12c&&_0x5e18e3>0x0&&_0x4b0207===_0x21e18d&&(_0x3986d3[_0xc9edf9(0x1bb)](),_0x21e18d['getAttribute']('contenteditable')!==_0xc9edf9(0x159)&&(_0x21e18d[_0xc9edf9(0x1a1)]('contenteditable',_0xc9edf9(0x159)),setTimeout(()=>_0x21e18d[_0xc9edf9(0x1eb)](),0x0))),_0x45591f=_0x407a86,_0x4b0207=_0x21e18d;});}_0x609de8[_0x345b7f(0x131)](_0x345b7f(0x170),_0x34d0b0=>{const _0x3df6d0=_0x345b7f,_0x3eb38f=_0x34d0b0[_0x3df6d0(0x1d7)];if(_0x3eb38f['tagName']!=='TD'||_0x3eb38f['getAttribute'](_0x3df6d0(0x12a))!==_0x3df6d0(0x159))return;const _0x51ea9a=()=>'ontouchstart'in window||navigator[_0x3df6d0(0x145)]>0x0;_0x51ea9a()&&_0x3eb38f[_0x3df6d0(0x1a1)](_0x3df6d0(0x12a),'false');const _0x3a3e1d=_0x3eb38f[_0x3df6d0(0xed)](_0x3df6d0(0x1d9));if(!_0x3a3e1d)return;const _0x544da7=parseInt(_0x3a3e1d['dataset'][_0x3df6d0(0x1d5)],0xa),_0x39d7bf=parseInt(_0x3eb38f[_0x3df6d0(0xed)]('tr')[_0x3df6d0(0x105)][_0x3df6d0(0x162)],0xa),_0x3a29bc=parseInt(_0x3eb38f['dataset'][_0x3df6d0(0x10d)],0xa),_0x484878=_0x3eb38f['textContent'];_0x5cc481[_0x3df6d0(0x1bd)](_0x544da7,_0x39d7bf,_0x3a29bc);const _0x319796={[_0x3a29bc]:_0x484878};_0x5cc481[_0x3df6d0(0x151)](_0x544da7,_0x39d7bf,_0x319796),_0x23ffd();},!![]);}_0x312543[_0x345b7f(0x105)][_0x345b7f(0x1b8)]=_0x345b7f(0x159),log(_0x345b7f(0x17c),_0x345b7f(0x193));}function bindBatchFillButton(){const _0x49ff04=_0x3fb332,_0x551eec=document[_0x49ff04(0x143)]('fill-table-now-btn');if(_0x551eec){if(_0x551eec[_0x49ff04(0x105)][_0x49ff04(0x1b3)])return;_0x551eec['addEventListener']('click',_0x342c77=>{const _0x35c543=_0x49ff04,_0x21be4e=extension_settings[extensionName],_0x33bebd=_0x21be4e[_0x35c543(0xfe)]!==![];if(!_0x33bebd){_0x342c77[_0x35c543(0x1bb)](),toastr['warning'](_0x35c543(0x109));return;}startBatchFilling();}),_0x551eec['dataset'][_0x49ff04(0x1b3)]='true',log(_0x49ff04(0x1b6),_0x49ff04(0x193));}}function bindFloorFillButtons(){const _0x444674=_0x3fb332,_0x2f5bf7=document[_0x444674(0x143)](_0x444674(0x190)),_0x2f2ed1=document[_0x444674(0x143)]('fill-current-floor-btn');if(_0x2f5bf7){if(_0x2f5bf7['dataset']['floorEventBound'])return;_0x2f5bf7[_0x444674(0x131)](_0x444674(0x1ed),_0x406939=>{const _0x4019d6=_0x444674,_0x4d1013=extension_settings[extensionName],_0x2ce066=_0x4d1013[_0x4019d6(0xfe)]!==![];if(!_0x2ce066){_0x406939['preventDefault'](),toastr[_0x4019d6(0xe3)](_0x4019d6(0x109));return;}const _0x5de428=document[_0x4019d6(0x143)](_0x4019d6(0x1c4)),_0x5885a4=document[_0x4019d6(0x143)](_0x4019d6(0x1a8)),_0x1261c9=parseInt(_0x5de428['value'],0xa),_0x28ac7e=parseInt(_0x5885a4[_0x4019d6(0xef)],0xa);if(!_0x1261c9||!_0x28ac7e){toastr[_0x4019d6(0xe3)](_0x4019d6(0x177));return;}if(_0x1261c9>_0x28ac7e){toastr[_0x4019d6(0xe3)]('起始楼层不能大于结束楼层。');return;}if(_0x1261c9<0x1){toastr[_0x4019d6(0xe3)](_0x4019d6(0x173));return;}import(_0x4019d6(0x1dd))[_0x4019d6(0x1df)](_0x4f57f8=>{const _0x581599=_0x4019d6;_0x4f57f8[_0x581599(0x108)](_0x1261c9,_0x28ac7e);});}),_0x2f5bf7[_0x444674(0x105)][_0x444674(0x104)]=_0x444674(0x159),log(_0x444674(0x188),_0x444674(0x193));}if(_0x2f2ed1){if(_0x2f2ed1[_0x444674(0x105)][_0x444674(0x117)])return;_0x2f2ed1['addEventListener'](_0x444674(0x1ed),_0x2c39b8=>{const _0x4f2e18=_0x444674,_0x340297=extension_settings[extensionName],_0x43960f=_0x340297[_0x4f2e18(0xfe)]!==![];if(!_0x43960f){_0x2c39b8[_0x4f2e18(0x1bb)](),toastr['warning'](_0x4f2e18(0x109));return;}import('../core/table-system/batch-filler.js')['then'](_0x580e2b=>{const _0x515da3=_0x4f2e18;_0x580e2b[_0x515da3(0x1e8)]();});}),_0x2f2ed1[_0x444674(0x105)][_0x444674(0x117)]=_0x444674(0x159),log('\x22填当前楼层\x22按钮已成功绑定。',_0x444674(0x193));}}function bindTemplateEditors(){const _0x2142f=_0x3fb332,_0x535909=document[_0x2142f(0x143)](_0x2142f(0x1cb)),_0x1b199a=document[_0x2142f(0x143)](_0x2142f(0x146)),_0x3f9418=document[_0x2142f(0x143)](_0x2142f(0x15b)),_0x5a922a=document[_0x2142f(0x143)](_0x2142f(0xe8)),_0x379978=document[_0x2142f(0x143)]('ai-flow-template-save-btn'),_0x35a9bf=document[_0x2142f(0x143)]('ai-flow-template-restore-btn');if(!_0x535909||!_0x5a922a){log(_0x2142f(0x152),'warn');return;}_0x535909[_0x2142f(0xef)]=_0x5cc481[_0x2142f(0x150)](),_0x5a922a[_0x2142f(0xef)]=_0x5cc481[_0x2142f(0x1af)](),_0x1b199a[_0x2142f(0x131)](_0x2142f(0x1ed),()=>{const _0x1ed4bd=_0x2142f;_0x5cc481[_0x1ed4bd(0x15f)](_0x535909[_0x1ed4bd(0xef)]),toastr['success'](_0x1ed4bd(0x167)),log(_0x1ed4bd(0x1e7),_0x1ed4bd(0x193));}),_0x379978['addEventListener']('click',()=>{const _0x232d1f=_0x2142f;_0x5cc481['saveBatchFillerFlowTemplate'](_0x5a922a['value']),toastr['success'](_0x232d1f(0x122)),log(_0x232d1f(0x195),_0x232d1f(0x193));}),_0x3f9418[_0x2142f(0x131)]('click',()=>{const _0x2a3e8e=_0x2142f;confirm(_0x2a3e8e(0x113))&&(_0x535909[_0x2a3e8e(0xef)]=DEFAULT_AI_RULE_TEMPLATE,_0x5cc481[_0x2a3e8e(0x15f)](_0x535909[_0x2a3e8e(0xef)]),toastr[_0x2a3e8e(0x185)](_0x2a3e8e(0x1c0)),log(_0x2a3e8e(0x132),_0x2a3e8e(0x185)));}),_0x35a9bf[_0x2142f(0x131)](_0x2142f(0x1ed),()=>{const _0x5bf9ae=_0x2142f;confirm(_0x5bf9ae(0x1c5))&&(_0x5a922a[_0x5bf9ae(0xef)]=DEFAULT_AI_FLOW_TEMPLATE,_0x5cc481[_0x5bf9ae(0x130)](_0x5a922a[_0x5bf9ae(0xef)]),toastr[_0x5bf9ae(0x185)]('流程提示词已恢复为默认。'),log(_0x5bf9ae(0x14b),'info'));}),log('指令模板编辑器已成功绑定。',_0x2142f(0x193));}
