const _0x39fe9b=_0x24eb;(function(_0x5b0839,_0x1e8594){const _0x2553c3=_0x24eb,_0x2cd666=_0x5b0839();while(!![]){try{const _0x3a91ae=parseInt(_0x2553c3(0x11d))/0x1*(-parseInt(_0x2553c3(0x186))/0x2)+-parseInt(_0x2553c3(0x1c9))/0x3*(-parseInt(_0x2553c3(0x138))/0x4)+-parseInt(_0x2553c3(0x1a4))/0x5+parseInt(_0x2553c3(0x16d))/0x6*(-parseInt(_0x2553c3(0x19f))/0x7)+-parseInt(_0x2553c3(0x157))/0x8*(parseInt(_0x2553c3(0x17c))/0x9)+parseInt(_0x2553c3(0x180))/0xa+parseInt(_0x2553c3(0x122))/0xb;if(_0x3a91ae===_0x1e8594)break;else _0x2cd666['push'](_0x2cd666['shift']());}catch(_0x1f803a){_0x2cd666['push'](_0x2cd666['shift']());}}}(_0x1c15,0x68c4b));import*as _0x303e6c from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x39fe9b(0x124)](_0x39fe9b(0x195));export function renderTables(){const _0x3d2170=_0x39fe9b;let _0x1f592d=_0x303e6c['getMemoryState']();!_0x1f592d&&(log('内存状态为空，从聊天记录加载作为后备。',_0x3d2170(0x18d)),_0x1f592d=_0x303e6c[_0x3d2170(0x131)]());const _0xe4cd0c=getAllTablesContainer();if(!_0x1f592d||!_0xe4cd0c){console[_0x3d2170(0x1b5)](_0x3d2170(0x13c));return;}const _0xa4c1c3=document[_0x3d2170(0x124)](_0x3d2170(0x198));_0xa4c1c3&&_0xa4c1c3[_0x3d2170(0x192)](),_0xe4cd0c['innerHTML']='',_0x1f592d['forEach']((_0x4fa5cd,_0x570298)=>{const _0x31e1d9=_0x3d2170,_0x3d8c68=document[_0x31e1d9(0x164)]('div');_0x3d8c68[_0x31e1d9(0x1c7)]='table-instance-container';const _0x59ebfa=document['createElement'](_0x31e1d9(0x1a3));_0x59ebfa[_0x31e1d9(0x1d5)][_0x31e1d9(0x1c2)]=_0x31e1d9(0x194),_0x59ebfa[_0x31e1d9(0x1d5)][_0x31e1d9(0x14a)]=_0x31e1d9(0x126),_0x59ebfa[_0x31e1d9(0x1d5)][_0x31e1d9(0x161)]=_0x31e1d9(0x149);const _0x1e7da3=document[_0x31e1d9(0x164)]('h3');_0x1e7da3[_0x31e1d9(0x158)]=_0x31e1d9(0x125)+_0x4fa5cd[_0x31e1d9(0x145)];const _0x24f3c2=document['createElement'](_0x31e1d9(0x1a3));_0x24f3c2[_0x31e1d9(0x1c7)]=_0x31e1d9(0x1ab);const _0x264f22=_0x570298>0x0?'<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22'+_0x570298+_0x31e1d9(0x184):'',_0x2da292=_0x570298<_0x1f592d[_0x31e1d9(0x19e)]-0x1?_0x31e1d9(0x1d0)+_0x570298+_0x31e1d9(0x18f):'';_0x24f3c2[_0x31e1d9(0x158)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x264f22+_0x31e1d9(0x1c6)+_0x2da292+_0x31e1d9(0x1b2)+_0x570298+_0x31e1d9(0x14f)+_0x570298+_0x31e1d9(0x141)+_0x570298+_0x31e1d9(0x15c)+_0x570298+_0x31e1d9(0x144),_0x59ebfa[_0x31e1d9(0x1ba)](_0x1e7da3),_0x59ebfa[_0x31e1d9(0x1ba)](_0x24f3c2),_0xe4cd0c[_0x31e1d9(0x1ba)](_0x59ebfa);const _0x45eb54=document['createElement'](_0x31e1d9(0x1a3));_0x45eb54['style'][_0x31e1d9(0x147)]=_0x31e1d9(0x139);const _0x92d4b3=document[_0x31e1d9(0x164)](_0x31e1d9(0x1ce));_0x92d4b3['id']='amily2-table-'+_0x570298,_0x92d4b3[_0x31e1d9(0x17e)][_0x31e1d9(0x16a)]=_0x570298;const _0x18d14b=_0x92d4b3['createTHead'](),_0x16fbc1=_0x18d14b[_0x31e1d9(0x15e)](),_0x5d529f=document[_0x31e1d9(0x164)]('th');_0x5d529f[_0x31e1d9(0x1c7)]=_0x31e1d9(0x14c),_0x5d529f[_0x31e1d9(0x153)]='#',_0x16fbc1[_0x31e1d9(0x1ba)](_0x5d529f),_0x4fa5cd[_0x31e1d9(0x177)][_0x31e1d9(0x13d)]((_0x4bcf83,_0x3bc8cb)=>{const _0x4852e9=_0x31e1d9,_0x99f4aa=document[_0x4852e9(0x164)]('th');_0x99f4aa[_0x4852e9(0x153)]=_0x4bcf83,_0x99f4aa['setAttribute']('contenteditable',_0x4852e9(0x1d6)),_0x99f4aa[_0x4852e9(0x17e)][_0x4852e9(0x19b)]=_0x3bc8cb;const _0x39f8bd=document[_0x4852e9(0x164)]('i');_0x39f8bd[_0x4852e9(0x1c7)]='fas\x20fa-pen-to-square\x20mobile-edit-handle',_0x39f8bd[_0x4852e9(0x1da)]=_0x4852e9(0x1b0),_0x39f8bd[_0x4852e9(0x1d5)][_0x4852e9(0x13f)]=_0x4852e9(0x133),_0x39f8bd[_0x4852e9(0x1d5)][_0x4852e9(0x189)]=_0x4852e9(0x1a8),_0x39f8bd['addEventListener'](_0x4852e9(0x15d),_0x30275a=>{const _0x425841=_0x4852e9;_0x30275a['stopPropagation'](),_0x99f4aa[_0x425841(0x197)](_0x425841(0x120),_0x425841(0x1d6)),_0x99f4aa['focus']();const _0x2d6de5=document[_0x425841(0x156)](),_0x33de37=window[_0x425841(0x17a)]();_0x2d6de5[_0x425841(0x181)](_0x99f4aa),_0x2d6de5['collapse'](![]),_0x33de37[_0x425841(0x14d)](),_0x33de37['addRange'](_0x2d6de5);}),_0x99f4aa[_0x4852e9(0x1ba)](_0x39f8bd),_0x16fbc1['appendChild'](_0x99f4aa);});const _0x32b5a0=_0x92d4b3[_0x31e1d9(0x17f)]();_0x4fa5cd[_0x31e1d9(0x15f)]&&_0x4fa5cd['rows'][_0x31e1d9(0x19e)]>0x0&&_0x4fa5cd['rows']['forEach']((_0x48dbc0,_0x3294cd)=>{const _0x1f6661=_0x31e1d9,_0x296b91=_0x32b5a0[_0x1f6661(0x15e)]();_0x296b91[_0x1f6661(0x17e)][_0x1f6661(0x1c3)]=_0x3294cd;const _0x332e41=_0x296b91['insertCell']();_0x332e41[_0x1f6661(0x1c7)]='index-col\x20delete-row-handle',_0x332e41[_0x1f6661(0x1da)]=_0x1f6661(0x12b),_0x332e41[_0x1f6661(0x153)]=_0x3294cd+0x1,_0x332e41['style']['cursor']=_0x1f6661(0x133),_0x332e41[_0x1f6661(0x1a1)](_0x1f6661(0x15d),async _0x4dae23=>{const _0x5b8e93=_0x1f6661;_0x4dae23['stopPropagation'](),window[_0x5b8e93(0x1bf)](_0x5b8e93(0x1be)+_0x4fa5cd[_0x5b8e93(0x145)]+_0x5b8e93(0x129)+(_0x3294cd+0x1)+_0x5b8e93(0x1d1))&&(await _0x303e6c[_0x5b8e93(0x17b)](_0x570298,_0x3294cd),renderTables());}),_0x48dbc0[_0x1f6661(0x13d)]((_0xa639a0,_0x3d5a7e)=>{const _0x45c2e3=_0x1f6661,_0x4dd059=_0x296b91[_0x45c2e3(0x167)]();_0x4dd059[_0x45c2e3(0x153)]=_0xa639a0,_0x4dd059[_0x45c2e3(0x197)](_0x45c2e3(0x120),_0x45c2e3(0x1d6)),_0x4dd059['dataset'][_0x45c2e3(0x19b)]=_0x3d5a7e,_0x4dd059['dataset'][_0x45c2e3(0x174)]=_0x4fa5cd[_0x45c2e3(0x177)][_0x3d5a7e]||'';});});_0x45eb54['appendChild'](_0x92d4b3),_0x3d8c68[_0x31e1d9(0x1ba)](_0x45eb54);if(_0x570298<_0x1f592d[_0x31e1d9(0x19e)]-0x1){const _0x2f7393=document[_0x31e1d9(0x164)]('hr');_0x2f7393[_0x31e1d9(0x1d5)][_0x31e1d9(0x12d)]=_0x31e1d9(0x151),_0x2f7393[_0x31e1d9(0x1d5)]['margin']='20px\x200',_0x2f7393[_0x31e1d9(0x1d5)][_0x31e1d9(0x13b)]=_0x31e1d9(0x176),_0x3d8c68[_0x31e1d9(0x1ba)](_0x2f7393);}_0xe4cd0c[_0x31e1d9(0x1ba)](_0x3d8c68);}),_0xa4c1c3&&_0xe4cd0c['appendChild'](_0xa4c1c3);}function openRuleEditor(_0x3f5c0c){const _0x1abcea=_0x39fe9b,_0x5e65ae=_0x303e6c['getMemoryState']();if(!_0x5e65ae||!_0x5e65ae[_0x3f5c0c])return;const _0x1e70b8=_0x5e65ae[_0x3f5c0c],_0x1d83eb='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“'+_0x1e70b8[_0x1abcea(0x145)]+'”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>'+(_0x1e70b8['note']||'')+_0x1abcea(0x188)+(_0x1e70b8[_0x1abcea(0x14b)]||'')+_0x1abcea(0x12c)+(_0x1e70b8[_0x1abcea(0x1b8)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x1e70b8['rule_update']||'')+_0x1abcea(0x19a),_0x2f0d08=$(_0x1d83eb)[_0x1abcea(0x187)]('body'),_0x5837e7=()=>{const _0x434e5f=_0x1abcea;_0x2f0d08[0x0][_0x434e5f(0x18a)](),_0x2f0d08[_0x434e5f(0x192)]();};_0x2f0d08[_0x1abcea(0x14e)](_0x1abcea(0x165))['on'](_0x1abcea(0x15d),()=>{const _0x41ce15=_0x1abcea,_0x115eb1={'note':_0x2f0d08[_0x41ce15(0x14e)](_0x41ce15(0x18e))[_0x41ce15(0x140)](),'rule_add':_0x2f0d08[_0x41ce15(0x14e)](_0x41ce15(0x13e))[_0x41ce15(0x140)](),'rule_delete':_0x2f0d08[_0x41ce15(0x14e)]('#rule-delete')[_0x41ce15(0x140)](),'rule_update':_0x2f0d08[_0x41ce15(0x14e)]('#rule-update')[_0x41ce15(0x140)]()};_0x303e6c[_0x41ce15(0x11e)](_0x3f5c0c,_0x115eb1),_0x5837e7();}),_0x2f0d08[_0x1abcea(0x14e)](_0x1abcea(0x1bc))['on'](_0x1abcea(0x15d),_0x5837e7),_0x2f0d08[0x0]['showModal']();}function _0x24eb(_0x20fabc,_0x49274e){const _0x1c15d7=_0x1c15();return _0x24eb=function(_0x24ebf3,_0x2745ce){_0x24ebf3=_0x24ebf3-0x11d;let _0x3fda90=_0x1c15d7[_0x24ebf3];return _0x3fda90;},_0x24eb(_0x20fabc,_0x49274e);}function bindInjectionSettings(){const _0x850c32=_0x39fe9b,_0x35c54b=extension_settings[extensionName],_0x4ce7d2=document[_0x850c32(0x124)](_0x850c32(0x12a)),_0x50b9cb=document[_0x850c32(0x124)](_0x850c32(0x148)),_0x5523bd=document['getElementById'](_0x850c32(0x190)),_0x4f0b16=document[_0x850c32(0x124)](_0x850c32(0x1ae));if(!_0x4ce7d2||!_0x50b9cb||!_0x5523bd||!_0x4f0b16)return;const _0x3fa92f=()=>{const _0x529d32=_0x850c32,_0x4f3d47=_0x50b9cb[_0x529d32(0x1b3)],_0x4170b4=_0x4f3d47==='1';_0x5523bd['disabled']=!_0x4170b4,_0x4f0b16[_0x529d32(0x1c1)]=!_0x4170b4;const _0x4091d6=_0x4170b4?'1':'0.5';_0x5523bd[_0x529d32(0x1d5)][_0x529d32(0x175)]=_0x4091d6;_0x5523bd[_0x529d32(0x130)]&&(_0x5523bd[_0x529d32(0x130)]['style'][_0x529d32(0x175)]=_0x4091d6);const _0x163ec2=_0x4170b4?'1':'0.5';_0x4f0b16['style'][_0x529d32(0x175)]=_0x163ec2,_0x4f0b16[_0x529d32(0x130)]&&(_0x4f0b16[_0x529d32(0x130)][_0x529d32(0x1d5)][_0x529d32(0x175)]=_0x163ec2);};_0x4ce7d2['checked']=_0x35c54b[_0x850c32(0x1d9)],_0x50b9cb['value']=_0x35c54b[_0x850c32(0x182)],_0x5523bd[_0x850c32(0x1b3)]=_0x35c54b['table_injection_depth'],_0x4f0b16[_0x850c32(0x1b3)]=_0x35c54b[_0x850c32(0x146)],_0x3fa92f(),_0x4ce7d2[_0x850c32(0x1a1)](_0x850c32(0x168),()=>{const _0x410080=_0x850c32;_0x35c54b[_0x410080(0x1d9)]=_0x4ce7d2[_0x410080(0x1ac)],saveSettingsDebounced();}),_0x50b9cb[_0x850c32(0x1a1)](_0x850c32(0x168),()=>{const _0x3177e5=_0x850c32;_0x35c54b[_0x3177e5(0x182)]=parseInt(_0x50b9cb[_0x3177e5(0x1b3)],0xa),saveSettingsDebounced(),_0x3fa92f();}),_0x5523bd['addEventListener'](_0x850c32(0x128),()=>{const _0x362ba8=_0x850c32;_0x35c54b[_0x362ba8(0x143)]=parseInt(_0x5523bd[_0x362ba8(0x1b3)],0xa),saveSettingsDebounced();}),_0x4f0b16['addEventListener'](_0x850c32(0x168),()=>{const _0x26c093=_0x850c32;_0x35c54b['table_injection_role']=_0x4f0b16[_0x26c093(0x1b3)],saveSettingsDebounced();}),log(_0x850c32(0x1a7),_0x850c32(0x171));}export function bindTableEvents(){const _0x574788=_0x39fe9b,_0x3a5129=document[_0x574788(0x124)](_0x574788(0x178));if(!_0x3a5129||_0x3a5129[_0x574788(0x17e)][_0x574788(0x1d4)])return;log(_0x574788(0x193),_0x574788(0x1ca));const _0x2ba502=()=>{renderTables(),bindInjectionSettings();};_0x2ba502(),bindBatchFillButton(),bindTemplateEditors();const _0x2466fe=document['querySelector']('#amily2_memorisation_forms_panel\x20.sinan-navigation-deck');_0x2466fe&&_0x2466fe[_0x574788(0x1a1)](_0x574788(0x15d),_0x492dca=>{const _0x4e004a=_0x574788,_0xf84c47=_0x492dca[_0x4e004a(0x1d2)]['closest']('.sinan-nav-item');if(!_0xf84c47)return;const _0x4eb7cf=_0xf84c47[_0x4e004a(0x17e)][_0x4e004a(0x134)];if(!_0x4eb7cf)return;const _0x59e70e=_0xf84c47[_0x4e004a(0x152)](_0x4e004a(0x1cf));if(!_0x59e70e)return;_0x59e70e[_0x4e004a(0x163)](_0x4e004a(0x16f))['forEach'](_0x3002b8=>_0x3002b8[_0x4e004a(0x191)][_0x4e004a(0x192)](_0x4e004a(0x1bb))),_0xf84c47[_0x4e004a(0x191)][_0x4e004a(0x15b)]('active'),_0x59e70e[_0x4e004a(0x163)](_0x4e004a(0x16c))[_0x4e004a(0x13d)](_0x14a7ad=>_0x14a7ad['classList']['remove']('active'));const _0x2345f1=_0x59e70e[_0x4e004a(0x1cd)](_0x4e004a(0x135)+_0x4eb7cf+_0x4e004a(0x1c4));_0x2345f1&&_0x2345f1[_0x4e004a(0x191)][_0x4e004a(0x15b)](_0x4e004a(0x1bb));});const _0x21053d=document['getElementById'](_0x574788(0x142)),_0x31ce75=document[_0x574788(0x124)](_0x574788(0x173)),_0x14e8e6=document[_0x574788(0x124)](_0x574788(0x1cc));_0x21053d&&_0x21053d[_0x574788(0x1a1)](_0x574788(0x15d),()=>_0x303e6c[_0x574788(0x137)]());_0x31ce75&&_0x31ce75[_0x574788(0x1a1)](_0x574788(0x15d),()=>_0x303e6c[_0x574788(0x132)]());_0x14e8e6&&_0x14e8e6['addEventListener'](_0x574788(0x15d),()=>_0x303e6c[_0x574788(0x1b6)](_0x2ba502));const _0x3d4b4f=document[_0x574788(0x124)](_0x574788(0x199));_0x3d4b4f&&_0x3d4b4f[_0x574788(0x1a1)](_0x574788(0x15d),()=>{const _0x60dbd2=_0x574788;confirm(_0x60dbd2(0x185))&&(_0x303e6c['clearAllTables'](),_0x2ba502());});const _0x1f430d=document[_0x574788(0x124)](_0x574788(0x198));_0x1f430d&&_0x1f430d[_0x574788(0x1a1)]('click',()=>{const _0x569058=_0x574788,_0x5a1f12=prompt(_0x569058(0x183),_0x569058(0x1c8));_0x5a1f12&&_0x5a1f12[_0x569058(0x150)]()&&(_0x303e6c[_0x569058(0x170)](_0x5a1f12[_0x569058(0x150)]()),_0x2ba502());});const _0x17797b=getAllTablesContainer();_0x17797b&&(_0x17797b[_0x574788(0x1a1)]('click',_0x514ab8=>{const _0x142449=_0x574788,_0x4bf163=_0x514ab8[_0x142449(0x1d2)][_0x142449(0x152)]('button');if(!_0x4bf163)return;const _0xfeaa22=parseInt(_0x4bf163[_0x142449(0x17e)][_0x142449(0x16a)],0xa);if(_0x4bf163[_0x142449(0x121)](_0x142449(0x166))){if(_0x4bf163[_0x142449(0x191)][_0x142449(0x1a9)](_0x142449(0x17d)))_0x303e6c[_0x142449(0x1c0)](_0xfeaa22);else{if(_0x4bf163[_0x142449(0x191)]['contains'](_0x142449(0x12f)))_0x303e6c[_0x142449(0x1cb)](_0xfeaa22);}_0x2ba502();}else{if(_0x4bf163[_0x142449(0x121)]('.move-table-up-btn')||_0x4bf163[_0x142449(0x121)](_0x142449(0x1a5))){const _0x4221df=_0x4bf163[_0x142449(0x191)][_0x142449(0x1a9)]('move-table-up-btn')?'up':_0x142449(0x1a6);_0x303e6c[_0x142449(0x1ad)](_0xfeaa22,_0x4221df),_0x2ba502();}else{if(_0x4bf163[_0x142449(0x121)](_0x142449(0x19c))){const _0x2db010=parseInt(_0x4bf163[_0x142449(0x152)]('tr')[_0x142449(0x17e)][_0x142449(0x1c3)],0xa);confirm(_0x142449(0x1aa))&&(_0x303e6c[_0x142449(0x17b)](_0xfeaa22,_0x2db010),_0x2ba502());}else{if(_0x4bf163[_0x142449(0x121)](_0x142449(0x1b9))||_0x4bf163[_0x142449(0x152)](_0x142449(0x1b9))){const _0x2e9ead=_0x4bf163['closest'](_0x142449(0x1b9)),_0x33fc23=parseInt(_0x2e9ead[_0x142449(0x17e)][_0x142449(0x16a)],0xa);openRuleEditor(_0x33fc23);}else{if(_0x4bf163['matches'](_0x142449(0x160))){const _0x2a1309=parseInt(_0x4bf163['dataset']['tableIndex'],0xa),_0x483334=_0x303e6c[_0x142449(0x16b)](),_0x14a28b=_0x483334[_0x2a1309]?.[_0x142449(0x145)]||_0x142449(0x162);confirm(_0x142449(0x1d3)+_0x14a28b+_0x142449(0x1a0))&&(_0x303e6c['deleteTable'](_0x2a1309),_0x2ba502());}}}}}}),_0x17797b[_0x574788(0x1a1)](_0x574788(0x123),_0x5e4fba=>{const _0x17f453=_0x574788,_0x521447=_0x5e4fba[_0x17f453(0x1d2)],_0x3a45d1=_0x521447['closest']('table');if(!_0x3a45d1)return;const _0x63a989=parseInt(_0x3a45d1[_0x17f453(0x17e)][_0x17f453(0x16a)],0xa),_0x41c805=_0x521447[_0x17f453(0x153)];if(_0x521447[_0x17f453(0x136)]==='TD'){const _0x4d9d6b=parseInt(_0x521447[_0x17f453(0x152)]('tr')[_0x17f453(0x17e)][_0x17f453(0x1c3)],0xa),_0x5c0243=parseInt(_0x521447[_0x17f453(0x17e)]['colIndex'],0xa);_0x303e6c['updateCell'](_0x63a989,_0x4d9d6b,_0x5c0243,_0x41c805);}else{if(_0x521447[_0x17f453(0x136)]==='TH'&&!_0x521447['classList'][_0x17f453(0x1a9)](_0x17f453(0x14c))){const _0x1a4852=parseInt(_0x521447[_0x17f453(0x17e)][_0x17f453(0x19b)],0xa);_0x41c805[_0x17f453(0x150)]()===''?confirm('您确定要通过清空表头来删除此列吗？')?(_0x303e6c[_0x17f453(0x159)](_0x63a989,_0x1a4852),_0x2ba502()):_0x2ba502():_0x303e6c[_0x17f453(0x1b7)](_0x63a989,_0x1a4852,_0x41c805);}}},!![])),_0x3a5129[_0x574788(0x17e)]['eventsBound']='true',log(_0x574788(0x1b1),_0x574788(0x171));}function bindBatchFillButton(){const _0x913dd0=_0x39fe9b,_0xce2b0f=document[_0x913dd0(0x124)](_0x913dd0(0x169));if(_0xce2b0f){if(_0xce2b0f[_0x913dd0(0x17e)]['batchEventBound'])return;_0xce2b0f['addEventListener'](_0x913dd0(0x15d),startBatchFilling),_0xce2b0f[_0x913dd0(0x17e)]['batchEventBound']=_0x913dd0(0x1d6),log(_0x913dd0(0x12e),_0x913dd0(0x171));}}function bindTemplateEditors(){const _0x8016b6=_0x39fe9b,_0x59dee7=document[_0x8016b6(0x124)](_0x8016b6(0x13a)),_0xfa8c8=document['getElementById'](_0x8016b6(0x155)),_0x543aee=document['getElementById'](_0x8016b6(0x1a2)),_0x372d39=document[_0x8016b6(0x124)](_0x8016b6(0x18c)),_0x2f8a1d=document[_0x8016b6(0x124)](_0x8016b6(0x18b)),_0x501e0c=document['getElementById'](_0x8016b6(0x179));if(!_0x59dee7||!_0x372d39){log('无法找到指令模板编辑器，绑定失败。',_0x8016b6(0x18d));return;}_0x59dee7[_0x8016b6(0x1b3)]=_0x303e6c[_0x8016b6(0x1bd)](),_0x372d39[_0x8016b6(0x1b3)]=_0x303e6c[_0x8016b6(0x1af)](),_0xfa8c8[_0x8016b6(0x1a1)](_0x8016b6(0x15d),()=>{const _0x55f7c7=_0x8016b6;_0x303e6c[_0x55f7c7(0x172)](_0x59dee7[_0x55f7c7(0x1b3)]),toastr[_0x55f7c7(0x171)](_0x55f7c7(0x1c5)),log(_0x55f7c7(0x11f),_0x55f7c7(0x171));}),_0x2f8a1d['addEventListener'](_0x8016b6(0x15d),()=>{const _0xb3fd6a=_0x8016b6;_0x303e6c[_0xb3fd6a(0x1d7)](_0x372d39[_0xb3fd6a(0x1b3)]),toastr[_0xb3fd6a(0x171)](_0xb3fd6a(0x1d8)),log(_0xb3fd6a(0x196),_0xb3fd6a(0x171));}),_0x543aee[_0x8016b6(0x1a1)](_0x8016b6(0x15d),()=>{const _0x52eb3e=_0x8016b6;confirm(_0x52eb3e(0x16e))&&(_0x59dee7[_0x52eb3e(0x1b3)]=DEFAULT_AI_RULE_TEMPLATE,_0x303e6c[_0x52eb3e(0x172)](_0x59dee7[_0x52eb3e(0x1b3)]),toastr[_0x52eb3e(0x1ca)]('规则提示词已恢复为默认。'),log(_0x52eb3e(0x1b4),'info'));}),_0x501e0c[_0x8016b6(0x1a1)](_0x8016b6(0x15d),()=>{const _0x98ad6c=_0x8016b6;confirm(_0x98ad6c(0x15a))&&(_0x372d39[_0x98ad6c(0x1b3)]=DEFAULT_AI_FLOW_TEMPLATE,_0x303e6c['saveBatchFillerFlowTemplate'](_0x372d39[_0x98ad6c(0x1b3)]),toastr['info'](_0x98ad6c(0x127)),log(_0x98ad6c(0x19d),_0x98ad6c(0x1ca)));}),log(_0x8016b6(0x154),_0x8016b6(0x171));}function _0x1c15(){const _0x65830e=['updateTableRules','批量填表-规则提示词已保存。','contenteditable','matches','16830352WyfgBw','blur','getElementById','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','space-between','流程提示词已恢复为默认。','input',']\x20的第\x20','table-injection-enabled','点击删除此行','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','borderStyle','“立即填表”按钮已成功绑定。','add-col-btn','previousElementSibling','loadTables','exportPresetFull','pointer','tab','#sinan-','tagName','exportPreset','4xYNHWE','auto','ai-rule-template-editor','borderColor','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','forEach','#rule-add','cursor','val','\x22>加行</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-col-btn\x22\x20data-table-index=\x22','amily2-export-preset-btn','table_injection_depth','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','name','table_injection_role','overflowX','table-injection-position','center','justifyContent','rule_add','index-col','removeAllRanges','find','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-row-btn\x22\x20data-table-index=\x22','trim','dashed','closest','textContent','指令模板编辑器已成功绑定。','ai-rule-template-save-btn','createRange','79208cDjToY','innerHTML','deleteColumn','您确定要将流程提示词恢复为默认设置吗？','add','\x22>加列</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','click','insertRow','rows','.delete-table-btn','alignItems','未知表格','querySelectorAll','createElement','.popup-button-ok','.add-row-btn,\x20.add-col-btn','insertCell','change','fill-table-now-btn','tableIndex','getMemoryState','.sinan-tab-pane','4986kHNwlb','您确定要将规则提示词恢复为默认设置吗？','.sinan-nav-item','addTable','success','saveBatchFillerRuleTemplate','amily2-export-preset-full-btn','label','opacity','rgba(255,\x20255,\x20255,\x200.2)','headers','amily2_memorisation_forms_panel','ai-flow-template-restore-btn','getSelection','deleteRow','90UGHmIW','add-row-btn','dataset','createTBody','1129530mpXIWD','selectNodeContents','table_injection_position','请输入新表格的名称：','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','6AZNLtn','appendTo','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','marginLeft','close','ai-flow-template-save-btn','ai-flow-template-editor','warn','#rule-note','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','table-injection-depth','classList','remove','开始为表格视图绑定交互事件...','flex','all-tables-container','批量填表-流程提示词已保存。','setAttribute','add-table-placeholder','amily2-clear-all-tables-btn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','colIndex','.delete-row-handle','批量填表-流程提示词已恢复默认。','length','4193Ruvmyz',']”\x20吗？此操作不可逆！','addEventListener','ai-rule-template-restore-btn','div','3834030dzEQtC','.move-table-down-btn','down','表格注入设置已成功绑定。','8px','contains','您确定要删除这一行吗？','table-controls','checked','moveTable','table-injection-role','getBatchFillerFlowTemplate','编辑此列名','表格视图交互事件已成功绑定。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','value','批量填表-规则提示词已恢复默认。','error','importPreset','updateHeader','rule_delete','.edit-rules-btn','appendChild','active','.popup-button-cancel','getBatchFillerRuleTemplate','您确定要删除表格\x20[','confirm','addRow','disabled','display','rowIndex','-tab','规则提示词已保存。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','className','新表格','2134452ruRwhV','info','addColumn','amily2-import-preset-btn','querySelector','table','.settings-group','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','\x20行吗？','target','【最终警告】您确定要永久废黜表格\x20“[','eventsBound','style','true','saveBatchFillerFlowTemplate','流程提示词已保存。','table_injection_enabled','title','187251wKUjZY'];_0x1c15=function(){return _0x65830e;};return _0x1c15();}
