const _0x33c8f3=_0x5e44;(function(_0x4f6809,_0x40a2ee){const _0x3165ae=_0x5e44,_0x37c398=_0x4f6809();while(!![]){try{const _0x1dfb32=-parseInt(_0x3165ae(0xba))/0x1*(parseInt(_0x3165ae(0x121))/0x2)+parseInt(_0x3165ae(0x90))/0x3+-parseInt(_0x3165ae(0x7d))/0x4*(parseInt(_0x3165ae(0xe7))/0x5)+-parseInt(_0x3165ae(0x12a))/0x6+-parseInt(_0x3165ae(0x99))/0x7+parseInt(_0x3165ae(0x12b))/0x8+parseInt(_0x3165ae(0xea))/0x9*(parseInt(_0x3165ae(0xdc))/0xa);if(_0x1dfb32===_0x40a2ee)break;else _0x37c398['push'](_0x37c398['shift']());}catch(_0x298703){_0x37c398['push'](_0x37c398['shift']());}}}(_0x2535,0xeb606));import*as _0x1225e6 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';function _0x2535(){const _0x4c956f=['auto','focus','danger','opacity','input','flex','floor-end-input','.amily2-context-menu','trim','100%','#rule-delete','alignItems','close','请输入新表格的名称：','stopPropagation','target','keydown','amily2-table-','rows','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','328PuuzLJ','table-injection-position','position','success','add-below','add-table-placeholder','.control-block-with-switch','表格视图交互事件已成功绑定。','fa-arrow-down','eventsBound','input[name=\x22table-injection-role\x22]','move-down','right','has','find','#rule-update','编辑列名','在下加行','../core/table-system/batch-filler.js','tagName','span','saveBatchFillerFlowTemplate','amily2-context-menu\x20amily2-row-context-menu','deleteTable','fill-table-now-btn','appendTo','table-injection-depth','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','move-table-up-btn','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','maxTouchPoints','#sinan-','table-system-master-switch','move-right','478130LWIbGb','innerHTML','您确定要将规则提示词恢复为默认设置吗？','add-above','fa-arrow-right','\x22></i>\x20','disabled','.radio-group','#column-name-input','楼层不能小于1。','fa-arrow-up','294390IZGJQx','textContent','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','162RzPxax','起始楼层不能大于结束楼层。','overflowX','amily2-import-preset-btn','remove','width','table-controls','contenteditable','pointer','button','injection','fill-current-floor-btn','向右移动','fa-arrow-left','loadTables','querySelector','display','optimized','move-up','overflowY','删除该行','delete','规则提示词已恢复为默认。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20custom-input-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#e0e0e0;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22\x20style=\x22color:\x20#9e8aff;\x22></i>\x20编辑列名\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22padding:\x2020px\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22color:\x20#ccc;\x20font-weight:\x20bold;\x22>列名：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22column-name-input\x22\x20class=\x22text_pole\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','importPreset','ai-rule-template-save-btn','body','matches','table','#amily2_memorisation_forms_panel\x20.sinan-navigation-deck','clearAllTables','amily2-header-text','marginBottom','false','main-api','moveTable','流程提示词已保存。','amily2_memorisation_forms_panel','querySelectorAll','which','开始为表格视图绑定交互事件...','exportPresetFull','fa-pen','.delete-table-btn','updateRow','forEach','val','.amily2-context-menu.amily2-menu-active','createElement','表格系统总开关已关闭，请先启用总开关。','列名已更新为\x20\x22','\x22立即填表\x22按钮已成功绑定。','.settings-group','getHighlights','内存状态为空，从聊天记录加载作为后备。','8306iOgLpZ','setAttribute','warning','left','amily2-context-menu','preventDefault','fill-selected-floors-btn','getBoundingClientRect','removeEventListener','3516312MBPQVv','5497320bJdZKs','.hly-scroll','规则提示词已保存。','innerHeight','click','.add-col-btn','createTHead','您确定要删除\x20“','change','\x20行吗？','.edit-rules-btn','”\x20列吗？','.sinan-tab-pane','div','未知表格','add-left','updateTableRules','fa-trash-alt','.move-table-up-btn','add-right','below','在右加列','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','addEventListener','0.5','getAttribute','流程提示词已恢复为默认。','.popup-button-ok','name','dataset','insertCell','filling_mode','fa-plus-circle','floorEventBound','删除该列','insertColumn','index-col','startFloorRangeFilling','role','批量填表-规则提示词已保存。','blur','label','td.index-col','insertRow','currentEventBound','min','addHighlight','warn','menu_button\x20small_button','.sinan-nav-item','classList','rowIndex','批量填表-流程提示词已恢复默认。','table_system_enabled','moveRow','-tab','#rule-add','previousElementSibling','amily2-export-preset-btn','新表格','then','tableIndex','addRow','优化中填表','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','style','.popup-button-cancel','block','depth','closest','请输入有效的起始楼层和结束楼层。','getTime','向上移动','getElementById','表格注入设置已成功绑定。','true','列名不能为空！','已禁用','已启用','length','table_injection_enabled','top','ai-flow-template-editor','className','分步填表','move-left','moveColumn','value','表格系统总开关','批量填表-流程提示词已保存。','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','appendChild','colIndex','无法找到指令模板编辑器，绑定失败。','20uJydUX','tab','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','delete-row','cursor','marginTop','table-injection-enabled','2px','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x2010px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20rgba(255,255,255,0.3);\x20background:\x20rgba(0,0,0,0.2);\x20color:\x20#fff;\x20font-size:\x201em;\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入列名...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:\x20#aaa;\x20font-style:\x20italic;\x22>提示：列名将用于标识此列的内容</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20justify-content:\x20flex-end;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20rgba(255,255,255,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22background:\x20rgba(120,120,120,0.2);\x20border-color:\x20rgba(120,120,120,0.4);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22\x20style=\x22background:\x20rgba(158,138,255,0.3);\x20border-color:\x20rgba(158,138,255,0.6);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20确认\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','all-tables-container','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','amily2-menu-active','rename','在左加列','batchEventBound','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','secondary-api','您确定要删除第\x20','table-role-system','5114889CBRXXK','headers','checked','rule_update','active','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','add','bottom','getBatchFillerRuleTemplate','322238OyRJVV','contains','\x22填当前楼层\x22按钮已成功绑定。','ai-rule-template-restore-btn','note','touchstart','.move-table-down-btn','select','info','amily2-menu-open','keypress','<i\x20class=\x22fas\x20','saveBatchFillerRuleTemplate'];_0x2535=function(){return _0x4c956f;};return _0x2535();}import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x33c8f3(0x174)](_0x33c8f3(0x86));function _0x5e44(_0x57ef3a,_0x511611){const _0x2535e5=_0x2535();return _0x5e44=function(_0x5e4492,_0x991aea){_0x5e4492=_0x5e4492-0x7c;let _0x559ea6=_0x2535e5[_0x5e4492];return _0x559ea6;},_0x5e44(_0x57ef3a,_0x511611);}function toggleRowContextMenu(_0x328b1c){const _0x4afb24=_0x33c8f3;_0x328b1c[_0x4afb24(0x126)](),_0x328b1c[_0x4afb24(0xb4)]();const _0x56eabd=_0x328b1c[_0x4afb24(0xb5)][_0x4afb24(0x170)](_0x4afb24(0x155));if(!_0x56eabd)return;const _0xf4b712=_0x56eabd['querySelector'](_0x4afb24(0xad));if(!_0xf4b712)return;const _0x4d0b7b=_0xf4b712[_0x4afb24(0x15d)][_0x4afb24(0x9a)]('amily2-menu-active');document[_0x4afb24(0x110)](_0x4afb24(0x119))['forEach'](_0x655a15=>{const _0x43bd1a=_0x4afb24;_0x655a15['classList'][_0x43bd1a(0xee)](_0x43bd1a(0x88));});!_0x4d0b7b&&_0xf4b712[_0x4afb24(0x15d)][_0x4afb24(0x96)](_0x4afb24(0x88));const _0x3ecdea=_0x2d2c7d=>{const _0x1981a7=_0x4afb24;!_0xf4b712['contains'](_0x2d2c7d[_0x1981a7(0xb5)])&&(_0xf4b712['classList']['remove']('amily2-menu-active'),document[_0x1981a7(0x129)]('click',_0x3ecdea,!![]));};setTimeout(()=>{const _0x4cfc46=_0x4afb24;_0xf4b712[_0x4cfc46(0x15d)][_0x4cfc46(0x9a)]('amily2-menu-active')&&document['addEventListener'](_0x4cfc46(0x12f),_0x3ecdea,!![]);},0x0);}function toggleColumnContextMenu(_0x1fda93){const _0x5b6b75=_0x33c8f3;_0x1fda93['preventDefault'](),_0x1fda93[_0x5b6b75(0xb4)]();const _0x481c4a=_0x1fda93[_0x5b6b75(0xb5)][_0x5b6b75(0x170)]('th');if(!_0x481c4a)return;const _0x2ec772=_0x481c4a[_0x5b6b75(0x15d)][_0x5b6b75(0x9a)](_0x5b6b75(0xa2));document[_0x5b6b75(0x110)]('th.amily2-menu-open')[_0x5b6b75(0x117)](_0x1d1e00=>{const _0x5de390=_0x5b6b75;_0x1d1e00[_0x5de390(0x15d)][_0x5de390(0xee)]('amily2-menu-open');});!_0x2ec772&&_0x481c4a[_0x5b6b75(0x15d)][_0x5b6b75(0x96)]('amily2-menu-open');const _0x4deb3b=_0x1ad07f=>{const _0xb2bf4f=_0x5b6b75;!_0x481c4a[_0xb2bf4f(0x9a)](_0x1ad07f[_0xb2bf4f(0xb5)])&&(_0x481c4a['classList'][_0xb2bf4f(0xee)](_0xb2bf4f(0xa2)),document[_0xb2bf4f(0x129)](_0xb2bf4f(0x12f),_0x4deb3b,!![]));};setTimeout(()=>{const _0x120cea=_0x5b6b75;_0x481c4a['classList'][_0x120cea(0x9a)]('amily2-menu-open')&&document['addEventListener']('click',_0x4deb3b,!![]);},0x0);}function showColumnNameEditor(_0x399c70,_0x1a48da,_0x145ba8){const _0x1bee50=_0x33c8f3,_0x2de7c8=_0x1bee50(0x101)+_0x145ba8+_0x1bee50(0x85),_0x2e7248=$(_0x2de7c8)['appendTo'](_0x1bee50(0x104)),_0x1bcfc5=_0x2e7248['find'](_0x1bee50(0xe4)),_0x86195=()=>{const _0x2cc39e=_0x1bee50;_0x2e7248[0x0][_0x2cc39e(0xb2)](),_0x2e7248[_0x2cc39e(0xee)]();};_0x2e7248[_0x1bee50(0xc8)]('.popup-button-ok')['on'](_0x1bee50(0x12f),()=>{const _0x58d461=_0x1bee50,_0x3bd508=_0x1bcfc5['val']()[_0x58d461(0xae)]();if(_0x3bd508&&_0x3bd508!==_0x145ba8)_0x1225e6['updateHeader'](_0x399c70,_0x1a48da,_0x3bd508),renderTables(),toastr[_0x58d461(0xbd)](_0x58d461(0x11c)+_0x3bd508+'\x22');else{if(!_0x3bd508){toastr[_0x58d461(0x123)](_0x58d461(0x177)),_0x1bcfc5['focus']();return;}}_0x86195();}),_0x2e7248[_0x1bee50(0xc8)]('.popup-button-cancel')['on']('click',_0x86195),_0x1bcfc5['on'](_0x1bee50(0xa3),_0x239a67=>{const _0x1b61be=_0x1bee50;_0x239a67[_0x1b61be(0x111)]===0xd&&_0x2e7248[_0x1b61be(0xc8)]('.popup-button-ok')[_0x1b61be(0x12f)]();}),_0x1bcfc5['on'](_0x1bee50(0xb6),_0xb7396a=>{const _0x58918c=_0x1bee50;_0xb7396a[_0x58918c(0x111)]===0x1b&&_0x86195();}),_0x2e7248[0x0]['showModal'](),_0x1bcfc5[_0x1bee50(0xa7)]()[_0x1bee50(0xa0)]();}function positionContextMenu(_0x3badaf,_0x1e2cf0){const _0x57bc6e=_0x33c8f3;_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0xbc)]='absolute',_0x3badaf[_0x57bc6e(0x16c)]['zIndex']='10000',_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0x124)]='0',_0x3badaf['style']['right']=_0x57bc6e(0xa6),_0x3badaf['style'][_0x57bc6e(0x82)]='',_0x3badaf['style'][_0x57bc6e(0x10a)]='',_0x3badaf[_0x57bc6e(0x16c)]['maxHeight']='',_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0xfd)]='';const _0x40dd79=window[_0x57bc6e(0x12e)],_0x22ecfb=_0x1e2cf0[_0x57bc6e(0x128)](),_0x4e6e1a=0xc8,_0x425e99=_0x1e2cf0['closest'](_0x57bc6e(0x12c)),_0x3a5130=_0x425e99?_0x425e99[_0x57bc6e(0x128)]():{'top':0x0,'bottom':_0x40dd79},_0xdcbc9=Math[_0x57bc6e(0x158)](_0x40dd79,_0x3a5130[_0x57bc6e(0x97)])-_0x22ecfb[_0x57bc6e(0x97)],_0x20c43b=_0x22ecfb[_0x57bc6e(0x17c)]-Math['max'](0x0,_0x3a5130['top']);_0xdcbc9<_0x4e6e1a&&_0x20c43b>_0xdcbc9?(_0x3badaf['style']['top']='auto',_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0x97)]=_0x57bc6e(0xaf),_0x3badaf['style']['marginBottom']=_0x57bc6e(0x84)):(_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0x17c)]=_0x57bc6e(0xaf),_0x3badaf[_0x57bc6e(0x16c)]['bottom']=_0x57bc6e(0xa6),_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0x82)]='2px');const _0x2347d9=0xa0,_0x589b0f=_0x1e2cf0[_0x57bc6e(0x170)](_0x57bc6e(0x106)),_0x15db8a=_0x589b0f?_0x589b0f[_0x57bc6e(0x170)]('div[style*=\x22overflowX\x22]'):null;if(_0x15db8a){const _0x85313d=_0x15db8a[_0x57bc6e(0x128)](),_0x4caa66=_0x22ecfb['left']-_0x85313d[_0x57bc6e(0x124)];_0x4caa66+_0x2347d9>_0x85313d[_0x57bc6e(0xef)]-0x14&&(_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0x124)]='auto',_0x3badaf[_0x57bc6e(0x16c)][_0x57bc6e(0xc6)]='0');}}export function renderTables(){const _0xedeb7d=_0x33c8f3;let _0x8f1f48=_0x1225e6['getMemoryState']();!_0x8f1f48&&(log(_0xedeb7d(0x120),_0xedeb7d(0x15a)),_0x8f1f48=_0x1225e6[_0xedeb7d(0xf8)]());const _0x419f31=getAllTablesContainer();if(!_0x8f1f48||!_0x419f31){console['error'](_0xedeb7d(0x16b));return;}const _0x254a9b=_0x1225e6[_0xedeb7d(0x11f)](),_0x183f8f=document[_0xedeb7d(0x174)]('add-table-placeholder');_0x183f8f&&_0x183f8f[_0xedeb7d(0xee)](),_0x419f31[_0xedeb7d(0xdd)]='',_0x8f1f48[_0xedeb7d(0x117)]((_0x42250e,_0x5ef5e3)=>{const _0x370277=_0xedeb7d,_0x5b8afc=document[_0x370277(0x11a)](_0x370277(0x138));_0x5b8afc[_0x370277(0x16c)]['display']=_0x370277(0xab),_0x5b8afc[_0x370277(0x16c)]['justifyContent']='space-between',_0x5b8afc['style'][_0x370277(0xb1)]='center';const _0x2f2d2c=document[_0x370277(0x11a)]('h3');_0x2f2d2c[_0x370277(0xdd)]='<i\x20class=\x22fas\x20fa-table\x22></i>\x20'+_0x42250e[_0x370277(0x147)];const _0x1399b4=document[_0x370277(0x11a)]('div');_0x1399b4[_0x370277(0x17e)]=_0x370277(0xf0);const _0x240f7e=_0x5ef5e3>0x0?_0x370277(0x95)+_0x5ef5e3+_0x370277(0xe9):'',_0x52b2dc=_0x5ef5e3<_0x8f1f48[_0x370277(0x17a)]-0x1?'<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22'+_0x5ef5e3+_0x370277(0xd7):'';_0x1399b4[_0x370277(0xdd)]=_0x370277(0x7f)+_0x240f7e+_0x370277(0x7f)+_0x52b2dc+_0x370277(0x87)+_0x5ef5e3+_0x370277(0x141)+_0x5ef5e3+'\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5b8afc[_0x370277(0x186)](_0x2f2d2c),_0x5b8afc[_0x370277(0x186)](_0x1399b4),_0x419f31['appendChild'](_0x5b8afc);const _0x22c5ff=document[_0x370277(0x11a)](_0x370277(0x106));_0x22c5ff[_0x370277(0x16c)][_0x370277(0xfa)]=_0x370277(0x16e),_0x22c5ff[_0x370277(0x16c)][_0x370277(0xec)]=_0x370277(0xa6),_0x22c5ff['id']=_0x370277(0xb7)+_0x5ef5e3,_0x22c5ff[_0x370277(0x148)]['tableIndex']=_0x5ef5e3;const _0x40e579=_0x22c5ff[_0x370277(0x131)](),_0x30b1b6=_0x40e579[_0x370277(0x156)](),_0x1a8a5c=document[_0x370277(0x11a)]('th');_0x1a8a5c[_0x370277(0x17e)]=_0x370277(0x14f),_0x1a8a5c[_0x370277(0xe8)]='#',_0x30b1b6[_0x370277(0x186)](_0x1a8a5c),_0x42250e[_0x370277(0x91)][_0x370277(0x117)]((_0x286401,_0x54f4aa)=>{const _0x505422=_0x370277,_0x16ac62=document[_0x505422(0x11a)]('th');_0x16ac62[_0x505422(0x148)][_0x505422(0x187)]=_0x54f4aa,_0x16ac62[_0x505422(0x16c)][_0x505422(0x81)]=_0x505422(0xf2);const _0x329290=document[_0x505422(0x11a)](_0x505422(0xce));_0x329290[_0x505422(0x17e)]=_0x505422(0x109),_0x329290[_0x505422(0xe8)]=_0x286401,_0x16ac62[_0x505422(0x186)](_0x329290);const _0x1f8e92=document[_0x505422(0x11a)](_0x505422(0x138));_0x1f8e92[_0x505422(0x17e)]=_0x505422(0x125);const _0x2e55a6=[{'label':'向左移动','action':_0x505422(0x180),'icon':_0x505422(0xf7)},{'label':_0x505422(0xf6),'action':_0x505422(0xdb),'icon':_0x505422(0xe0)},{'label':_0x505422(0x8a),'action':_0x505422(0x13a),'icon':_0x505422(0x14b)},{'label':_0x505422(0x140),'action':_0x505422(0x13e),'icon':_0x505422(0x14b)},{'label':_0x505422(0xca),'action':_0x505422(0x89),'icon':_0x505422(0x114)},{'label':_0x505422(0x14d),'action':_0x505422(0xff),'icon':_0x505422(0x13c),'isDanger':!![]}];_0x2e55a6[_0x505422(0x117)](({label:_0x428a27,action:_0x4582e9,icon:_0xf0a822,isDanger:_0x580b34})=>{const _0xe08b25=_0x505422,_0x578491=document[_0xe08b25(0x11a)](_0xe08b25(0xf3));_0x578491[_0xe08b25(0xe8)]=_0x428a27,_0x578491[_0xe08b25(0x17e)]=_0xe08b25(0x15b);if(_0x580b34)_0x578491[_0xe08b25(0x15d)]['add'](_0xe08b25(0xa8));_0x578491['addEventListener'](_0xe08b25(0x12f),_0x227638=>{const _0x41671b=_0xe08b25;_0x227638[_0x41671b(0xb4)]();switch(_0x4582e9){case'move-left':_0x1225e6[_0x41671b(0x181)](_0x5ef5e3,_0x54f4aa,_0x41671b(0x124));break;case _0x41671b(0xdb):_0x1225e6[_0x41671b(0x181)](_0x5ef5e3,_0x54f4aa,_0x41671b(0xc6));break;case'add-left':_0x1225e6[_0x41671b(0x14e)](_0x5ef5e3,_0x54f4aa,_0x41671b(0x124));break;case _0x41671b(0x13e):_0x1225e6[_0x41671b(0x14e)](_0x5ef5e3,_0x54f4aa,_0x41671b(0xc6));break;case _0x41671b(0x89):showColumnNameEditor(_0x5ef5e3,_0x54f4aa,_0x286401);break;case _0x41671b(0xff):confirm(_0x41671b(0x132)+_0x286401+_0x41671b(0x136))&&_0x1225e6['deleteColumn'](_0x5ef5e3,_0x54f4aa);break;}renderTables();}),_0x1f8e92[_0xe08b25(0x186)](_0x578491);}),_0x16ac62['appendChild'](_0x1f8e92),_0x30b1b6['appendChild'](_0x16ac62);});const _0x240ddd=_0x22c5ff['createTBody']();_0x42250e[_0x370277(0xb8)]&&_0x42250e[_0x370277(0xb8)][_0x370277(0x17a)]>0x0&&_0x42250e[_0x370277(0xb8)][_0x370277(0x117)]((_0x199dbf,_0x3157a7)=>{const _0x54db35=_0x370277,_0x5c27bc=_0x240ddd['insertRow']();_0x5c27bc['dataset'][_0x54db35(0x15e)]=_0x3157a7;const _0x5455dc=_0x5c27bc[_0x54db35(0x149)]();_0x5455dc[_0x54db35(0x17e)]=_0x54db35(0x14f);const _0x121d79=document[_0x54db35(0x11a)](_0x54db35(0xce));_0x121d79[_0x54db35(0xe8)]=_0x3157a7+0x1,_0x5455dc[_0x54db35(0x186)](_0x121d79);const _0x4643a5=document[_0x54db35(0x11a)](_0x54db35(0x138));_0x4643a5['className']=_0x54db35(0xd0);const _0x4d97da=[{'label':_0x54db35(0x173),'action':_0x54db35(0xfc),'icon':_0x54db35(0xe6)},{'label':'向下移动','action':_0x54db35(0xc5),'icon':_0x54db35(0xc2)},{'label':'在上加行','action':_0x54db35(0xdf),'icon':_0x54db35(0x14b)},{'label':_0x54db35(0xcb),'action':'add-below','icon':_0x54db35(0x14b)},{'label':_0x54db35(0xfe),'action':_0x54db35(0x80),'icon':_0x54db35(0x13c),'isDanger':!![]}];_0x4d97da[_0x54db35(0x117)](({label:_0x10747f,action:_0x2e7b0d,icon:_0x5d83a6,isDanger:_0xff9257})=>{const _0x2d5fe9=_0x54db35,_0x42993e=document[_0x2d5fe9(0x11a)](_0x2d5fe9(0xf3));_0x42993e[_0x2d5fe9(0xdd)]=_0x2d5fe9(0xa4)+_0x5d83a6+_0x2d5fe9(0xe1)+_0x10747f,_0x42993e[_0x2d5fe9(0x17e)]=_0x2d5fe9(0x15b);if(_0xff9257)_0x42993e[_0x2d5fe9(0x15d)][_0x2d5fe9(0x96)](_0x2d5fe9(0xa8));_0x42993e[_0x2d5fe9(0x142)](_0x2d5fe9(0x12f),_0x2dfd6a=>{const _0x20d851=_0x2d5fe9;_0x2dfd6a[_0x20d851(0xb4)]();switch(_0x2e7b0d){case'move-up':_0x1225e6['moveRow'](_0x5ef5e3,_0x3157a7,'up');break;case _0x20d851(0xc5):_0x1225e6[_0x20d851(0x161)](_0x5ef5e3,_0x3157a7,'down');break;case _0x20d851(0xdf):_0x1225e6[_0x20d851(0x156)](_0x5ef5e3,_0x3157a7,'above');break;case _0x20d851(0xbe):_0x1225e6[_0x20d851(0x156)](_0x5ef5e3,_0x3157a7,_0x20d851(0x13f));break;case _0x20d851(0x80):confirm(_0x20d851(0x8e)+(_0x3157a7+0x1)+_0x20d851(0x134))&&_0x1225e6['deleteRow'](_0x5ef5e3,_0x3157a7);break;}renderTables();}),_0x4643a5[_0x2d5fe9(0x186)](_0x42993e);}),_0x5455dc[_0x54db35(0x186)](_0x4643a5),_0x199dbf['forEach']((_0xf3869b,_0x5c1063)=>{const _0x542c18=_0x54db35,_0x1551d2=_0x5c27bc['insertCell']();_0x1551d2['textContent']=_0xf3869b;const _0x114fd4=()=>'ontouchstart'in window||navigator[_0x542c18(0xd8)]>0x0;!_0x114fd4()&&_0x1551d2[_0x542c18(0x122)](_0x542c18(0xf1),_0x542c18(0x176));_0x1551d2['dataset']['colIndex']=_0x5c1063,_0x1551d2['dataset'][_0x542c18(0x154)]=_0x42250e[_0x542c18(0x91)][_0x5c1063]||'';const _0x8d64aa=_0x5ef5e3+'-'+_0x3157a7+'-'+_0x5c1063;_0x254a9b[_0x542c18(0xc7)](_0x8d64aa)&&_0x1551d2[_0x542c18(0x15d)][_0x542c18(0x96)]('cell-highlight');});}),_0x419f31[_0x370277(0x186)](_0x22c5ff);}),_0x183f8f&&_0x419f31[_0xedeb7d(0x186)](_0x183f8f);}function openRuleEditor(_0x27b6a0){const _0x3a8440=_0x33c8f3,_0x273013=_0x1225e6['getMemoryState']();if(!_0x273013||!_0x273013[_0x27b6a0])return;const _0xcc9348=_0x273013[_0x27b6a0],_0x461be4=_0x3a8440(0xb9)+_0xcc9348[_0x3a8440(0x147)]+'”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>'+(_0xcc9348[_0x3a8440(0x9d)]||'')+_0x3a8440(0xd5)+(_0xcc9348['rule_add']||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0xcc9348['rule_delete']||'')+_0x3a8440(0x185)+(_0xcc9348[_0x3a8440(0x93)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>',_0x5208bf=$(_0x461be4)[_0x3a8440(0xd3)](_0x3a8440(0x104)),_0xde74a3=()=>{const _0x52f189=_0x3a8440;_0x5208bf[0x0][_0x52f189(0xb2)](),_0x5208bf[_0x52f189(0xee)]();};_0x5208bf[_0x3a8440(0xc8)](_0x3a8440(0x146))['on'](_0x3a8440(0x12f),()=>{const _0x1ba56e=_0x3a8440,_0x5e6acd={'note':_0x5208bf[_0x1ba56e(0xc8)]('#rule-note')['val'](),'rule_add':_0x5208bf[_0x1ba56e(0xc8)](_0x1ba56e(0x163))[_0x1ba56e(0x118)](),'rule_delete':_0x5208bf[_0x1ba56e(0xc8)](_0x1ba56e(0xb0))[_0x1ba56e(0x118)](),'rule_update':_0x5208bf[_0x1ba56e(0xc8)](_0x1ba56e(0xc9))[_0x1ba56e(0x118)]()};_0x1225e6[_0x1ba56e(0x13b)](_0x27b6a0,_0x5e6acd),_0xde74a3();}),_0x5208bf[_0x3a8440(0xc8)](_0x3a8440(0x16d))['on'](_0x3a8440(0x12f),_0xde74a3),_0x5208bf[0x0]['showModal']();}function bindInjectionSettings(){const _0x3f8101=_0x33c8f3,_0x5c5d6d=extension_settings[extensionName],_0x5b1abb=document[_0x3f8101(0x174)](_0x3f8101(0xda)),_0x391bd4=document['getElementById'](_0x3f8101(0x83)),_0x38b3dd=document[_0x3f8101(0x174)](_0x3f8101(0xbb)),_0x2f33eb=document[_0x3f8101(0x174)](_0x3f8101(0xd4)),_0xd25e55=document['querySelectorAll'](_0x3f8101(0xc4));if(!_0x5b1abb||!_0x391bd4||!_0x38b3dd||!_0x2f33eb||!_0xd25e55[_0x3f8101(0x17a)])return;const _0x4f6f37=()=>{const _0x162899=_0x3f8101,_0x403ce4=_0x38b3dd['value'],_0x1ea4bb=_0x5b1abb[_0x162899(0x92)],_0x41bff3=_0x403ce4==='1';_0x391bd4['disabled']=!_0x1ea4bb,_0x38b3dd[_0x162899(0xe2)]=!_0x1ea4bb,_0x2f33eb[_0x162899(0xe2)]=!_0x1ea4bb||!_0x41bff3,_0xd25e55[_0x162899(0x117)](_0x5972f6=>_0x5972f6[_0x162899(0xe2)]=!_0x1ea4bb||!_0x41bff3);const _0x3947e0=_0x1ea4bb?'1':_0x162899(0x143);_0x391bd4['style'][_0x162899(0xa9)]=_0x3947e0;_0x391bd4[_0x162899(0x170)]('.control-block-with-switch')&&(_0x391bd4[_0x162899(0x170)](_0x162899(0xc0))[_0x162899(0x16c)][_0x162899(0xa9)]=_0x3947e0);_0x38b3dd['style'][_0x162899(0xa9)]=_0x3947e0;_0x38b3dd['previousElementSibling']&&(_0x38b3dd['previousElementSibling']['style'][_0x162899(0xa9)]=_0x3947e0);const _0x27f5d4=_0x1ea4bb&&_0x41bff3?'1':'0.5';_0x2f33eb[_0x162899(0x16c)][_0x162899(0xa9)]=_0x27f5d4;_0x2f33eb['previousElementSibling']&&(_0x2f33eb[_0x162899(0x164)][_0x162899(0x16c)]['opacity']=_0x27f5d4);const _0x126c1a=_0x1ea4bb&&_0x41bff3?'1':_0x162899(0x143),_0x545601=document['getElementById'](_0x162899(0x8f))?.['closest'](_0x162899(0xe3));_0x545601&&(_0x545601[_0x162899(0x16c)][_0x162899(0xa9)]=_0x126c1a,_0x545601[_0x162899(0x164)]&&(_0x545601['previousElementSibling'][_0x162899(0x16c)][_0x162899(0xa9)]=_0x126c1a));const _0xcfabfb=document['querySelectorAll']('input[name=\x22filling-mode\x22]');_0xcfabfb[_0x162899(0x117)](_0x199000=>{const _0x236aec=_0x162899;_0x199000[_0x236aec(0xe2)]=!_0x1ea4bb;const _0x55fbf5=_0x199000[_0x236aec(0x170)](_0x236aec(0x154));_0x55fbf5&&(_0x55fbf5[_0x236aec(0x16c)]['opacity']=_0x1ea4bb?'1':_0x236aec(0x143));});const _0x532b85=document[_0x162899(0x174)]('fill-table-now-btn');_0x532b85&&(_0x532b85['disabled']=!_0x1ea4bb,_0x532b85[_0x162899(0x16c)][_0x162899(0xa9)]=_0x1ea4bb?'1':'0.5');};_0x5b1abb[_0x3f8101(0x92)]=_0x5c5d6d[_0x3f8101(0x160)]!==![],_0x391bd4[_0x3f8101(0x92)]=_0x5c5d6d[_0x3f8101(0x17b)],_0x38b3dd[_0x3f8101(0x182)]=_0x5c5d6d[_0x3f8101(0xf4)][_0x3f8101(0xbc)],_0x2f33eb[_0x3f8101(0x182)]=_0x5c5d6d[_0x3f8101(0xf4)][_0x3f8101(0x16f)],_0xd25e55[_0x3f8101(0x117)](_0x3a96d3=>{const _0x5eb769=_0x3f8101;parseInt(_0x3a96d3[_0x5eb769(0x182)],0xa)===_0x5c5d6d[_0x5eb769(0xf4)][_0x5eb769(0x151)]&&(_0x3a96d3[_0x5eb769(0x92)]=!![]);}),_0x4f6f37(),_0x5b1abb[_0x3f8101(0x142)]('change',()=>{const _0x2c9569=_0x3f8101;_0x5c5d6d[_0x2c9569(0x160)]=_0x5b1abb[_0x2c9569(0x92)],saveSettingsDebounced(),_0x4f6f37();const _0x29ffa8=_0x5b1abb[_0x2c9569(0x92)]?_0x2c9569(0x179):_0x2c9569(0x178);toastr[_0x2c9569(0xa1)](_0x2c9569(0x183)+_0x29ffa8+'。'),log(_0x2c9569(0x183)+_0x29ffa8+'。',_0x2c9569(0xa1));}),_0x391bd4[_0x3f8101(0x142)](_0x3f8101(0x133),()=>{_0x5c5d6d['table_injection_enabled']=_0x391bd4['checked'],saveSettingsDebounced();}),_0x38b3dd[_0x3f8101(0x142)]('change',()=>{const _0x2ad122=_0x3f8101;_0x5c5d6d['injection'][_0x2ad122(0xbc)]=parseInt(_0x38b3dd[_0x2ad122(0x182)],0xa),saveSettingsDebounced(),_0x4f6f37();}),_0x2f33eb[_0x3f8101(0x142)](_0x3f8101(0xaa),()=>{const _0x2446ba=_0x3f8101;_0x5c5d6d[_0x2446ba(0xf4)][_0x2446ba(0x16f)]=parseInt(_0x2f33eb[_0x2446ba(0x182)],0xa),saveSettingsDebounced();}),_0xd25e55[_0x3f8101(0x117)](_0x230d84=>{const _0x201377=_0x3f8101;_0x230d84[_0x201377(0x142)](_0x201377(0x133),()=>{const _0x48bee9=_0x201377;_0x230d84[_0x48bee9(0x92)]&&(_0x5c5d6d['injection'][_0x48bee9(0x151)]=parseInt(_0x230d84[_0x48bee9(0x182)],0xa),saveSettingsDebounced());});}),log(_0x3f8101(0x175),_0x3f8101(0xbd));}function updateAndSaveTableSetting(_0x1c7b93,_0x5c8de2){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x1c7b93]=_0x5c8de2,saveSettingsDebounced();}export function bindTableEvents(){const _0x30ea5f=_0x33c8f3,_0x5a8ad6=document[_0x30ea5f(0x174)](_0x30ea5f(0x10f));if(!_0x5a8ad6||_0x5a8ad6['dataset'][_0x30ea5f(0xc3)])return;log(_0x30ea5f(0x112),_0x30ea5f(0xa1));const _0x210e3c=_0x5a8ad6[_0x30ea5f(0x110)]('input[name=\x22filling-mode\x22]'),_0x2fb50e=()=>{const _0x32fc0d=_0x30ea5f,_0x3e719a=extension_settings[extensionName]?.[_0x32fc0d(0x14a)]||_0x32fc0d(0x10c);_0x210e3c[_0x32fc0d(0x117)](_0x153b7b=>{const _0x2e7cf9=_0x32fc0d;_0x153b7b['checked']=_0x153b7b[_0x2e7cf9(0x182)]===_0x3e719a;});};_0x210e3c[_0x30ea5f(0x117)](_0x3a9961=>{const _0x4560e7=_0x30ea5f;_0x3a9961[_0x4560e7(0x142)](_0x4560e7(0x133),function(){const _0x1be240=_0x4560e7,_0x47e1f9=this[_0x1be240(0x182)];updateAndSaveTableSetting(_0x1be240(0x14a),_0x47e1f9);let _0x52432f='原始填表';if(_0x47e1f9===_0x1be240(0x8d))_0x52432f=_0x1be240(0x17f);if(_0x47e1f9===_0x1be240(0xfb))_0x52432f=_0x1be240(0x16a);toastr['info']('填表模式已切换为\x20'+_0x52432f+'。'),_0x2fb50e();});}),_0x2fb50e();const _0x3af2d2=()=>{renderTables(),bindInjectionSettings();};_0x3af2d2(),bindBatchFillButton(),bindFloorFillButtons(),bindTemplateEditors();const _0x5741b6=document['querySelector'](_0x30ea5f(0x107));_0x5741b6&&_0x5741b6['addEventListener'](_0x30ea5f(0x12f),_0x57dd7d=>{const _0x20f95f=_0x30ea5f,_0x4b27f6=_0x57dd7d[_0x20f95f(0xb5)][_0x20f95f(0x170)](_0x20f95f(0x15c));if(!_0x4b27f6)return;const _0x2dc25a=_0x4b27f6[_0x20f95f(0x148)][_0x20f95f(0x7e)];if(!_0x2dc25a)return;const _0x2766d8=_0x4b27f6['closest'](_0x20f95f(0x11e));if(!_0x2766d8)return;_0x2766d8[_0x20f95f(0x110)](_0x20f95f(0x15c))[_0x20f95f(0x117)](_0x299d4c=>_0x299d4c[_0x20f95f(0x15d)][_0x20f95f(0xee)](_0x20f95f(0x94))),_0x4b27f6['classList'][_0x20f95f(0x96)](_0x20f95f(0x94)),_0x2766d8['querySelectorAll'](_0x20f95f(0x137))[_0x20f95f(0x117)](_0x24de47=>_0x24de47[_0x20f95f(0x15d)][_0x20f95f(0xee)]('active'));const _0x429ed0=_0x2766d8[_0x20f95f(0xf9)](_0x20f95f(0xd9)+_0x2dc25a+_0x20f95f(0x162));_0x429ed0&&_0x429ed0[_0x20f95f(0x15d)][_0x20f95f(0x96)](_0x20f95f(0x94));});const _0x167d47=document['getElementById'](_0x30ea5f(0x165)),_0x6ce665=document[_0x30ea5f(0x174)]('amily2-export-preset-full-btn'),_0x3361d3=document[_0x30ea5f(0x174)](_0x30ea5f(0xed));_0x167d47&&_0x167d47[_0x30ea5f(0x142)]('click',()=>_0x1225e6['exportPreset']());_0x6ce665&&_0x6ce665[_0x30ea5f(0x142)](_0x30ea5f(0x12f),()=>_0x1225e6[_0x30ea5f(0x113)]());_0x3361d3&&_0x3361d3[_0x30ea5f(0x142)]('click',()=>_0x1225e6[_0x30ea5f(0x102)](_0x3af2d2));const _0x301101=document[_0x30ea5f(0x174)]('amily2-clear-all-tables-btn');_0x301101&&_0x301101[_0x30ea5f(0x142)](_0x30ea5f(0x12f),()=>{const _0x160db6=_0x30ea5f;confirm(_0x160db6(0x8c))&&(_0x1225e6[_0x160db6(0x108)](),_0x3af2d2());});const _0x1b77df=document[_0x30ea5f(0x174)](_0x30ea5f(0xbf));_0x1b77df&&_0x1b77df[_0x30ea5f(0x142)](_0x30ea5f(0x12f),()=>{const _0x538f46=_0x30ea5f,_0x538767=prompt(_0x538f46(0xb3),_0x538f46(0x166));_0x538767&&_0x538767[_0x538f46(0xae)]()&&(_0x1225e6['addTable'](_0x538767[_0x538f46(0xae)]()),_0x3af2d2());});const _0x3e43f9=getAllTablesContainer();if(_0x3e43f9){_0x3e43f9[_0x30ea5f(0x142)](_0x30ea5f(0x12f),_0x5b6d05=>{const _0x5107f6=_0x30ea5f,_0x44de75=_0x5b6d05['target'][_0x5107f6(0x170)]('th');if(_0x44de75&&!_0x44de75[_0x5107f6(0x15d)][_0x5107f6(0x9a)](_0x5107f6(0x14f))){toggleColumnContextMenu(_0x5b6d05);return;}const _0x7c8db0=_0x5b6d05[_0x5107f6(0xb5)][_0x5107f6(0x170)](_0x5107f6(0x155));if(_0x7c8db0){toggleRowContextMenu(_0x5b6d05);return;}const _0x131d2d=_0x5b6d05[_0x5107f6(0xb5)]['closest'](_0x5107f6(0xf3));if(!_0x131d2d)return;const _0x5c6539=parseInt(_0x131d2d[_0x5107f6(0x148)][_0x5107f6(0x168)],0xa);if(_0x131d2d[_0x5107f6(0x105)]('.add-row-btn'))_0x1225e6[_0x5107f6(0x169)](_0x5c6539),_0x3af2d2();else{if(_0x131d2d[_0x5107f6(0x105)](_0x5107f6(0x130)))_0x1225e6['addColumn'](_0x5c6539),_0x3af2d2();else{if(_0x131d2d[_0x5107f6(0x105)](_0x5107f6(0x13d))||_0x131d2d[_0x5107f6(0x105)](_0x5107f6(0x9f))){const _0x4dc0bf=_0x131d2d[_0x5107f6(0x15d)][_0x5107f6(0x9a)](_0x5107f6(0xd6))?'up':'down';_0x1225e6[_0x5107f6(0x10d)](_0x5c6539,_0x4dc0bf),_0x3af2d2();}else{if(_0x131d2d[_0x5107f6(0x105)](_0x5107f6(0x135)))openRuleEditor(_0x5c6539);else{if(_0x131d2d[_0x5107f6(0x105)](_0x5107f6(0x115))){const _0x387b8b=_0x1225e6['getMemoryState'](),_0x20bc1b=_0x387b8b[_0x5c6539]?.['name']||_0x5107f6(0x139);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x20bc1b+']”\x20吗？此操作不可逆！')&&(_0x1225e6[_0x5107f6(0xd1)](_0x5c6539),_0x3af2d2());}}}}}});const _0x1357cf=()=>'ontouchstart'in window||navigator[_0x30ea5f(0xd8)]>0x0;if(_0x1357cf()){let _0x5e85e2=0x0,_0xc6beee=null;_0x3e43f9[_0x30ea5f(0x142)](_0x30ea5f(0x9e),_0x1bc578=>{const _0x2419d5=_0x30ea5f,_0x10d7fd=_0x1bc578[_0x2419d5(0xb5)][_0x2419d5(0x170)]('td');if(!_0x10d7fd||_0x10d7fd[_0x2419d5(0x148)]['colIndex']===undefined)return;const _0x37a037=new Date()[_0x2419d5(0x172)](),_0x35fc20=_0x37a037-_0x5e85e2;_0x35fc20<0x12c&&_0x35fc20>0x0&&_0xc6beee===_0x10d7fd&&(_0x1bc578[_0x2419d5(0x126)](),_0x10d7fd['getAttribute'](_0x2419d5(0xf1))!==_0x2419d5(0x176)&&(_0x10d7fd[_0x2419d5(0x122)](_0x2419d5(0xf1),_0x2419d5(0x176)),setTimeout(()=>_0x10d7fd['focus'](),0x0))),_0x5e85e2=_0x37a037,_0xc6beee=_0x10d7fd;});}_0x3e43f9[_0x30ea5f(0x142)](_0x30ea5f(0x153),_0x5555fa=>{const _0x22aff3=_0x30ea5f,_0x2646ab=_0x5555fa[_0x22aff3(0xb5)];if(_0x2646ab[_0x22aff3(0xcd)]!=='TD'||_0x2646ab[_0x22aff3(0x144)](_0x22aff3(0xf1))!==_0x22aff3(0x176))return;const _0x4e5389=()=>'ontouchstart'in window||navigator['maxTouchPoints']>0x0;_0x4e5389()&&_0x2646ab[_0x22aff3(0x122)](_0x22aff3(0xf1),_0x22aff3(0x10b));const _0x37bad3=_0x2646ab[_0x22aff3(0x170)]('table');if(!_0x37bad3)return;const _0x15e524=parseInt(_0x37bad3[_0x22aff3(0x148)]['tableIndex'],0xa),_0x3ad6d7=parseInt(_0x2646ab[_0x22aff3(0x170)]('tr')[_0x22aff3(0x148)][_0x22aff3(0x15e)],0xa),_0x1ce406=parseInt(_0x2646ab[_0x22aff3(0x148)][_0x22aff3(0x187)],0xa),_0x2f8ff0=_0x2646ab[_0x22aff3(0xe8)];_0x1225e6[_0x22aff3(0x159)](_0x15e524,_0x3ad6d7,_0x1ce406);const _0x19460f={[_0x1ce406]:_0x2f8ff0};_0x1225e6[_0x22aff3(0x116)](_0x15e524,_0x3ad6d7,_0x19460f),_0x3af2d2();},!![]);}_0x5a8ad6[_0x30ea5f(0x148)]['eventsBound']=_0x30ea5f(0x176),log(_0x30ea5f(0xc1),_0x30ea5f(0xbd));}function bindBatchFillButton(){const _0xba786a=_0x33c8f3,_0x5cf245=document[_0xba786a(0x174)](_0xba786a(0xd2));if(_0x5cf245){if(_0x5cf245[_0xba786a(0x148)][_0xba786a(0x8b)])return;_0x5cf245[_0xba786a(0x142)](_0xba786a(0x12f),_0x57432a=>{const _0x21e002=_0xba786a,_0x557c1b=extension_settings[extensionName],_0x572d4d=_0x557c1b['table_system_enabled']!==![];if(!_0x572d4d){_0x57432a[_0x21e002(0x126)](),toastr[_0x21e002(0x123)](_0x21e002(0x11b));return;}startBatchFilling();}),_0x5cf245[_0xba786a(0x148)][_0xba786a(0x8b)]=_0xba786a(0x176),log(_0xba786a(0x11d),_0xba786a(0xbd));}}function bindFloorFillButtons(){const _0x49b5ff=_0x33c8f3,_0x5f5272=document[_0x49b5ff(0x174)](_0x49b5ff(0x127)),_0x39cf67=document[_0x49b5ff(0x174)](_0x49b5ff(0xf5));if(_0x5f5272){if(_0x5f5272['dataset']['floorEventBound'])return;_0x5f5272['addEventListener'](_0x49b5ff(0x12f),_0x3e5275=>{const _0x1b095b=_0x49b5ff,_0x5c2acd=extension_settings[extensionName],_0x5b22fa=_0x5c2acd['table_system_enabled']!==![];if(!_0x5b22fa){_0x3e5275['preventDefault'](),toastr[_0x1b095b(0x123)](_0x1b095b(0x11b));return;}const _0x2b9f10=document['getElementById']('floor-start-input'),_0x2358fc=document[_0x1b095b(0x174)](_0x1b095b(0xac)),_0x5b5bac=parseInt(_0x2b9f10[_0x1b095b(0x182)],0xa),_0x31e85f=parseInt(_0x2358fc[_0x1b095b(0x182)],0xa);if(!_0x5b5bac||!_0x31e85f){toastr['warning'](_0x1b095b(0x171));return;}if(_0x5b5bac>_0x31e85f){toastr[_0x1b095b(0x123)](_0x1b095b(0xeb));return;}if(_0x5b5bac<0x1){toastr['warning'](_0x1b095b(0xe5));return;}import(_0x1b095b(0xcc))['then'](_0x1ca3c9=>{const _0x532c05=_0x1b095b;_0x1ca3c9[_0x532c05(0x150)](_0x5b5bac,_0x31e85f);});}),_0x5f5272[_0x49b5ff(0x148)][_0x49b5ff(0x14c)]=_0x49b5ff(0x176),log('\x22选定楼层填表\x22按钮已成功绑定。',_0x49b5ff(0xbd));}if(_0x39cf67){if(_0x39cf67['dataset'][_0x49b5ff(0x157)])return;_0x39cf67[_0x49b5ff(0x142)]('click',_0x3f65cb=>{const _0x540625=_0x49b5ff,_0x1b9fc6=extension_settings[extensionName],_0x534308=_0x1b9fc6[_0x540625(0x160)]!==![];if(!_0x534308){_0x3f65cb['preventDefault'](),toastr[_0x540625(0x123)]('表格系统总开关已关闭，请先启用总开关。');return;}import(_0x540625(0xcc))[_0x540625(0x167)](_0x4262e2=>{_0x4262e2['startCurrentFloorFilling']();});}),_0x39cf67[_0x49b5ff(0x148)]['currentEventBound']='true',log(_0x49b5ff(0x9b),_0x49b5ff(0xbd));}}function bindTemplateEditors(){const _0x2609ee=_0x33c8f3,_0x3be6cb=document[_0x2609ee(0x174)]('ai-rule-template-editor'),_0x3d67cb=document[_0x2609ee(0x174)](_0x2609ee(0x103)),_0x375b9c=document[_0x2609ee(0x174)](_0x2609ee(0x9c)),_0x3d6f76=document['getElementById'](_0x2609ee(0x17d)),_0x2a58bd=document[_0x2609ee(0x174)]('ai-flow-template-save-btn'),_0x13d067=document[_0x2609ee(0x174)]('ai-flow-template-restore-btn');if(!_0x3be6cb||!_0x3d6f76){log(_0x2609ee(0x7c),'warn');return;}_0x3be6cb[_0x2609ee(0x182)]=_0x1225e6[_0x2609ee(0x98)](),_0x3d6f76['value']=_0x1225e6['getBatchFillerFlowTemplate'](),_0x3d67cb[_0x2609ee(0x142)](_0x2609ee(0x12f),()=>{const _0x3c9334=_0x2609ee;_0x1225e6[_0x3c9334(0xa5)](_0x3be6cb[_0x3c9334(0x182)]),toastr[_0x3c9334(0xbd)](_0x3c9334(0x12d)),log(_0x3c9334(0x152),'success');}),_0x2a58bd['addEventListener']('click',()=>{const _0x1bc0a4=_0x2609ee;_0x1225e6[_0x1bc0a4(0xcf)](_0x3d6f76['value']),toastr[_0x1bc0a4(0xbd)](_0x1bc0a4(0x10e)),log(_0x1bc0a4(0x184),'success');}),_0x375b9c[_0x2609ee(0x142)]('click',()=>{const _0x45febf=_0x2609ee;confirm(_0x45febf(0xde))&&(_0x3be6cb[_0x45febf(0x182)]=DEFAULT_AI_RULE_TEMPLATE,_0x1225e6['saveBatchFillerRuleTemplate'](_0x3be6cb[_0x45febf(0x182)]),toastr[_0x45febf(0xa1)](_0x45febf(0x100)),log('批量填表-规则提示词已恢复默认。',_0x45febf(0xa1)));}),_0x13d067[_0x2609ee(0x142)]('click',()=>{const _0x30cb5a=_0x2609ee;confirm('您确定要将流程提示词恢复为默认设置吗？')&&(_0x3d6f76[_0x30cb5a(0x182)]=DEFAULT_AI_FLOW_TEMPLATE,_0x1225e6[_0x30cb5a(0xcf)](_0x3d6f76[_0x30cb5a(0x182)]),toastr[_0x30cb5a(0xa1)](_0x30cb5a(0x145)),log(_0x30cb5a(0x15f),_0x30cb5a(0xa1)));}),log('指令模板编辑器已成功绑定。','success');}
