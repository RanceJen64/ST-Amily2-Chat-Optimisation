function _0x1d38(_0x55ece3,_0x260f1f){const _0x2a2413=_0x2a24();return _0x1d38=function(_0x1d38fb,_0x554ccb){_0x1d38fb=_0x1d38fb-0x1b0;let _0x5b8c58=_0x2a2413[_0x1d38fb];return _0x5b8c58;},_0x1d38(_0x55ece3,_0x260f1f);}const _0x5d3901=_0x1d38;(function(_0x580cca,_0x32d9be){const _0x9308ec=_0x1d38,_0x523f62=_0x580cca();while(!![]){try{const _0x150e5b=parseInt(_0x9308ec(0x1df))/0x1*(parseInt(_0x9308ec(0x1b8))/0x2)+-parseInt(_0x9308ec(0x279))/0x3+-parseInt(_0x9308ec(0x24b))/0x4*(-parseInt(_0x9308ec(0x1e6))/0x5)+-parseInt(_0x9308ec(0x20e))/0x6*(-parseInt(_0x9308ec(0x23c))/0x7)+-parseInt(_0x9308ec(0x22a))/0x8+parseInt(_0x9308ec(0x1ef))/0x9+parseInt(_0x9308ec(0x1bb))/0xa*(-parseInt(_0x9308ec(0x27d))/0xb);if(_0x150e5b===_0x32d9be)break;else _0x523f62['push'](_0x523f62['shift']());}catch(_0x3e635f){_0x523f62['push'](_0x523f62['shift']());}}}(_0x2a24,0x2f665));import*as _0x3678f0 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document['getElementById'](_0x5d3901(0x214));function toggleRowContextMenu(_0x4a6002){const _0x4c71bb=_0x5d3901;_0x4a6002['preventDefault'](),_0x4a6002[_0x4c71bb(0x212)]();const _0x104c22=_0x4a6002[_0x4c71bb(0x225)][_0x4c71bb(0x1cc)](_0x4c71bb(0x1e5));if(!_0x104c22)return;const _0x41766a=_0x104c22[_0x4c71bb(0x26e)](_0x4c71bb(0x25c));if(!_0x41766a)return;const _0x42c4b6=_0x41766a[_0x4c71bb(0x1f8)][_0x4c71bb(0x259)](_0x4c71bb(0x200));document[_0x4c71bb(0x223)](_0x4c71bb(0x1fa))[_0x4c71bb(0x1c0)](_0x15b978=>{const _0x1bb961=_0x4c71bb;_0x15b978[_0x1bb961(0x1f8)][_0x1bb961(0x217)](_0x1bb961(0x200));});!_0x42c4b6&&_0x41766a[_0x4c71bb(0x1f8)][_0x4c71bb(0x221)]('amily2-menu-active');const _0xccff42=_0x2616e4=>{const _0x57bed0=_0x4c71bb;!_0x41766a[_0x57bed0(0x259)](_0x2616e4[_0x57bed0(0x225)])&&(_0x41766a['classList'][_0x57bed0(0x217)](_0x57bed0(0x200)),document[_0x57bed0(0x25d)](_0x57bed0(0x262),_0xccff42,!![]));};setTimeout(()=>{const _0x4d139e=_0x4c71bb;_0x41766a[_0x4d139e(0x1f8)][_0x4d139e(0x259)]('amily2-menu-active')&&document[_0x4d139e(0x1c3)](_0x4d139e(0x262),_0xccff42,!![]);},0x0);}function toggleColumnContextMenu(_0x480df8){const _0x520667=_0x5d3901;_0x480df8[_0x520667(0x253)](),_0x480df8[_0x520667(0x212)]();const _0x4b5eee=_0x480df8['target'][_0x520667(0x1cc)]('th');if(!_0x4b5eee)return;const _0x98127f=_0x4b5eee[_0x520667(0x26e)](_0x520667(0x25c));if(!_0x98127f)return;const _0x4d02fe=_0x98127f[_0x520667(0x1f8)]['contains'](_0x520667(0x200));document[_0x520667(0x223)]('.amily2-context-menu.amily2-menu-active')[_0x520667(0x1c0)](_0x589109=>{const _0xbc4756=_0x520667;_0x589109[_0xbc4756(0x1f8)][_0xbc4756(0x217)](_0xbc4756(0x200));});!_0x4d02fe&&_0x98127f[_0x520667(0x1f8)][_0x520667(0x221)](_0x520667(0x200));const _0x41e7b7=_0x509ef7=>{const _0x174351=_0x520667;!_0x98127f['contains'](_0x509ef7[_0x174351(0x225)])&&(_0x98127f[_0x174351(0x1f8)][_0x174351(0x217)](_0x174351(0x200)),document['removeEventListener'](_0x174351(0x262),_0x41e7b7,!![]));};setTimeout(()=>{const _0x14d977=_0x520667;_0x98127f[_0x14d977(0x1f8)]['contains'](_0x14d977(0x200))&&document[_0x14d977(0x1c3)](_0x14d977(0x262),_0x41e7b7,!![]);},0x0);}function _0x2a24(){const _0x2e00cf=['focus','1787720BXeaXT','note','.sinan-tab-pane','amily2-table-','move-up','开始为表格视图绑定交互事件...','moveColumn','warn','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','div','.edit-rules-btn','在左加列','table_injection_role','exportPreset','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','【最终警告】您确定要永久废黜表格\x20“[','table-injection-position','clearAllTables','4907vtJpOF','menu_button\x20small_button','table','active','rule_delete','您确定要删除第\x20','分步填表','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','请输入新表格的名称：','cursor','move-down','\x20行吗？','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','.settings-group','saveBatchFillerRuleTemplate','75608YAlHoz','getMemoryState','删除该行','getAttribute','getBatchFillerRuleTemplate','contenteditable','label','createElement','preventDefault','0.5','opacity','table_injection_depth','index-col','true','contains',']”\x20吗？此操作不可逆！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','.amily2-context-menu','removeEventListener','原始填表','success','fa-plus-circle','add-above','click','ai-flow-template-restore-btn','appendChild','amily2-context-menu\x20amily2-row-context-menu','val','body','请输入新的列名：','表格注入设置已成功绑定。','batchEventBound','filling_mode','rows','add-below','querySelector','addColumn','向上移动','info','overflowX','move-right','headers','tableIndex','tab','ai-rule-template-restore-btn','table-injection-role','19842DkooaI','fa-arrow-left','add-left','fa-arrow-right','24068nQJqGb','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','find','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','innerHTML','insertRow','流程提示词已恢复为默认。','table_injection_position','rename','exportPresetFull','deleteRow','name','规则提示词已恢复为默认。','flex','<i\x20class=\x22fas\x20','center','.add-row-btn,\x20.add-col-btn','ai-flow-template-editor','.move-table-down-btn','fa-arrow-down','close','接收到强制UI重载事件，正在刷新表格UI...','您确定要将流程提示词恢复为默认设置吗？','button','amily2-context-menu','amily2-import-preset-btn','122OwwYkx','删除该列','向下移动','2330ojdDHr','delete','rule_update','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22','forEach','input','流程提示词已保存。','addEventListener','未知表格','规则提示词已保存。','向左移动','fa-trash-alt','move-table-up-btn','\x22></i>\x20','importPreset','table_injection_enabled','closest','danger','.delete-table-btn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','value','.popup-button-ok','在下加行','loadTables','您确定要将规则提示词恢复为默认设置吗？','add-row-btn','add-table-placeholder','length','moveRow','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','blur','change','main-api','updateTableRules','tagName','3413WXLHWV','指令模板编辑器已成功绑定。','getElementById','.add-row-btn','pointer','style','td.index-col','80DripVX','amily2-clear-all-tables-btn','.popup-button-cancel','previousElementSibling','amily2-export-preset-full-btn','在上加行','checked','showModal','down','384876tgJoiM','addTable','dataset','.delete-row-handle','在右加列','批量填表-规则提示词已恢复默认。','ai-rule-template-editor','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','alignItems','classList','insertColumn','.amily2-context-menu.amily2-menu-active','.move-table-up-btn','insertCell','您确定要删除这一行吗？','无法找到指令模板编辑器，绑定失败。','add-right','amily2-menu-active','colIndex','false','moveTable','ontouchstart','span','table-injection-enabled','rowIndex','disabled','appendTo','getBatchFillerFlowTemplate','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','#rule-add','error','3258vkPfOo','above','className','<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22','stopPropagation','内存状态为空，从聊天记录加载作为后备。','all-tables-container','#sinan-','trim','remove','textContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','eventsBound','matches','maxTouchPoints','addRow','setAttribute','input[name=\x22filling-mode\x22]','right','add','-tab','querySelectorAll','saveBatchFillerFlowTemplate','target','deleteTable','.add-col-btn','fill-table-now-btn'];_0x2a24=function(){return _0x2e00cf;};return _0x2a24();}export function renderTables(){const _0x58a6be=_0x5d3901;let _0x1f50ed=_0x3678f0['getMemoryState']();!_0x1f50ed&&(log(_0x58a6be(0x213),_0x58a6be(0x231)),_0x1f50ed=_0x3678f0[_0x58a6be(0x1d3)]());const _0x2fdeb1=getAllTablesContainer();if(!_0x1f50ed||!_0x2fdeb1){console[_0x58a6be(0x20d)](_0x58a6be(0x248));return;}const _0x9a8289=document[_0x58a6be(0x1e1)](_0x58a6be(0x1d6));_0x9a8289&&_0x9a8289[_0x58a6be(0x217)](),_0x2fdeb1[_0x58a6be(0x281)]='',_0x1f50ed[_0x58a6be(0x1c0)]((_0x48ad58,_0x525453)=>{const _0x4df8fd=_0x58a6be,_0x358c78=document[_0x4df8fd(0x252)](_0x4df8fd(0x233));_0x358c78['style']['display']=_0x4df8fd(0x28a),_0x358c78['style']['justifyContent']='space-between',_0x358c78[_0x4df8fd(0x1e4)][_0x4df8fd(0x1f7)]=_0x4df8fd(0x28c);const _0x4e05ec=document[_0x4df8fd(0x252)]('h3');_0x4e05ec[_0x4df8fd(0x281)]=_0x4df8fd(0x280)+_0x48ad58[_0x4df8fd(0x288)];const _0x19e113=document[_0x4df8fd(0x252)](_0x4df8fd(0x233));_0x19e113[_0x4df8fd(0x210)]='table-controls';const _0x413a38=_0x525453>0x0?_0x4df8fd(0x1bf)+_0x525453+_0x4df8fd(0x232):'',_0x2b308f=_0x525453<_0x1f50ed[_0x4df8fd(0x1d7)]-0x1?_0x4df8fd(0x211)+_0x525453+'\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>':'';_0x19e113[_0x4df8fd(0x281)]=_0x4df8fd(0x219)+_0x413a38+_0x4df8fd(0x219)+_0x2b308f+_0x4df8fd(0x25b)+_0x525453+_0x4df8fd(0x1be)+_0x525453+_0x4df8fd(0x20b),_0x358c78[_0x4df8fd(0x264)](_0x4e05ec),_0x358c78[_0x4df8fd(0x264)](_0x19e113),_0x2fdeb1[_0x4df8fd(0x264)](_0x358c78);const _0x5d3c59=document[_0x4df8fd(0x252)](_0x4df8fd(0x233));_0x5d3c59[_0x4df8fd(0x1e4)][_0x4df8fd(0x272)]='auto';const _0x4de97e=document['createElement'](_0x4df8fd(0x23e));_0x4de97e['id']=_0x4df8fd(0x22d)+_0x525453,_0x4de97e['dataset'][_0x4df8fd(0x275)]=_0x525453;const _0x502123=_0x4de97e['createTHead'](),_0x410b13=_0x502123['insertRow'](),_0x52e730=document[_0x4df8fd(0x252)]('th');_0x52e730[_0x4df8fd(0x210)]=_0x4df8fd(0x257),_0x52e730[_0x4df8fd(0x218)]='#',_0x410b13['appendChild'](_0x52e730),_0x48ad58[_0x4df8fd(0x274)][_0x4df8fd(0x1c0)]((_0x2d615f,_0x2e2106)=>{const _0x24f3b1=_0x4df8fd,_0x457903=document[_0x24f3b1(0x252)]('th');_0x457903['dataset'][_0x24f3b1(0x201)]=_0x2e2106,_0x457903[_0x24f3b1(0x1e4)][_0x24f3b1(0x245)]=_0x24f3b1(0x1e3);const _0x529ce8=document[_0x24f3b1(0x252)](_0x24f3b1(0x205));_0x529ce8[_0x24f3b1(0x218)]=_0x2d615f,_0x457903[_0x24f3b1(0x264)](_0x529ce8);const _0xad07df=document[_0x24f3b1(0x252)]('div');_0xad07df[_0x24f3b1(0x210)]=_0x24f3b1(0x1b6);const _0x223525=[{'label':_0x24f3b1(0x1c6),'action':'move-left','icon':_0x24f3b1(0x27a)},{'label':'向右移动','action':_0x24f3b1(0x273),'icon':_0x24f3b1(0x27c)},{'label':_0x24f3b1(0x235),'action':'add-left','icon':'fa-plus-circle'},{'label':_0x24f3b1(0x1f3),'action':'add-right','icon':_0x24f3b1(0x260)},{'label':'编辑列名','action':'rename','icon':'fa-pen'},{'label':_0x24f3b1(0x1b9),'action':_0x24f3b1(0x1bc),'icon':_0x24f3b1(0x1c7),'isDanger':!![]}];_0x223525[_0x24f3b1(0x1c0)](({label:_0x1c5f41,action:_0x3a13c4,icon:_0x10624f,isDanger:_0x34cf85})=>{const _0x316f3d=_0x24f3b1,_0x1e83e3=document[_0x316f3d(0x252)]('button');_0x1e83e3[_0x316f3d(0x281)]=_0x316f3d(0x28b)+_0x10624f+_0x316f3d(0x1c9)+_0x1c5f41,_0x1e83e3[_0x316f3d(0x210)]='menu_button\x20small_button';if(_0x34cf85)_0x1e83e3[_0x316f3d(0x1f8)]['add'](_0x316f3d(0x1cd));_0x1e83e3['addEventListener'](_0x316f3d(0x262),_0x3a9e2d=>{const _0x13537b=_0x316f3d;_0x3a9e2d[_0x13537b(0x212)]();switch(_0x3a13c4){case'move-left':_0x3678f0[_0x13537b(0x230)](_0x525453,_0x2e2106,'left');break;case _0x13537b(0x273):_0x3678f0[_0x13537b(0x230)](_0x525453,_0x2e2106,_0x13537b(0x220));break;case _0x13537b(0x27b):_0x3678f0[_0x13537b(0x1f9)](_0x525453,_0x2e2106,'left');break;case _0x13537b(0x1ff):_0x3678f0[_0x13537b(0x1f9)](_0x525453,_0x2e2106,'right');break;case _0x13537b(0x285):const _0x2da5a9=prompt(_0x13537b(0x268),_0x2d615f);_0x2da5a9!==null&&_0x3678f0['updateHeader'](_0x525453,_0x2e2106,_0x2da5a9);break;case _0x13537b(0x1bc):confirm('您确定要删除\x20“'+_0x2d615f+'”\x20列吗？')&&_0x3678f0['deleteColumn'](_0x525453,_0x2e2106);break;}renderTables();}),_0xad07df[_0x316f3d(0x264)](_0x1e83e3);}),_0x457903[_0x24f3b1(0x264)](_0xad07df),_0x410b13[_0x24f3b1(0x264)](_0x457903);});const _0x4bb714=_0x4de97e['createTBody']();_0x48ad58[_0x4df8fd(0x26c)]&&_0x48ad58['rows'][_0x4df8fd(0x1d7)]>0x0&&_0x48ad58[_0x4df8fd(0x26c)][_0x4df8fd(0x1c0)]((_0x1dc7a6,_0x2c2a7d)=>{const _0x5a7374=_0x4df8fd,_0x13f134=_0x4bb714['insertRow']();_0x13f134[_0x5a7374(0x1f1)]['rowIndex']=_0x2c2a7d;const _0x4332dd=_0x13f134['insertCell']();_0x4332dd[_0x5a7374(0x210)]=_0x5a7374(0x257);const _0x5325e4=document[_0x5a7374(0x252)](_0x5a7374(0x205));_0x5325e4[_0x5a7374(0x218)]=_0x2c2a7d+0x1,_0x4332dd[_0x5a7374(0x264)](_0x5325e4);const _0xac7149=document[_0x5a7374(0x252)]('div');_0xac7149[_0x5a7374(0x210)]=_0x5a7374(0x265);const _0x179b9f=[{'label':_0x5a7374(0x270),'action':_0x5a7374(0x22e),'icon':'fa-arrow-up'},{'label':_0x5a7374(0x1ba),'action':_0x5a7374(0x246),'icon':_0x5a7374(0x1b1)},{'label':_0x5a7374(0x1eb),'action':'add-above','icon':_0x5a7374(0x260)},{'label':_0x5a7374(0x1d2),'action':_0x5a7374(0x26d),'icon':_0x5a7374(0x260)},{'label':_0x5a7374(0x24d),'action':'delete-row','icon':'fa-trash-alt','isDanger':!![]}];_0x179b9f[_0x5a7374(0x1c0)](({label:_0xde2d86,action:_0x599db0,icon:_0x41a086,isDanger:_0x2fa38f})=>{const _0x4287d3=_0x5a7374,_0x101762=document[_0x4287d3(0x252)](_0x4287d3(0x1b5));_0x101762[_0x4287d3(0x281)]=_0x4287d3(0x28b)+_0x41a086+_0x4287d3(0x1c9)+_0xde2d86,_0x101762['className']=_0x4287d3(0x23d);if(_0x2fa38f)_0x101762['classList'][_0x4287d3(0x221)](_0x4287d3(0x1cd));_0x101762[_0x4287d3(0x1c3)]('click',_0x3aa60a=>{const _0x2ce85e=_0x4287d3;_0x3aa60a[_0x2ce85e(0x212)]();switch(_0x599db0){case _0x2ce85e(0x22e):_0x3678f0[_0x2ce85e(0x1d8)](_0x525453,_0x2c2a7d,'up');break;case _0x2ce85e(0x246):_0x3678f0[_0x2ce85e(0x1d8)](_0x525453,_0x2c2a7d,_0x2ce85e(0x1ee));break;case _0x2ce85e(0x261):_0x3678f0['insertRow'](_0x525453,_0x2c2a7d,_0x2ce85e(0x20f));break;case'add-below':_0x3678f0[_0x2ce85e(0x282)](_0x525453,_0x2c2a7d,'below');break;case'delete-row':confirm(_0x2ce85e(0x241)+(_0x2c2a7d+0x1)+_0x2ce85e(0x247))&&_0x3678f0[_0x2ce85e(0x287)](_0x525453,_0x2c2a7d);break;}renderTables();}),_0xac7149['appendChild'](_0x101762);}),_0x4332dd['appendChild'](_0xac7149),_0x1dc7a6['forEach']((_0x2f25cc,_0x32d407)=>{const _0x366270=_0x5a7374,_0x431d23=_0x13f134[_0x366270(0x1fc)]();_0x431d23[_0x366270(0x218)]=_0x2f25cc;const _0x2ef80f=()=>_0x366270(0x204)in window||navigator['maxTouchPoints']>0x0;!_0x2ef80f()&&_0x431d23[_0x366270(0x21e)](_0x366270(0x250),_0x366270(0x258)),_0x431d23[_0x366270(0x1f1)][_0x366270(0x201)]=_0x32d407,_0x431d23[_0x366270(0x1f1)][_0x366270(0x251)]=_0x48ad58[_0x366270(0x274)][_0x32d407]||'';});}),_0x5d3c59[_0x4df8fd(0x264)](_0x4de97e),_0x2fdeb1[_0x4df8fd(0x264)](_0x5d3c59);}),_0x9a8289&&_0x2fdeb1[_0x58a6be(0x264)](_0x9a8289);}function openRuleEditor(_0x53ecb2){const _0x21c47f=_0x5d3901,_0x45e722=_0x3678f0[_0x21c47f(0x24c)]();if(!_0x45e722||!_0x45e722[_0x53ecb2])return;const _0x5beaa0=_0x45e722[_0x53ecb2],_0x344fec=_0x21c47f(0x27e)+_0x5beaa0[_0x21c47f(0x288)]+'”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>'+(_0x5beaa0[_0x21c47f(0x22b)]||'')+_0x21c47f(0x1d9)+(_0x5beaa0['rule_add']||'')+_0x21c47f(0x1f6)+(_0x5beaa0[_0x21c47f(0x240)]||'')+_0x21c47f(0x238)+(_0x5beaa0[_0x21c47f(0x1bd)]||'')+_0x21c47f(0x1cf),_0x5c839c=$(_0x344fec)[_0x21c47f(0x209)](_0x21c47f(0x267)),_0x281dba=()=>{const _0xd0cd9=_0x21c47f;_0x5c839c[0x0][_0xd0cd9(0x1b2)](),_0x5c839c[_0xd0cd9(0x217)]();};_0x5c839c[_0x21c47f(0x27f)](_0x21c47f(0x1d1))['on']('click',()=>{const _0x462046=_0x21c47f,_0x35a6fa={'note':_0x5c839c[_0x462046(0x27f)]('#rule-note')[_0x462046(0x266)](),'rule_add':_0x5c839c[_0x462046(0x27f)](_0x462046(0x20c))[_0x462046(0x266)](),'rule_delete':_0x5c839c[_0x462046(0x27f)]('#rule-delete')[_0x462046(0x266)](),'rule_update':_0x5c839c['find']('#rule-update')[_0x462046(0x266)]()};_0x3678f0[_0x462046(0x1dd)](_0x53ecb2,_0x35a6fa),_0x281dba();}),_0x5c839c[_0x21c47f(0x27f)](_0x21c47f(0x1e8))['on'](_0x21c47f(0x262),_0x281dba),_0x5c839c[0x0][_0x21c47f(0x1ed)]();}function bindInjectionSettings(){const _0x40b52a=_0x5d3901,_0x142771=extension_settings[extensionName],_0x463a7f=document[_0x40b52a(0x1e1)](_0x40b52a(0x206)),_0x3dbe74=document[_0x40b52a(0x1e1)](_0x40b52a(0x23a)),_0x45062e=document[_0x40b52a(0x1e1)]('table-injection-depth'),_0x969942=document[_0x40b52a(0x1e1)](_0x40b52a(0x278));if(!_0x463a7f||!_0x3dbe74||!_0x45062e||!_0x969942)return;const _0x29dab2=()=>{const _0x2faa54=_0x40b52a,_0x2a7019=_0x3dbe74[_0x2faa54(0x1d0)],_0x4638d5=_0x2a7019==='1';_0x45062e[_0x2faa54(0x208)]=!_0x4638d5,_0x969942['disabled']=!_0x4638d5;const _0x1b9e04=_0x4638d5?'1':_0x2faa54(0x254);_0x45062e['style'][_0x2faa54(0x255)]=_0x1b9e04;_0x45062e[_0x2faa54(0x1e9)]&&(_0x45062e['previousElementSibling'][_0x2faa54(0x1e4)][_0x2faa54(0x255)]=_0x1b9e04);const _0x3a85f0=_0x4638d5?'1':_0x2faa54(0x254);_0x969942[_0x2faa54(0x1e4)][_0x2faa54(0x255)]=_0x3a85f0,_0x969942[_0x2faa54(0x1e9)]&&(_0x969942[_0x2faa54(0x1e9)][_0x2faa54(0x1e4)][_0x2faa54(0x255)]=_0x3a85f0);};_0x463a7f[_0x40b52a(0x1ec)]=_0x142771[_0x40b52a(0x1cb)],_0x3dbe74['value']=_0x142771[_0x40b52a(0x284)],_0x45062e[_0x40b52a(0x1d0)]=_0x142771[_0x40b52a(0x256)],_0x969942[_0x40b52a(0x1d0)]=_0x142771['table_injection_role'],_0x29dab2(),_0x463a7f[_0x40b52a(0x1c3)]('change',()=>{const _0x275125=_0x40b52a;_0x142771[_0x275125(0x1cb)]=_0x463a7f['checked'],saveSettingsDebounced();}),_0x3dbe74[_0x40b52a(0x1c3)](_0x40b52a(0x1db),()=>{_0x142771['table_injection_position']=parseInt(_0x3dbe74['value'],0xa),saveSettingsDebounced(),_0x29dab2();}),_0x45062e[_0x40b52a(0x1c3)](_0x40b52a(0x1c1),()=>{const _0x1a8be2=_0x40b52a;_0x142771[_0x1a8be2(0x256)]=parseInt(_0x45062e['value'],0xa),saveSettingsDebounced();}),_0x969942[_0x40b52a(0x1c3)]('change',()=>{const _0x5e7cf6=_0x40b52a;_0x142771[_0x5e7cf6(0x236)]=_0x969942[_0x5e7cf6(0x1d0)],saveSettingsDebounced();}),log(_0x40b52a(0x269),'success');}function updateAndSaveTableSetting(_0x1fb6e7,_0x35cf32){!extension_settings[extensionName]&&(extension_settings[extensionName]={}),extension_settings[extensionName][_0x1fb6e7]=_0x35cf32,saveSettingsDebounced();}export function bindTableEvents(){const _0x51f318=_0x5d3901,_0x42c32f=document['getElementById']('amily2_memorisation_forms_panel');if(!_0x42c32f||_0x42c32f[_0x51f318(0x1f1)][_0x51f318(0x21a)])return;log(_0x51f318(0x22f),_0x51f318(0x271));const _0x200138=_0x42c32f['querySelectorAll'](_0x51f318(0x21f)),_0x32dc4e=()=>{const _0x25f267=_0x51f318,_0x24d398=extension_settings[extensionName]?.[_0x25f267(0x26b)]||_0x25f267(0x1dc);_0x200138[_0x25f267(0x1c0)](_0x38920b=>{const _0x17ba09=_0x25f267;_0x38920b['checked']=_0x38920b[_0x17ba09(0x1d0)]===_0x24d398;});};_0x200138[_0x51f318(0x1c0)](_0x3558a0=>{const _0x9c19a3=_0x51f318;_0x3558a0['addEventListener'](_0x9c19a3(0x1db),function(){const _0x43c73e=_0x9c19a3,_0x2d3e11=this[_0x43c73e(0x1d0)];updateAndSaveTableSetting(_0x43c73e(0x26b),_0x2d3e11);let _0x3cdf3b=_0x43c73e(0x25e);if(_0x2d3e11==='secondary-api')_0x3cdf3b=_0x43c73e(0x242);if(_0x2d3e11==='optimized')_0x3cdf3b='优化中填表';toastr[_0x43c73e(0x271)]('填表模式已切换为\x20'+_0x3cdf3b+'。'),_0x32dc4e();});}),_0x32dc4e();const _0x17e367=()=>{renderTables(),bindInjectionSettings();};_0x17e367(),bindBatchFillButton(),bindTemplateEditors();const _0x4731eb=document['querySelector']('#amily2_memorisation_forms_panel\x20.sinan-navigation-deck');_0x4731eb&&_0x4731eb[_0x51f318(0x1c3)](_0x51f318(0x262),_0x3d6cc4=>{const _0x8d9691=_0x51f318,_0x13256b=_0x3d6cc4[_0x8d9691(0x225)][_0x8d9691(0x1cc)]('.sinan-nav-item');if(!_0x13256b)return;const _0x1dfd27=_0x13256b['dataset'][_0x8d9691(0x276)];if(!_0x1dfd27)return;const _0x38f509=_0x13256b[_0x8d9691(0x1cc)](_0x8d9691(0x249));if(!_0x38f509)return;_0x38f509[_0x8d9691(0x223)]('.sinan-nav-item')[_0x8d9691(0x1c0)](_0x5ed2c6=>_0x5ed2c6[_0x8d9691(0x1f8)]['remove'](_0x8d9691(0x23f))),_0x13256b[_0x8d9691(0x1f8)]['add'](_0x8d9691(0x23f)),_0x38f509[_0x8d9691(0x223)](_0x8d9691(0x22c))[_0x8d9691(0x1c0)](_0x359063=>_0x359063[_0x8d9691(0x1f8)][_0x8d9691(0x217)](_0x8d9691(0x23f)));const _0x156fcd=_0x38f509[_0x8d9691(0x26e)](_0x8d9691(0x215)+_0x1dfd27+_0x8d9691(0x222));_0x156fcd&&_0x156fcd[_0x8d9691(0x1f8)][_0x8d9691(0x221)](_0x8d9691(0x23f));});const _0x46b580=document[_0x51f318(0x1e1)]('amily2-export-preset-btn'),_0x2e8d14=document['getElementById'](_0x51f318(0x1ea)),_0x6d68d6=document[_0x51f318(0x1e1)](_0x51f318(0x1b7));_0x46b580&&_0x46b580[_0x51f318(0x1c3)](_0x51f318(0x262),()=>_0x3678f0[_0x51f318(0x237)]());_0x2e8d14&&_0x2e8d14['addEventListener']('click',()=>_0x3678f0[_0x51f318(0x286)]());_0x6d68d6&&_0x6d68d6[_0x51f318(0x1c3)](_0x51f318(0x262),()=>_0x3678f0[_0x51f318(0x1ca)](_0x17e367));const _0x1a7710=document[_0x51f318(0x1e1)](_0x51f318(0x1e7));_0x1a7710&&_0x1a7710[_0x51f318(0x1c3)](_0x51f318(0x262),()=>{const _0x442b13=_0x51f318;confirm(_0x442b13(0x243))&&(_0x3678f0[_0x442b13(0x23b)](),_0x17e367());});const _0x1d4686=document[_0x51f318(0x1e1)](_0x51f318(0x1d6));_0x1d4686&&_0x1d4686[_0x51f318(0x1c3)](_0x51f318(0x262),()=>{const _0x518044=_0x51f318,_0x4da0e2=prompt(_0x518044(0x244),'新表格');_0x4da0e2&&_0x4da0e2[_0x518044(0x216)]()&&(_0x3678f0[_0x518044(0x1f0)](_0x4da0e2[_0x518044(0x216)]()),_0x17e367());});const _0x41b169=getAllTablesContainer();if(_0x41b169){_0x41b169[_0x51f318(0x1c3)](_0x51f318(0x262),_0xb978b2=>{const _0x1b469c=_0x51f318,_0xbf9cea=_0xb978b2[_0x1b469c(0x225)]['closest']('button');if(!_0xbf9cea)return;const _0x58a6dc=parseInt(_0xbf9cea[_0x1b469c(0x1f1)]['tableIndex'],0xa);if(_0xbf9cea[_0x1b469c(0x21b)](_0x1b469c(0x28d))){if(_0xbf9cea[_0x1b469c(0x1f8)][_0x1b469c(0x259)](_0x1b469c(0x1d5)))_0x3678f0[_0x1b469c(0x21d)](_0x58a6dc);else{if(_0xbf9cea[_0x1b469c(0x1f8)][_0x1b469c(0x259)]('add-col-btn'))_0x3678f0[_0x1b469c(0x26f)](_0x58a6dc);}_0x17e367();}else{if(_0xbf9cea[_0x1b469c(0x21b)]('.move-table-up-btn')||_0xbf9cea['matches'](_0x1b469c(0x1b0))){const _0x664e7b=_0xbf9cea['classList']['contains']('move-table-up-btn')?'up':_0x1b469c(0x1ee);_0x3678f0[_0x1b469c(0x203)](_0x58a6dc,_0x664e7b),_0x17e367();}else{if(_0xbf9cea[_0x1b469c(0x21b)](_0x1b469c(0x1f2))){const _0x3c4ffd=parseInt(_0xbf9cea['closest']('tr')[_0x1b469c(0x1f1)][_0x1b469c(0x207)],0xa);confirm(_0x1b469c(0x1fd))&&(_0x3678f0[_0x1b469c(0x287)](_0x58a6dc,_0x3c4ffd),_0x17e367());}else{if(_0xbf9cea[_0x1b469c(0x21b)](_0x1b469c(0x234))||_0xbf9cea[_0x1b469c(0x1cc)](_0x1b469c(0x234))){const _0x4badbd=_0xbf9cea['closest'](_0x1b469c(0x234)),_0x2b7db0=parseInt(_0x4badbd['dataset'][_0x1b469c(0x275)],0xa);openRuleEditor(_0x2b7db0);}else{if(_0xbf9cea[_0x1b469c(0x21b)]('.delete-table-btn')){const _0x4990d8=parseInt(_0xbf9cea[_0x1b469c(0x1f1)][_0x1b469c(0x275)],0xa),_0x4775ef=_0x3678f0[_0x1b469c(0x24c)](),_0x245fcc=_0x4775ef[_0x4990d8]?.[_0x1b469c(0x288)]||_0x1b469c(0x1c4);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x245fcc+_0x1b469c(0x25a))&&(_0x3678f0['deleteTable'](_0x4990d8),_0x17e367());}}}}}}),_0x41b169[_0x51f318(0x1c3)](_0x51f318(0x262),_0x2c5578=>{const _0x5560eb=_0x51f318,_0x3773ef=_0x2c5578[_0x5560eb(0x225)][_0x5560eb(0x1cc)]('th');if(_0x3773ef&&!_0x3773ef[_0x5560eb(0x1f8)][_0x5560eb(0x259)]('index-col')){toggleColumnContextMenu(_0x2c5578);return;}const _0x2cc98d=_0x2c5578[_0x5560eb(0x225)][_0x5560eb(0x1cc)]('td.index-col');if(_0x2cc98d){toggleRowContextMenu(_0x2c5578);return;}const _0x12fb6=_0x2c5578[_0x5560eb(0x225)][_0x5560eb(0x1cc)](_0x5560eb(0x1b5));if(!_0x12fb6)return;const _0x379341=parseInt(_0x12fb6['dataset'][_0x5560eb(0x275)],0xa);if(_0x12fb6['matches'](_0x5560eb(0x1e2)))_0x3678f0[_0x5560eb(0x21d)](_0x379341),_0x17e367();else{if(_0x12fb6[_0x5560eb(0x21b)](_0x5560eb(0x227)))_0x3678f0[_0x5560eb(0x26f)](_0x379341),_0x17e367();else{if(_0x12fb6[_0x5560eb(0x21b)](_0x5560eb(0x1fb))||_0x12fb6['matches'](_0x5560eb(0x1b0))){const _0x501b1b=_0x12fb6[_0x5560eb(0x1f8)]['contains'](_0x5560eb(0x1c8))?'up':'down';_0x3678f0['moveTable'](_0x379341,_0x501b1b),_0x17e367();}else{if(_0x12fb6[_0x5560eb(0x21b)]('.edit-rules-btn'))openRuleEditor(_0x379341);else{if(_0x12fb6[_0x5560eb(0x21b)](_0x5560eb(0x1ce))){const _0x28795e=_0x3678f0[_0x5560eb(0x24c)](),_0x5a5035=_0x28795e[_0x379341]?.['name']||_0x5560eb(0x1c4);confirm(_0x5560eb(0x239)+_0x5a5035+']”\x20吗？此操作不可逆！')&&(_0x3678f0[_0x5560eb(0x226)](_0x379341),_0x17e367());}}}}}});const _0x38af57=()=>_0x51f318(0x204)in window||navigator[_0x51f318(0x21c)]>0x0;_0x38af57()&&_0x41b169[_0x51f318(0x1c3)]('dblclick',_0x49cd01=>{const _0xf7bcae=_0x51f318,_0x422115=_0x49cd01[_0xf7bcae(0x225)][_0xf7bcae(0x1cc)]('td');_0x422115&&_0x422115['dataset']['colIndex']!==undefined&&_0x422115[_0xf7bcae(0x24e)](_0xf7bcae(0x250))!==_0xf7bcae(0x258)&&(_0x422115['setAttribute'](_0xf7bcae(0x250),'true'),_0x422115[_0xf7bcae(0x229)]());}),_0x41b169['addEventListener'](_0x51f318(0x1da),_0x2ce667=>{const _0x47869f=_0x51f318,_0x1f2198=_0x2ce667[_0x47869f(0x225)];if(_0x1f2198[_0x47869f(0x1de)]!=='TD'||_0x1f2198[_0x47869f(0x24e)](_0x47869f(0x250))!==_0x47869f(0x258))return;const _0x4c6101=()=>_0x47869f(0x204)in window||navigator[_0x47869f(0x21c)]>0x0;_0x4c6101()&&_0x1f2198[_0x47869f(0x21e)](_0x47869f(0x250),_0x47869f(0x202));const _0x4c95f2=_0x1f2198[_0x47869f(0x1cc)](_0x47869f(0x23e));if(!_0x4c95f2)return;const _0x6704d1=parseInt(_0x4c95f2[_0x47869f(0x1f1)][_0x47869f(0x275)],0xa),_0x1c4af2=parseInt(_0x1f2198['closest']('tr')[_0x47869f(0x1f1)][_0x47869f(0x207)],0xa),_0x40d29c=parseInt(_0x1f2198[_0x47869f(0x1f1)][_0x47869f(0x201)],0xa),_0x2a0230=_0x1f2198[_0x47869f(0x218)],_0x40548d={[_0x40d29c]:_0x2a0230};_0x3678f0['updateRow'](_0x6704d1,_0x1c4af2,_0x40548d),_0x17e367();},!![]);}_0x42c32f[_0x51f318(0x1f1)]['eventsBound']=_0x51f318(0x258),log('表格视图交互事件已成功绑定。','success'),document[_0x51f318(0x1c3)]('amily2-force-ui-reload',()=>{const _0x2402e7=_0x51f318;log(_0x2402e7(0x1b3),_0x2402e7(0x271)),_0x17e367();});}function bindBatchFillButton(){const _0x3fae3a=_0x5d3901,_0x79b143=document[_0x3fae3a(0x1e1)](_0x3fae3a(0x228));if(_0x79b143){if(_0x79b143[_0x3fae3a(0x1f1)]['batchEventBound'])return;_0x79b143[_0x3fae3a(0x1c3)](_0x3fae3a(0x262),startBatchFilling),_0x79b143[_0x3fae3a(0x1f1)][_0x3fae3a(0x26a)]=_0x3fae3a(0x258),log('“立即填表”按钮已成功绑定。',_0x3fae3a(0x25f));}}function bindTemplateEditors(){const _0x1a48a9=_0x5d3901,_0x40546b=document[_0x1a48a9(0x1e1)](_0x1a48a9(0x1f5)),_0x3cc06b=document[_0x1a48a9(0x1e1)]('ai-rule-template-save-btn'),_0x2c4bdb=document[_0x1a48a9(0x1e1)](_0x1a48a9(0x277)),_0x4e7013=document[_0x1a48a9(0x1e1)](_0x1a48a9(0x28e)),_0x2fa3e1=document['getElementById']('ai-flow-template-save-btn'),_0x18c0f9=document[_0x1a48a9(0x1e1)](_0x1a48a9(0x263));if(!_0x40546b||!_0x4e7013){log(_0x1a48a9(0x1fe),'warn');return;}_0x40546b['value']=_0x3678f0[_0x1a48a9(0x24f)](),_0x4e7013[_0x1a48a9(0x1d0)]=_0x3678f0[_0x1a48a9(0x20a)](),_0x3cc06b[_0x1a48a9(0x1c3)](_0x1a48a9(0x262),()=>{const _0x5f0147=_0x1a48a9;_0x3678f0[_0x5f0147(0x24a)](_0x40546b[_0x5f0147(0x1d0)]),toastr[_0x5f0147(0x25f)](_0x5f0147(0x1c5)),log('批量填表-规则提示词已保存。',_0x5f0147(0x25f));}),_0x2fa3e1[_0x1a48a9(0x1c3)](_0x1a48a9(0x262),()=>{const _0x515c49=_0x1a48a9;_0x3678f0[_0x515c49(0x224)](_0x4e7013[_0x515c49(0x1d0)]),toastr[_0x515c49(0x25f)](_0x515c49(0x1c2)),log('批量填表-流程提示词已保存。',_0x515c49(0x25f));}),_0x2c4bdb[_0x1a48a9(0x1c3)]('click',()=>{const _0x132d0b=_0x1a48a9;confirm(_0x132d0b(0x1d4))&&(_0x40546b['value']=DEFAULT_AI_RULE_TEMPLATE,_0x3678f0[_0x132d0b(0x24a)](_0x40546b['value']),toastr[_0x132d0b(0x271)](_0x132d0b(0x289)),log(_0x132d0b(0x1f4),_0x132d0b(0x271)));}),_0x18c0f9[_0x1a48a9(0x1c3)](_0x1a48a9(0x262),()=>{const _0x3d70e7=_0x1a48a9;confirm(_0x3d70e7(0x1b4))&&(_0x4e7013[_0x3d70e7(0x1d0)]=DEFAULT_AI_FLOW_TEMPLATE,_0x3678f0['saveBatchFillerFlowTemplate'](_0x4e7013['value']),toastr[_0x3d70e7(0x271)](_0x3d70e7(0x283)),log('批量填表-流程提示词已恢复默认。',_0x3d70e7(0x271)));}),log(_0x1a48a9(0x1e0),_0x1a48a9(0x25f));}
