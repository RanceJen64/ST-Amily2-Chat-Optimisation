const _0x45f9f2=_0x30b6;(function(_0xbbd31,_0x3cd911){const _0x5ae176=_0x30b6,_0x425581=_0xbbd31();while(!![]){try{const _0x1ff3da=-parseInt(_0x5ae176(0x16f))/0x1+-parseInt(_0x5ae176(0x101))/0x2+parseInt(_0x5ae176(0xda))/0x3+-parseInt(_0x5ae176(0x17e))/0x4*(parseInt(_0x5ae176(0x17f))/0x5)+-parseInt(_0x5ae176(0x12f))/0x6+-parseInt(_0x5ae176(0xdd))/0x7+parseInt(_0x5ae176(0x165))/0x8;if(_0x1ff3da===_0x3cd911)break;else _0x425581['push'](_0x425581['shift']());}catch(_0x122c6a){_0x425581['push'](_0x425581['shift']());}}}(_0x395f,0xc218e));import*as _0x5c8f92 from'../core/table-system/manager.js';import{log}from'../core/table-system/logger.js';import{extension_settings}from'/scripts/extensions.js';import{extensionName}from'../utils/settings.js';import{saveSettingsDebounced}from'/script.js';function _0x30b6(_0x9d1e82,_0x2b1372){const _0x395ff0=_0x395f();return _0x30b6=function(_0x30b67a,_0x2437c4){_0x30b67a=_0x30b67a-0xd2;let _0x24fff7=_0x395ff0[_0x30b67a];return _0x24fff7;},_0x30b6(_0x9d1e82,_0x2b1372);}function _0x395f(){const _0x1d791b=['getBatchFillerFlowTemplate','length','amily2-table-','target','#rule-add','display','updateTableRules','amily2-clear-all-tables-btn','saveBatchFillerRuleTemplate','table-instance-container','trim','borderStyle','dataset','success','批量填表-流程提示词已恢复默认。','fill-table-now-btn','.sinan-nav-item','.popup-button-cancel','.move-table-down-btn','updateHeader','.settings-group','20px\x200','style','index-col\x20delete-row-handle','getMemoryState','表格视图交互事件已成功绑定。','.move-table-up-btn','moveTable','rule_delete','rule_update','exportPreset','opacity','updateCell','规则提示词已保存。','appendChild','getBatchFillerRuleTemplate','#sinan-','tableIndex','859320dCfRDG','body',']”\x20吗？此操作不可逆！','addEventListener','table_injection_depth','.sinan-tab-pane','createTHead','checked','#rule-delete','colIndex','table-injection-enabled','内存状态为空，从聊天记录加载作为后备。','\x20行吗？','规则提示词已恢复为默认。','name','批量填表-规则提示词已恢复默认。','\x22\x20title=\x22上移\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>','all-tables-container','insertCell','ai-rule-template-restore-btn','您确定要通过清空表头来删除此列吗？','confirm','tab','classList','remove','amily2-import-preset-btn','dashed','showModal','<i\x20class=\x22fas\x20fa-table\x22></i>\x20','ai-flow-template-save-btn','auto','exportPresetFull','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-ok\x20menu_button\x20menu_button_primary\x20interactable\x22>保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-button-cancel\x20menu_button\x20interactable\x22\x20style=\x22margin-left:\x2010px;\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</dialog>','input','overflowX','table_injection_role','开始为表格视图绑定交互事件...','borderColor','createTBody','table_injection_enabled','请输入新表格的名称：','add-col-btn','space-between','deleteTable','error','div','流程提示词已恢复为默认。','#rule-update','【确认】您确定要清空所有表格的剧情内容吗？此操作将保留表格结构，但会删除所有已填写的行。','点击删除此行','val','click','ai-rule-template-save-btn','add','37229960VwfcVo','closest','contenteditable','previousElementSibling','move-table-up-btn','change','-tab','close','flex','.popup-button-ok','1158584AqVAvt','find','\x22\x20title=\x22编辑规则\x22><i\x20class=\x22fa-solid\x20fa-scroll\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-row-btn\x22\x20data-table-index=\x22','table-injection-role','ai-flow-template-editor','rows','未知表格','add-row-btn','center','matches','blur','saveBatchFillerFlowTemplate','headers','disabled',']\x20的第\x20','56LuTtjT','313040fqtKHf','deleteColumn','table_injection_position','批量填表-流程提示词已保存。','appendTo','querySelector','batchEventBound','#rule-note','value','pointer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20title=\x22废黜此表\x22><i\x20class=\x22fas\x20fa-trash-alt\x22></i></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','add-table-placeholder','active','479091nDjAAR','justifyContent','\x22\x20title=\x22下移\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>','10975566MtrDXi','[内存储司-工部]\x20缺少表格数据或容器，无法渲染。','insertRow','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20edit-rules-btn\x22\x20data-table-index=\x22','createElement','addRow','流程提示词已保存。','textContent','contains','eventsBound','table-controls','新表格','table-injection-position','warn','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-delete\x22>【删除】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-delete\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','无法找到指令模板编辑器，绑定失败。','true','rgba(255,\x20255,\x20255,\x200.2)','info','innerHTML','clearAllTables','tagName','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-add\x22>【增加】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-add\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>','setAttribute','.delete-row-handle','margin','stopPropagation','rowIndex','ai-rule-template-editor','cursor','className','您确定要删除表格\x20[','.add-row-btn,\x20.add-col-btn','querySelectorAll','\x22>加列</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20danger\x20delete-table-btn\x22\x20data-table-index=\x22','forEach','544332ISMFUv','index-col','deleteRow','amily2_memorisation_forms_panel','getElementById','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<dialog\x20class=\x22popup\x20wide_dialogue_popup\x20large_dialogue_popup\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4\x20style=\x22margin-top:0;\x20color:\x20#eee;\x20border-bottom:\x201px\x20solid\x20rgba(255,255,255,0.2);\x20padding-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fa-solid\x20fa-scroll\x22></i>\x20编辑\x20“','ai-flow-template-restore-btn','table'];_0x395f=function(){return _0x1d791b;};return _0x395f();}import{startBatchFilling}from'../core/table-system/batch-filler.js';import{DEFAULT_AI_RULE_TEMPLATE,DEFAULT_AI_FLOW_TEMPLATE}from'../core/table-system/settings.js';const getAllTablesContainer=()=>document[_0x45f9f2(0x105)](_0x45f9f2(0x140));export function renderTables(){const _0x1cdf3a=_0x45f9f2;let _0x4fbf7f=_0x5c8f92[_0x1cdf3a(0x121)]();!_0x4fbf7f&&(log(_0x1cdf3a(0x13a),_0x1cdf3a(0xea)),_0x4fbf7f=_0x5c8f92['loadTables']());const _0x496fbe=getAllTablesContainer();if(!_0x4fbf7f||!_0x496fbe){console[_0x1cdf3a(0x15b)](_0x1cdf3a(0xde));return;}const _0x3cbf04=document[_0x1cdf3a(0x105)](_0x1cdf3a(0xd8));_0x3cbf04&&_0x3cbf04[_0x1cdf3a(0x147)](),_0x496fbe[_0x1cdf3a(0xf0)]='',_0x4fbf7f[_0x1cdf3a(0x100)]((_0x2df433,_0x59ad21)=>{const _0xe79f8c=_0x1cdf3a,_0x4f9d10=document['createElement']('div');_0x4f9d10['className']=_0xe79f8c(0x112);const _0x132c0b=document['createElement'](_0xe79f8c(0x15c));_0x132c0b[_0xe79f8c(0x11f)][_0xe79f8c(0x10e)]=_0xe79f8c(0x16d),_0x132c0b[_0xe79f8c(0x11f)][_0xe79f8c(0xdb)]=_0xe79f8c(0x159),_0x132c0b[_0xe79f8c(0x11f)]['alignItems']=_0xe79f8c(0x177);const _0x3d7a14=document[_0xe79f8c(0xe1)]('h3');_0x3d7a14[_0xe79f8c(0xf0)]=_0xe79f8c(0x14b)+_0x2df433[_0xe79f8c(0x13d)];const _0x58d404=document[_0xe79f8c(0xe1)]('div');_0x58d404[_0xe79f8c(0xfb)]=_0xe79f8c(0xe7);const _0x473867=_0x59ad21>0x0?'<button\x20class=\x22menu_button\x20small_button\x20move-table-up-btn\x22\x20data-table-index=\x22'+_0x59ad21+_0xe79f8c(0x13f):'',_0x2a2f6d=_0x59ad21<_0x4fbf7f[_0xe79f8c(0x10a)]-0x1?'<button\x20class=\x22menu_button\x20small_button\x20move-table-down-btn\x22\x20data-table-index=\x22'+_0x59ad21+_0xe79f8c(0xdc):'';_0x58d404[_0xe79f8c(0xf0)]=_0xe79f8c(0xd6)+_0x473867+_0xe79f8c(0xd6)+_0x2a2f6d+_0xe79f8c(0xe0)+_0x59ad21+_0xe79f8c(0x171)+_0x59ad21+'\x22>加行</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22menu_button\x20small_button\x20add-col-btn\x22\x20data-table-index=\x22'+_0x59ad21+_0xe79f8c(0xff)+_0x59ad21+_0xe79f8c(0xd7),_0x132c0b[_0xe79f8c(0x12b)](_0x3d7a14),_0x132c0b[_0xe79f8c(0x12b)](_0x58d404),_0x496fbe[_0xe79f8c(0x12b)](_0x132c0b);const _0x40c837=document['createElement'](_0xe79f8c(0x15c));_0x40c837[_0xe79f8c(0x11f)][_0xe79f8c(0x151)]=_0xe79f8c(0x14d);const _0x39f87e=document[_0xe79f8c(0xe1)](_0xe79f8c(0x108));_0x39f87e['id']=_0xe79f8c(0x10b)+_0x59ad21,_0x39f87e[_0xe79f8c(0x115)][_0xe79f8c(0x12e)]=_0x59ad21;const _0x52d09c=_0x39f87e[_0xe79f8c(0x135)](),_0x5cef0a=_0x52d09c[_0xe79f8c(0xdf)](),_0x5139e0=document[_0xe79f8c(0xe1)]('th');_0x5139e0['className']='index-col',_0x5139e0['textContent']='#',_0x5cef0a[_0xe79f8c(0x12b)](_0x5139e0),_0x2df433[_0xe79f8c(0x17b)][_0xe79f8c(0x100)]((_0x4eb742,_0x39fa03)=>{const _0x1fb6a9=_0xe79f8c,_0x1efd7d=document[_0x1fb6a9(0xe1)]('th');_0x1efd7d['textContent']=_0x4eb742,_0x1efd7d[_0x1fb6a9(0xf4)](_0x1fb6a9(0x167),_0x1fb6a9(0xed)),_0x1efd7d[_0x1fb6a9(0x115)][_0x1fb6a9(0x138)]=_0x39fa03,_0x5cef0a[_0x1fb6a9(0x12b)](_0x1efd7d);});const _0x5457fc=_0x39f87e[_0xe79f8c(0x155)]();_0x2df433[_0xe79f8c(0x174)]&&_0x2df433['rows'][_0xe79f8c(0x10a)]>0x0&&_0x2df433[_0xe79f8c(0x174)][_0xe79f8c(0x100)]((_0xc7abc2,_0x2ec812)=>{const _0x2a978c=_0xe79f8c,_0x502a45=_0x5457fc[_0x2a978c(0xdf)]();_0x502a45[_0x2a978c(0x115)][_0x2a978c(0xf8)]=_0x2ec812;const _0x142d21=_0x502a45['insertCell']();_0x142d21['className']=_0x2a978c(0x120),_0x142d21['title']=_0x2a978c(0x160),_0x142d21[_0x2a978c(0xe4)]=_0x2ec812+0x1,_0x142d21['style'][_0x2a978c(0xfa)]=_0x2a978c(0xd5),_0x142d21[_0x2a978c(0x132)](_0x2a978c(0x162),async _0x5ac6fd=>{const _0xc33137=_0x2a978c;_0x5ac6fd[_0xc33137(0xf7)](),window[_0xc33137(0x144)](_0xc33137(0xfc)+_0x2df433[_0xc33137(0x13d)]+_0xc33137(0x17d)+(_0x2ec812+0x1)+_0xc33137(0x13b))&&(await _0x5c8f92[_0xc33137(0x103)](_0x59ad21,_0x2ec812),renderTables());}),_0xc7abc2[_0x2a978c(0x100)]((_0x3267e7,_0x1617e1)=>{const _0x2e61a9=_0x2a978c,_0x214f38=_0x502a45[_0x2e61a9(0x141)]();_0x214f38['textContent']=_0x3267e7,_0x214f38[_0x2e61a9(0xf4)](_0x2e61a9(0x167),_0x2e61a9(0xed)),_0x214f38[_0x2e61a9(0x115)][_0x2e61a9(0x138)]=_0x1617e1;});});_0x40c837[_0xe79f8c(0x12b)](_0x39f87e),_0x4f9d10[_0xe79f8c(0x12b)](_0x40c837);if(_0x59ad21<_0x4fbf7f[_0xe79f8c(0x10a)]-0x1){const _0x176644=document['createElement']('hr');_0x176644[_0xe79f8c(0x11f)][_0xe79f8c(0x114)]=_0xe79f8c(0x149),_0x176644['style'][_0xe79f8c(0xf6)]=_0xe79f8c(0x11e),_0x176644[_0xe79f8c(0x11f)][_0xe79f8c(0x154)]=_0xe79f8c(0xee),_0x4f9d10[_0xe79f8c(0x12b)](_0x176644);}_0x496fbe[_0xe79f8c(0x12b)](_0x4f9d10);}),_0x3cbf04&&_0x496fbe[_0x1cdf3a(0x12b)](_0x3cbf04);}function openRuleEditor(_0x204866){const _0x15f32a=_0x45f9f2,_0x434122=_0x5c8f92['getMemoryState']();if(!_0x434122||!_0x434122[_0x204866])return;const _0x8487ed=_0x434122[_0x204866],_0x41b6ed=_0x15f32a(0x106)+_0x8487ed[_0x15f32a(0x13d)]+'”\x20的规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-content\x22\x20style=\x22height:\x2070vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-form\x22\x20style=\x22display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2015px;\x20padding:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-note\x22>【说明】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-note\x22\x20class=\x22text_pole\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x22>'+(_0x8487ed['note']||'')+_0x15f32a(0xf3)+(_0x8487ed['rule_add']||'')+_0x15f32a(0xeb)+(_0x8487ed[_0x15f32a(0x125)]||'')+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22rule-editor-field\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22rule-update\x22>【修改】:</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22rule-update\x22\x20class=\x22text_pole\x22\x20rows=\x223\x22\x20style=\x22width:\x20100%;\x22>'+(_0x8487ed[_0x15f32a(0x126)]||'')+_0x15f32a(0x14f),_0x3566a2=$(_0x41b6ed)[_0x15f32a(0x183)](_0x15f32a(0x130)),_0x134c1c=()=>{const _0x581654=_0x15f32a;_0x3566a2[0x0][_0x581654(0x16c)](),_0x3566a2[_0x581654(0x147)]();};_0x3566a2['find'](_0x15f32a(0x16e))['on'](_0x15f32a(0x162),()=>{const _0x55bb71=_0x15f32a,_0x588243={'note':_0x3566a2[_0x55bb71(0x170)](_0x55bb71(0xd3))[_0x55bb71(0x161)](),'rule_add':_0x3566a2[_0x55bb71(0x170)](_0x55bb71(0x10d))[_0x55bb71(0x161)](),'rule_delete':_0x3566a2[_0x55bb71(0x170)](_0x55bb71(0x137))[_0x55bb71(0x161)](),'rule_update':_0x3566a2[_0x55bb71(0x170)](_0x55bb71(0x15e))[_0x55bb71(0x161)]()};_0x5c8f92[_0x55bb71(0x10f)](_0x204866,_0x588243),_0x134c1c();}),_0x3566a2['find'](_0x15f32a(0x11a))['on'](_0x15f32a(0x162),_0x134c1c),_0x3566a2[0x0][_0x15f32a(0x14a)]();}function bindInjectionSettings(){const _0x36d9eb=_0x45f9f2,_0x3ea4d7=extension_settings[extensionName],_0x1b3c25=document[_0x36d9eb(0x105)](_0x36d9eb(0x139)),_0x8db833=document['getElementById'](_0x36d9eb(0xe9)),_0x3f2cb3=document[_0x36d9eb(0x105)]('table-injection-depth'),_0x462aea=document['getElementById'](_0x36d9eb(0x172));if(!_0x1b3c25||!_0x8db833||!_0x3f2cb3||!_0x462aea)return;const _0x19760e=()=>{const _0x360de1=_0x36d9eb,_0x2f5c6a=_0x8db833['value'],_0xabfbd7=_0x2f5c6a==='1';_0x3f2cb3[_0x360de1(0x17c)]=!_0xabfbd7,_0x462aea[_0x360de1(0x17c)]=!_0xabfbd7;const _0x2d8a5b=_0xabfbd7?'1':'0.5';_0x3f2cb3[_0x360de1(0x11f)][_0x360de1(0x128)]=_0x2d8a5b;_0x3f2cb3['previousElementSibling']&&(_0x3f2cb3[_0x360de1(0x168)]['style'][_0x360de1(0x128)]=_0x2d8a5b);const _0x19149e=_0xabfbd7?'1':'0.5';_0x462aea[_0x360de1(0x11f)]['opacity']=_0x19149e,_0x462aea[_0x360de1(0x168)]&&(_0x462aea[_0x360de1(0x168)][_0x360de1(0x11f)][_0x360de1(0x128)]=_0x19149e);};_0x1b3c25[_0x36d9eb(0x136)]=_0x3ea4d7[_0x36d9eb(0x156)],_0x8db833[_0x36d9eb(0xd4)]=_0x3ea4d7[_0x36d9eb(0x181)],_0x3f2cb3['value']=_0x3ea4d7[_0x36d9eb(0x133)],_0x462aea['value']=_0x3ea4d7[_0x36d9eb(0x152)],_0x19760e(),_0x1b3c25[_0x36d9eb(0x132)](_0x36d9eb(0x16a),()=>{const _0x237f4d=_0x36d9eb;_0x3ea4d7[_0x237f4d(0x156)]=_0x1b3c25[_0x237f4d(0x136)],saveSettingsDebounced();}),_0x8db833['addEventListener']('change',()=>{const _0x1b135c=_0x36d9eb;_0x3ea4d7['table_injection_position']=parseInt(_0x8db833[_0x1b135c(0xd4)],0xa),saveSettingsDebounced(),_0x19760e();}),_0x3f2cb3[_0x36d9eb(0x132)](_0x36d9eb(0x150),()=>{const _0x546ab3=_0x36d9eb;_0x3ea4d7[_0x546ab3(0x133)]=parseInt(_0x3f2cb3[_0x546ab3(0xd4)],0xa),saveSettingsDebounced();}),_0x462aea[_0x36d9eb(0x132)](_0x36d9eb(0x16a),()=>{const _0x233cb5=_0x36d9eb;_0x3ea4d7['table_injection_role']=parseInt(_0x462aea[_0x233cb5(0xd4)],0xa),saveSettingsDebounced();}),log('表格注入设置已成功绑定。','success');}export function bindTableEvents(){const _0x88952=_0x45f9f2,_0x4b74ce=document[_0x88952(0x105)](_0x88952(0x104));if(!_0x4b74ce||_0x4b74ce[_0x88952(0x115)]['eventsBound'])return;log(_0x88952(0x153),_0x88952(0xef));const _0x280a70=()=>{renderTables(),bindInjectionSettings();};_0x280a70(),bindBatchFillButton(),bindTemplateEditors();const _0x2affe3=document[_0x88952(0x184)]('#amily2_memorisation_forms_panel\x20.sinan-navigation-deck');_0x2affe3&&_0x2affe3[_0x88952(0x132)](_0x88952(0x162),_0x4100e0=>{const _0x140a19=_0x88952,_0x1aecee=_0x4100e0['target']['closest'](_0x140a19(0x119));if(!_0x1aecee)return;const _0x303831=_0x1aecee[_0x140a19(0x115)][_0x140a19(0x145)];if(!_0x303831)return;const _0xaa859f=_0x1aecee['closest'](_0x140a19(0x11d));if(!_0xaa859f)return;_0xaa859f['querySelectorAll']('.sinan-nav-item')[_0x140a19(0x100)](_0x1c1733=>_0x1c1733['classList'][_0x140a19(0x147)]('active')),_0x1aecee[_0x140a19(0x146)][_0x140a19(0x164)](_0x140a19(0xd9)),_0xaa859f[_0x140a19(0xfe)](_0x140a19(0x134))[_0x140a19(0x100)](_0x5c5b4b=>_0x5c5b4b[_0x140a19(0x146)][_0x140a19(0x147)]('active'));const _0x32eeb8=_0xaa859f[_0x140a19(0x184)](_0x140a19(0x12d)+_0x303831+_0x140a19(0x16b));_0x32eeb8&&_0x32eeb8[_0x140a19(0x146)][_0x140a19(0x164)](_0x140a19(0xd9));});const _0x4af247=document['getElementById']('amily2-export-preset-btn'),_0x39f9ac=document['getElementById']('amily2-export-preset-full-btn'),_0x50bbca=document[_0x88952(0x105)](_0x88952(0x148));_0x4af247&&_0x4af247[_0x88952(0x132)](_0x88952(0x162),()=>_0x5c8f92[_0x88952(0x127)]());_0x39f9ac&&_0x39f9ac[_0x88952(0x132)]('click',()=>_0x5c8f92[_0x88952(0x14e)]());_0x50bbca&&_0x50bbca[_0x88952(0x132)](_0x88952(0x162),()=>_0x5c8f92['importPreset'](_0x280a70));const _0x4c50ad=document['getElementById'](_0x88952(0x110));_0x4c50ad&&_0x4c50ad[_0x88952(0x132)](_0x88952(0x162),()=>{const _0x5455f3=_0x88952;confirm(_0x5455f3(0x15f))&&(_0x5c8f92[_0x5455f3(0xf1)](),_0x280a70());});const _0x2790d7=document[_0x88952(0x105)]('add-table-placeholder');_0x2790d7&&_0x2790d7[_0x88952(0x132)](_0x88952(0x162),()=>{const _0x3a9ee3=_0x88952,_0x459e63=prompt(_0x3a9ee3(0x157),_0x3a9ee3(0xe8));_0x459e63&&_0x459e63[_0x3a9ee3(0x113)]()&&(_0x5c8f92['addTable'](_0x459e63[_0x3a9ee3(0x113)]()),_0x280a70());});const _0x2e52dd=getAllTablesContainer();_0x2e52dd&&(_0x2e52dd[_0x88952(0x132)](_0x88952(0x162),_0x47bd1b=>{const _0x1d279e=_0x88952,_0x4636ba=_0x47bd1b[_0x1d279e(0x10c)][_0x1d279e(0x166)]('button');if(!_0x4636ba)return;const _0x1342fb=parseInt(_0x4636ba[_0x1d279e(0x115)][_0x1d279e(0x12e)],0xa);if(_0x4636ba['matches'](_0x1d279e(0xfd))){if(_0x4636ba[_0x1d279e(0x146)][_0x1d279e(0xe5)](_0x1d279e(0x176)))_0x5c8f92[_0x1d279e(0xe2)](_0x1342fb);else{if(_0x4636ba[_0x1d279e(0x146)][_0x1d279e(0xe5)](_0x1d279e(0x158)))_0x5c8f92['addColumn'](_0x1342fb);}_0x280a70();}else{if(_0x4636ba[_0x1d279e(0x178)](_0x1d279e(0x123))||_0x4636ba[_0x1d279e(0x178)](_0x1d279e(0x11b))){const _0x50b5e7=_0x4636ba[_0x1d279e(0x146)]['contains'](_0x1d279e(0x169))?'up':'down';_0x5c8f92[_0x1d279e(0x124)](_0x1342fb,_0x50b5e7),_0x280a70();}else{if(_0x4636ba[_0x1d279e(0x178)](_0x1d279e(0xf5))){const _0x18d834=parseInt(_0x4636ba[_0x1d279e(0x166)]('tr')[_0x1d279e(0x115)][_0x1d279e(0xf8)],0xa);confirm('您确定要删除这一行吗？')&&(_0x5c8f92['deleteRow'](_0x1342fb,_0x18d834),_0x280a70());}else{if(_0x4636ba[_0x1d279e(0x178)]('.edit-rules-btn')||_0x4636ba['closest']('.edit-rules-btn')){const _0x116db1=_0x4636ba['closest']('.edit-rules-btn'),_0x3dbbd3=parseInt(_0x116db1[_0x1d279e(0x115)][_0x1d279e(0x12e)],0xa);openRuleEditor(_0x3dbbd3);}else{if(_0x4636ba['matches']('.delete-table-btn')){const _0x2c6d59=parseInt(_0x4636ba[_0x1d279e(0x115)][_0x1d279e(0x12e)],0xa),_0x2a8c81=_0x5c8f92[_0x1d279e(0x121)](),_0x4000f3=_0x2a8c81[_0x2c6d59]?.['name']||_0x1d279e(0x175);confirm('【最终警告】您确定要永久废黜表格\x20“['+_0x4000f3+_0x1d279e(0x131))&&(_0x5c8f92[_0x1d279e(0x15a)](_0x2c6d59),_0x280a70());}}}}}}),_0x2e52dd[_0x88952(0x132)](_0x88952(0x179),_0x40b8ab=>{const _0x23b715=_0x88952,_0x243571=_0x40b8ab[_0x23b715(0x10c)],_0xba63c9=_0x243571[_0x23b715(0x166)](_0x23b715(0x108));if(!_0xba63c9)return;const _0x2abb7e=parseInt(_0xba63c9['dataset'][_0x23b715(0x12e)],0xa),_0x58bbad=_0x243571[_0x23b715(0xe4)];if(_0x243571[_0x23b715(0xf2)]==='TD'){const _0x15be8c=parseInt(_0x243571[_0x23b715(0x166)]('tr')[_0x23b715(0x115)][_0x23b715(0xf8)],0xa),_0x4d5ef2=parseInt(_0x243571[_0x23b715(0x115)][_0x23b715(0x138)],0xa);_0x5c8f92[_0x23b715(0x129)](_0x2abb7e,_0x15be8c,_0x4d5ef2,_0x58bbad);}else{if(_0x243571['tagName']==='TH'&&!_0x243571[_0x23b715(0x146)][_0x23b715(0xe5)](_0x23b715(0x102))){const _0x5e2821=parseInt(_0x243571[_0x23b715(0x115)][_0x23b715(0x138)],0xa);_0x58bbad[_0x23b715(0x113)]()===''?confirm(_0x23b715(0x143))?(_0x5c8f92[_0x23b715(0x180)](_0x2abb7e,_0x5e2821),_0x280a70()):_0x280a70():_0x5c8f92[_0x23b715(0x11c)](_0x2abb7e,_0x5e2821,_0x58bbad);}}},!![])),_0x4b74ce[_0x88952(0x115)][_0x88952(0xe6)]=_0x88952(0xed),log(_0x88952(0x122),'success');}function bindBatchFillButton(){const _0x37829d=_0x45f9f2,_0x444fc0=document[_0x37829d(0x105)](_0x37829d(0x118));if(_0x444fc0){if(_0x444fc0[_0x37829d(0x115)][_0x37829d(0xd2)])return;_0x444fc0[_0x37829d(0x132)]('click',startBatchFilling),_0x444fc0[_0x37829d(0x115)][_0x37829d(0xd2)]=_0x37829d(0xed),log('“立即填表”按钮已成功绑定。',_0x37829d(0x116));}}function bindTemplateEditors(){const _0x58be83=_0x45f9f2,_0x537e8f=document[_0x58be83(0x105)](_0x58be83(0xf9)),_0x4ea885=document[_0x58be83(0x105)](_0x58be83(0x163)),_0x4be6a3=document[_0x58be83(0x105)](_0x58be83(0x142)),_0x3aacbb=document[_0x58be83(0x105)](_0x58be83(0x173)),_0x36cf78=document[_0x58be83(0x105)](_0x58be83(0x14c)),_0x50eb0f=document[_0x58be83(0x105)](_0x58be83(0x107));if(!_0x537e8f||!_0x3aacbb){log(_0x58be83(0xec),_0x58be83(0xea));return;}_0x537e8f[_0x58be83(0xd4)]=_0x5c8f92[_0x58be83(0x12c)](),_0x3aacbb['value']=_0x5c8f92[_0x58be83(0x109)](),_0x4ea885['addEventListener'](_0x58be83(0x162),()=>{const _0x46753f=_0x58be83;_0x5c8f92['saveBatchFillerRuleTemplate'](_0x537e8f[_0x46753f(0xd4)]),toastr[_0x46753f(0x116)](_0x46753f(0x12a)),log('批量填表-规则提示词已保存。',_0x46753f(0x116));}),_0x36cf78['addEventListener']('click',()=>{const _0x529715=_0x58be83;_0x5c8f92[_0x529715(0x17a)](_0x3aacbb[_0x529715(0xd4)]),toastr[_0x529715(0x116)](_0x529715(0xe3)),log(_0x529715(0x182),_0x529715(0x116));}),_0x4be6a3[_0x58be83(0x132)](_0x58be83(0x162),()=>{const _0xce3b6f=_0x58be83;confirm('您确定要将规则提示词恢复为默认设置吗？')&&(_0x537e8f[_0xce3b6f(0xd4)]=DEFAULT_AI_RULE_TEMPLATE,_0x5c8f92[_0xce3b6f(0x111)](_0x537e8f[_0xce3b6f(0xd4)]),toastr[_0xce3b6f(0xef)](_0xce3b6f(0x13c)),log(_0xce3b6f(0x13e),'info'));}),_0x50eb0f[_0x58be83(0x132)](_0x58be83(0x162),()=>{const _0x51fc61=_0x58be83;confirm('您确定要将流程提示词恢复为默认设置吗？')&&(_0x3aacbb[_0x51fc61(0xd4)]=DEFAULT_AI_FLOW_TEMPLATE,_0x5c8f92['saveBatchFillerFlowTemplate'](_0x3aacbb['value']),toastr[_0x51fc61(0xef)](_0x51fc61(0x15d)),log(_0x51fc61(0x117),'info'));}),log('指令模板编辑器已成功绑定。','success');}
