const _0x3ab9dc=_0x7601;(function(_0xcad50b,_0x522914){const _0x21bac7=_0x7601,_0x5d02ea=_0xcad50b();while(!![]){try{const _0x1085bd=-parseInt(_0x21bac7(0x125))/0x1*(parseInt(_0x21bac7(0x12c))/0x2)+parseInt(_0x21bac7(0x123))/0x3+-parseInt(_0x21bac7(0x119))/0x4+parseInt(_0x21bac7(0x128))/0x5*(parseInt(_0x21bac7(0x102))/0x6)+-parseInt(_0x21bac7(0x104))/0x7*(-parseInt(_0x21bac7(0x112))/0x8)+parseInt(_0x21bac7(0x10c))/0x9*(-parseInt(_0x21bac7(0x11b))/0xa)+parseInt(_0x21bac7(0x120))/0xb;if(_0x1085bd===_0x522914)break;else _0x5d02ea['push'](_0x5d02ea['shift']());}catch(_0x2a2c50){_0x5d02ea['push'](_0x5d02ea['shift']());}}}(_0x9ecb,0xbd2ae));import{createDrawer}from'./ui/drawer.js';import{registerSlashCommands}from'./core/commands.js';function _0x7601(_0x4bb0b0,_0x1641dd){const _0x9ecb6=_0x9ecb();return _0x7601=function(_0x760178,_0x109059){_0x760178=_0x760178-0x100;let _0x2ebd49=_0x9ecb6[_0x760178];return _0x2ebd49;},_0x7601(_0x4bb0b0,_0x1641dd);}import{onMessageReceived,onChatChanged}from'./core/events.js';import{eventSource,event_types}from'/script.js';import{checkForUpdates}from'./core/api.js';import{setUpdateInfo}from'./ui/state.js';import{pluginVersion,extensionName,defaultSettings}from'./utils/settings.js';import{extension_settings}from'/scripts/extensions.js';function compareVersions(_0x2d3ca6,_0x1ac2c7){const _0x30b69c=_0x7601,_0x2be24e=_0x2d3ca6[_0x30b69c(0x12a)]('.')['map'](Number),_0x224eb2=_0x1ac2c7[_0x30b69c(0x12a)]('.')[_0x30b69c(0x106)](Number),_0x498291=Math['max'](_0x2be24e[_0x30b69c(0x11d)],_0x224eb2[_0x30b69c(0x11d)]);for(let _0x2c1c65=0x0;_0x2c1c65<_0x498291;_0x2c1c65++){const _0x172dcc=_0x2be24e[_0x2c1c65]||0x0,_0x29a13c=_0x224eb2[_0x2c1c65]||0x0;if(_0x172dcc>_0x29a13c)return!![];if(_0x172dcc<_0x29a13c)return![];}return![];}async function handleUpdateCheck(){const _0x5a9f27=_0x7601;console[_0x5a9f27(0x101)](_0x5a9f27(0x105));const _0x4acec7=await checkForUpdates();if(_0x4acec7&&_0x4acec7['version']){const _0x6b27f3=compareVersions(_0x4acec7[_0x5a9f27(0x10f)],pluginVersion);_0x6b27f3?console[_0x5a9f27(0x101)]('【Amily2号-情报部】捷报！发现新版本:\x20'+_0x4acec7[_0x5a9f27(0x10f)]+_0x5a9f27(0x107)):console[_0x5a9f27(0x101)]('【Amily2号-情报部】一切安好，帝国已是最新版本。情报已转交内务府备案。'),setUpdateInfo(_0x6b27f3,_0x4acec7);}}function loadPluginStyles(){const _0x1f6b75=_0x7601,_0x4b1256=_0x26b070=>{const _0x19c85d=_0x7601,_0xd6ab47=_0x19c85d(0x114)+_0x26b070[_0x19c85d(0x12a)]('.')[0x0];if(document[_0x19c85d(0x12f)](_0xd6ab47))return;const _0x1b0de8='scripts/extensions/third-party/'+extensionName+_0x19c85d(0x113)+_0x26b070+_0x19c85d(0x10b)+Date[_0x19c85d(0x116)](),_0x7428ae=document[_0x19c85d(0x10d)](_0x19c85d(0x110));_0x7428ae['id']=_0xd6ab47,_0x7428ae['rel']=_0x19c85d(0x12d),_0x7428ae[_0x19c85d(0x131)]=_0x19c85d(0x100),_0x7428ae['href']=_0x1b0de8,document['head'][_0x19c85d(0x127)](_0x7428ae),console[_0x19c85d(0x101)](_0x19c85d(0x117)+_0x26b070);};_0x4b1256(_0x1f6b75(0x126)),_0x4b1256(_0x1f6b75(0x12b)),_0x4b1256(_0x1f6b75(0x12e));}function _0x9ecb(){const _0x5d0843=['addEventListener','14454539mkyaJY','IMPERSONATE_READY','amily2EventsRegistered','506187hbMCvz','stack','3917fkcsyE','style.css','appendChild','7359705TvoIrU','[Amily2号]\x20部署失败：等待\x20','split','historiography.css','196DkWYlt','stylesheet','hanlinyuan.css','getElementById','Amily2插件错误:\x20','type','[Amily2号-开国大典]\x20步骤四：部署帝国哨兵网络...','text/css','log','6ZrVEWa','assign','455WpJdJS','【Amily2号】帝国已就绪，现派遣外交官，为陛下探查外界新情报...','map','。情报已转交内务府。','[Amily2号-开国大典]\x20步骤一：为宫殿披上华服...','error','【Amily2号】帝国秩序已完美建立。Amily2号的府邸已恭候陛下的莅临。','?v=','12392289auSahw','createElement','#sys-settings-button','version','link','[Amily2号-开国大典]\x20步骤三：开始召唤府邸...','28136noRChI','/assets/','amily2-style-','ST-Amily2-Chat-Optimisation','now','[Amily2号-皇家制衣局]\x20已为帝国披上华服:\x20','[Amily2号-帝国枢密院]\x20SillyTavern宫殿主体已确认，开国大典正式开始！','2590828iQFUEH','未知错误','10EkXnfK','严重错误','length','[Amily2-全局卫队]\x20捕获到严重错误:'];_0x9ecb=function(){return _0x5d0843;};return _0x9ecb();}window[_0x3ab9dc(0x11f)](_0x3ab9dc(0x109),_0xba75ec=>{const _0x20d01a=_0x3ab9dc,_0x101839=_0xba75ec[_0x20d01a(0x109)]?.[_0x20d01a(0x124)]||'';_0x101839['includes'](_0x20d01a(0x115))&&(console['error'](_0x20d01a(0x11e),_0xba75ec[_0x20d01a(0x109)]),toastr[_0x20d01a(0x109)](_0x20d01a(0x130)+(_0xba75ec[_0x20d01a(0x109)]?.['message']||_0x20d01a(0x11a)),_0x20d01a(0x11c),{'timeOut':0x2710}));}),jQuery(async()=>{const _0x3fac4c=_0x3ab9dc;console[_0x3fac4c(0x101)]('[Amily2号-帝国枢密院]\x20开始执行开国大典...');!extension_settings[extensionName]&&(extension_settings[extensionName]={});Object[_0x3fac4c(0x103)](extension_settings[extensionName],{...defaultSettings,...extension_settings[extensionName]}),console[_0x3fac4c(0x101)]('[Amily2号-帝国枢密院]\x20帝国基本法已确认，档案室已与国库对接完毕。');let _0xc17631=0x0;const _0xb2c27f=0x64,_0x4fce08=0x64,_0xb95261=_0x3fac4c(0x10e),_0xece02c=setInterval(async()=>{const _0x1ef985=_0x3fac4c;if($(_0xb95261)[_0x1ef985(0x11d)]>0x0){clearInterval(_0xece02c),console['log'](_0x1ef985(0x118));try{console[_0x1ef985(0x101)](_0x1ef985(0x108)),loadPluginStyles(),console['log']('[Amily2号-开国大典]\x20步骤二：皇家仪仗队就位...'),await registerSlashCommands(),console[_0x1ef985(0x101)](_0x1ef985(0x111)),createDrawer(),console['log'](_0x1ef985(0x132)),!window['amily2EventsRegistered']&&(eventSource['on'](event_types['MESSAGE_RECEIVED'],onMessageReceived),eventSource['on'](event_types[_0x1ef985(0x121)],onMessageReceived),eventSource['on'](event_types['CHAT_CHANGED'],onChatChanged),window[_0x1ef985(0x122)]=!![]),console[_0x1ef985(0x101)](_0x1ef985(0x10a)),handleUpdateCheck();}catch(_0x215be3){console[_0x1ef985(0x109)]('!!!【开国大典失败】在执行系列法令时发生严重错误:',_0x215be3);}}else _0xc17631++,_0xc17631>=_0xb2c27f&&(clearInterval(_0xece02c),console[_0x1ef985(0x109)](_0x1ef985(0x129)+_0xb95261+'\x20超时。'));},_0x4fce08);});
